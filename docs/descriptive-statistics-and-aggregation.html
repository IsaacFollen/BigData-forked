<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Descriptive Statistics and Aggregation | Big Data Analytics</title>
  <meta name="description" content="A guide to practical big data analytics in R." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Descriptive Statistics and Aggregation | Big Data Analytics" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://umatter.github.io/BigData" />
  <meta property="og:image" content="https://umatter.github.io/BigDataimg/cover.png" />
  <meta property="og:description" content="A guide to practical big data analytics in R." />
  <meta name="github-repo" content="umatter/BigData" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Descriptive Statistics and Aggregation | Big Data Analytics" />
  
  <meta name="twitter:description" content="A guide to practical big data analytics in R." />
  <meta name="twitter:image" content="https://umatter.github.io/BigDataimg/cover.png" />

<meta name="author" content="Ulrich Matter" />


<meta name="date" content="2022-02-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="big-data-cleaning-and-transformation.html"/>
<link rel="next" href="big-data-visualization.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<script src="libs/d3/d3.min.js"></script>
<link href="libs/profvis/profvis.css" rel="stylesheet" />
<script src="libs/profvis/profvis.js"></script>
<script src="libs/profvis/scroll.js"></script>
<link href="libs/highlight/textmate.css" rel="stylesheet" />
<script src="libs/highlight/highlight.js"></script>
<script src="libs/profvis-binding/profvis.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Big Data Analytics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-big-in-big-data"><i class="fa fa-check"></i><b>1.1</b> What is <em>big</em> in “Big Data?”</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#approaches-to-analyzing-big-data"><i class="fa fa-check"></i><b>1.2</b> Approaches to analyzing Big Data</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#content-overview"><i class="fa fa-check"></i><b>1.3</b> Content overview</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#prerequisits"><i class="fa fa-check"></i><b>1.4</b> Prerequisits</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="big-data-econometrics.html"><a href="big-data-econometrics.html"><i class="fa fa-check"></i><b>2</b> Big Data Econometrics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="big-data-econometrics.html"><a href="big-data-econometrics.html#a-practical-big-p-problem"><i class="fa fa-check"></i><b>2.1</b> A practical <em>big P</em> problem</a></li>
<li class="chapter" data-level="2.2" data-path="big-data-econometrics.html"><a href="big-data-econometrics.html#a-practical-big-n-problem"><i class="fa fa-check"></i><b>2.2</b> A practical <em>big N</em> problem</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="big-data-econometrics.html"><a href="big-data-econometrics.html#ols-as-a-point-of-reference"><i class="fa fa-check"></i><b>2.2.1</b> OLS as a point of reference</a></li>
<li class="chapter" data-level="2.2.2" data-path="big-data-econometrics.html"><a href="big-data-econometrics.html#the-uluru-algorithm-as-an-alternative-to-ols"><i class="fa fa-check"></i><b>2.2.2</b> The Uluru algorithm as an alternative to OLS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html"><i class="fa fa-check"></i><b>3</b> Software: Programming with (Big) Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#domains-of-programming-with-big-data"><i class="fa fa-check"></i><b>3.1</b> Domains of programming with (big) data</a></li>
<li class="chapter" data-level="3.2" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#measuring-r-performance"><i class="fa fa-check"></i><b>3.2</b> Measuring R performance</a></li>
<li class="chapter" data-level="3.3" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#writing-efficient-r-code"><i class="fa fa-check"></i><b>3.3</b> Writing efficient R code</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#memory-allocation-and-growing-objects"><i class="fa fa-check"></i><b>3.3.1</b> Memory allocation and growing objects</a></li>
<li class="chapter" data-level="3.3.2" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#vectorization-in-basic-r-functions"><i class="fa fa-check"></i><b>3.3.2</b> Vectorization in basic R functions</a></li>
<li class="chapter" data-level="3.3.3" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#apply-type-functions-and-vectorization"><i class="fa fa-check"></i><b>3.3.3</b> <code>apply</code>-type functions and vectorization</a></li>
<li class="chapter" data-level="3.3.4" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#avoid-unnecessary-copying"><i class="fa fa-check"></i><b>3.3.4</b> Avoid unnecessary copying</a></li>
<li class="chapter" data-level="3.3.5" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#releasing-memory"><i class="fa fa-check"></i><b>3.3.5</b> Releasing memory</a></li>
<li class="chapter" data-level="3.3.6" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#beyond-r"><i class="fa fa-check"></i><b>3.3.6</b> Beyond R</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#sql-basics"><i class="fa fa-check"></i><b>3.4</b> SQL basics</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#first-steps-in-sqlite"><i class="fa fa-check"></i><b>3.4.1</b> First steps in SQL(ite)</a></li>
<li class="chapter" data-level="3.4.2" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#joins"><i class="fa fa-check"></i><b>3.4.2</b> Joins</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html"><i class="fa fa-check"></i><b>4</b> Hardware: Computing Resources</a>
<ul>
<li class="chapter" data-level="4.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#components-of-a-standard-computing-environment"><i class="fa fa-check"></i><b>4.1</b> Components of a standard computing environment</a></li>
<li class="chapter" data-level="4.2" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#mass-storage"><i class="fa fa-check"></i><b>4.2</b> Mass storage</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#avoid-redundancies"><i class="fa fa-check"></i><b>4.2.1</b> Avoid redundancies</a></li>
<li class="chapter" data-level="4.2.2" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#data-compression"><i class="fa fa-check"></i><b>4.2.2</b> Data compression</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#random-access-memory-ram"><i class="fa fa-check"></i><b>4.3</b> Random access memory (RAM)</a></li>
<li class="chapter" data-level="4.4" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#combining-ram-and-hard-disk-virtual-memory"><i class="fa fa-check"></i><b>4.4</b> Combining RAM and hard-disk: virtual memory</a></li>
<li class="chapter" data-level="4.5" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#cpu-and-parallelization"><i class="fa fa-check"></i><b>4.5</b> CPU and parallelization</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#naive-multi-session-approach"><i class="fa fa-check"></i><b>4.5.1</b> Naive multi-session approach</a></li>
<li class="chapter" data-level="4.5.2" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#multi-core-and-multi-node-approach"><i class="fa fa-check"></i><b>4.5.2</b> Multi-core and multi-node approach</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#gpus-for-scientific-computing"><i class="fa fa-check"></i><b>4.6</b> GPUs for scientific computing</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#gpus-in-r"><i class="fa fa-check"></i><b>4.6.1</b> GPUs in R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="distributed-systems.html"><a href="distributed-systems.html"><i class="fa fa-check"></i><b>5</b> Distributed Systems</a>
<ul>
<li class="chapter" data-level="5.1" data-path="distributed-systems.html"><a href="distributed-systems.html#mapreduce"><i class="fa fa-check"></i><b>5.1</b> MapReduce</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="distributed-systems.html"><a href="distributed-systems.html#mapreduce-concept-illustrated-in-r"><i class="fa fa-check"></i><b>5.1.1</b> Map/Reduce Concept Illustrated in R</a></li>
<li class="chapter" data-level="5.1.2" data-path="distributed-systems.html"><a href="distributed-systems.html#mapper"><i class="fa fa-check"></i><b>5.1.2</b> Mapper</a></li>
<li class="chapter" data-level="5.1.3" data-path="distributed-systems.html"><a href="distributed-systems.html#reducer"><i class="fa fa-check"></i><b>5.1.3</b> Reducer</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="distributed-systems.html"><a href="distributed-systems.html#hadoop"><i class="fa fa-check"></i><b>5.2</b> Hadoop</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="distributed-systems.html"><a href="distributed-systems.html#hadoop-word-count-example"><i class="fa fa-check"></i><b>5.2.1</b> Hadoop word count example</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="distributed-systems.html"><a href="distributed-systems.html#spark"><i class="fa fa-check"></i><b>5.3</b> Spark</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="distributed-systems.html"><a href="distributed-systems.html#spark-with-r"><i class="fa fa-check"></i><b>5.3.1</b> Spark with R</a></li>
<li class="chapter" data-level="5.3.2" data-path="distributed-systems.html"><a href="distributed-systems.html#data-import-and-summary-statistics"><i class="fa fa-check"></i><b>5.3.2</b> Data import and summary statistics</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="distributed-systems.html"><a href="distributed-systems.html#spark-with-sql"><i class="fa fa-check"></i><b>5.4</b> Spark with SQL</a></li>
<li class="chapter" data-level="5.5" data-path="distributed-systems.html"><a href="distributed-systems.html#spark-with-r-sql"><i class="fa fa-check"></i><b>5.5</b> Spark with R + SQL</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="cloud-computing.html"><a href="cloud-computing.html"><i class="fa fa-check"></i><b>6</b> Cloud Computing</a>
<ul>
<li class="chapter" data-level="6.1" data-path="cloud-computing.html"><a href="cloud-computing.html#scaling-up-with-aws-ec2-and-rrstudio"><i class="fa fa-check"></i><b>6.1</b> Scaling up with AWS EC2 and R/RStudio</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="cloud-computing.html"><a href="cloud-computing.html#parallelization-with-an-ec2-instance"><i class="fa fa-check"></i><b>6.1.1</b> Parallelization with an EC2 instance</a></li>
<li class="chapter" data-level="6.1.2" data-path="cloud-computing.html"><a href="cloud-computing.html#gpus-on-google-colab"><i class="fa fa-check"></i><b>6.1.2</b> GPUs on Google Colab</a></li>
<li class="chapter" data-level="6.1.3" data-path="cloud-computing.html"><a href="cloud-computing.html#aws-emr-mapreduce-in-the-cloud"><i class="fa fa-check"></i><b>6.1.3</b> AWS EMR: MapReduce in the cloud</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html"><i class="fa fa-check"></i><b>7</b> Data Collection and Data Storage</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#gathering-and-compilation-of-raw-data"><i class="fa fa-check"></i><b>7.1</b> Gathering and compilation of raw data</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#nyc-taxi-data"><i class="fa fa-check"></i><b>7.1.1</b> NYC taxi data</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#data-import-and-memory-allocation"><i class="fa fa-check"></i><b>7.2</b> Data import and memory allocation</a></li>
<li class="chapter" data-level="7.3" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#big-data-storage"><i class="fa fa-check"></i><b>7.3</b> (Big) Data Storage</a></li>
<li class="chapter" data-level="7.4" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#rdbms-basics"><i class="fa fa-check"></i><b>7.4</b> RDBMS basics</a></li>
<li class="chapter" data-level="7.5" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#row-based-vs-column-based-databases"><i class="fa fa-check"></i><b>7.5</b> Row-based vs column-based databases</a></li>
<li class="chapter" data-level="7.6" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#getting-started-with-rsqlite"><i class="fa fa-check"></i><b>7.6</b> Getting started with RSQLite</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#warm-up-in-sqlite-indices-and-joins"><i class="fa fa-check"></i><b>7.6.1</b> Warm up in SQLite: indices and joins</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#sqlite-from-within-r"><i class="fa fa-check"></i><b>7.7</b> SQLite from within R</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#creating-a-new-database-with-rsqlite"><i class="fa fa-check"></i><b>7.7.1</b> Creating a new database with <code>RSQLite</code></a></li>
<li class="chapter" data-level="7.7.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#importing-data"><i class="fa fa-check"></i><b>7.7.2</b> Importing data</a></li>
<li class="chapter" data-level="7.7.3" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#issue-queries"><i class="fa fa-check"></i><b>7.7.3</b> Issue queries</a></li>
<li class="chapter" data-level="7.7.4" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#mass-storage-mariadb-on-an-ec2-instance"><i class="fa fa-check"></i><b>7.7.4</b> Mass Storage: MariaDB on an EC2 instance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html"><i class="fa fa-check"></i><b>8</b> Big Data Cleaning and Transformation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#out-of-memory-strategies"><i class="fa fa-check"></i><b>8.1</b> ‘Out-of-memory’ strategies</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#chunking-data-with-the-ff-package"><i class="fa fa-check"></i><b>8.1.1</b> Chunking data with the <code>ff</code>-package</a></li>
<li class="chapter" data-level="8.1.2" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#memory-mapping-with-bigmemory"><i class="fa fa-check"></i><b>8.1.2</b> Memory mapping with <code>bigmemory</code></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#typical-cleaning-tasks"><i class="fa fa-check"></i><b>8.2</b> Typical cleaning tasks</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#data-preparation-with-ff"><i class="fa fa-check"></i><b>8.2.1</b> Data Preparation with <code>ff</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html"><i class="fa fa-check"></i><b>9</b> Descriptive Statistics and Aggregation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#data-aggregation-the-split-apply-combine-strategy"><i class="fa fa-check"></i><b>9.1</b> Data aggregation: The ‘split-apply-combine’ strategy</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#data-aggregation-with-chunked-data-files"><i class="fa fa-check"></i><b>9.1.1</b> Data aggregation with chunked data files</a></li>
<li class="chapter" data-level="9.1.2" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#high-speed-in-memory-data-aggregation-with-data.table"><i class="fa fa-check"></i><b>9.1.2</b> High-speed in-memory data aggregation with <code>data.table</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="big-data-visualization.html"><a href="big-data-visualization.html"><i class="fa fa-check"></i><b>10</b> (Big) Data Visualization</a>
<ul>
<li class="chapter" data-level="10.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#data-set"><i class="fa fa-check"></i><b>10.1</b> Data Set</a></li>
<li class="chapter" data-level="10.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#excursus-modify-and-create-themes"><i class="fa fa-check"></i><b>10.2</b> Excursus: modify and create themes</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#create-your-own-theme-simple-approach"><i class="fa fa-check"></i><b>10.2.1</b> Create your own theme: simple approach</a></li>
<li class="chapter" data-level="10.2.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#implementing-actual-themes-as-functions."><i class="fa fa-check"></i><b>10.2.2</b> Implementing actual themes as functions.</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="big-data-visualization.html"><a href="big-data-visualization.html#visualize-time-and-space"><i class="fa fa-check"></i><b>10.3</b> Visualize Time and Space</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#preparations"><i class="fa fa-check"></i><b>10.3.1</b> Preparations</a></li>
<li class="chapter" data-level="10.3.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#pick-up-and-drop-off-locations"><i class="fa fa-check"></i><b>10.3.2</b> Pick-up and drop-off locations</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="big-data-visualization.html"><a href="big-data-visualization.html#excursus-change-color-schemes"><i class="fa fa-check"></i><b>10.4</b> Excursus: change color schemes</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html"><i class="fa fa-check"></i><b>11</b> Bottle Necks in Local Big Data Analytics</a>
<ul>
<li class="chapter" data-level="11.1" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#example-of-computation-time-and-memory-allocation"><i class="fa fa-check"></i><b>11.1</b> Example of Computation Time and Memory Allocation</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#preparation"><i class="fa fa-check"></i><b>11.1.1</b> Preparation</a></li>
<li class="chapter" data-level="11.1.2" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#naïve-approach-ignorant-of-r"><i class="fa fa-check"></i><b>11.1.2</b> Naïve Approach (ignorant of R)</a></li>
<li class="chapter" data-level="11.1.3" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#improvement-1-pre-allocation-of-memory"><i class="fa fa-check"></i><b>11.1.3</b> Improvement 1: Pre-allocation of memory</a></li>
<li class="chapter" data-level="11.1.4" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#improvement-2-exploit-vectorization"><i class="fa fa-check"></i><b>11.1.4</b> Improvement 2: Exploit vectorization</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#case-study-parallel-processing"><i class="fa fa-check"></i><b>11.2</b> Case study: Parallel processing</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#parallelization-with-an-ec2-instance-1"><i class="fa fa-check"></i><b>11.2.1</b> Parallelization with an EC2 instance</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#case-study-memory-allocation"><i class="fa fa-check"></i><b>11.3</b> Case study: Memory allocation</a></li>
<li class="chapter" data-level="11.4" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#gpus-and-machine-learning"><i class="fa fa-check"></i><b>11.4</b> GPUs and Machine Learning</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#tensorflowkeras-example-predict-housing-prices"><i class="fa fa-check"></i><b>11.4.1</b> Tensorflow/Keras example: predict housing prices</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#a-word-of-caution"><i class="fa fa-check"></i><b>11.5</b> A word of caution</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="applied-econometrics-with-spark.html"><a href="applied-econometrics-with-spark.html"><i class="fa fa-check"></i><b>12</b> Applied Econometrics with Spark</a>
<ul>
<li class="chapter" data-level="12.1" data-path="applied-econometrics-with-spark.html"><a href="applied-econometrics-with-spark.html#regression-analysis-with-sparklyr"><i class="fa fa-check"></i><b>12.1</b> Regression analysis with <code>sparklyr</code></a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-a.html"><a href="appendix-a.html"><i class="fa fa-check"></i><b>A</b> Appendix A</a>
<ul>
<li class="chapter" data-level="A.1" data-path="appendix-a.html"><a href="appendix-a.html#github"><i class="fa fa-check"></i><b>A.1</b> GitHub</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="appendix-a.html"><a href="appendix-a.html#initiate-a-new-repository"><i class="fa fa-check"></i><b>A.1.1</b> Initiate a new repository</a></li>
<li class="chapter" data-level="A.1.2" data-path="appendix-a.html"><a href="appendix-a.html#clone-this-courses-repository"><i class="fa fa-check"></i><b>A.1.2</b> Clone this course’s repository</a></li>
<li class="chapter" data-level="A.1.3" data-path="appendix-a.html"><a href="appendix-a.html#fork-this-courses-repository"><i class="fa fa-check"></i><b>A.1.3</b> Fork this course’s repository</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="appendix-b.html"><a href="appendix-b.html"><i class="fa fa-check"></i><b>B</b> Appendix B</a>
<ul>
<li class="chapter" data-level="B.0.1" data-path="appendix-b.html"><a href="appendix-b.html#data-types-and-memorystorage"><i class="fa fa-check"></i><b>B.0.1</b> Data types and memory/storage</a></li>
<li class="chapter" data-level="B.0.2" data-path="appendix-b.html"><a href="appendix-b.html#data-structures"><i class="fa fa-check"></i><b>B.0.2</b> Data structures</a></li>
<li class="chapter" data-level="B.0.3" data-path="appendix-b.html"><a href="appendix-b.html#vectors-vs-factors-in-r"><i class="fa fa-check"></i><b>B.0.3</b> Vectors vs Factors in R</a></li>
<li class="chapter" data-level="B.0.4" data-path="appendix-b.html"><a href="appendix-b.html#r-tools-to-investigate-structures-and-types"><i class="fa fa-check"></i><b>B.0.4</b> R-tools to investigate structures and types</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="appendix-c.html"><a href="appendix-c.html"><i class="fa fa-check"></i><b>C</b> Appendix C</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://umatter.github.io" target="blank">umatter.github.io</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Big Data Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="descriptive-statistics-and-aggregation" class="section level1" number="9">
<h1><span class="header-section-number">Chapter 9</span> Descriptive Statistics and Aggregation</h1>
<div id="data-aggregation-the-split-apply-combine-strategy" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Data aggregation: The ‘split-apply-combine’ strategy</h2>
<p>The ‘split-apply-combine’ strategy plays an important role in many data analysis tasks, ranging from data preparation to summary statistics and model-fitting.<a href="#fn37" class="footnote-ref" id="fnref37"><sup>37</sup></a> The strategy can be defined as “break up a problem into manageable pieces, operate on each piece independently and then put all the pieces back together.” <span class="citation">(<a href="references.html#ref-wickham_2011" role="doc-biblioref">Wickham 2011, 1</a>)</span></p>
<p>Many R users are familiar with the basic concept of split-apply-combine implemented in the <code>plyr</code>-package intended for the usual in-memory operations (data set fits into RAM). Here, we explore the options for split-apply-combine approaches to large data sets that do not fit into RAM.</p>
<div id="data-aggregation-with-chunked-data-files" class="section level3" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Data aggregation with chunked data files</h3>
<p>In this tutorial we explore the world of New York’s famous Yellow Caps. In in a first step, we will focus on the <code>ff</code>-based approach to employ parts of the hard disk as ‘virtual memory.’ This means, all of the examples are easily scalable without risking too much memory pressure. Given the size of the entire TLC database (over 200GB), we will only use one million taxi trips records of January 2009.<a href="#fn38" class="footnote-ref" id="fnref38"><sup>38</sup></a></p>
<div id="data-import-2" class="section level4" number="9.1.1.1">
<h4><span class="header-section-number">9.1.1.1</span> Data import</h4>
<p>First, we read the raw taxi trips records into R with the <code>ff</code>-package.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="descriptive-statistics-and-aggregation.html#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb318-2"><a href="descriptive-statistics-and-aggregation.html#cb318-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ff)</span>
<span id="cb318-3"><a href="descriptive-statistics-and-aggregation.html#cb318-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ffbase)</span>
<span id="cb318-4"><a href="descriptive-statistics-and-aggregation.html#cb318-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-5"><a href="descriptive-statistics-and-aggregation.html#cb318-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set up the ff directory (for data file chunks)</span></span>
<span id="cb318-6"><a href="descriptive-statistics-and-aggregation.html#cb318-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">&quot;fftaxi&quot;</span>)){</span>
<span id="cb318-7"><a href="descriptive-statistics-and-aggregation.html#cb318-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">system</span>(<span class="st">&quot;mkdir fftaxi&quot;</span>)</span>
<span id="cb318-8"><a href="descriptive-statistics-and-aggregation.html#cb318-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb318-9"><a href="descriptive-statistics-and-aggregation.html#cb318-9" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">fftempdir =</span> <span class="st">&quot;fftaxi&quot;</span>)</span>
<span id="cb318-10"><a href="descriptive-statistics-and-aggregation.html#cb318-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-11"><a href="descriptive-statistics-and-aggregation.html#cb318-11" aria-hidden="true" tabindex="-1"></a><span class="co"># import a few lines of the data, setting the column classes explicitly</span></span>
<span id="cb318-12"><a href="descriptive-statistics-and-aggregation.html#cb318-12" aria-hidden="true" tabindex="-1"></a>col_classes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">V1 =</span> <span class="st">&quot;factor&quot;</span>,</span>
<span id="cb318-13"><a href="descriptive-statistics-and-aggregation.html#cb318-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V2 =</span> <span class="st">&quot;POSIXct&quot;</span>,</span>
<span id="cb318-14"><a href="descriptive-statistics-and-aggregation.html#cb318-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V3 =</span> <span class="st">&quot;POSIXct&quot;</span>,</span>
<span id="cb318-15"><a href="descriptive-statistics-and-aggregation.html#cb318-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V4 =</span> <span class="st">&quot;integer&quot;</span>,</span>
<span id="cb318-16"><a href="descriptive-statistics-and-aggregation.html#cb318-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V5 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb318-17"><a href="descriptive-statistics-and-aggregation.html#cb318-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V6 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb318-18"><a href="descriptive-statistics-and-aggregation.html#cb318-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V7 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb318-19"><a href="descriptive-statistics-and-aggregation.html#cb318-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V8 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb318-20"><a href="descriptive-statistics-and-aggregation.html#cb318-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V9 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb318-21"><a href="descriptive-statistics-and-aggregation.html#cb318-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V10 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb318-22"><a href="descriptive-statistics-and-aggregation.html#cb318-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V11 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb318-23"><a href="descriptive-statistics-and-aggregation.html#cb318-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V12 =</span> <span class="st">&quot;factor&quot;</span>,</span>
<span id="cb318-24"><a href="descriptive-statistics-and-aggregation.html#cb318-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V13 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb318-25"><a href="descriptive-statistics-and-aggregation.html#cb318-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V14 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb318-26"><a href="descriptive-statistics-and-aggregation.html#cb318-26" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V15 =</span> <span class="st">&quot;factor&quot;</span>,</span>
<span id="cb318-27"><a href="descriptive-statistics-and-aggregation.html#cb318-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V16 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb318-28"><a href="descriptive-statistics-and-aggregation.html#cb318-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V17 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb318-29"><a href="descriptive-statistics-and-aggregation.html#cb318-29" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V18 =</span> <span class="st">&quot;numeric&quot;</span>)</span>
<span id="cb318-30"><a href="descriptive-statistics-and-aggregation.html#cb318-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-31"><a href="descriptive-statistics-and-aggregation.html#cb318-31" aria-hidden="true" tabindex="-1"></a><span class="co"># import the first one million observations</span></span>
<span id="cb318-32"><a href="descriptive-statistics-and-aggregation.html#cb318-32" aria-hidden="true" tabindex="-1"></a>taxi <span class="ot">&lt;-</span> <span class="fu">read.table.ffdf</span>(<span class="at">file =</span> <span class="st">&quot;data/tlc_trips.csv&quot;</span>,</span>
<span id="cb318-33"><a href="descriptive-statistics-and-aggregation.html#cb318-33" aria-hidden="true" tabindex="-1"></a>                        <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb318-34"><a href="descriptive-statistics-and-aggregation.html#cb318-34" aria-hidden="true" tabindex="-1"></a>                        <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb318-35"><a href="descriptive-statistics-and-aggregation.html#cb318-35" aria-hidden="true" tabindex="-1"></a>                        <span class="at">next.rows =</span> <span class="dv">100000</span>,</span>
<span id="cb318-36"><a href="descriptive-statistics-and-aggregation.html#cb318-36" aria-hidden="true" tabindex="-1"></a>                        <span class="at">colClasses=</span> col_classes,</span>
<span id="cb318-37"><a href="descriptive-statistics-and-aggregation.html#cb318-37" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nrows =</span> <span class="dv">1000000</span></span>
<span id="cb318-38"><a href="descriptive-statistics-and-aggregation.html#cb318-38" aria-hidden="true" tabindex="-1"></a>                        )</span></code></pre></div>
<p>Following the data documentation provided by TLC, we give the columns of our data set more meaningful names and remove the empty columns (some covariates are only collected in later years).</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="descriptive-statistics-and-aggregation.html#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first, we remove the empty vars V8 and V9</span></span>
<span id="cb319-2"><a href="descriptive-statistics-and-aggregation.html#cb319-2" aria-hidden="true" tabindex="-1"></a>taxi<span class="sc">$</span>V8 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb319-3"><a href="descriptive-statistics-and-aggregation.html#cb319-3" aria-hidden="true" tabindex="-1"></a>taxi<span class="sc">$</span>V9 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb319-4"><a href="descriptive-statistics-and-aggregation.html#cb319-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-5"><a href="descriptive-statistics-and-aggregation.html#cb319-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-6"><a href="descriptive-statistics-and-aggregation.html#cb319-6" aria-hidden="true" tabindex="-1"></a><span class="co"># set covariate names according to the data dictionary</span></span>
<span id="cb319-7"><a href="descriptive-statistics-and-aggregation.html#cb319-7" aria-hidden="true" tabindex="-1"></a><span class="co"># see https://www1.nyc.gov/assets/tlc/downloads/pdf/data_dictionary_trip_records_yellow.pdf</span></span>
<span id="cb319-8"><a href="descriptive-statistics-and-aggregation.html#cb319-8" aria-hidden="true" tabindex="-1"></a><span class="co"># note instead of taxizonne ids, long/lat are provided</span></span>
<span id="cb319-9"><a href="descriptive-statistics-and-aggregation.html#cb319-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-10"><a href="descriptive-statistics-and-aggregation.html#cb319-10" aria-hidden="true" tabindex="-1"></a>varnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;vendor_id&quot;</span>,</span>
<span id="cb319-11"><a href="descriptive-statistics-and-aggregation.html#cb319-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;pickup_time&quot;</span>,</span>
<span id="cb319-12"><a href="descriptive-statistics-and-aggregation.html#cb319-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;dropoff_time&quot;</span>,</span>
<span id="cb319-13"><a href="descriptive-statistics-and-aggregation.html#cb319-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;passenger_count&quot;</span>,</span>
<span id="cb319-14"><a href="descriptive-statistics-and-aggregation.html#cb319-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;trip_distance&quot;</span>,</span>
<span id="cb319-15"><a href="descriptive-statistics-and-aggregation.html#cb319-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;start_lat&quot;</span>,</span>
<span id="cb319-16"><a href="descriptive-statistics-and-aggregation.html#cb319-16" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;start_long&quot;</span>,</span>
<span id="cb319-17"><a href="descriptive-statistics-and-aggregation.html#cb319-17" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;dest_lat&quot;</span>,</span>
<span id="cb319-18"><a href="descriptive-statistics-and-aggregation.html#cb319-18" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;dest_long&quot;</span>,</span>
<span id="cb319-19"><a href="descriptive-statistics-and-aggregation.html#cb319-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;payment_type&quot;</span>,</span>
<span id="cb319-20"><a href="descriptive-statistics-and-aggregation.html#cb319-20" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;fare_amount&quot;</span>,</span>
<span id="cb319-21"><a href="descriptive-statistics-and-aggregation.html#cb319-21" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;extra&quot;</span>,</span>
<span id="cb319-22"><a href="descriptive-statistics-and-aggregation.html#cb319-22" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;mta_tax&quot;</span>,</span>
<span id="cb319-23"><a href="descriptive-statistics-and-aggregation.html#cb319-23" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;tip_amount&quot;</span>,</span>
<span id="cb319-24"><a href="descriptive-statistics-and-aggregation.html#cb319-24" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;tolls_amount&quot;</span>,</span>
<span id="cb319-25"><a href="descriptive-statistics-and-aggregation.html#cb319-25" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;total_amount&quot;</span>)</span>
<span id="cb319-26"><a href="descriptive-statistics-and-aggregation.html#cb319-26" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(taxi) <span class="ot">&lt;-</span> varnames</span></code></pre></div>
<p>When inspecting the factor variables of the data set, we notice that some of the values are not standardized/normalized and the resulting factor levels are, therefore, somewhat ambiguous. We better clean this before getting into data aggregation tasks. Note the <code>ff</code>-specific syntax needed to recode the factor.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="descriptive-statistics-and-aggregation.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect the factor levels</span></span>
<span id="cb320-2"><a href="descriptive-statistics-and-aggregation.html#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(taxi<span class="sc">$</span>payment_type)</span></code></pre></div>
<pre><code>## [1] &quot;Cash&quot;      &quot;CASH&quot;      &quot;Credit&quot;    &quot;CREDIT&quot;   
## [5] &quot;Dispute&quot;   &quot;No Charge&quot;</code></pre>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="descriptive-statistics-and-aggregation.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recode them</span></span>
<span id="cb322-2"><a href="descriptive-statistics-and-aggregation.html#cb322-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(taxi<span class="sc">$</span>payment_type) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">levels</span>(taxi<span class="sc">$</span>payment_type))</span>
<span id="cb322-3"><a href="descriptive-statistics-and-aggregation.html#cb322-3" aria-hidden="true" tabindex="-1"></a>taxi<span class="sc">$</span>payment_type <span class="ot">&lt;-</span> <span class="fu">ff</span>(taxi<span class="sc">$</span>payment_type,</span>
<span id="cb322-4"><a href="descriptive-statistics-and-aggregation.html#cb322-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">levels</span>(taxi<span class="sc">$</span>payment_type)),</span>
<span id="cb322-5"><a href="descriptive-statistics-and-aggregation.html#cb322-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ramclass =</span> <span class="st">&quot;factor&quot;</span>)</span>
<span id="cb322-6"><a href="descriptive-statistics-and-aggregation.html#cb322-6" aria-hidden="true" tabindex="-1"></a><span class="co"># check result</span></span>
<span id="cb322-7"><a href="descriptive-statistics-and-aggregation.html#cb322-7" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(taxi<span class="sc">$</span>payment_type)</span></code></pre></div>
<pre><code>## [1] &quot;cash&quot;      &quot;credit&quot;    &quot;dispute&quot;   &quot;no charge&quot;</code></pre>
</div>
<div id="aggregation-with-split-apply-combine" class="section level4" number="9.1.1.2">
<h4><span class="header-section-number">9.1.1.2</span> Aggregation with split-apply-combine</h4>
<p>First, we have a look at whether trips paid with credit card tend to involve lower tip amounts than trips paid by cash. In order to do so, we create a table that shows the average amount of tip paid for each payment-type category.</p>
<p>In simple words, this means we first split the data set into subsets, each of which containing all observations belonging to a distinct payment type. Then, we compute the arithmetic mean of the tip-column of each of these subsets. Finally, we combine all of these results in one table (i.e., the split-apply-combine strategy). When working with <code>ff</code>, the <code>ffdfply()</code>-function provides a user-friendly implementation of split-apply-combine type of tasks.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="descriptive-statistics-and-aggregation.html#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb324-2"><a href="descriptive-statistics-and-aggregation.html#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doBy)</span>
<span id="cb324-3"><a href="descriptive-statistics-and-aggregation.html#cb324-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-4"><a href="descriptive-statistics-and-aggregation.html#cb324-4" aria-hidden="true" tabindex="-1"></a><span class="co"># split-apply-combine procedure on data file chunks</span></span>
<span id="cb324-5"><a href="descriptive-statistics-and-aggregation.html#cb324-5" aria-hidden="true" tabindex="-1"></a>tip_pcategory <span class="ot">&lt;-</span> <span class="fu">ffdfdply</span>(taxi,</span>
<span id="cb324-6"><a href="descriptive-statistics-and-aggregation.html#cb324-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">split =</span> taxi<span class="sc">$</span>payment_type,</span>
<span id="cb324-7"><a href="descriptive-statistics-and-aggregation.html#cb324-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">BATCHBYTES =</span> <span class="dv">100000000</span>,</span>
<span id="cb324-8"><a href="descriptive-statistics-and-aggregation.html#cb324-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb324-9"><a href="descriptive-statistics-and-aggregation.html#cb324-9" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">summaryBy</span>(tip_amount<span class="sc">~</span>payment_type,</span>
<span id="cb324-10"><a href="descriptive-statistics-and-aggregation.html#cb324-10" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">data =</span> x,</span>
<span id="cb324-11"><a href="descriptive-statistics-and-aggregation.html#cb324-11" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">FUN =</span> mean,</span>
<span id="cb324-12"><a href="descriptive-statistics-and-aggregation.html#cb324-12" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">na.rm =</span> <span class="cn">TRUE</span>)})</span></code></pre></div>
<pre><code>## 2022-02-25 23:36:28, calculating split sizes</code></pre>
<pre><code>## 2022-02-25 23:36:28, building up split locations</code></pre>
<pre><code>## 2022-02-25 23:36:29, working on split 1/2, extracting data in RAM of 1 split elements, totalling, 0.0815 GB, while max specified data specified using BATCHBYTES is 0.09313 GB</code></pre>
<pre><code>## 2022-02-25 23:36:29, ... applying FUN to selected data</code></pre>
<pre><code>## 2022-02-25 23:36:29, ... appending result to the output ffdf</code></pre>
<pre><code>## 2022-02-25 23:36:29, working on split 2/2, extracting data in RAM of 3 split elements, totalling, 0.02281 GB, while max specified data specified using BATCHBYTES is 0.09313 GB</code></pre>
<pre><code>## 2022-02-25 23:36:29, ... applying FUN to selected data</code></pre>
<pre><code>## 2022-02-25 23:36:29, ... appending result to the output ffdf</code></pre>
<p>Note how the output describes the procedure step by step. Now we can have a look at the resulting summary statistic in the form of a <code>data.frame()</code>.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="descriptive-statistics-and-aggregation.html#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(tip_pcategory)</span></code></pre></div>
<pre><code>##   payment_type tip_amount.mean
## 1         cash       0.0008162
## 2       credit       2.1619737
## 3      dispute       0.0035075
## 4    no charge       0.0041056</code></pre>
<p>The result would go against our initial hypothesis. However, the comparison is a little flawed. If trips paid by credit card also tend to be longer, the result is not too surprising. We should thus look at the share of tip (or percentage), given the overall amount paid for the trip.</p>
<p>We add an additional variable <code>percent_tip</code> and then repeat the aggregation exercise for this variable.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="descriptive-statistics-and-aggregation.html#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add additional column with the share of tip</span></span>
<span id="cb335-2"><a href="descriptive-statistics-and-aggregation.html#cb335-2" aria-hidden="true" tabindex="-1"></a>taxi<span class="sc">$</span>percent_tip <span class="ot">&lt;-</span> (taxi<span class="sc">$</span>tip_amount<span class="sc">/</span>taxi<span class="sc">$</span>total_amount)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb335-3"><a href="descriptive-statistics-and-aggregation.html#cb335-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-4"><a href="descriptive-statistics-and-aggregation.html#cb335-4" aria-hidden="true" tabindex="-1"></a><span class="co"># recompute the aggregate stats</span></span>
<span id="cb335-5"><a href="descriptive-statistics-and-aggregation.html#cb335-5" aria-hidden="true" tabindex="-1"></a>tip_pcategory <span class="ot">&lt;-</span> <span class="fu">ffdfdply</span>(taxi,</span>
<span id="cb335-6"><a href="descriptive-statistics-and-aggregation.html#cb335-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">split =</span> taxi<span class="sc">$</span>payment_type,</span>
<span id="cb335-7"><a href="descriptive-statistics-and-aggregation.html#cb335-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">BATCHBYTES =</span> <span class="dv">100000000</span>,</span>
<span id="cb335-8"><a href="descriptive-statistics-and-aggregation.html#cb335-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb335-9"><a href="descriptive-statistics-and-aggregation.html#cb335-9" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">summaryBy</span>(percent_tip<span class="sc">~</span>payment_type, <span class="co"># note the difference here</span></span>
<span id="cb335-10"><a href="descriptive-statistics-and-aggregation.html#cb335-10" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">data =</span> x,</span>
<span id="cb335-11"><a href="descriptive-statistics-and-aggregation.html#cb335-11" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">FUN =</span> mean,</span>
<span id="cb335-12"><a href="descriptive-statistics-and-aggregation.html#cb335-12" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">na.rm =</span> <span class="cn">TRUE</span>)})</span></code></pre></div>
<pre><code>## 2022-02-25 23:36:30, calculating split sizes</code></pre>
<pre><code>## 2022-02-25 23:36:30, building up split locations</code></pre>
<pre><code>## 2022-02-25 23:36:30, working on split 1/2, extracting data in RAM of 1 split elements, totalling, 0.08732 GB, while max specified data specified using BATCHBYTES is 0.09313 GB</code></pre>
<pre><code>## 2022-02-25 23:36:30, ... applying FUN to selected data</code></pre>
<pre><code>## 2022-02-25 23:36:31, ... appending result to the output ffdf</code></pre>
<pre><code>## 2022-02-25 23:36:31, working on split 2/2, extracting data in RAM of 3 split elements, totalling, 0.02444 GB, while max specified data specified using BATCHBYTES is 0.09313 GB</code></pre>
<pre><code>## 2022-02-25 23:36:31, ... applying FUN to selected data</code></pre>
<pre><code>## 2022-02-25 23:36:31, ... appending result to the output ffdf</code></pre>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="descriptive-statistics-and-aggregation.html#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show result as data frame</span></span>
<span id="cb344-2"><a href="descriptive-statistics-and-aggregation.html#cb344-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(tip_pcategory)</span></code></pre></div>
<pre><code>##   payment_type percent_tip.mean
## 1         cash         0.005978
## 2       credit        16.004173
## 3      dispute         0.045660
## 4    no charge         0.040433</code></pre>
</div>
<div id="cross-tabulation-of-ff-vectors" class="section level4" number="9.1.1.3">
<h4><span class="header-section-number">9.1.1.3</span> Cross-tabulation of <code>ff</code> vectors</h4>
<p>Also in relative terms, trips paid by credit card tend to be tipped more. However, are there actually many trips paid by credit card? In order to figure this out, we count the number of trips per payment type by applying the <code>table.ff</code>-function provided in <code>ffbase</code>.</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="descriptive-statistics-and-aggregation.html#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table.ff</span>(taxi<span class="sc">$</span>payment_type)</span></code></pre></div>
<pre><code>## 
##      cash    credit   dispute no charge 
##    781295    215424       536      2745</code></pre>
<p>Incidentally, trips paid in cash are way more frequent than trips paid by credit card. Again using the <code>table.ff</code>-function, we investigate what factors might be correlated with payment types. First, we have a look at whether payment type is associated with the number of passengers in a trip.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="descriptive-statistics-and-aggregation.html#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select the subset of observations only containing trips paid by credit card or cash</span></span>
<span id="cb348-2"><a href="descriptive-statistics-and-aggregation.html#cb348-2" aria-hidden="true" tabindex="-1"></a>taxi_sub <span class="ot">&lt;-</span> <span class="fu">subset.ffdf</span>(taxi, payment_type<span class="sc">==</span><span class="st">&quot;credit&quot;</span> <span class="sc">|</span> payment_type <span class="sc">==</span> <span class="st">&quot;cash&quot;</span>)</span>
<span id="cb348-3"><a href="descriptive-statistics-and-aggregation.html#cb348-3" aria-hidden="true" tabindex="-1"></a>taxi_sub<span class="sc">$</span>payment_type <span class="ot">&lt;-</span> <span class="fu">ff</span>(taxi_sub<span class="sc">$</span>payment_type,</span>
<span id="cb348-4"><a href="descriptive-statistics-and-aggregation.html#cb348-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;credit&quot;</span>, <span class="st">&quot;cash&quot;</span>),</span>
<span id="cb348-5"><a href="descriptive-statistics-and-aggregation.html#cb348-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ramclass =</span> <span class="st">&quot;factor&quot;</span>)</span>
<span id="cb348-6"><a href="descriptive-statistics-and-aggregation.html#cb348-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-7"><a href="descriptive-statistics-and-aggregation.html#cb348-7" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the cross tabulation</span></span>
<span id="cb348-8"><a href="descriptive-statistics-and-aggregation.html#cb348-8" aria-hidden="true" tabindex="-1"></a>crosstab <span class="ot">&lt;-</span> <span class="fu">table.ff</span>(taxi_sub<span class="sc">$</span>passenger_count,</span>
<span id="cb348-9"><a href="descriptive-statistics-and-aggregation.html#cb348-9" aria-hidden="true" tabindex="-1"></a>                     taxi_sub<span class="sc">$</span>payment_type</span>
<span id="cb348-10"><a href="descriptive-statistics-and-aggregation.html#cb348-10" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb348-11"><a href="descriptive-statistics-and-aggregation.html#cb348-11" aria-hidden="true" tabindex="-1"></a><span class="co"># add names to the margins</span></span>
<span id="cb348-12"><a href="descriptive-statistics-and-aggregation.html#cb348-12" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">dimnames</span>(crosstab)) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Passenger count&quot;</span>, <span class="st">&quot;Payment type&quot;</span>)</span>
<span id="cb348-13"><a href="descriptive-statistics-and-aggregation.html#cb348-13" aria-hidden="true" tabindex="-1"></a><span class="co"># show result</span></span>
<span id="cb348-14"><a href="descriptive-statistics-and-aggregation.html#cb348-14" aria-hidden="true" tabindex="-1"></a>crosstab</span></code></pre></div>
<pre><code>##                Payment type
## Passenger count credit   cash
##               0      2     44
##               1 149990 516828
##               2  32891 133468
##               3   7847  36439
##               4   2909  17901
##               5  20688  73027
##               6   1097   3588</code></pre>
<p>From the raw numbers it is hard to see whether there are significant differences between the categories cash and credit. We therefore use a visualization technique called ‘mosaic plot’ to visualize the cross-tabulation.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="descriptive-statistics-and-aggregation.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(vcd)</span></span>
<span id="cb350-2"><a href="descriptive-statistics-and-aggregation.html#cb350-2" aria-hidden="true" tabindex="-1"></a><span class="co"># load package for mosaic plot</span></span>
<span id="cb350-3"><a href="descriptive-statistics-and-aggregation.html#cb350-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span></code></pre></div>
<pre><code>## Loading required package: grid</code></pre>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="descriptive-statistics-and-aggregation.html#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate a mosaic plot</span></span>
<span id="cb352-2"><a href="descriptive-statistics-and-aggregation.html#cb352-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(crosstab, <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-166-1.png" width="672" /></p>
<p>The plot suggests that trips involving more than one passenger tend to be paid rather by cash than by credit card.</p>
</div>
</div>
<div id="high-speed-in-memory-data-aggregation-with-data.table" class="section level3" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> High-speed in-memory data aggregation with <code>data.table</code></h3>
<p>For large data sets that still fit into RAM, the <code>data.table</code>-package provides very fast and elegant functions to compute aggregate statistics.</p>
<div id="data-import-3" class="section level4" number="9.1.2.1">
<h4><span class="header-section-number">9.1.2.1</span> Data import</h4>
<p>We use the already familiar <code>fread()</code> to import the same first million observations from the January 2009 taxi trips records.</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="descriptive-statistics-and-aggregation.html#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb353-2"><a href="descriptive-statistics-and-aggregation.html#cb353-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb353-3"><a href="descriptive-statistics-and-aggregation.html#cb353-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb353-4"><a href="descriptive-statistics-and-aggregation.html#cb353-4" aria-hidden="true" tabindex="-1"></a><span class="co"># import data into RAM (needs around 200MB)</span></span>
<span id="cb353-5"><a href="descriptive-statistics-and-aggregation.html#cb353-5" aria-hidden="true" tabindex="-1"></a>taxi <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;data/tlc_trips.csv&quot;</span>,</span>
<span id="cb353-6"><a href="descriptive-statistics-and-aggregation.html#cb353-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">nrows =</span> <span class="dv">1000000</span>)</span></code></pre></div>
</div>
<div id="data-preparation" class="section level4" number="9.1.2.2">
<h4><span class="header-section-number">9.1.2.2</span> Data preparation</h4>
<p>We prepare/clean the data as in the <code>ff</code>-approach above.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="descriptive-statistics-and-aggregation.html#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first, we remove the empty vars V8 and V9</span></span>
<span id="cb354-2"><a href="descriptive-statistics-and-aggregation.html#cb354-2" aria-hidden="true" tabindex="-1"></a>taxi<span class="sc">$</span>V8 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb354-3"><a href="descriptive-statistics-and-aggregation.html#cb354-3" aria-hidden="true" tabindex="-1"></a>taxi<span class="sc">$</span>V9 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb354-4"><a href="descriptive-statistics-and-aggregation.html#cb354-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-5"><a href="descriptive-statistics-and-aggregation.html#cb354-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-6"><a href="descriptive-statistics-and-aggregation.html#cb354-6" aria-hidden="true" tabindex="-1"></a><span class="co"># set covariate names according to the data dictionary</span></span>
<span id="cb354-7"><a href="descriptive-statistics-and-aggregation.html#cb354-7" aria-hidden="true" tabindex="-1"></a><span class="co"># see https://www1.nyc.gov/assets/tlc/downloads/pdf/data_dictionary_trip_records_yellow.pdf</span></span>
<span id="cb354-8"><a href="descriptive-statistics-and-aggregation.html#cb354-8" aria-hidden="true" tabindex="-1"></a><span class="co"># note instead of taxizonne ids, long/lat are provided</span></span>
<span id="cb354-9"><a href="descriptive-statistics-and-aggregation.html#cb354-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-10"><a href="descriptive-statistics-and-aggregation.html#cb354-10" aria-hidden="true" tabindex="-1"></a>varnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;vendor_id&quot;</span>,</span>
<span id="cb354-11"><a href="descriptive-statistics-and-aggregation.html#cb354-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;pickup_time&quot;</span>,</span>
<span id="cb354-12"><a href="descriptive-statistics-and-aggregation.html#cb354-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;dropoff_time&quot;</span>,</span>
<span id="cb354-13"><a href="descriptive-statistics-and-aggregation.html#cb354-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;passenger_count&quot;</span>,</span>
<span id="cb354-14"><a href="descriptive-statistics-and-aggregation.html#cb354-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;trip_distance&quot;</span>,</span>
<span id="cb354-15"><a href="descriptive-statistics-and-aggregation.html#cb354-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;start_lat&quot;</span>,</span>
<span id="cb354-16"><a href="descriptive-statistics-and-aggregation.html#cb354-16" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;start_long&quot;</span>,</span>
<span id="cb354-17"><a href="descriptive-statistics-and-aggregation.html#cb354-17" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;dest_lat&quot;</span>,</span>
<span id="cb354-18"><a href="descriptive-statistics-and-aggregation.html#cb354-18" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;dest_long&quot;</span>,</span>
<span id="cb354-19"><a href="descriptive-statistics-and-aggregation.html#cb354-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;payment_type&quot;</span>,</span>
<span id="cb354-20"><a href="descriptive-statistics-and-aggregation.html#cb354-20" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;fare_amount&quot;</span>,</span>
<span id="cb354-21"><a href="descriptive-statistics-and-aggregation.html#cb354-21" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;extra&quot;</span>,</span>
<span id="cb354-22"><a href="descriptive-statistics-and-aggregation.html#cb354-22" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;mta_tax&quot;</span>,</span>
<span id="cb354-23"><a href="descriptive-statistics-and-aggregation.html#cb354-23" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;tip_amount&quot;</span>,</span>
<span id="cb354-24"><a href="descriptive-statistics-and-aggregation.html#cb354-24" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;tolls_amount&quot;</span>,</span>
<span id="cb354-25"><a href="descriptive-statistics-and-aggregation.html#cb354-25" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;total_amount&quot;</span>)</span>
<span id="cb354-26"><a href="descriptive-statistics-and-aggregation.html#cb354-26" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(taxi) <span class="ot">&lt;-</span> varnames</span>
<span id="cb354-27"><a href="descriptive-statistics-and-aggregation.html#cb354-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-28"><a href="descriptive-statistics-and-aggregation.html#cb354-28" aria-hidden="true" tabindex="-1"></a><span class="co"># clean the factor levels</span></span>
<span id="cb354-29"><a href="descriptive-statistics-and-aggregation.html#cb354-29" aria-hidden="true" tabindex="-1"></a>taxi<span class="sc">$</span>payment_type <span class="ot">&lt;-</span> <span class="fu">tolower</span>(taxi<span class="sc">$</span>payment_type)</span>
<span id="cb354-30"><a href="descriptive-statistics-and-aggregation.html#cb354-30" aria-hidden="true" tabindex="-1"></a>taxi<span class="sc">$</span>payment_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(taxi<span class="sc">$</span>payment_type, <span class="at">levels =</span> <span class="fu">unique</span>(taxi<span class="sc">$</span>payment_type))     </span></code></pre></div>
<p>Note the simpler syntax of essentially doing the same thing, but all in-memory.</p>
</div>
<div id="data.table-syntax-for-split-apply-combine-operations" class="section level4" number="9.1.2.3">
<h4><span class="header-section-number">9.1.2.3</span> <code>data.table</code>-syntax for ‘split-apply-combine’ operations</h4>
<p>With the <code>[]</code>-syntax we index/subset usual <code>data.frame</code> objects in R. When working with <code>data.table</code>s, much more can be done in the step of ‘sub-setting’ the frame.<a href="#fn39" class="footnote-ref" id="fnref39"><sup>39</sup></a></p>
<p>For example, we can directly compute on columns.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="descriptive-statistics-and-aggregation.html#cb355-1" aria-hidden="true" tabindex="-1"></a>taxi[, <span class="fu">mean</span>(tip_amount<span class="sc">/</span>total_amount)]</span></code></pre></div>
<pre><code>## [1] 0.03452</code></pre>
<p>Moreover, in the same step, we can ‘split’ the rows <em>by</em> specific groups and apply the function to each subset.</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="descriptive-statistics-and-aggregation.html#cb357-1" aria-hidden="true" tabindex="-1"></a>taxi[, .(<span class="at">percent_tip =</span> <span class="fu">mean</span>((tip_amount<span class="sc">/</span>total_amount)<span class="sc">*</span><span class="dv">100</span>)), by <span class="ot">=</span> payment_type]</span></code></pre></div>
<pre><code>##    payment_type percent_tip
## 1:         cash    0.005978
## 2:       credit   16.004173
## 3:    no charge    0.040433
## 4:      dispute    0.045660</code></pre>
<p>Similarly, we can use <code>data.table</code>’s <code>dcast()</code> for cross-tabulation-like operations.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="descriptive-statistics-and-aggregation.html#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dcast</span>(taxi[payment_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;credit&quot;</span>, <span class="st">&quot;cash&quot;</span>)],</span>
<span id="cb359-2"><a href="descriptive-statistics-and-aggregation.html#cb359-2" aria-hidden="true" tabindex="-1"></a>      passenger_count<span class="sc">~</span>payment_type, </span>
<span id="cb359-3"><a href="descriptive-statistics-and-aggregation.html#cb359-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">fun.aggregate =</span> length,</span>
<span id="cb359-4"><a href="descriptive-statistics-and-aggregation.html#cb359-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">value.var =</span> <span class="st">&quot;vendor_id&quot;</span>)</span></code></pre></div>
<pre><code>##    passenger_count   cash credit
## 1:               0     44      2
## 2:               1 516828 149990
## 3:               2 133468  32891
## 4:               3  36439   7847
## 5:               4  17901   2909
## 6:               5  73027  20688
## 7:               6   3588   1097</code></pre>

</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="37">
<li id="fn37"><p>Moreover, ‘split-apply-combine’ is closely related to a core strategy of Big Data analytics with distributed systems: Map/Reduce - more on this in the lecture on distributed systems.<a href="descriptive-statistics-and-aggregation.html#fnref37" class="footnote-back">↩︎</a></p></li>
<li id="fn38"><p>Note that the code examples below could also be run based on the entire TLC database (provided that there is enough hard-disk space available). But, creating the <code>ff</code> chunked file structure for a 200GB CSV would take hours or even days.<a href="descriptive-statistics-and-aggregation.html#fnref38" class="footnote-back">↩︎</a></p></li>
<li id="fn39"><p>See <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html" class="uri">https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html</a> for a detailed introduction to the syntax.<a href="descriptive-statistics-and-aggregation.html#fnref39" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="big-data-cleaning-and-transformation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="big-data-visualization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 1
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bigdata.pdf", "bigdata.html", "bigdata.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
