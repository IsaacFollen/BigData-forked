<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Descriptive Statistics and Aggregation | Big Data Analytics</title>
  <meta name="description" content="A guide to data science practitioners making the transition to Big Data." />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Descriptive Statistics and Aggregation | Big Data Analytics" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://umatter.github.io/BigData/img/cover.png" />
  <meta property="og:description" content="A guide to data science practitioners making the transition to Big Data." />
  <meta name="github-repo" content="umatter/BigData" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Descriptive Statistics and Aggregation | Big Data Analytics" />
  
  <meta name="twitter:description" content="A guide to data science practitioners making the transition to Big Data." />
  <meta name="twitter:image" content="https://umatter.github.io/BigData/img/cover.png" />

<meta name="author" content="Ulrich Matter" />


<meta name="date" content="2022-09-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="big-data-cleaning-and-transformation.html"/>
<link rel="next" href="big-data-visualization.html"/>
<script src="libs/jquery/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Big Data Analytics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="part"><span><b>I Setting the Scene: Analyzing Big Data</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-big-in-big-data"><i class="fa fa-check"></i><b>1.1</b> What is <em>big</em> in “Big Data”?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#approaches-to-analyzing-big-data"><i class="fa fa-check"></i><b>1.2</b> Approaches to analyzing Big Data</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#content-overview"><i class="fa fa-check"></i><b>1.3</b> Content overview</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="two-domains-of-big-data-analytics.html"><a href="two-domains-of-big-data-analytics.html"><i class="fa fa-check"></i><b>2</b> Two domains of Big Data Analytics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="two-domains-of-big-data-analytics.html"><a href="two-domains-of-big-data-analytics.html#a-practical-big-p-problem"><i class="fa fa-check"></i><b>2.1</b> A practical <em>big P</em> problem</a></li>
<li class="chapter" data-level="2.2" data-path="two-domains-of-big-data-analytics.html"><a href="two-domains-of-big-data-analytics.html#a-practical-big-n-problem"><i class="fa fa-check"></i><b>2.2</b> A practical <em>big N</em> problem</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="two-domains-of-big-data-analytics.html"><a href="two-domains-of-big-data-analytics.html#ols-as-a-point-of-reference"><i class="fa fa-check"></i><b>2.2.1</b> OLS as a point of reference</a></li>
<li class="chapter" data-level="2.2.2" data-path="two-domains-of-big-data-analytics.html"><a href="two-domains-of-big-data-analytics.html#the-uluru-algorithm-as-an-alternative-to-ols"><i class="fa fa-check"></i><b>2.2.2</b> The <em>Uluru</em> algorithm as an alternative to OLS</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="two-domains-of-big-data-analytics.html"><a href="two-domains-of-big-data-analytics.html#conclusion"><i class="fa fa-check"></i><b>2.3</b> Conclusion</a></li>
</ul></li>
<li class="part"><span><b>II Platform: Software and Computing Resources</b></span></li>
<li class="chapter" data-level="3" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html"><i class="fa fa-check"></i><b>3</b> Software: Programming with (Big) Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#domains-of-programming-with-big-data"><i class="fa fa-check"></i><b>3.1</b> Domains of programming with (big) data</a></li>
<li class="chapter" data-level="3.2" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#measuring-r-performance"><i class="fa fa-check"></i><b>3.2</b> Measuring R performance</a></li>
<li class="chapter" data-level="3.3" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#writing-efficient-r-code"><i class="fa fa-check"></i><b>3.3</b> Writing efficient R code</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#memory-allocation-and-growing-objects"><i class="fa fa-check"></i><b>3.3.1</b> Memory allocation and growing objects</a></li>
<li class="chapter" data-level="3.3.2" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#vectorization-in-basic-r-functions"><i class="fa fa-check"></i><b>3.3.2</b> Vectorization in basic R functions</a></li>
<li class="chapter" data-level="3.3.3" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#apply-type-functions-and-vectorization"><i class="fa fa-check"></i><b>3.3.3</b> <code>apply</code>-type functions and vectorization</a></li>
<li class="chapter" data-level="3.3.4" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#avoid-unnecessary-copying"><i class="fa fa-check"></i><b>3.3.4</b> Avoid unnecessary copying</a></li>
<li class="chapter" data-level="3.3.5" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#releasing-memory"><i class="fa fa-check"></i><b>3.3.5</b> Releasing memory</a></li>
<li class="chapter" data-level="3.3.6" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#beyond-r"><i class="fa fa-check"></i><b>3.3.6</b> Beyond R</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#sql-basics"><i class="fa fa-check"></i><b>3.4</b> SQL basics</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#first-steps-in-sqlite"><i class="fa fa-check"></i><b>3.4.1</b> First steps in SQL(ite)</a></li>
<li class="chapter" data-level="3.4.2" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#joins"><i class="fa fa-check"></i><b>3.4.2</b> Joins</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html"><i class="fa fa-check"></i><b>4</b> Hardware: Computing Resources</a>
<ul>
<li class="chapter" data-level="4.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#components-of-a-standard-computing-environment"><i class="fa fa-check"></i><b>4.1</b> Components of a standard computing environment</a></li>
<li class="chapter" data-level="4.2" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#mass-storage"><i class="fa fa-check"></i><b>4.2</b> Mass storage</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#avoid-redundancies"><i class="fa fa-check"></i><b>4.2.1</b> Avoid redundancies</a></li>
<li class="chapter" data-level="4.2.2" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#data-compression"><i class="fa fa-check"></i><b>4.2.2</b> Data compression</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#random-access-memory-ram"><i class="fa fa-check"></i><b>4.3</b> Random access memory (RAM)</a></li>
<li class="chapter" data-level="4.4" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#combining-ram-and-hard-disk-virtual-memory"><i class="fa fa-check"></i><b>4.4</b> Combining RAM and hard disk: virtual memory</a></li>
<li class="chapter" data-level="4.5" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#cpu-and-parallelization"><i class="fa fa-check"></i><b>4.5</b> CPU and parallelization</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#naive-multi-session-approach"><i class="fa fa-check"></i><b>4.5.1</b> Naive multi-session approach</a></li>
<li class="chapter" data-level="4.5.2" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#multi-core-and-multi-node-approach"><i class="fa fa-check"></i><b>4.5.2</b> Multi-core and multi-node approach</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#gpus-for-scientific-computing"><i class="fa fa-check"></i><b>4.6</b> GPUs for scientific computing</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#gpus-in-r"><i class="fa fa-check"></i><b>4.6.1</b> GPUs in R</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#the-road-ahead-hardware-made-for-machine-learning"><i class="fa fa-check"></i><b>4.7</b> The road ahead: Hardware made for machine learning</a></li>
<li class="chapter" data-level="4.8" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#insufficient-computing-resources"><i class="fa fa-check"></i><b>4.8</b> Insufficient computing resources?</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="distributed-systems.html"><a href="distributed-systems.html"><i class="fa fa-check"></i><b>5</b> Distributed Systems</a>
<ul>
<li class="chapter" data-level="5.1" data-path="distributed-systems.html"><a href="distributed-systems.html#mapreduce"><i class="fa fa-check"></i><b>5.1</b> MapReduce</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="distributed-systems.html"><a href="distributed-systems.html#mapreduce-concept-illustrated-in-r"><i class="fa fa-check"></i><b>5.1.1</b> Map/Reduce Concept Illustrated in R</a></li>
<li class="chapter" data-level="5.1.2" data-path="distributed-systems.html"><a href="distributed-systems.html#mapper"><i class="fa fa-check"></i><b>5.1.2</b> Mapper</a></li>
<li class="chapter" data-level="5.1.3" data-path="distributed-systems.html"><a href="distributed-systems.html#reducer"><i class="fa fa-check"></i><b>5.1.3</b> Reducer</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="distributed-systems.html"><a href="distributed-systems.html#hadoop"><i class="fa fa-check"></i><b>5.2</b> Hadoop</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="distributed-systems.html"><a href="distributed-systems.html#hadoop-word-count-example"><i class="fa fa-check"></i><b>5.2.1</b> Hadoop word count example</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="distributed-systems.html"><a href="distributed-systems.html#spark"><i class="fa fa-check"></i><b>5.3</b> Spark</a></li>
<li class="chapter" data-level="5.4" data-path="distributed-systems.html"><a href="distributed-systems.html#spark-with-r"><i class="fa fa-check"></i><b>5.4</b> Spark with R</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="distributed-systems.html"><a href="distributed-systems.html#data-import-and-summary-statistics"><i class="fa fa-check"></i><b>5.4.1</b> Data import and summary statistics</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="distributed-systems.html"><a href="distributed-systems.html#spark-with-sql"><i class="fa fa-check"></i><b>5.5</b> Spark with SQL</a></li>
<li class="chapter" data-level="5.6" data-path="distributed-systems.html"><a href="distributed-systems.html#spark-with-r-sql"><i class="fa fa-check"></i><b>5.6</b> Spark with R + SQL</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="cloud-computing.html"><a href="cloud-computing.html"><i class="fa fa-check"></i><b>6</b> Cloud Computing</a>
<ul>
<li class="chapter" data-level="6.1" data-path="cloud-computing.html"><a href="cloud-computing.html#cloud-computing-basics-and-platforms"><i class="fa fa-check"></i><b>6.1</b> Cloud computing basics and platforms</a></li>
<li class="chapter" data-level="6.2" data-path="cloud-computing.html"><a href="cloud-computing.html#scaling-up-in-the-cloud"><i class="fa fa-check"></i><b>6.2</b> Scaling up in the cloud</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="cloud-computing.html"><a href="cloud-computing.html#scaling-up-with-aws-ec2-and-rrstudio"><i class="fa fa-check"></i><b>6.2.1</b> Scaling up with AWS EC2 and R/RStudio</a></li>
<li class="chapter" data-level="6.2.2" data-path="cloud-computing.html"><a href="cloud-computing.html#scaling-up-with-gpus"><i class="fa fa-check"></i><b>6.2.2</b> Scaling up with GPUs</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="cloud-computing.html"><a href="cloud-computing.html#gpus-on-google-colab"><i class="fa fa-check"></i><b>6.3</b> GPUs on Google Colab</a></li>
<li class="chapter" data-level="6.4" data-path="cloud-computing.html"><a href="cloud-computing.html#aws-emr-mapreduce-in-the-cloud"><i class="fa fa-check"></i><b>6.4</b> AWS EMR: MapReduce in the cloud</a></li>
</ul></li>
<li class="part"><span><b>III Applied Big Data Analytics</b></span></li>
<li class="chapter" data-level="7" data-path="forms-of-big-data-and-the-data-pipeline.html"><a href="forms-of-big-data-and-the-data-pipeline.html"><i class="fa fa-check"></i><b>7</b> Forms of Big Data and the Data Pipeline</a>
<ul>
<li class="chapter" data-level="7.1" data-path="forms-of-big-data-and-the-data-pipeline.html"><a href="forms-of-big-data-and-the-data-pipeline.html#unstructured-semi-structured-structured-data"><i class="fa fa-check"></i><b>7.1</b> Unstructured, semi-structured, structured data</a></li>
<li class="chapter" data-level="7.2" data-path="forms-of-big-data-and-the-data-pipeline.html"><a href="forms-of-big-data-and-the-data-pipeline.html#data-pipelines-a-systematic-approach-to-processing-big-data"><i class="fa fa-check"></i><b>7.2</b> Data pipelines: a systematic approach to processing big data</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html"><i class="fa fa-check"></i><b>8</b> Data Collection and Data Storage</a>
<ul>
<li class="chapter" data-level="8.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#gathering-and-compilation-of-raw-data"><i class="fa fa-check"></i><b>8.1</b> Gathering and compilation of raw data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#nyc-taxi-data"><i class="fa fa-check"></i><b>8.1.1</b> NYC taxi data</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#data-import-and-memory-allocation"><i class="fa fa-check"></i><b>8.2</b> Data import and memory allocation</a></li>
<li class="chapter" data-level="8.3" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#efficient-local-data-storage"><i class="fa fa-check"></i><b>8.3</b> Efficient local data storage</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#rdbms-basics"><i class="fa fa-check"></i><b>8.3.1</b> RDBMS basics</a></li>
<li class="chapter" data-level="8.3.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#efficient-data-access-indices-and-joins-in-sqlite"><i class="fa fa-check"></i><b>8.3.2</b> Efficient data access: indices and joins in SQLite</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#connecting-r-to-rdbms"><i class="fa fa-check"></i><b>8.4</b> Connecting R to RDBMS</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#creating-a-new-database-with-rsqlite"><i class="fa fa-check"></i><b>8.4.1</b> Creating a new database with <code>RSQLite</code></a></li>
<li class="chapter" data-level="8.4.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#importing-data"><i class="fa fa-check"></i><b>8.4.2</b> Importing data</a></li>
<li class="chapter" data-level="8.4.3" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#issue-queries"><i class="fa fa-check"></i><b>8.4.3</b> Issue queries</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#cloud-solutions-for-big-data-storage"><i class="fa fa-check"></i><b>8.5</b> Cloud solutions for (big) data storage</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#easy-to-use-rdbms-in-the-cloud-aws-rds"><i class="fa fa-check"></i><b>8.5.1</b> Easy-to-use RDBMS in the cloud: AWS RDS</a></li>
<li class="chapter" data-level="8.5.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#database-server-in-the-cloud-mariadb-on-an-ec2-instance"><i class="fa fa-check"></i><b>8.5.2</b> Database server in the cloud: MariaDB on an EC2 instance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html"><i class="fa fa-check"></i><b>9</b> Big Data Cleaning and Transformation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#out-of-memory-strategies"><i class="fa fa-check"></i><b>9.1</b> ‘Out-of-memory’ strategies</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#chunking-data-with-the-ff-package"><i class="fa fa-check"></i><b>9.1.1</b> Chunking data with the <code>ff</code>-package</a></li>
<li class="chapter" data-level="9.1.2" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#memory-mapping-with-bigmemory"><i class="fa fa-check"></i><b>9.1.2</b> Memory mapping with <code>bigmemory</code></a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#typical-cleaning-tasks"><i class="fa fa-check"></i><b>9.2</b> Typical cleaning tasks</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#data-preparation-with-ff"><i class="fa fa-check"></i><b>9.2.1</b> Data Preparation with <code>ff</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html"><i class="fa fa-check"></i><b>10</b> Descriptive Statistics and Aggregation</a>
<ul>
<li class="chapter" data-level="10.1" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#data-aggregation-the-split-apply-combine-strategy"><i class="fa fa-check"></i><b>10.1</b> Data aggregation: The ‘split-apply-combine’ strategy</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#data-aggregation-with-chunked-data-files"><i class="fa fa-check"></i><b>10.1.1</b> Data aggregation with chunked data files</a></li>
<li class="chapter" data-level="10.1.2" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#cross-tabulation-of-ff-vectors"><i class="fa fa-check"></i><b>10.1.2</b> Cross-tabulation of <code>ff</code> vectors</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#high-speed-in-memory-data-aggregation-with-data.table"><i class="fa fa-check"></i><b>10.2</b> High-speed in-memory data aggregation with <code>data.table</code></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="big-data-visualization.html"><a href="big-data-visualization.html"><i class="fa fa-check"></i><b>11</b> (Big) Data Visualization</a>
<ul>
<li class="chapter" data-level="11.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#data-exploration-with-ggplot2"><i class="fa fa-check"></i><b>11.1</b> Data exploration with <code>ggplot2</code></a></li>
<li class="chapter" data-level="11.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#excursus-modify-and-create-themes"><i class="fa fa-check"></i><b>11.2</b> Excursus: modify and create themes</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#create-your-own-theme-simple-approach"><i class="fa fa-check"></i><b>11.2.1</b> Create your own theme: simple approach</a></li>
<li class="chapter" data-level="11.2.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#implementing-actual-themes-as-functions."><i class="fa fa-check"></i><b>11.2.2</b> Implementing actual themes as functions.</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="big-data-visualization.html"><a href="big-data-visualization.html#visualize-time-and-space"><i class="fa fa-check"></i><b>11.3</b> Visualize Time and Space</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#preparations"><i class="fa fa-check"></i><b>11.3.1</b> Preparations</a></li>
<li class="chapter" data-level="11.3.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#pick-up-and-drop-off-locations"><i class="fa fa-check"></i><b>11.3.2</b> Pick-up and drop-off locations</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="big-data-visualization.html"><a href="big-data-visualization.html#excursus-change-color-schemes"><i class="fa fa-check"></i><b>11.4</b> Excursus: change color schemes</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html"><i class="fa fa-check"></i><b>12</b> Bottle Necks in Local Big Data Analytics</a>
<ul>
<li class="chapter" data-level="12.1" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#case-study-data-import-and-memory-allocation"><i class="fa fa-check"></i><b>12.1</b> Case study: Data Import and Memory Allocation</a></li>
<li class="chapter" data-level="12.2" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#case-study-loops-memory-and-vectorization"><i class="fa fa-check"></i><b>12.2</b> Case Study: Loops, Memory, and Vectorization</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#preparation"><i class="fa fa-check"></i><b>12.2.1</b> Preparation</a></li>
<li class="chapter" data-level="12.2.2" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#naïve-approach-ignorant-of-r"><i class="fa fa-check"></i><b>12.2.2</b> Naïve Approach (ignorant of R)</a></li>
<li class="chapter" data-level="12.2.3" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#improvement-1-pre-allocation-of-memory"><i class="fa fa-check"></i><b>12.2.3</b> Improvement 1: Pre-allocation of memory</a></li>
<li class="chapter" data-level="12.2.4" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#improvement-2-exploit-vectorization"><i class="fa fa-check"></i><b>12.2.4</b> Improvement 2: Exploit vectorization</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#case-study-bootstrapping-and-parallel-processing"><i class="fa fa-check"></i><b>12.3</b> Case study: Bootstrapping and Parallel Processing</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#parallelization-with-an-ec2-instance-1"><i class="fa fa-check"></i><b>12.3.1</b> Parallelization with an EC2 instance</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#case-study-efficient-fixed-effects-estimation"><i class="fa fa-check"></i><b>12.4</b> Case Study: Efficient Fixed Effects Estimation</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="gpus-and-machine-learning.html"><a href="gpus-and-machine-learning.html"><i class="fa fa-check"></i><b>13</b> GPUs and Machine Learning</a>
<ul>
<li class="chapter" data-level="13.1" data-path="gpus-and-machine-learning.html"><a href="gpus-and-machine-learning.html#tensorflowkeras-example-predict-housing-prices"><i class="fa fa-check"></i><b>13.1</b> Tensorflow/Keras example: predict housing prices</a></li>
<li class="chapter" data-level="13.2" data-path="gpus-and-machine-learning.html"><a href="gpus-and-machine-learning.html#data-preparation-1"><i class="fa fa-check"></i><b>13.2</b> Data preparation</a></li>
<li class="chapter" data-level="13.3" data-path="gpus-and-machine-learning.html"><a href="gpus-and-machine-learning.html#model-specification"><i class="fa fa-check"></i><b>13.3</b> Model specification</a></li>
<li class="chapter" data-level="13.4" data-path="gpus-and-machine-learning.html"><a href="gpus-and-machine-learning.html#training-and-prediction"><i class="fa fa-check"></i><b>13.4</b> Training and prediction</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="gpus-and-machine-learning.html"><a href="gpus-and-machine-learning.html#a-word-of-caution"><i class="fa fa-check"></i><b>13.4.1</b> A word of caution</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Application: Topics in Big Data Econometrics</b></span></li>
<li class="chapter" data-level="14" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html"><i class="fa fa-check"></i><b>14</b> Regression Analysis and Categorization with Spark and R</a>
<ul>
<li class="chapter" data-level="14.1" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#simple-regression-analysis"><i class="fa fa-check"></i><b>14.1</b> Simple regression analysis</a></li>
<li class="chapter" data-level="14.2" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#machine-learning-for-classification"><i class="fa fa-check"></i><b>14.2</b> Machine learning for classification</a></li>
<li class="chapter" data-level="14.3" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#building-machine-learning-pipelines-with-r-and-spark"><i class="fa fa-check"></i><b>14.3</b> Building machine learning pipelines with R and Spark</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#set-up-and-data-import"><i class="fa fa-check"></i><b>14.3.1</b> Set up and data import</a></li>
<li class="chapter" data-level="14.3.2" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#building-the-pipeline"><i class="fa fa-check"></i><b>14.3.2</b> Building the pipeline</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html"><i class="fa fa-check"></i><b>15</b> Large-scale Text Analysis with sparklyr</a>
<ul>
<li class="chapter" data-level="15.1" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html#getting-started-import-preparation-and-word-frequencies"><i class="fa fa-check"></i><b>15.1</b> Getting started: import, preparation, and word frequencies</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-a.html"><a href="appendix-a.html"><i class="fa fa-check"></i><b>A</b> Appendix A</a>
<ul>
<li class="chapter" data-level="A.1" data-path="appendix-a.html"><a href="appendix-a.html#github"><i class="fa fa-check"></i><b>A.1</b> GitHub</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="appendix-a.html"><a href="appendix-a.html#initiate-a-new-repository"><i class="fa fa-check"></i><b>A.1.1</b> Initiate a new repository</a></li>
<li class="chapter" data-level="A.1.2" data-path="appendix-a.html"><a href="appendix-a.html#clone-this-courses-repository"><i class="fa fa-check"></i><b>A.1.2</b> Clone this course’s repository</a></li>
<li class="chapter" data-level="A.1.3" data-path="appendix-a.html"><a href="appendix-a.html#fork-this-courses-repository"><i class="fa fa-check"></i><b>A.1.3</b> Fork this course’s repository</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="appendix-b.html"><a href="appendix-b.html"><i class="fa fa-check"></i><b>B</b> Appendix B</a>
<ul>
<li class="chapter" data-level="B.1" data-path="appendix-b.html"><a href="appendix-b.html#data-types-and-memorystorage"><i class="fa fa-check"></i><b>B.1</b> Data types and memory/storage</a>
<ul>
<li class="chapter" data-level="B.1.1" data-path="appendix-b.html"><a href="appendix-b.html#example-in-r-data-types-and-information-storage"><i class="fa fa-check"></i><b>B.1.1</b> Example in R: Data types and information storage</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="appendix-b.html"><a href="appendix-b.html#data-structures"><i class="fa fa-check"></i><b>B.2</b> Data structures</a>
<ul>
<li class="chapter" data-level="B.2.1" data-path="appendix-b.html"><a href="appendix-b.html#vectors-vs-factors-in-r"><i class="fa fa-check"></i><b>B.2.1</b> Vectors vs Factors in R</a></li>
<li class="chapter" data-level="B.2.2" data-path="appendix-b.html"><a href="appendix-b.html#matricesarrays"><i class="fa fa-check"></i><b>B.2.2</b> Matrices/Arrays</a></li>
<li class="chapter" data-level="B.2.3" data-path="appendix-b.html"><a href="appendix-b.html#data-frames-tibbles-and-data-tables"><i class="fa fa-check"></i><b>B.2.3</b> Data frames, tibbles, and data tables</a></li>
<li class="chapter" data-level="B.2.4" data-path="appendix-b.html"><a href="appendix-b.html#lists"><i class="fa fa-check"></i><b>B.2.4</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="appendix-b.html"><a href="appendix-b.html#r-tools-to-investigate-structures-and-types"><i class="fa fa-check"></i><b>B.3</b> R-tools to investigate structures and types</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="appendix-c.html"><a href="appendix-c.html"><i class="fa fa-check"></i><b>C</b> Appendix C</a>
<ul>
<li class="chapter" data-level="C.1" data-path="appendix-c.html"><a href="appendix-c.html#install-hadoop-on-ubuntu-linux"><i class="fa fa-check"></i><b>C.1</b> Install Hadoop (on Ubuntu Linux)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://umatter.github.io" target="blank">umatter.github.io</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Big Data Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="descriptive-statistics-and-aggregation" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">Chapter 10</span> Descriptive Statistics and Aggregation<a href="descriptive-statistics-and-aggregation.html#descriptive-statistics-and-aggregation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="data-aggregation-the-split-apply-combine-strategy" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Data aggregation: The ‘split-apply-combine’ strategy<a href="descriptive-statistics-and-aggregation.html#data-aggregation-the-split-apply-combine-strategy" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The ‘split-apply-combine’ strategy plays an important role in many data analysis tasks, ranging from data preparation to summary statistics and model-fitting.<a href="#fn40" class="footnote-ref" id="fnref40"><sup>40</sup></a> The strategy can be defined as “break up a problem into manageable pieces, operate on each piece independently and then put all the pieces back together.” <span class="citation">(<a href="#ref-wickham_2011" role="doc-biblioref">Wickham 2011, 1</a>)</span></p>
<p>Many R users are familiar with the basic concept of split-apply-combine implemented in the <code>plyr</code>-package intended for the usual in-memory operations (data set fits into RAM). Here, we explore the options for split-apply-combine approaches to large data sets that do not fit into RAM.</p>
<div id="data-aggregation-with-chunked-data-files" class="section level3 hasAnchor" number="10.1.1">
<h3><span class="header-section-number">10.1.1</span> Data aggregation with chunked data files<a href="descriptive-statistics-and-aggregation.html#data-aggregation-with-chunked-data-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this tutorial we explore the world of New York’s famous Yellow Caps. In in a first step, we will focus on the <code>ff</code>-based approach to employ parts of the hard disk as ‘virtual memory’. This means, all of the examples are easily scalable without risking too much memory pressure. Given the size of the entire TLC database (over 200GB), we will only use one million taxi trips records of January 2009.<a href="#fn41" class="footnote-ref" id="fnref41"><sup>41</sup></a></p>
<div id="data-import-2" class="section level4 hasAnchor" number="10.1.1.1">
<h4><span class="header-section-number">10.1.1.1</span> Data import<a href="descriptive-statistics-and-aggregation.html#data-import-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we read the raw taxi trips records into R with the <code>ff</code>-package.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="descriptive-statistics-and-aggregation.html#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb319-2"><a href="descriptive-statistics-and-aggregation.html#cb319-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ff)</span>
<span id="cb319-3"><a href="descriptive-statistics-and-aggregation.html#cb319-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ffbase)</span>
<span id="cb319-4"><a href="descriptive-statistics-and-aggregation.html#cb319-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-5"><a href="descriptive-statistics-and-aggregation.html#cb319-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set up the ff directory (for data file chunks)</span></span>
<span id="cb319-6"><a href="descriptive-statistics-and-aggregation.html#cb319-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">&quot;fftaxi&quot;</span>)){</span>
<span id="cb319-7"><a href="descriptive-statistics-and-aggregation.html#cb319-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">system</span>(<span class="st">&quot;mkdir fftaxi&quot;</span>)</span>
<span id="cb319-8"><a href="descriptive-statistics-and-aggregation.html#cb319-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb319-9"><a href="descriptive-statistics-and-aggregation.html#cb319-9" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">fftempdir =</span> <span class="st">&quot;fftaxi&quot;</span>)</span>
<span id="cb319-10"><a href="descriptive-statistics-and-aggregation.html#cb319-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-11"><a href="descriptive-statistics-and-aggregation.html#cb319-11" aria-hidden="true" tabindex="-1"></a><span class="co"># import a few lines of the data, setting the column classes explicitly</span></span>
<span id="cb319-12"><a href="descriptive-statistics-and-aggregation.html#cb319-12" aria-hidden="true" tabindex="-1"></a>col_classes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">V1 =</span> <span class="st">&quot;factor&quot;</span>,</span>
<span id="cb319-13"><a href="descriptive-statistics-and-aggregation.html#cb319-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V2 =</span> <span class="st">&quot;POSIXct&quot;</span>,</span>
<span id="cb319-14"><a href="descriptive-statistics-and-aggregation.html#cb319-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V3 =</span> <span class="st">&quot;POSIXct&quot;</span>,</span>
<span id="cb319-15"><a href="descriptive-statistics-and-aggregation.html#cb319-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V4 =</span> <span class="st">&quot;integer&quot;</span>,</span>
<span id="cb319-16"><a href="descriptive-statistics-and-aggregation.html#cb319-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V5 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb319-17"><a href="descriptive-statistics-and-aggregation.html#cb319-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V6 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb319-18"><a href="descriptive-statistics-and-aggregation.html#cb319-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V7 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb319-19"><a href="descriptive-statistics-and-aggregation.html#cb319-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V8 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb319-20"><a href="descriptive-statistics-and-aggregation.html#cb319-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V9 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb319-21"><a href="descriptive-statistics-and-aggregation.html#cb319-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V10 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb319-22"><a href="descriptive-statistics-and-aggregation.html#cb319-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V11 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb319-23"><a href="descriptive-statistics-and-aggregation.html#cb319-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V12 =</span> <span class="st">&quot;factor&quot;</span>,</span>
<span id="cb319-24"><a href="descriptive-statistics-and-aggregation.html#cb319-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V13 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb319-25"><a href="descriptive-statistics-and-aggregation.html#cb319-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V14 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb319-26"><a href="descriptive-statistics-and-aggregation.html#cb319-26" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V15 =</span> <span class="st">&quot;factor&quot;</span>,</span>
<span id="cb319-27"><a href="descriptive-statistics-and-aggregation.html#cb319-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V16 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb319-28"><a href="descriptive-statistics-and-aggregation.html#cb319-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V17 =</span> <span class="st">&quot;numeric&quot;</span>,</span>
<span id="cb319-29"><a href="descriptive-statistics-and-aggregation.html#cb319-29" aria-hidden="true" tabindex="-1"></a>                 <span class="at">V18 =</span> <span class="st">&quot;numeric&quot;</span>)</span>
<span id="cb319-30"><a href="descriptive-statistics-and-aggregation.html#cb319-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-31"><a href="descriptive-statistics-and-aggregation.html#cb319-31" aria-hidden="true" tabindex="-1"></a><span class="co"># import the first one million observations</span></span>
<span id="cb319-32"><a href="descriptive-statistics-and-aggregation.html#cb319-32" aria-hidden="true" tabindex="-1"></a>taxi <span class="ot">&lt;-</span> <span class="fu">read.table.ffdf</span>(<span class="at">file =</span> <span class="st">&quot;data/tlc_trips.csv&quot;</span>,</span>
<span id="cb319-33"><a href="descriptive-statistics-and-aggregation.html#cb319-33" aria-hidden="true" tabindex="-1"></a>                        <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb319-34"><a href="descriptive-statistics-and-aggregation.html#cb319-34" aria-hidden="true" tabindex="-1"></a>                        <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb319-35"><a href="descriptive-statistics-and-aggregation.html#cb319-35" aria-hidden="true" tabindex="-1"></a>                        <span class="at">next.rows =</span> <span class="dv">100000</span>,</span>
<span id="cb319-36"><a href="descriptive-statistics-and-aggregation.html#cb319-36" aria-hidden="true" tabindex="-1"></a>                        <span class="at">colClasses=</span> col_classes,</span>
<span id="cb319-37"><a href="descriptive-statistics-and-aggregation.html#cb319-37" aria-hidden="true" tabindex="-1"></a>                        <span class="at">nrows =</span> <span class="dv">1000000</span></span>
<span id="cb319-38"><a href="descriptive-statistics-and-aggregation.html#cb319-38" aria-hidden="true" tabindex="-1"></a>                        )</span></code></pre></div>
<p>Following the data documentation provided by TLC, we give the columns of our data set more meaningful names and remove the empty columns (some covariates are only collected in later years).</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="descriptive-statistics-and-aggregation.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first, we remove the empty vars V8 and V9</span></span>
<span id="cb320-2"><a href="descriptive-statistics-and-aggregation.html#cb320-2" aria-hidden="true" tabindex="-1"></a>taxi<span class="sc">$</span>V8 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb320-3"><a href="descriptive-statistics-and-aggregation.html#cb320-3" aria-hidden="true" tabindex="-1"></a>taxi<span class="sc">$</span>V9 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb320-4"><a href="descriptive-statistics-and-aggregation.html#cb320-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-5"><a href="descriptive-statistics-and-aggregation.html#cb320-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-6"><a href="descriptive-statistics-and-aggregation.html#cb320-6" aria-hidden="true" tabindex="-1"></a><span class="co"># set covariate names according to the data dictionary</span></span>
<span id="cb320-7"><a href="descriptive-statistics-and-aggregation.html#cb320-7" aria-hidden="true" tabindex="-1"></a><span class="co"># see https://www1.nyc.gov/assets/tlc/downloads/pdf/data_dictionary_trip_records_yellow.pdf</span></span>
<span id="cb320-8"><a href="descriptive-statistics-and-aggregation.html#cb320-8" aria-hidden="true" tabindex="-1"></a><span class="co"># note instead of taxizonne ids, long/lat are provided</span></span>
<span id="cb320-9"><a href="descriptive-statistics-and-aggregation.html#cb320-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-10"><a href="descriptive-statistics-and-aggregation.html#cb320-10" aria-hidden="true" tabindex="-1"></a>varnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;vendor_id&quot;</span>,</span>
<span id="cb320-11"><a href="descriptive-statistics-and-aggregation.html#cb320-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;pickup_time&quot;</span>,</span>
<span id="cb320-12"><a href="descriptive-statistics-and-aggregation.html#cb320-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;dropoff_time&quot;</span>,</span>
<span id="cb320-13"><a href="descriptive-statistics-and-aggregation.html#cb320-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;passenger_count&quot;</span>,</span>
<span id="cb320-14"><a href="descriptive-statistics-and-aggregation.html#cb320-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;trip_distance&quot;</span>,</span>
<span id="cb320-15"><a href="descriptive-statistics-and-aggregation.html#cb320-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;start_lat&quot;</span>,</span>
<span id="cb320-16"><a href="descriptive-statistics-and-aggregation.html#cb320-16" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;start_long&quot;</span>,</span>
<span id="cb320-17"><a href="descriptive-statistics-and-aggregation.html#cb320-17" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;dest_lat&quot;</span>,</span>
<span id="cb320-18"><a href="descriptive-statistics-and-aggregation.html#cb320-18" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;dest_long&quot;</span>,</span>
<span id="cb320-19"><a href="descriptive-statistics-and-aggregation.html#cb320-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;payment_type&quot;</span>,</span>
<span id="cb320-20"><a href="descriptive-statistics-and-aggregation.html#cb320-20" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;fare_amount&quot;</span>,</span>
<span id="cb320-21"><a href="descriptive-statistics-and-aggregation.html#cb320-21" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;extra&quot;</span>,</span>
<span id="cb320-22"><a href="descriptive-statistics-and-aggregation.html#cb320-22" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;mta_tax&quot;</span>,</span>
<span id="cb320-23"><a href="descriptive-statistics-and-aggregation.html#cb320-23" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;tip_amount&quot;</span>,</span>
<span id="cb320-24"><a href="descriptive-statistics-and-aggregation.html#cb320-24" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;tolls_amount&quot;</span>,</span>
<span id="cb320-25"><a href="descriptive-statistics-and-aggregation.html#cb320-25" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;total_amount&quot;</span>)</span>
<span id="cb320-26"><a href="descriptive-statistics-and-aggregation.html#cb320-26" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(taxi) <span class="ot">&lt;-</span> varnames</span></code></pre></div>
<p>When inspecting the factor variables of the data set, we notice that some of the values are not standardized/normalized and the resulting factor levels are, therefore, somewhat ambiguous. We better clean this before getting into data aggregation tasks. Note the <code>ff</code>-specific syntax needed to recode the factor.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="descriptive-statistics-and-aggregation.html#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect the factor levels</span></span>
<span id="cb321-2"><a href="descriptive-statistics-and-aggregation.html#cb321-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(taxi<span class="sc">$</span>payment_type)</span></code></pre></div>
<pre><code>## [1] &quot;Cash&quot;      &quot;CASH&quot;      &quot;Credit&quot;    &quot;CREDIT&quot;   
## [5] &quot;Dispute&quot;   &quot;No Charge&quot;</code></pre>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="descriptive-statistics-and-aggregation.html#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recode them</span></span>
<span id="cb323-2"><a href="descriptive-statistics-and-aggregation.html#cb323-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(taxi<span class="sc">$</span>payment_type) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">levels</span>(taxi<span class="sc">$</span>payment_type))</span>
<span id="cb323-3"><a href="descriptive-statistics-and-aggregation.html#cb323-3" aria-hidden="true" tabindex="-1"></a>taxi<span class="sc">$</span>payment_type <span class="ot">&lt;-</span> <span class="fu">ff</span>(taxi<span class="sc">$</span>payment_type,</span>
<span id="cb323-4"><a href="descriptive-statistics-and-aggregation.html#cb323-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">levels</span>(taxi<span class="sc">$</span>payment_type)),</span>
<span id="cb323-5"><a href="descriptive-statistics-and-aggregation.html#cb323-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ramclass =</span> <span class="st">&quot;factor&quot;</span>)</span>
<span id="cb323-6"><a href="descriptive-statistics-and-aggregation.html#cb323-6" aria-hidden="true" tabindex="-1"></a><span class="co"># check result</span></span>
<span id="cb323-7"><a href="descriptive-statistics-and-aggregation.html#cb323-7" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(taxi<span class="sc">$</span>payment_type)</span></code></pre></div>
<pre><code>## [1] &quot;cash&quot;      &quot;credit&quot;    &quot;dispute&quot;   &quot;no charge&quot;</code></pre>
</div>
<div id="aggregation-with-split-apply-combine" class="section level4 hasAnchor" number="10.1.1.2">
<h4><span class="header-section-number">10.1.1.2</span> Aggregation with split-apply-combine<a href="descriptive-statistics-and-aggregation.html#aggregation-with-split-apply-combine" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we have a look at whether trips paid with credit card tend to involve lower tip amounts than trips paid by cash. In order to do so, we create a table that shows the average amount of tip paid for each payment-type category.</p>
<p>In simple words, this means we first split the data set into subsets, each of which containing all observations belonging to a distinct payment type. Then, we compute the arithmetic mean of the tip-column of each of these subsets. Finally, we combine all of these results in one table (i.e., the split-apply-combine strategy). When working with <code>ff</code>, the <code>ffdfply()</code>-function provides a user-friendly implementation of split-apply-combine type of tasks.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="descriptive-statistics-and-aggregation.html#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb325-2"><a href="descriptive-statistics-and-aggregation.html#cb325-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doBy)</span>
<span id="cb325-3"><a href="descriptive-statistics-and-aggregation.html#cb325-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-4"><a href="descriptive-statistics-and-aggregation.html#cb325-4" aria-hidden="true" tabindex="-1"></a><span class="co"># split-apply-combine procedure on data file chunks</span></span>
<span id="cb325-5"><a href="descriptive-statistics-and-aggregation.html#cb325-5" aria-hidden="true" tabindex="-1"></a>tip_pcategory <span class="ot">&lt;-</span> <span class="fu">ffdfdply</span>(taxi,</span>
<span id="cb325-6"><a href="descriptive-statistics-and-aggregation.html#cb325-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">split =</span> taxi<span class="sc">$</span>payment_type,</span>
<span id="cb325-7"><a href="descriptive-statistics-and-aggregation.html#cb325-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">BATCHBYTES =</span> <span class="dv">100000000</span>,</span>
<span id="cb325-8"><a href="descriptive-statistics-and-aggregation.html#cb325-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb325-9"><a href="descriptive-statistics-and-aggregation.html#cb325-9" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">summaryBy</span>(tip_amount<span class="sc">~</span>payment_type,</span>
<span id="cb325-10"><a href="descriptive-statistics-and-aggregation.html#cb325-10" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">data =</span> x,</span>
<span id="cb325-11"><a href="descriptive-statistics-and-aggregation.html#cb325-11" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">FUN =</span> mean,</span>
<span id="cb325-12"><a href="descriptive-statistics-and-aggregation.html#cb325-12" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">na.rm =</span> <span class="cn">TRUE</span>)})</span></code></pre></div>
<pre><code>## 2022-09-23 17:55:27, calculating split sizes</code></pre>
<pre><code>## 2022-09-23 17:55:27, building up split locations</code></pre>
<pre><code>## 2022-09-23 17:55:28, working on split 1/2, extracting data in RAM of 1 split elements, totalling, 0.0815 GB, while max specified data specified using BATCHBYTES is 0.09313 GB</code></pre>
<pre><code>## 2022-09-23 17:55:28, ... applying FUN to selected data</code></pre>
<pre><code>## 2022-09-23 17:55:28, ... appending result to the output ffdf</code></pre>
<pre><code>## 2022-09-23 17:55:28, working on split 2/2, extracting data in RAM of 3 split elements, totalling, 0.02281 GB, while max specified data specified using BATCHBYTES is 0.09313 GB</code></pre>
<pre><code>## 2022-09-23 17:55:29, ... applying FUN to selected data</code></pre>
<pre><code>## 2022-09-23 17:55:29, ... appending result to the output ffdf</code></pre>
<p>Note how the output describes the procedure step by step. Now we can have a look at the resulting summary statistic in the form of a <code>data.frame()</code>.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="descriptive-statistics-and-aggregation.html#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(tip_pcategory)</span></code></pre></div>
<pre><code>##   payment_type tip_amount.mean
## 1         cash       0.0008162
## 2       credit       2.1619737
## 3      dispute       0.0035075
## 4    no charge       0.0041056</code></pre>
<p>The result would go against our initial hypothesis. However, the comparison is a little flawed. If trips paid by credit card also tend to be longer, the result is not too surprising. We should thus look at the share of tip (or percentage), given the overall amount paid for the trip.</p>
<p>We add an additional variable <code>percent_tip</code> and then repeat the aggregation exercise for this variable.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="descriptive-statistics-and-aggregation.html#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add additional column with the share of tip</span></span>
<span id="cb336-2"><a href="descriptive-statistics-and-aggregation.html#cb336-2" aria-hidden="true" tabindex="-1"></a>taxi<span class="sc">$</span>percent_tip <span class="ot">&lt;-</span> (taxi<span class="sc">$</span>tip_amount<span class="sc">/</span>taxi<span class="sc">$</span>total_amount)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb336-3"><a href="descriptive-statistics-and-aggregation.html#cb336-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-4"><a href="descriptive-statistics-and-aggregation.html#cb336-4" aria-hidden="true" tabindex="-1"></a><span class="co"># recompute the aggregate stats</span></span>
<span id="cb336-5"><a href="descriptive-statistics-and-aggregation.html#cb336-5" aria-hidden="true" tabindex="-1"></a>tip_pcategory <span class="ot">&lt;-</span> <span class="fu">ffdfdply</span>(taxi,</span>
<span id="cb336-6"><a href="descriptive-statistics-and-aggregation.html#cb336-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">split =</span> taxi<span class="sc">$</span>payment_type,</span>
<span id="cb336-7"><a href="descriptive-statistics-and-aggregation.html#cb336-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">BATCHBYTES =</span> <span class="dv">100000000</span>,</span>
<span id="cb336-8"><a href="descriptive-statistics-and-aggregation.html#cb336-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb336-9"><a href="descriptive-statistics-and-aggregation.html#cb336-9" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">summaryBy</span>(percent_tip<span class="sc">~</span>payment_type, <span class="co"># note the difference here</span></span>
<span id="cb336-10"><a href="descriptive-statistics-and-aggregation.html#cb336-10" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">data =</span> x,</span>
<span id="cb336-11"><a href="descriptive-statistics-and-aggregation.html#cb336-11" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">FUN =</span> mean,</span>
<span id="cb336-12"><a href="descriptive-statistics-and-aggregation.html#cb336-12" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">na.rm =</span> <span class="cn">TRUE</span>)})</span></code></pre></div>
<pre><code>## 2022-09-23 17:55:29, calculating split sizes</code></pre>
<pre><code>## 2022-09-23 17:55:29, building up split locations</code></pre>
<pre><code>## 2022-09-23 17:55:29, working on split 1/2, extracting data in RAM of 1 split elements, totalling, 0.08732 GB, while max specified data specified using BATCHBYTES is 0.09313 GB</code></pre>
<pre><code>## 2022-09-23 17:55:30, ... applying FUN to selected data</code></pre>
<pre><code>## 2022-09-23 17:55:30, ... appending result to the output ffdf</code></pre>
<pre><code>## 2022-09-23 17:55:30, working on split 2/2, extracting data in RAM of 3 split elements, totalling, 0.02444 GB, while max specified data specified using BATCHBYTES is 0.09313 GB</code></pre>
<pre><code>## 2022-09-23 17:55:31, ... applying FUN to selected data</code></pre>
<pre><code>## 2022-09-23 17:55:31, ... appending result to the output ffdf</code></pre>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="descriptive-statistics-and-aggregation.html#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show result as data frame</span></span>
<span id="cb345-2"><a href="descriptive-statistics-and-aggregation.html#cb345-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(tip_pcategory)</span></code></pre></div>
<pre><code>##   payment_type percent_tip.mean
## 1         cash         0.005978
## 2       credit        16.004173
## 3      dispute         0.045660
## 4    no charge         0.040433</code></pre>
</div>
</div>
<div id="cross-tabulation-of-ff-vectors" class="section level3 hasAnchor" number="10.1.2">
<h3><span class="header-section-number">10.1.2</span> Cross-tabulation of <code>ff</code> vectors<a href="descriptive-statistics-and-aggregation.html#cross-tabulation-of-ff-vectors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Also in relative terms, trips paid by credit card tend to be tipped more. However, are there actually many trips paid by credit card? In order to figure this out, we count the number of trips per payment type by applying the <code>table.ff</code>-function provided in <code>ffbase</code>.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="descriptive-statistics-and-aggregation.html#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table.ff</span>(taxi<span class="sc">$</span>payment_type)</span></code></pre></div>
<pre><code>## 
##      cash    credit   dispute no charge 
##    781295    215424       536      2745</code></pre>
<p>Incidentally, trips paid in cash are way more frequent than trips paid by credit card. Again using the <code>table.ff</code>-function, we investigate what factors might be correlated with payment types. First, we have a look at whether payment type is associated with the number of passengers in a trip.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="descriptive-statistics-and-aggregation.html#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select the subset of observations only containing trips paid by credit card or cash</span></span>
<span id="cb349-2"><a href="descriptive-statistics-and-aggregation.html#cb349-2" aria-hidden="true" tabindex="-1"></a>taxi_sub <span class="ot">&lt;-</span> <span class="fu">subset.ffdf</span>(taxi, payment_type<span class="sc">==</span><span class="st">&quot;credit&quot;</span> <span class="sc">|</span> payment_type <span class="sc">==</span> <span class="st">&quot;cash&quot;</span>)</span>
<span id="cb349-3"><a href="descriptive-statistics-and-aggregation.html#cb349-3" aria-hidden="true" tabindex="-1"></a>taxi_sub<span class="sc">$</span>payment_type <span class="ot">&lt;-</span> <span class="fu">ff</span>(taxi_sub<span class="sc">$</span>payment_type,</span>
<span id="cb349-4"><a href="descriptive-statistics-and-aggregation.html#cb349-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;credit&quot;</span>, <span class="st">&quot;cash&quot;</span>),</span>
<span id="cb349-5"><a href="descriptive-statistics-and-aggregation.html#cb349-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ramclass =</span> <span class="st">&quot;factor&quot;</span>)</span>
<span id="cb349-6"><a href="descriptive-statistics-and-aggregation.html#cb349-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-7"><a href="descriptive-statistics-and-aggregation.html#cb349-7" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the cross tabulation</span></span>
<span id="cb349-8"><a href="descriptive-statistics-and-aggregation.html#cb349-8" aria-hidden="true" tabindex="-1"></a>crosstab <span class="ot">&lt;-</span> <span class="fu">table.ff</span>(taxi_sub<span class="sc">$</span>passenger_count,</span>
<span id="cb349-9"><a href="descriptive-statistics-and-aggregation.html#cb349-9" aria-hidden="true" tabindex="-1"></a>                     taxi_sub<span class="sc">$</span>payment_type</span>
<span id="cb349-10"><a href="descriptive-statistics-and-aggregation.html#cb349-10" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb349-11"><a href="descriptive-statistics-and-aggregation.html#cb349-11" aria-hidden="true" tabindex="-1"></a><span class="co"># add names to the margins</span></span>
<span id="cb349-12"><a href="descriptive-statistics-and-aggregation.html#cb349-12" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">dimnames</span>(crosstab)) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Passenger count&quot;</span>, <span class="st">&quot;Payment type&quot;</span>)</span>
<span id="cb349-13"><a href="descriptive-statistics-and-aggregation.html#cb349-13" aria-hidden="true" tabindex="-1"></a><span class="co"># show result</span></span>
<span id="cb349-14"><a href="descriptive-statistics-and-aggregation.html#cb349-14" aria-hidden="true" tabindex="-1"></a>crosstab</span></code></pre></div>
<pre><code>##                Payment type
## Passenger count credit   cash
##               0      2     44
##               1 149990 516828
##               2  32891 133468
##               3   7847  36439
##               4   2909  17901
##               5  20688  73027
##               6   1097   3588</code></pre>
<p>From the raw numbers it is hard to see whether there are significant differences between the categories cash and credit. We therefore use a visualization technique called ‘mosaic plot’ to visualize the cross-tabulation.</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="descriptive-statistics-and-aggregation.html#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(vcd)</span></span>
<span id="cb351-2"><a href="descriptive-statistics-and-aggregation.html#cb351-2" aria-hidden="true" tabindex="-1"></a><span class="co"># load package for mosaic plot</span></span>
<span id="cb351-3"><a href="descriptive-statistics-and-aggregation.html#cb351-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span></code></pre></div>
<pre><code>## Loading required package: grid</code></pre>
<pre><code>## 
## Attaching package: &#39;grid&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ff&#39;:
## 
##     pattern</code></pre>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="descriptive-statistics-and-aggregation.html#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate a mosaic plot</span></span>
<span id="cb355-2"><a href="descriptive-statistics-and-aggregation.html#cb355-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(crosstab, <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-178-1.png" width="672" /></p>
<p>The plot suggests that trips involving more than one passenger tend to be paid rather by cash than by credit card.</p>
</div>
</div>
<div id="high-speed-in-memory-data-aggregation-with-data.table" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> High-speed in-memory data aggregation with <code>data.table</code><a href="descriptive-statistics-and-aggregation.html#high-speed-in-memory-data-aggregation-with-data.table" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For large data sets that still fit into RAM, the <code>data.table</code>-package provides very fast and elegant functions to compute aggregate statistics.</p>
<div id="data-import-3" class="section level4 hasAnchor" number="10.2.0.1">
<h4><span class="header-section-number">10.2.0.1</span> Data import<a href="descriptive-statistics-and-aggregation.html#data-import-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We use the already familiar <code>fread()</code> to import the same first million observations from the January 2009 taxi trips records.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="descriptive-statistics-and-aggregation.html#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb356-2"><a href="descriptive-statistics-and-aggregation.html#cb356-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb356-3"><a href="descriptive-statistics-and-aggregation.html#cb356-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-4"><a href="descriptive-statistics-and-aggregation.html#cb356-4" aria-hidden="true" tabindex="-1"></a><span class="co"># import data into RAM (needs around 200MB)</span></span>
<span id="cb356-5"><a href="descriptive-statistics-and-aggregation.html#cb356-5" aria-hidden="true" tabindex="-1"></a>taxi <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;data/tlc_trips.csv&quot;</span>,</span>
<span id="cb356-6"><a href="descriptive-statistics-and-aggregation.html#cb356-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">nrows =</span> <span class="dv">1000000</span>)</span></code></pre></div>
</div>
<div id="data-preparation" class="section level4 hasAnchor" number="10.2.0.2">
<h4><span class="header-section-number">10.2.0.2</span> Data preparation<a href="descriptive-statistics-and-aggregation.html#data-preparation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We prepare/clean the data as in the <code>ff</code>-approach above.</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="descriptive-statistics-and-aggregation.html#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first, we remove the empty vars V8 and V9</span></span>
<span id="cb357-2"><a href="descriptive-statistics-and-aggregation.html#cb357-2" aria-hidden="true" tabindex="-1"></a>taxi<span class="sc">$</span>V8 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb357-3"><a href="descriptive-statistics-and-aggregation.html#cb357-3" aria-hidden="true" tabindex="-1"></a>taxi<span class="sc">$</span>V9 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb357-4"><a href="descriptive-statistics-and-aggregation.html#cb357-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb357-5"><a href="descriptive-statistics-and-aggregation.html#cb357-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb357-6"><a href="descriptive-statistics-and-aggregation.html#cb357-6" aria-hidden="true" tabindex="-1"></a><span class="co"># set covariate names according to the data dictionary</span></span>
<span id="cb357-7"><a href="descriptive-statistics-and-aggregation.html#cb357-7" aria-hidden="true" tabindex="-1"></a><span class="co"># see https://www1.nyc.gov/assets/tlc/downloads/pdf/data_dictionary_trip_records_yellow.pdf</span></span>
<span id="cb357-8"><a href="descriptive-statistics-and-aggregation.html#cb357-8" aria-hidden="true" tabindex="-1"></a><span class="co"># note instead of taxizonne ids, long/lat are provided</span></span>
<span id="cb357-9"><a href="descriptive-statistics-and-aggregation.html#cb357-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb357-10"><a href="descriptive-statistics-and-aggregation.html#cb357-10" aria-hidden="true" tabindex="-1"></a>varnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;vendor_id&quot;</span>,</span>
<span id="cb357-11"><a href="descriptive-statistics-and-aggregation.html#cb357-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;pickup_time&quot;</span>,</span>
<span id="cb357-12"><a href="descriptive-statistics-and-aggregation.html#cb357-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;dropoff_time&quot;</span>,</span>
<span id="cb357-13"><a href="descriptive-statistics-and-aggregation.html#cb357-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;passenger_count&quot;</span>,</span>
<span id="cb357-14"><a href="descriptive-statistics-and-aggregation.html#cb357-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;trip_distance&quot;</span>,</span>
<span id="cb357-15"><a href="descriptive-statistics-and-aggregation.html#cb357-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;start_lat&quot;</span>,</span>
<span id="cb357-16"><a href="descriptive-statistics-and-aggregation.html#cb357-16" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;start_long&quot;</span>,</span>
<span id="cb357-17"><a href="descriptive-statistics-and-aggregation.html#cb357-17" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;dest_lat&quot;</span>,</span>
<span id="cb357-18"><a href="descriptive-statistics-and-aggregation.html#cb357-18" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;dest_long&quot;</span>,</span>
<span id="cb357-19"><a href="descriptive-statistics-and-aggregation.html#cb357-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;payment_type&quot;</span>,</span>
<span id="cb357-20"><a href="descriptive-statistics-and-aggregation.html#cb357-20" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;fare_amount&quot;</span>,</span>
<span id="cb357-21"><a href="descriptive-statistics-and-aggregation.html#cb357-21" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;extra&quot;</span>,</span>
<span id="cb357-22"><a href="descriptive-statistics-and-aggregation.html#cb357-22" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;mta_tax&quot;</span>,</span>
<span id="cb357-23"><a href="descriptive-statistics-and-aggregation.html#cb357-23" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;tip_amount&quot;</span>,</span>
<span id="cb357-24"><a href="descriptive-statistics-and-aggregation.html#cb357-24" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;tolls_amount&quot;</span>,</span>
<span id="cb357-25"><a href="descriptive-statistics-and-aggregation.html#cb357-25" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;total_amount&quot;</span>)</span>
<span id="cb357-26"><a href="descriptive-statistics-and-aggregation.html#cb357-26" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(taxi) <span class="ot">&lt;-</span> varnames</span>
<span id="cb357-27"><a href="descriptive-statistics-and-aggregation.html#cb357-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb357-28"><a href="descriptive-statistics-and-aggregation.html#cb357-28" aria-hidden="true" tabindex="-1"></a><span class="co"># clean the factor levels</span></span>
<span id="cb357-29"><a href="descriptive-statistics-and-aggregation.html#cb357-29" aria-hidden="true" tabindex="-1"></a>taxi<span class="sc">$</span>payment_type <span class="ot">&lt;-</span> <span class="fu">tolower</span>(taxi<span class="sc">$</span>payment_type)</span>
<span id="cb357-30"><a href="descriptive-statistics-and-aggregation.html#cb357-30" aria-hidden="true" tabindex="-1"></a>taxi<span class="sc">$</span>payment_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(taxi<span class="sc">$</span>payment_type, <span class="at">levels =</span> <span class="fu">unique</span>(taxi<span class="sc">$</span>payment_type))     </span></code></pre></div>
<p>Note the simpler syntax of essentially doing the same thing, but all in-memory.</p>
</div>
<div id="data.table-syntax-for-split-apply-combine-operations" class="section level4 hasAnchor" number="10.2.0.3">
<h4><span class="header-section-number">10.2.0.3</span> <code>data.table</code>-syntax for ‘split-apply-combine’ operations<a href="descriptive-statistics-and-aggregation.html#data.table-syntax-for-split-apply-combine-operations" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>With the <code>[]</code>-syntax we index/subset usual <code>data.frame</code> objects in R. When working with <code>data.table</code>s, much more can be done in the step of ‘sub-setting’ the frame.<a href="#fn42" class="footnote-ref" id="fnref42"><sup>42</sup></a></p>
<p>For example, we can directly compute on columns.</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="descriptive-statistics-and-aggregation.html#cb358-1" aria-hidden="true" tabindex="-1"></a>taxi[, <span class="fu">mean</span>(tip_amount<span class="sc">/</span>total_amount)]</span></code></pre></div>
<pre><code>## [1] 0.03452</code></pre>
<p>Moreover, in the same step, we can ‘split’ the rows <em>by</em> specific groups and apply the function to each subset.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="descriptive-statistics-and-aggregation.html#cb360-1" aria-hidden="true" tabindex="-1"></a>taxi[, .(<span class="at">percent_tip =</span> <span class="fu">mean</span>((tip_amount<span class="sc">/</span>total_amount)<span class="sc">*</span><span class="dv">100</span>)), by <span class="ot">=</span> payment_type]</span></code></pre></div>
<pre><code>##    payment_type percent_tip
## 1:         cash    0.005978
## 2:       credit   16.004173
## 3:    no charge    0.040433
## 4:      dispute    0.045660</code></pre>
<p>Similarly, we can use <code>data.table</code>’s <code>dcast()</code> for cross-tabulation-like operations.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="descriptive-statistics-and-aggregation.html#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dcast</span>(taxi[payment_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;credit&quot;</span>, <span class="st">&quot;cash&quot;</span>)],</span>
<span id="cb362-2"><a href="descriptive-statistics-and-aggregation.html#cb362-2" aria-hidden="true" tabindex="-1"></a>      passenger_count<span class="sc">~</span>payment_type, </span>
<span id="cb362-3"><a href="descriptive-statistics-and-aggregation.html#cb362-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">fun.aggregate =</span> length,</span>
<span id="cb362-4"><a href="descriptive-statistics-and-aggregation.html#cb362-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">value.var =</span> <span class="st">&quot;vendor_id&quot;</span>)</span></code></pre></div>
<pre><code>##    passenger_count   cash credit
## 1:               0     44      2
## 2:               1 516828 149990
## 3:               2 133468  32891
## 4:               3  36439   7847
## 5:               4  17901   2909
## 6:               5  73027  20688
## 7:               6   3588   1097</code></pre>

</div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-wickham_2011" class="csl-entry">
Wickham, Hadley. 2011. <span>“The Split-Apply-Combine Strategy for Data Analysis.”</span> <em>Journal of Statistical Software</em> 40.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="40">
<li id="fn40"><p>Moreover, ‘split-apply-combine’ is closely related to a core strategy of Big Data analytics with distributed systems: Map/Reduce - more on this in the lecture on distributed systems.<a href="descriptive-statistics-and-aggregation.html#fnref40" class="footnote-back">↩︎</a></p></li>
<li id="fn41"><p>Note that the code examples below could also be run based on the entire TLC database (provided that there is enough hard-disk space available). But, creating the <code>ff</code> chunked file structure for a 200GB CSV would take hours or even days.<a href="descriptive-statistics-and-aggregation.html#fnref41" class="footnote-back">↩︎</a></p></li>
<li id="fn42"><p>See <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html" class="uri">https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html</a> for a detailed introduction to the syntax.<a href="descriptive-statistics-and-aggregation.html#fnref42" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="big-data-cleaning-and-transformation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="big-data-visualization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 1
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
