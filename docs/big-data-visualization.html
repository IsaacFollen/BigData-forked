<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 13 (Big) Data Visualization | Big Data Analytics</title>
  <meta name="description" content="A guide to data science practitioners making the transition to Big Data." />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 13 (Big) Data Visualization | Big Data Analytics" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://umatter.github.io/BigData/img/cover.png" />
  <meta property="og:description" content="A guide to data science practitioners making the transition to Big Data." />
  <meta name="github-repo" content="umatter/BigData" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 13 (Big) Data Visualization | Big Data Analytics" />
  
  <meta name="twitter:description" content="A guide to data science practitioners making the transition to Big Data." />
  <meta name="twitter:image" content="https://umatter.github.io/BigData/img/cover.png" />

<meta name="author" content="Ulrich Matter" />


<meta name="date" content="2022-11-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="descriptive-statistics-and-aggregation.html"/>
<link rel="next" href="bottle-necks-in-local-big-data-analytics.html"/>
<script src="libs/jquery/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Big Data Analytics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="part"><span><b>I Setting the Scene: Analyzing Big Data</b></span></li>
<li class="chapter" data-level="" data-path="s.html"><a href="s.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="2" data-path="what-is-big-in-big-data.html"><a href="what-is-big-in-big-data.html"><i class="fa fa-check"></i><b>2</b> What is <em>big</em> in “Big Data”?</a></li>
<li class="chapter" data-level="3" data-path="approaches-to-analyzing-big-data.html"><a href="approaches-to-analyzing-big-data.html"><i class="fa fa-check"></i><b>3</b> Approaches to analyzing Big Data</a></li>
<li class="chapter" data-level="4" data-path="two-domains-of-big-data-analytics.html"><a href="two-domains-of-big-data-analytics.html"><i class="fa fa-check"></i><b>4</b> Two domains of Big Data Analytics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="two-domains-of-big-data-analytics.html"><a href="two-domains-of-big-data-analytics.html#a-practical-big-p-problem"><i class="fa fa-check"></i><b>4.1</b> A practical <em>big P</em> problem</a></li>
<li class="chapter" data-level="4.2" data-path="two-domains-of-big-data-analytics.html"><a href="two-domains-of-big-data-analytics.html#a-practical-big-n-problem"><i class="fa fa-check"></i><b>4.2</b> A practical <em>big N</em> problem</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="two-domains-of-big-data-analytics.html"><a href="two-domains-of-big-data-analytics.html#ols-as-a-point-of-reference"><i class="fa fa-check"></i><b>4.2.1</b> OLS as a point of reference</a></li>
<li class="chapter" data-level="4.2.2" data-path="two-domains-of-big-data-analytics.html"><a href="two-domains-of-big-data-analytics.html#the-uluru-algorithm-as-an-alternative-to-ols"><i class="fa fa-check"></i><b>4.2.2</b> The <em>Uluru</em> algorithm as an alternative to OLS</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="two-domains-of-big-data-analytics.html"><a href="two-domains-of-big-data-analytics.html#conclusion"><i class="fa fa-check"></i><b>4.3</b> Conclusion</a></li>
</ul></li>
<li class="part"><span><b>II Platform: Software and Computing Resources</b></span></li>
<li class="chapter" data-level="" data-path="p.html"><a href="p.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="5" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html"><i class="fa fa-check"></i><b>5</b> Software: Programming with (Big) Data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#domains-of-programming-with-big-data"><i class="fa fa-check"></i><b>5.1</b> Domains of programming with (big) data</a></li>
<li class="chapter" data-level="5.2" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#measuring-r-performance"><i class="fa fa-check"></i><b>5.2</b> Measuring R performance</a></li>
<li class="chapter" data-level="5.3" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#writing-efficient-r-code"><i class="fa fa-check"></i><b>5.3</b> Writing efficient R code</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#memory-allocation-and-growing-objects"><i class="fa fa-check"></i><b>5.3.1</b> Memory allocation and growing objects</a></li>
<li class="chapter" data-level="5.3.2" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#vectorization-in-basic-r-functions"><i class="fa fa-check"></i><b>5.3.2</b> Vectorization in basic R functions</a></li>
<li class="chapter" data-level="5.3.3" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#apply-type-functions-and-vectorization"><i class="fa fa-check"></i><b>5.3.3</b> <code>apply</code>-type functions and vectorization</a></li>
<li class="chapter" data-level="5.3.4" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#avoid-unnecessary-copying"><i class="fa fa-check"></i><b>5.3.4</b> Avoid unnecessary copying</a></li>
<li class="chapter" data-level="5.3.5" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#releasing-memory"><i class="fa fa-check"></i><b>5.3.5</b> Releasing memory</a></li>
<li class="chapter" data-level="5.3.6" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#beyond-r"><i class="fa fa-check"></i><b>5.3.6</b> Beyond R</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#sql-basics"><i class="fa fa-check"></i><b>5.4</b> SQL basics</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#first-steps-in-sqlite"><i class="fa fa-check"></i><b>5.4.1</b> First steps in SQL(ite)</a></li>
<li class="chapter" data-level="5.4.2" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#joins"><i class="fa fa-check"></i><b>5.4.2</b> Joins</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html"><i class="fa fa-check"></i><b>6</b> Hardware: Computing Resources</a>
<ul>
<li class="chapter" data-level="6.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#components-of-a-standard-computing-environment"><i class="fa fa-check"></i><b>6.1</b> Components of a standard computing environment</a></li>
<li class="chapter" data-level="6.2" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#mass-storage"><i class="fa fa-check"></i><b>6.2</b> Mass storage</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#avoid-redundancies"><i class="fa fa-check"></i><b>6.2.1</b> Avoid redundancies</a></li>
<li class="chapter" data-level="6.2.2" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#data-compression"><i class="fa fa-check"></i><b>6.2.2</b> Data compression</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#random-access-memory-ram"><i class="fa fa-check"></i><b>6.3</b> Random access memory (RAM)</a></li>
<li class="chapter" data-level="6.4" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#combining-ram-and-hard-disk-virtual-memory"><i class="fa fa-check"></i><b>6.4</b> Combining RAM and hard disk: virtual memory</a></li>
<li class="chapter" data-level="6.5" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#cpu-and-parallelization"><i class="fa fa-check"></i><b>6.5</b> CPU and parallelization</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#naive-multi-session-approach"><i class="fa fa-check"></i><b>6.5.1</b> Naive multi-session approach</a></li>
<li class="chapter" data-level="6.5.2" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#multi-core-and-multi-node-approach"><i class="fa fa-check"></i><b>6.5.2</b> Multi-core and multi-node approach</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#gpus-for-scientific-computing"><i class="fa fa-check"></i><b>6.6</b> GPUs for scientific computing</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#gpus-in-r"><i class="fa fa-check"></i><b>6.6.1</b> GPUs in R</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#the-road-ahead-hardware-made-for-machine-learning"><i class="fa fa-check"></i><b>6.7</b> The road ahead: Hardware made for machine learning</a></li>
<li class="chapter" data-level="6.8" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#insufficient-computing-resources"><i class="fa fa-check"></i><b>6.8</b> Insufficient computing resources?</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="distributed-systems.html"><a href="distributed-systems.html"><i class="fa fa-check"></i><b>7</b> Distributed Systems</a>
<ul>
<li class="chapter" data-level="7.1" data-path="distributed-systems.html"><a href="distributed-systems.html#mapreduce"><i class="fa fa-check"></i><b>7.1</b> MapReduce</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="distributed-systems.html"><a href="distributed-systems.html#mapreduce-concept-illustrated-in-r"><i class="fa fa-check"></i><b>7.1.1</b> Map/Reduce Concept Illustrated in R</a></li>
<li class="chapter" data-level="7.1.2" data-path="distributed-systems.html"><a href="distributed-systems.html#mapper"><i class="fa fa-check"></i><b>7.1.2</b> Mapper</a></li>
<li class="chapter" data-level="7.1.3" data-path="distributed-systems.html"><a href="distributed-systems.html#reducer"><i class="fa fa-check"></i><b>7.1.3</b> Reducer</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="distributed-systems.html"><a href="distributed-systems.html#hadoop"><i class="fa fa-check"></i><b>7.2</b> Hadoop</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="distributed-systems.html"><a href="distributed-systems.html#hadoop-word-count-example"><i class="fa fa-check"></i><b>7.2.1</b> Hadoop word count example</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="distributed-systems.html"><a href="distributed-systems.html#spark"><i class="fa fa-check"></i><b>7.3</b> Spark</a></li>
<li class="chapter" data-level="7.4" data-path="distributed-systems.html"><a href="distributed-systems.html#spark-with-r"><i class="fa fa-check"></i><b>7.4</b> Spark with R</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="distributed-systems.html"><a href="distributed-systems.html#data-import-and-summary-statistics"><i class="fa fa-check"></i><b>7.4.1</b> Data import and summary statistics</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="distributed-systems.html"><a href="distributed-systems.html#spark-with-sql"><i class="fa fa-check"></i><b>7.5</b> Spark with SQL</a></li>
<li class="chapter" data-level="7.6" data-path="distributed-systems.html"><a href="distributed-systems.html#spark-with-r-sql"><i class="fa fa-check"></i><b>7.6</b> Spark with R + SQL</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="cloud-computing.html"><a href="cloud-computing.html"><i class="fa fa-check"></i><b>8</b> Cloud Computing</a>
<ul>
<li class="chapter" data-level="8.1" data-path="cloud-computing.html"><a href="cloud-computing.html#cloud-computing-basics-and-platforms"><i class="fa fa-check"></i><b>8.1</b> Cloud computing basics and platforms</a></li>
<li class="chapter" data-level="8.2" data-path="cloud-computing.html"><a href="cloud-computing.html#scaling-up-in-the-cloud"><i class="fa fa-check"></i><b>8.2</b> Scaling up in the cloud</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="cloud-computing.html"><a href="cloud-computing.html#scaling-up-with-aws-ec2-and-rrstudio"><i class="fa fa-check"></i><b>8.2.1</b> Scaling up with AWS EC2 and R/RStudio</a></li>
<li class="chapter" data-level="8.2.2" data-path="cloud-computing.html"><a href="cloud-computing.html#scaling-up-with-gpus"><i class="fa fa-check"></i><b>8.2.2</b> Scaling up with GPUs</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="cloud-computing.html"><a href="cloud-computing.html#gpus-on-google-colab"><i class="fa fa-check"></i><b>8.3</b> GPUs on Google Colab</a></li>
<li class="chapter" data-level="8.4" data-path="cloud-computing.html"><a href="cloud-computing.html#scaling-out-mapreduce-in-the-cloud"><i class="fa fa-check"></i><b>8.4</b> Scaling out: MapReduce in the cloud</a></li>
</ul></li>
<li class="part"><span><b>III Components of Big Data Analytics</b></span></li>
<li class="chapter" data-level="" data-path="c.html"><a href="c.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="9" data-path="forms-of-big-data-and-the-data-pipeline.html"><a href="forms-of-big-data-and-the-data-pipeline.html"><i class="fa fa-check"></i><b>9</b> Forms of Big Data and the Data Pipeline</a>
<ul>
<li class="chapter" data-level="9.1" data-path="forms-of-big-data-and-the-data-pipeline.html"><a href="forms-of-big-data-and-the-data-pipeline.html#unstructured-semi-structured-structured-data"><i class="fa fa-check"></i><b>9.1</b> Unstructured, semi-structured, structured data</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html"><i class="fa fa-check"></i><b>10</b> Data Collection and Data Storage</a>
<ul>
<li class="chapter" data-level="10.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#gathering-and-compilation-of-raw-data"><i class="fa fa-check"></i><b>10.1</b> Gathering and compilation of raw data</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#nyc-taxi-data"><i class="fa fa-check"></i><b>10.1.1</b> NYC taxi data</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#data-import-and-memory-allocation"><i class="fa fa-check"></i><b>10.2</b> Data import and memory allocation</a></li>
<li class="chapter" data-level="10.3" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#efficient-local-data-storage"><i class="fa fa-check"></i><b>10.3</b> Efficient local data storage</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#rdbms-basics"><i class="fa fa-check"></i><b>10.3.1</b> RDBMS basics</a></li>
<li class="chapter" data-level="10.3.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#efficient-data-access-indices-and-joins-in-sqlite"><i class="fa fa-check"></i><b>10.3.2</b> Efficient data access: indices and joins in SQLite</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#connecting-r-to-rdbms"><i class="fa fa-check"></i><b>10.4</b> Connecting R to RDBMS</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#creating-a-new-database-with-rsqlite"><i class="fa fa-check"></i><b>10.4.1</b> Creating a new database with <code>RSQLite</code></a></li>
<li class="chapter" data-level="10.4.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#importing-data"><i class="fa fa-check"></i><b>10.4.2</b> Importing data</a></li>
<li class="chapter" data-level="10.4.3" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#issue-queries"><i class="fa fa-check"></i><b>10.4.3</b> Issue queries</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#cloud-solutions-for-big-data-storage"><i class="fa fa-check"></i><b>10.5</b> Cloud solutions for (big) data storage</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#easy-to-use-rdbms-in-the-cloud-aws-rds"><i class="fa fa-check"></i><b>10.5.1</b> Easy-to-use RDBMS in the cloud: AWS RDS</a></li>
<li class="chapter" data-level="10.5.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#database-server-in-the-cloud-mariadb-on-an-ec2-instance"><i class="fa fa-check"></i><b>10.5.2</b> Database server in the cloud: MariaDB on an EC2 instance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html"><i class="fa fa-check"></i><b>11</b> Big Data Cleaning and Transformation</a>
<ul>
<li class="chapter" data-level="11.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#out-of-memory-strategies"><i class="fa fa-check"></i><b>11.1</b> ‘Out-of-memory’ strategies</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#chunking-data-with-the-ff-package"><i class="fa fa-check"></i><b>11.1.1</b> Chunking data with the <code>ff</code>-package</a></li>
<li class="chapter" data-level="11.1.2" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#memory-mapping-with-bigmemory"><i class="fa fa-check"></i><b>11.1.2</b> Memory mapping with <code>bigmemory</code></a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#typical-cleaning-tasks"><i class="fa fa-check"></i><b>11.2</b> Typical cleaning tasks</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#data-preparation-with-ff"><i class="fa fa-check"></i><b>11.2.1</b> Data Preparation with <code>ff</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html"><i class="fa fa-check"></i><b>12</b> Descriptive Statistics and Aggregation</a>
<ul>
<li class="chapter" data-level="12.1" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#data-aggregation-the-split-apply-combine-strategy"><i class="fa fa-check"></i><b>12.1</b> Data aggregation: The ‘split-apply-combine’ strategy</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#data-aggregation-with-chunked-data-files"><i class="fa fa-check"></i><b>12.1.1</b> Data aggregation with chunked data files</a></li>
<li class="chapter" data-level="12.1.2" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#cross-tabulation-of-ff-vectors"><i class="fa fa-check"></i><b>12.1.2</b> Cross-tabulation of <code>ff</code> vectors</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#high-speed-in-memory-data-aggregation-with-data.table"><i class="fa fa-check"></i><b>12.2</b> High-speed in-memory data aggregation with <code>data.table</code></a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="big-data-visualization.html"><a href="big-data-visualization.html"><i class="fa fa-check"></i><b>13</b> (Big) Data Visualization</a>
<ul>
<li class="chapter" data-level="13.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#data-exploration-with-ggplot2"><i class="fa fa-check"></i><b>13.1</b> Data exploration with <code>ggplot2</code></a></li>
<li class="chapter" data-level="13.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#aside-modify-and-create-themes"><i class="fa fa-check"></i><b>13.2</b> Aside: modify and create themes</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#create-your-own-theme-simple-approach"><i class="fa fa-check"></i><b>13.2.1</b> Create your own theme: simple approach</a></li>
<li class="chapter" data-level="13.2.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#implementing-actual-themes-as-functions."><i class="fa fa-check"></i><b>13.2.2</b> Implementing actual themes as functions.</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="big-data-visualization.html"><a href="big-data-visualization.html#visualize-time-and-space"><i class="fa fa-check"></i><b>13.3</b> Visualize Time and Space</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#preparations"><i class="fa fa-check"></i><b>13.3.1</b> Preparations</a></li>
<li class="chapter" data-level="13.3.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#pick-up-and-drop-off-locations"><i class="fa fa-check"></i><b>13.3.2</b> Pick-up and drop-off locations</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="big-data-visualization.html"><a href="big-data-visualization.html#aside-change-color-schemes"><i class="fa fa-check"></i><b>13.4</b> Aside: change color schemes</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html"><i class="fa fa-check"></i><b>14</b> Bottle Necks in Local Big Data Analytics</a>
<ul>
<li class="chapter" data-level="14.1" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#case-study-data-import-and-memory-allocation"><i class="fa fa-check"></i><b>14.1</b> Case study: Data Import and Memory Allocation</a></li>
<li class="chapter" data-level="14.2" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#case-study-loops-memory-and-vectorization"><i class="fa fa-check"></i><b>14.2</b> Case Study: Loops, Memory, and Vectorization</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#preparation"><i class="fa fa-check"></i><b>14.2.1</b> Preparation</a></li>
<li class="chapter" data-level="14.2.2" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#naïve-approach-ignorant-of-r"><i class="fa fa-check"></i><b>14.2.2</b> Naïve Approach (ignorant of R)</a></li>
<li class="chapter" data-level="14.2.3" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#improvement-1-pre-allocation-of-memory"><i class="fa fa-check"></i><b>14.2.3</b> Improvement 1: Pre-allocation of memory</a></li>
<li class="chapter" data-level="14.2.4" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#improvement-2-exploit-vectorization"><i class="fa fa-check"></i><b>14.2.4</b> Improvement 2: Exploit vectorization</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#case-study-bootstrapping-and-parallel-processing"><i class="fa fa-check"></i><b>14.3</b> Case study: Bootstrapping and Parallel Processing</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#parallelization-with-an-ec2-instance-1"><i class="fa fa-check"></i><b>14.3.1</b> Parallelization with an EC2 instance</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="bottle-necks-in-local-big-data-analytics.html"><a href="bottle-necks-in-local-big-data-analytics.html#case-study-efficient-fixed-effects-estimation"><i class="fa fa-check"></i><b>14.4</b> Case Study: Efficient Fixed Effects Estimation</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="gpus-and-machine-learning.html"><a href="gpus-and-machine-learning.html"><i class="fa fa-check"></i><b>15</b> GPUs and Machine Learning</a>
<ul>
<li class="chapter" data-level="15.1" data-path="gpus-and-machine-learning.html"><a href="gpus-and-machine-learning.html#tensorflowkeras-example-predict-housing-prices"><i class="fa fa-check"></i><b>15.1</b> Tensorflow/Keras example: predict housing prices</a></li>
<li class="chapter" data-level="15.2" data-path="gpus-and-machine-learning.html"><a href="gpus-and-machine-learning.html#data-preparation-1"><i class="fa fa-check"></i><b>15.2</b> Data preparation</a></li>
<li class="chapter" data-level="15.3" data-path="gpus-and-machine-learning.html"><a href="gpus-and-machine-learning.html#model-specification"><i class="fa fa-check"></i><b>15.3</b> Model specification</a></li>
<li class="chapter" data-level="15.4" data-path="gpus-and-machine-learning.html"><a href="gpus-and-machine-learning.html#training-and-prediction"><i class="fa fa-check"></i><b>15.4</b> Training and prediction</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="gpus-and-machine-learning.html"><a href="gpus-and-machine-learning.html#a-word-of-caution"><i class="fa fa-check"></i><b>15.4.1</b> A word of caution</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Application: Topics in Big Data Econometrics</b></span></li>
<li class="chapter" data-level="" data-path="a.html"><a href="a.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="16" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html"><i class="fa fa-check"></i><b>16</b> Regression Analysis and Categorization with Spark and R</a>
<ul>
<li class="chapter" data-level="16.1" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#simple-regression-analysis"><i class="fa fa-check"></i><b>16.1</b> Simple regression analysis</a></li>
<li class="chapter" data-level="16.2" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#machine-learning-for-classification"><i class="fa fa-check"></i><b>16.2</b> Machine learning for classification</a></li>
<li class="chapter" data-level="16.3" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#building-machine-learning-pipelines-with-r-and-spark"><i class="fa fa-check"></i><b>16.3</b> Building machine learning pipelines with R and Spark</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#set-up-and-data-import"><i class="fa fa-check"></i><b>16.3.1</b> Set up and data import</a></li>
<li class="chapter" data-level="16.3.2" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#building-the-pipeline"><i class="fa fa-check"></i><b>16.3.2</b> Building the pipeline</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html"><i class="fa fa-check"></i><b>17</b> Large-scale Text Analysis with sparklyr</a>
<ul>
<li class="chapter" data-level="17.1" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html#getting-started-import-preparation-and-word-frequencies"><i class="fa fa-check"></i><b>17.1</b> Getting started: import, preparation, and word frequencies</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-a.html"><a href="appendix-a.html"><i class="fa fa-check"></i><b>A</b> Appendix A</a>
<ul>
<li class="chapter" data-level="A.1" data-path="appendix-a.html"><a href="appendix-a.html#github"><i class="fa fa-check"></i><b>A.1</b> GitHub</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="appendix-a.html"><a href="appendix-a.html#initiate-a-new-repository"><i class="fa fa-check"></i><b>A.1.1</b> Initiate a new repository</a></li>
<li class="chapter" data-level="A.1.2" data-path="appendix-a.html"><a href="appendix-a.html#clone-this-courses-repository"><i class="fa fa-check"></i><b>A.1.2</b> Clone this course’s repository</a></li>
<li class="chapter" data-level="A.1.3" data-path="appendix-a.html"><a href="appendix-a.html#fork-this-courses-repository"><i class="fa fa-check"></i><b>A.1.3</b> Fork this course’s repository</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="appendix-b.html"><a href="appendix-b.html"><i class="fa fa-check"></i><b>B</b> Appendix B</a>
<ul>
<li class="chapter" data-level="B.1" data-path="appendix-b.html"><a href="appendix-b.html#data-types-and-memorystorage"><i class="fa fa-check"></i><b>B.1</b> Data types and memory/storage</a>
<ul>
<li class="chapter" data-level="B.1.1" data-path="appendix-b.html"><a href="appendix-b.html#example-in-r-data-types-and-information-storage"><i class="fa fa-check"></i><b>B.1.1</b> Example in R: Data types and information storage</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="appendix-b.html"><a href="appendix-b.html#data-structures"><i class="fa fa-check"></i><b>B.2</b> Data structures</a>
<ul>
<li class="chapter" data-level="B.2.1" data-path="appendix-b.html"><a href="appendix-b.html#vectors-vs-factors-in-r"><i class="fa fa-check"></i><b>B.2.1</b> Vectors vs Factors in R</a></li>
<li class="chapter" data-level="B.2.2" data-path="appendix-b.html"><a href="appendix-b.html#matricesarrays"><i class="fa fa-check"></i><b>B.2.2</b> Matrices/Arrays</a></li>
<li class="chapter" data-level="B.2.3" data-path="appendix-b.html"><a href="appendix-b.html#data-frames-tibbles-and-data-tables"><i class="fa fa-check"></i><b>B.2.3</b> Data frames, tibbles, and data tables</a></li>
<li class="chapter" data-level="B.2.4" data-path="appendix-b.html"><a href="appendix-b.html#lists"><i class="fa fa-check"></i><b>B.2.4</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="appendix-b.html"><a href="appendix-b.html#r-tools-to-investigate-structures-and-types"><i class="fa fa-check"></i><b>B.3</b> R-tools to investigate structures and types</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="appendix-c.html"><a href="appendix-c.html"><i class="fa fa-check"></i><b>C</b> Appendix C</a>
<ul>
<li class="chapter" data-level="C.1" data-path="appendix-c.html"><a href="appendix-c.html#install-hadoop-on-ubuntu-linux"><i class="fa fa-check"></i><b>C.1</b> Install Hadoop (on Ubuntu Linux)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://umatter.github.io" target="blank">umatter.github.io</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Big Data Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="big-data-visualization" class="section level1 hasAnchor" number="13">
<h1><span class="header-section-number">Chapter 13</span> (Big) Data Visualization<a href="big-data-visualization.html#big-data-visualization" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="data-exploration-with-ggplot2" class="section level2 hasAnchor" number="13.1">
<h2><span class="header-section-number">13.1</span> Data exploration with <code>ggplot2</code><a href="big-data-visualization.html#data-exploration-with-ggplot2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this tutorial we will work with the TLC data used in the data aggregation session. The raw data consists of several monthly CSV-files and can be downloaded via the <a href="https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page">TLC’s website</a>. Again, we work only with the first million observations.</p>
<p>In order to better understand the large data set at hand (particularly regarding the determinants of tips paid) we use <code>ggplot2</code> to visualize some key aspects of the data.</p>
<p>First, let’s look at the raw relationship between fare paid and the tip paid. We set up the canvas with <code>ggplot</code>.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="big-data-visualization.html#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb364-2"><a href="big-data-visualization.html#cb364-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb364-3"><a href="big-data-visualization.html#cb364-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-4"><a href="big-data-visualization.html#cb364-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set up the canvas</span></span>
<span id="cb364-5"><a href="big-data-visualization.html#cb364-5" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(taxi, <span class="fu">aes</span>(<span class="at">y=</span>tip_amount, <span class="at">x=</span> fare_amount)) </span>
<span id="cb364-6"><a href="big-data-visualization.html#cb364-6" aria-hidden="true" tabindex="-1"></a>taxiplot</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-185-1.png" width="672" /></p>
<p>Now we visualize the co-distribution of the two variables with a simple scatter-plot.</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="big-data-visualization.html#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simple x/y plot</span></span>
<span id="cb365-2"><a href="big-data-visualization.html#cb365-2" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="sc">+</span></span>
<span id="cb365-3"><a href="big-data-visualization.html#cb365-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-186-1.png" width="672" /></p>
<p>Note that this took quite a while, as R had to literally plot one million dots on the canvas. Moreover many dots fall within the same area, making it impossible to recognize how much mass there actually is. This is typical for visualization exercises with large data sets. One way to improve this, is by making the dots more transparent by setting the <code>alpha</code> parameter.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="big-data-visualization.html#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simple x/y plot</span></span>
<span id="cb366-2"><a href="big-data-visualization.html#cb366-2" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="sc">+</span></span>
<span id="cb366-3"><a href="big-data-visualization.html#cb366-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-187-1.png" width="672" /></p>
<p>Alternatively, we can compute two-dimensional bins. Thereby, the canvas is split into rectangles and the number of observations falling into each respective rectangle is computed. The visualization is based on plotting the rectangles with counts greater than 0 and the shading of the rectangles indicates the count values.</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="big-data-visualization.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2-dimensional bins</span></span>
<span id="cb367-2"><a href="big-data-visualization.html#cb367-2" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="sc">+</span></span>
<span id="cb367-3"><a href="big-data-visualization.html#cb367-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_bin2d</span>()</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-188-1.png" width="672" /></p>
<p>A large part of the tip/fare observations seem to be in the very lower-left corner of the pane, while most other trips seem to be evenly distributed. However, we fail to see slighter differences in this visualization. In order to reduce the dominance of the 2d-bins with very high counts, we display the natural logarithm of counts and display the bins as points.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="big-data-visualization.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2-dimensional bins</span></span>
<span id="cb368-2"><a href="big-data-visualization.html#cb368-2" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="sc">+</span></span>
<span id="cb368-3"><a href="big-data-visualization.html#cb368-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">stat_bin_2d</span>(<span class="at">geom=</span><span class="st">&quot;point&quot;</span>,</span>
<span id="cb368-4"><a href="big-data-visualization.html#cb368-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">mapping=</span> <span class="fu">aes</span>(<span class="at">size =</span> <span class="fu">log</span>(..count..))) <span class="sc">+</span></span>
<span id="cb368-5"><a href="big-data-visualization.html#cb368-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">guides</span>(<span class="at">fill =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated.
## Please use `guides(&lt;scale&gt; = &quot;none&quot;)` instead.</code></pre>
<p><img src="bigdata_files/figure-html/unnamed-chunk-189-1.png" width="672" /></p>
<p>We note that there are many cases with very low fare amounts, many cases with no or hardly any tip, and quite a lot of cases with very high tip amounts (in relation to the rather low fare amount). In the following, we dissect this picture by having a closer look at ‘typical’ tip amounts and whether they differ by type of payment.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="big-data-visualization.html#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute frequency of per tip amount and payment method</span></span>
<span id="cb370-2"><a href="big-data-visualization.html#cb370-2" aria-hidden="true" tabindex="-1"></a>taxi[, n_same_tip<span class="sc">:</span><span class="er">=</span> .N, by<span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;tip_amount&quot;</span>, <span class="st">&quot;payment_type&quot;</span>)]</span>
<span id="cb370-3"><a href="big-data-visualization.html#cb370-3" aria-hidden="true" tabindex="-1"></a>frequencies <span class="ot">&lt;-</span> <span class="fu">unique</span>(taxi[payment_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;credit&quot;</span>, <span class="st">&quot;cash&quot;</span>),</span>
<span id="cb370-4"><a href="big-data-visualization.html#cb370-4" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">c</span>(<span class="st">&quot;n_same_tip&quot;</span>, <span class="st">&quot;tip_amount&quot;</span>, <span class="st">&quot;payment_type&quot;</span>)][<span class="fu">order</span>(n_same_tip, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)])</span>
<span id="cb370-5"><a href="big-data-visualization.html#cb370-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-6"><a href="big-data-visualization.html#cb370-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-7"><a href="big-data-visualization.html#cb370-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot top 20 frequent tip amounts</span></span>
<span id="cb370-8"><a href="big-data-visualization.html#cb370-8" aria-hidden="true" tabindex="-1"></a>fare <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> frequencies[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>], <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(tip_amount), <span class="at">y =</span> n_same_tip)) </span>
<span id="cb370-9"><a href="big-data-visualization.html#cb370-9" aria-hidden="true" tabindex="-1"></a>fare <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) </span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-190-1.png" width="672" /></p>
<p>Indeed, paying no tip at all is quite frequent, overall.<a href="#fn43" class="footnote-ref" id="fnref43"><sup>43</sup></a> The bar plot also indicates that there seem to be some ‘focal points’ in the amount of tips paid. Clearly, paying one USD or two USD is more common than paying fractions. However, fractions of dollars might be more likely if tips are paid in cash and customers simply add some loose change to the fare amount paid.</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="big-data-visualization.html#cb371-1" aria-hidden="true" tabindex="-1"></a>fare <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span> </span>
<span id="cb371-2"><a href="big-data-visualization.html#cb371-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">facet_wrap</span>(<span class="st">&quot;payment_type&quot;</span>) </span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-191-1.png" width="672" /></p>
<p>Clearly, it looks like trips paid in cash tend not to be tipped (at least in this subsample).</p>
<p>Let’s try to tease this information out of the initial points plot. Trips paid in cash are often not tipped, we thus should indicate the payment method. Moreover, tips paid in full dollar amounts might indicate a habit.</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="big-data-visualization.html#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="co"># indicate natural numbers</span></span>
<span id="cb372-2"><a href="big-data-visualization.html#cb372-2" aria-hidden="true" tabindex="-1"></a>taxi[, dollar_paid <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(tip_amount <span class="sc">==</span> <span class="fu">round</span>(tip_amount,<span class="dv">0</span>), <span class="st">&quot;Full&quot;</span>, <span class="st">&quot;Fraction&quot;</span>),]</span>
<span id="cb372-3"><a href="big-data-visualization.html#cb372-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-4"><a href="big-data-visualization.html#cb372-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-5"><a href="big-data-visualization.html#cb372-5" aria-hidden="true" tabindex="-1"></a><span class="co"># extended x/y plot</span></span>
<span id="cb372-6"><a href="big-data-visualization.html#cb372-6" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="sc">+</span></span>
<span id="cb372-7"><a href="big-data-visualization.html#cb372-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.2</span>, <span class="fu">aes</span>(<span class="at">color=</span>payment_type)) <span class="sc">+</span></span>
<span id="cb372-8"><a href="big-data-visualization.html#cb372-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">facet_wrap</span>(<span class="st">&quot;dollar_paid&quot;</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-192-1.png" width="672" /></p>
<p>Now the picture is getting clearer. Paying tip seems to follow certain rules of thumb. Certain fixed amounts tend to be paid independent of the fare amount (visible in the straight lines of dots on the right-hand panel). At the same time, the pattern in the left panel indicates another habit: computing the amount of tip as a linear function of the total fare amount (‘pay 10% tip’). A third habit might be to determine the amount of tip by ‘rounding up’ the total amount paid. In the following, we try to tease the latter out, only focusing on credit card payments.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="big-data-visualization.html#cb373-1" aria-hidden="true" tabindex="-1"></a>taxi[, rounded_up <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(fare_amount <span class="sc">+</span> tip_amount <span class="sc">==</span> <span class="fu">round</span>(fare_amount <span class="sc">+</span> tip_amount, <span class="dv">0</span>),</span>
<span id="cb373-2"><a href="big-data-visualization.html#cb373-2" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;Rounded up&quot;</span>,</span>
<span id="cb373-3"><a href="big-data-visualization.html#cb373-3" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;Not rounded&quot;</span>)]</span>
<span id="cb373-4"><a href="big-data-visualization.html#cb373-4" aria-hidden="true" tabindex="-1"></a><span class="co"># extended x/y plot</span></span>
<span id="cb373-5"><a href="big-data-visualization.html#cb373-5" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="sc">+</span></span>
<span id="cb373-6"><a href="big-data-visualization.html#cb373-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">data=</span> taxi[payment_type <span class="sc">==</span> <span class="st">&quot;credit&quot;</span>],</span>
<span id="cb373-7"><a href="big-data-visualization.html#cb373-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="fu">aes</span>(<span class="at">color=</span>rounded_up)) <span class="sc">+</span></span>
<span id="cb373-8"><a href="big-data-visualization.html#cb373-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">facet_wrap</span>(<span class="st">&quot;dollar_paid&quot;</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-193-1.png" width="672" /></p>
<p>Now we can start modelling. A reasonable first shot is to model the tip amount as a linear function of the fare amount, conditional on the no-zero tip amounts paid as fractions of a dollar.</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="big-data-visualization.html#cb374-1" aria-hidden="true" tabindex="-1"></a>modelplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span> taxi[payment_type <span class="sc">==</span> <span class="st">&quot;credit&quot;</span> <span class="sc">&amp;</span> dollar_paid <span class="sc">==</span> <span class="st">&quot;Fraction&quot;</span> <span class="sc">&amp;</span> <span class="dv">0</span> <span class="sc">&lt;</span> tip_amount],</span>
<span id="cb374-2"><a href="big-data-visualization.html#cb374-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x =</span> fare_amount, <span class="at">y =</span> tip_amount))</span>
<span id="cb374-3"><a href="big-data-visualization.html#cb374-3" aria-hidden="true" tabindex="-1"></a>modelplot <span class="sc">+</span></span>
<span id="cb374-4"><a href="big-data-visualization.html#cb374-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">colour=</span><span class="st">&quot;darkgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb374-5"><a href="big-data-visualization.html#cb374-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="bigdata_files/figure-html/unnamed-chunk-194-1.png" width="672" /></p>
<p>Finally, we prepare the plot for reporting. <code>ggplot2</code> provides several predefined ‘themes’ for plots which define all kind of aspects of a plot (background color, line colors, font size etc.). The easiest way to tweak the design of your final plot in a certain direction is to just add such a pre-defined theme at the end of your plot. Some of the pre-defined themes allow you to change a few aspects such as the font type and the base size of all the texts in the plot (labels and tick numbers etc.). Here, we use the <code>theme_bw()</code>, increase the font size and switch to serif-type font. <code>theme_bw()</code> is one of the complete themes already shipped with the basic <code>ggplot2</code> installation.<a href="#fn44" class="footnote-ref" id="fnref44"><sup>44</sup></a> Many more themes can be found in additional R packages (see, for example, the <a href="https://cran.r-project.org/web/packages/ggthemes/index.html"><code>ggthemes</code> package</a>).</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="big-data-visualization.html#cb376-1" aria-hidden="true" tabindex="-1"></a>modelplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span> taxi[payment_type <span class="sc">==</span> <span class="st">&quot;credit&quot;</span> <span class="sc">&amp;</span> dollar_paid <span class="sc">==</span> <span class="st">&quot;Fraction&quot;</span> <span class="sc">&amp;</span> <span class="dv">0</span> <span class="sc">&lt;</span> tip_amount],</span>
<span id="cb376-2"><a href="big-data-visualization.html#cb376-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x =</span> fare_amount, <span class="at">y =</span> tip_amount))</span>
<span id="cb376-3"><a href="big-data-visualization.html#cb376-3" aria-hidden="true" tabindex="-1"></a>modelplot <span class="sc">+</span></span>
<span id="cb376-4"><a href="big-data-visualization.html#cb376-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">colour=</span><span class="st">&quot;darkgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb376-5"><a href="big-data-visualization.html#cb376-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb376-6"><a href="big-data-visualization.html#cb376-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ylab</span>(<span class="st">&quot;Amount of tip paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb376-7"><a href="big-data-visualization.html#cb376-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">xlab</span>(<span class="st">&quot;Amount of fare paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb376-8"><a href="big-data-visualization.html#cb376-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>, <span class="at">base_family =</span> <span class="st">&quot;serif&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="bigdata_files/figure-html/unnamed-chunk-195-1.png" width="672" /></p>
</div>
<div id="aside-modify-and-create-themes" class="section level2 hasAnchor" number="13.2">
<h2><span class="header-section-number">13.2</span> Aside: modify and create themes<a href="big-data-visualization.html#aside-modify-and-create-themes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Apart from using pre-defined themes as illustrated above, we can use the <code>theme()</code> function to further modify the design of a plot. For example, we can print the axis labels (‘axis titles’) in bold.</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="big-data-visualization.html#cb378-1" aria-hidden="true" tabindex="-1"></a>modelplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span> taxi[payment_type <span class="sc">==</span> <span class="st">&quot;credit&quot;</span> <span class="sc">&amp;</span> dollar_paid <span class="sc">==</span> <span class="st">&quot;Fraction&quot;</span> <span class="sc">&amp;</span> <span class="dv">0</span> <span class="sc">&lt;</span> tip_amount],</span>
<span id="cb378-2"><a href="big-data-visualization.html#cb378-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x =</span> fare_amount, <span class="at">y =</span> tip_amount))</span>
<span id="cb378-3"><a href="big-data-visualization.html#cb378-3" aria-hidden="true" tabindex="-1"></a>modelplot <span class="sc">+</span></span>
<span id="cb378-4"><a href="big-data-visualization.html#cb378-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">colour=</span><span class="st">&quot;darkgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb378-5"><a href="big-data-visualization.html#cb378-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb378-6"><a href="big-data-visualization.html#cb378-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ylab</span>(<span class="st">&quot;Amount of tip paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb378-7"><a href="big-data-visualization.html#cb378-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">xlab</span>(<span class="st">&quot;Amount of fare paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb378-8"><a href="big-data-visualization.html#cb378-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>, <span class="at">base_family =</span> <span class="st">&quot;serif&quot;</span>) <span class="sc">+</span></span>
<span id="cb378-9"><a href="big-data-visualization.html#cb378-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="bigdata_files/figure-html/unnamed-chunk-196-1.png" width="672" /></p>
<p>There is a large list of plot design aspects that can be modified in this way (see <code>?theme()</code> for details).</p>
<div id="create-your-own-theme-simple-approach" class="section level3 hasAnchor" number="13.2.1">
<h3><span class="header-section-number">13.2.1</span> Create your own theme: simple approach<a href="big-data-visualization.html#create-your-own-theme-simple-approach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Extensive design modifications via <code>theme()</code> can involve many lines of code, making your plot code harder to read/understand. In practice, you might want to define your specific theme once and then apply this theme to all of your plots. In order to do so it makes sense to choose one of the existing themes as a basis and then modify its design aspects until you have the design you are looking for. Following the design choices in the examples above, we can create our own <code>theme_my_serif()</code> as follows.</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="big-data-visualization.html#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;define&#39; a new theme</span></span>
<span id="cb380-2"><a href="big-data-visualization.html#cb380-2" aria-hidden="true" tabindex="-1"></a>theme_my_serif <span class="ot">&lt;-</span>      </span>
<span id="cb380-3"><a href="big-data-visualization.html#cb380-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>, <span class="at">base_family =</span> <span class="st">&quot;serif&quot;</span>) <span class="sc">+</span></span>
<span id="cb380-4"><a href="big-data-visualization.html#cb380-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">&quot;bold&quot;</span>))</span>
<span id="cb380-5"><a href="big-data-visualization.html#cb380-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-6"><a href="big-data-visualization.html#cb380-6" aria-hidden="true" tabindex="-1"></a><span class="co"># apply it </span></span>
<span id="cb380-7"><a href="big-data-visualization.html#cb380-7" aria-hidden="true" tabindex="-1"></a>modelplot <span class="sc">+</span></span>
<span id="cb380-8"><a href="big-data-visualization.html#cb380-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">colour=</span><span class="st">&quot;darkgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb380-9"><a href="big-data-visualization.html#cb380-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb380-10"><a href="big-data-visualization.html#cb380-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ylab</span>(<span class="st">&quot;Amount of tip paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb380-11"><a href="big-data-visualization.html#cb380-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">xlab</span>(<span class="st">&quot;Amount of fare paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb380-12"><a href="big-data-visualization.html#cb380-12" aria-hidden="true" tabindex="-1"></a>  theme_my_serif</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="bigdata_files/figure-html/unnamed-chunk-197-1.png" width="672" /></p>
<p>This practical approach does not require you to define every aspect of a theme. If you indeed want completely define every aspect of a theme, you can set <code>complete=TRUE</code> when calling the theme function.</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="big-data-visualization.html#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;define&#39; a new theme</span></span>
<span id="cb382-2"><a href="big-data-visualization.html#cb382-2" aria-hidden="true" tabindex="-1"></a>my_serif_theme <span class="ot">&lt;-</span>      </span>
<span id="cb382-3"><a href="big-data-visualization.html#cb382-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>, <span class="at">base_family =</span> <span class="st">&quot;serif&quot;</span>) <span class="sc">+</span></span>
<span id="cb382-4"><a href="big-data-visualization.html#cb382-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">&quot;bold&quot;</span>), <span class="at">complete =</span> <span class="cn">TRUE</span>)</span>
<span id="cb382-5"><a href="big-data-visualization.html#cb382-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb382-6"><a href="big-data-visualization.html#cb382-6" aria-hidden="true" tabindex="-1"></a><span class="co"># apply it </span></span>
<span id="cb382-7"><a href="big-data-visualization.html#cb382-7" aria-hidden="true" tabindex="-1"></a>modelplot <span class="sc">+</span></span>
<span id="cb382-8"><a href="big-data-visualization.html#cb382-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">colour=</span><span class="st">&quot;darkgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb382-9"><a href="big-data-visualization.html#cb382-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb382-10"><a href="big-data-visualization.html#cb382-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ylab</span>(<span class="st">&quot;Amount of tip paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb382-11"><a href="big-data-visualization.html#cb382-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">xlab</span>(<span class="st">&quot;Amount of fare paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb382-12"><a href="big-data-visualization.html#cb382-12" aria-hidden="true" tabindex="-1"></a>  theme_my_serif</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="bigdata_files/figure-html/unnamed-chunk-198-1.png" width="672" /></p>
<p>Note that since we have only defined one aspect (bold axis titles), the rest of the elements follow the default theme.</p>
<p>Importantly, the approach outlined above does technically not really create a new theme like <code>theme_bw()</code>, as these pre-defined themes are implemented as functions. Note that we add the new theme simply with <code>+ theme_my_serif</code> to the plot (no parentheses). In practice this is the most simple approach and it provides all the functionality you need in order to apply your own ‘theme’ to each of your plots.</p>
</div>
<div id="implementing-actual-themes-as-functions." class="section level3 hasAnchor" number="13.2.2">
<h3><span class="header-section-number">13.2.2</span> Implementing actual themes as functions.<a href="big-data-visualization.html#implementing-actual-themes-as-functions." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you really want to implement a theme as a function. The following blueprint can get you started.</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="big-data-visualization.html#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define own theme</span></span>
<span id="cb384-2"><a href="big-data-visualization.html#cb384-2" aria-hidden="true" tabindex="-1"></a>theme_my_serif <span class="ot">&lt;-</span> </span>
<span id="cb384-3"><a href="big-data-visualization.html#cb384-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(<span class="at">base_size =</span> <span class="dv">15</span>,</span>
<span id="cb384-4"><a href="big-data-visualization.html#cb384-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">base_family =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb384-5"><a href="big-data-visualization.html#cb384-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">base_line_size =</span> base_size<span class="sc">/</span><span class="dv">170</span>,</span>
<span id="cb384-6"><a href="big-data-visualization.html#cb384-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">base_rect_size =</span> base_size<span class="sc">/</span><span class="dv">170</span>){ </span>
<span id="cb384-7"><a href="big-data-visualization.html#cb384-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb384-8"><a href="big-data-visualization.html#cb384-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> base_size,</span>
<span id="cb384-9"><a href="big-data-visualization.html#cb384-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">base_family =</span> base_family,</span>
<span id="cb384-10"><a href="big-data-visualization.html#cb384-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">base_line_size =</span> base_size<span class="sc">/</span><span class="dv">170</span>,</span>
<span id="cb384-11"><a href="big-data-visualization.html#cb384-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">base_rect_size =</span> base_size<span class="sc">/</span><span class="dv">170</span>) <span class="sc">%+replace%</span>    <span class="co"># use theme_bw() as a basis but replace some design elements</span></span>
<span id="cb384-12"><a href="big-data-visualization.html#cb384-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb384-13"><a href="big-data-visualization.html#cb384-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">&quot;bold&quot;</span>)</span>
<span id="cb384-14"><a href="big-data-visualization.html#cb384-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb384-15"><a href="big-data-visualization.html#cb384-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb384-16"><a href="big-data-visualization.html#cb384-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-17"><a href="big-data-visualization.html#cb384-17" aria-hidden="true" tabindex="-1"></a><span class="co"># apply the theme</span></span>
<span id="cb384-18"><a href="big-data-visualization.html#cb384-18" aria-hidden="true" tabindex="-1"></a><span class="co"># apply it </span></span>
<span id="cb384-19"><a href="big-data-visualization.html#cb384-19" aria-hidden="true" tabindex="-1"></a>modelplot <span class="sc">+</span></span>
<span id="cb384-20"><a href="big-data-visualization.html#cb384-20" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">colour=</span><span class="st">&quot;darkgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb384-21"><a href="big-data-visualization.html#cb384-21" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb384-22"><a href="big-data-visualization.html#cb384-22" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ylab</span>(<span class="st">&quot;Amount of tip paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb384-23"><a href="big-data-visualization.html#cb384-23" aria-hidden="true" tabindex="-1"></a>     <span class="fu">xlab</span>(<span class="st">&quot;Amount of fare paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb384-24"><a href="big-data-visualization.html#cb384-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_my_serif</span>(<span class="at">base_size =</span> <span class="dv">18</span>, <span class="at">base_family=</span><span class="st">&quot;serif&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="bigdata_files/figure-html/unnamed-chunk-199-1.png" width="672" /></p>
</div>
</div>
<div id="visualize-time-and-space" class="section level2 hasAnchor" number="13.3">
<h2><span class="header-section-number">13.3</span> Visualize Time and Space<a href="big-data-visualization.html#visualize-time-and-space" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The previous visualization exercises were focused on visually exploring patterns in the tipping behavior of people taking a NYC yellow cap ride. Based on the same data set, will explore the time dimension and spatial dimension of the TLC Yellow Cap data. That is, we explore where trips tend to start and end, depending on the time of the day.</p>
<div id="preparations" class="section level3 hasAnchor" number="13.3.1">
<h3><span class="header-section-number">13.3.1</span> Preparations<a href="big-data-visualization.html#preparations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For the visualization of spatial data we first load additional packages that give R some <a href="https://en.wikipedia.org/wiki/Geographic_information_system">GIS</a> features.</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="big-data-visualization.html#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load GIS packages</span></span>
<span id="cb386-2"><a href="big-data-visualization.html#cb386-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb386-3"><a href="big-data-visualization.html#cb386-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgeos)</span></code></pre></div>
<p>Moreover, we download and import a so-called <a href="https://en.wikipedia.org/wiki/Shapefile">‘shape file’</a> (a geospatial data format) of New York City. This will be the basis for our visualization of the spatial dimension of taxi trips. The file is downloaded from <a href="https://www1.nyc.gov/site/planning/index.page">New York’s Department of City Planning</a> and indicates the city’s community district borders.<a href="#fn45" class="footnote-ref" id="fnref45"><sup>45</sup></a></p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="big-data-visualization.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download the zipped shapefile to a temporary file, unzip</span></span>
<span id="cb387-2"><a href="big-data-visualization.html#cb387-2" aria-hidden="true" tabindex="-1"></a>URL <span class="ot">&lt;-</span> <span class="st">&quot;https://www1.nyc.gov/assets/planning/download/zip/data-maps/open-data/nycd_19a.zip&quot;</span></span>
<span id="cb387-3"><a href="big-data-visualization.html#cb387-3" aria-hidden="true" tabindex="-1"></a>tmp_file <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb387-4"><a href="big-data-visualization.html#cb387-4" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(URL, tmp_file)</span>
<span id="cb387-5"><a href="big-data-visualization.html#cb387-5" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">unzip</span>(tmp_file, <span class="at">exdir=</span> <span class="st">&quot;data&quot;</span>)</span>
<span id="cb387-6"><a href="big-data-visualization.html#cb387-6" aria-hidden="true" tabindex="-1"></a><span class="co"># delete the temporary file</span></span>
<span id="cb387-7"><a href="big-data-visualization.html#cb387-7" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(tmp_file)</span></code></pre></div>
<p>Now we can import the shape file and have a look at how the GIS data is structured.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="big-data-visualization.html#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read GIS data</span></span>
<span id="cb388-2"><a href="big-data-visualization.html#cb388-2" aria-hidden="true" tabindex="-1"></a>nyc_map <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(file_path[<span class="dv">1</span>], <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb388-3"><a href="big-data-visualization.html#cb388-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-4"><a href="big-data-visualization.html#cb388-4" aria-hidden="true" tabindex="-1"></a><span class="co"># have a look at the GIS data</span></span>
<span id="cb388-5"><a href="big-data-visualization.html#cb388-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nyc_map)</span></code></pre></div>
<pre><code>## Object of class SpatialPolygonsDataFrame
## Coordinates:
##      min     max
## x 913175 1067383
## y 120122  272844
## Is projected: TRUE 
## proj4string :
## [+proj=lcc +lat_0=40.1666666666667 +lon_0=-74
## +lat_1=41.0333333333333 +lat_2=40.6666666666667
## +x_0=300000 +y_0=0 +datum=NAD83 +units=us-ft
## +no_defs]
## Data attributes:
##      BoroCD      Shape_Leng       Shape_Area      
##  Min.   :101   Min.   : 23963   Min.   :2.43e+07  
##  1st Qu.:206   1st Qu.: 36611   1st Qu.:4.84e+07  
##  Median :308   Median : 52246   Median :8.27e+07  
##  Mean   :297   Mean   : 74890   Mean   :1.19e+08  
##  3rd Qu.:406   3rd Qu.: 85711   3rd Qu.:1.37e+08  
##  Max.   :595   Max.   :270660   Max.   :5.99e+08</code></pre>
<p>Note that the coordinates are not in the usual longitude and latitude units. The original map uses a different projection than the TLC data of cap trips records. Before plotting, we thus have to change the projection to be in line with the TLC data.</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="big-data-visualization.html#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform the projection</span></span>
<span id="cb390-2"><a href="big-data-visualization.html#cb390-2" aria-hidden="true" tabindex="-1"></a>nyc_map <span class="ot">&lt;-</span> <span class="fu">spTransform</span>(nyc_map, <span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0&quot;</span>))</span>
<span id="cb390-3"><a href="big-data-visualization.html#cb390-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check result</span></span>
<span id="cb390-4"><a href="big-data-visualization.html#cb390-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nyc_map)</span></code></pre></div>
<pre><code>## Object of class SpatialPolygonsDataFrame
## Coordinates:
##      min    max
## x -74.26 -73.70
## y  40.50  40.92
## Is projected: FALSE 
## proj4string : [+proj=longlat +datum=WGS84 +no_defs]
## Data attributes:
##      BoroCD      Shape_Leng       Shape_Area      
##  Min.   :101   Min.   : 23963   Min.   :2.43e+07  
##  1st Qu.:206   1st Qu.: 36611   1st Qu.:4.84e+07  
##  Median :308   Median : 52246   Median :8.27e+07  
##  Mean   :297   Mean   : 74890   Mean   :1.19e+08  
##  3rd Qu.:406   3rd Qu.: 85711   3rd Qu.:1.37e+08  
##  Max.   :595   Max.   :270660   Max.   :5.99e+08</code></pre>
<p>One last preparatory step is to convert the map data to a <code>data.frame</code> for plotting with <code>ggplot</code>.</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="big-data-visualization.html#cb392-1" aria-hidden="true" tabindex="-1"></a>nyc_map <span class="ot">&lt;-</span> <span class="fu">fortify</span>(nyc_map)</span></code></pre></div>
</div>
<div id="pick-up-and-drop-off-locations" class="section level3 hasAnchor" number="13.3.2">
<h3><span class="header-section-number">13.3.2</span> Pick-up and drop-off locations<a href="big-data-visualization.html#pick-up-and-drop-off-locations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Since trips might actually start or end outside of NYC, we first restrict the sample of trips to those within the boundary box of the map. For the sake of the exercise, we only select a random sample of <code>50000</code> trips from the remaining trip records.</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="big-data-visualization.html#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="co"># taxi trips plot data</span></span>
<span id="cb393-2"><a href="big-data-visualization.html#cb393-2" aria-hidden="true" tabindex="-1"></a>taxi_trips <span class="ot">&lt;-</span> taxi[start_long <span class="sc">&lt;=</span> <span class="fu">max</span>(nyc_map<span class="sc">$</span>long) <span class="sc">&amp;</span> </span>
<span id="cb393-3"><a href="big-data-visualization.html#cb393-3" aria-hidden="true" tabindex="-1"></a>                        start_long <span class="sc">&gt;=</span> <span class="fu">min</span>(nyc_map<span class="sc">$</span>long) <span class="sc">&amp;</span></span>
<span id="cb393-4"><a href="big-data-visualization.html#cb393-4" aria-hidden="true" tabindex="-1"></a>                        dest_long <span class="sc">&lt;=</span> <span class="fu">max</span>(nyc_map<span class="sc">$</span>long) <span class="sc">&amp;</span></span>
<span id="cb393-5"><a href="big-data-visualization.html#cb393-5" aria-hidden="true" tabindex="-1"></a>                        dest_long <span class="sc">&gt;=</span> <span class="fu">min</span>(nyc_map<span class="sc">$</span>long) <span class="sc">&amp;</span></span>
<span id="cb393-6"><a href="big-data-visualization.html#cb393-6" aria-hidden="true" tabindex="-1"></a>                        start_lat <span class="sc">&lt;=</span> <span class="fu">max</span>(nyc_map<span class="sc">$</span>lat) <span class="sc">&amp;</span> </span>
<span id="cb393-7"><a href="big-data-visualization.html#cb393-7" aria-hidden="true" tabindex="-1"></a>                        start_lat <span class="sc">&gt;=</span> <span class="fu">min</span>(nyc_map<span class="sc">$</span>lat) <span class="sc">&amp;</span></span>
<span id="cb393-8"><a href="big-data-visualization.html#cb393-8" aria-hidden="true" tabindex="-1"></a>                        dest_lat <span class="sc">&lt;=</span> <span class="fu">max</span>(nyc_map<span class="sc">$</span>lat) <span class="sc">&amp;</span></span>
<span id="cb393-9"><a href="big-data-visualization.html#cb393-9" aria-hidden="true" tabindex="-1"></a>                        dest_lat <span class="sc">&gt;=</span> <span class="fu">min</span>(nyc_map<span class="sc">$</span>lat) </span>
<span id="cb393-10"><a href="big-data-visualization.html#cb393-10" aria-hidden="true" tabindex="-1"></a>                        ]</span>
<span id="cb393-11"><a href="big-data-visualization.html#cb393-11" aria-hidden="true" tabindex="-1"></a>taxi_trips <span class="ot">&lt;-</span> taxi_trips[base<span class="sc">::</span><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(taxi_trips), <span class="dv">50000</span>)]</span></code></pre></div>
<p>In order to visualize how the cap traffic is changing over the course of the day, we add an additional variable called <code>start_time</code> in which we store the time (hour) of the day a trip started.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="big-data-visualization.html#cb394-1" aria-hidden="true" tabindex="-1"></a>taxi_trips<span class="sc">$</span>start_time <span class="ot">&lt;-</span> <span class="fu">hour</span>(taxi_trips<span class="sc">$</span>pickup_time)</span></code></pre></div>
<p>Particularly, we want to look at differences between, morning, afternoon, and evening/night.</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="big-data-visualization.html#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define new variable for facets</span></span>
<span id="cb395-2"><a href="big-data-visualization.html#cb395-2" aria-hidden="true" tabindex="-1"></a>taxi_trips<span class="sc">$</span>time_of_day <span class="ot">&lt;-</span> <span class="st">&quot;Morning&quot;</span></span>
<span id="cb395-3"><a href="big-data-visualization.html#cb395-3" aria-hidden="true" tabindex="-1"></a>taxi_trips[start_time <span class="sc">&gt;</span> <span class="dv">12</span> <span class="sc">&amp;</span> start_time <span class="sc">&lt;</span> <span class="dv">17</span>]<span class="sc">$</span>time_of_day <span class="ot">&lt;-</span> <span class="st">&quot;Afternoon&quot;</span></span>
<span id="cb395-4"><a href="big-data-visualization.html#cb395-4" aria-hidden="true" tabindex="-1"></a>taxi_trips[start_time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">17</span><span class="sc">:</span><span class="dv">24</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>)]<span class="sc">$</span>time_of_day <span class="ot">&lt;-</span> <span class="st">&quot;Evening/Night&quot;</span></span>
<span id="cb395-5"><a href="big-data-visualization.html#cb395-5" aria-hidden="true" tabindex="-1"></a>taxi_trips<span class="sc">$</span>time_of_day  <span class="ot">&lt;-</span> <span class="fu">factor</span>(taxi_trips<span class="sc">$</span>time_of_day, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Morning&quot;</span>, <span class="st">&quot;Afternoon&quot;</span>, <span class="st">&quot;Evening/Night&quot;</span>))</span></code></pre></div>
<p>We initiate the plot by first setting up the canvas with our taxi trips data. Then, we add the map as a first layer.</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="big-data-visualization.html#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up the canvas</span></span>
<span id="cb396-2"><a href="big-data-visualization.html#cb396-2" aria-hidden="true" tabindex="-1"></a>locations <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(taxi_trips, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat))</span>
<span id="cb396-3"><a href="big-data-visualization.html#cb396-3" aria-hidden="true" tabindex="-1"></a><span class="co"># add the map geometry</span></span>
<span id="cb396-4"><a href="big-data-visualization.html#cb396-4" aria-hidden="true" tabindex="-1"></a>locations <span class="ot">&lt;-</span> locations <span class="sc">+</span> <span class="fu">geom_map</span>(<span class="at">data =</span> nyc_map,</span>
<span id="cb396-5"><a href="big-data-visualization.html#cb396-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">map =</span> nyc_map,</span>
<span id="cb396-6"><a href="big-data-visualization.html#cb396-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">aes</span>(<span class="at">map_id =</span> id))</span>
<span id="cb396-7"><a href="big-data-visualization.html#cb396-7" aria-hidden="true" tabindex="-1"></a>locations</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-208-1.png" width="672" /></p>
<p>Now we can start adding the pick-up and drop-off locations of cap trips.</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="big-data-visualization.html#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add pick-up locations to plot</span></span>
<span id="cb397-2"><a href="big-data-visualization.html#cb397-2" aria-hidden="true" tabindex="-1"></a>locations <span class="sc">+</span> </span>
<span id="cb397-3"><a href="big-data-visualization.html#cb397-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>start_long, <span class="at">y=</span>start_lat),</span>
<span id="cb397-4"><a href="big-data-visualization.html#cb397-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">color=</span><span class="st">&quot;orange&quot;</span>,</span>
<span id="cb397-5"><a href="big-data-visualization.html#cb397-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="fl">0.1</span>,</span>
<span id="cb397-6"><a href="big-data-visualization.html#cb397-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-209-1.png" width="672" /></p>
<p>As to be expected, most of the trips start in Manhattan. Now let’s look at where trips end.</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="big-data-visualization.html#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add pick-up locations to plot</span></span>
<span id="cb398-2"><a href="big-data-visualization.html#cb398-2" aria-hidden="true" tabindex="-1"></a>locations <span class="sc">+</span></span>
<span id="cb398-3"><a href="big-data-visualization.html#cb398-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>dest_long, <span class="at">y=</span>dest_lat),</span>
<span id="cb398-4"><a href="big-data-visualization.html#cb398-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">color=</span><span class="st">&quot;steelblue&quot;</span>,</span>
<span id="cb398-5"><a href="big-data-visualization.html#cb398-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="fl">0.1</span>,</span>
<span id="cb398-6"><a href="big-data-visualization.html#cb398-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb398-7"><a href="big-data-visualization.html#cb398-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>start_long, <span class="at">y=</span>start_lat),</span>
<span id="cb398-8"><a href="big-data-visualization.html#cb398-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">color=</span><span class="st">&quot;orange&quot;</span>,</span>
<span id="cb398-9"><a href="big-data-visualization.html#cb398-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="fl">0.1</span>,</span>
<span id="cb398-10"><a href="big-data-visualization.html#cb398-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-210-1.png" width="672" /></p>
<p>Incidentally, more trips tend to end outside of Manhattan. And the destinations seem to be broader spread across the city then the pick-up locations. Most destinations are still in Manhattan, though.</p>
<p>Now let’s have a look at how this picture changes depending on the time of the day.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="big-data-visualization.html#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pick-up locations </span></span>
<span id="cb399-2"><a href="big-data-visualization.html#cb399-2" aria-hidden="true" tabindex="-1"></a>locations <span class="sc">+</span></span>
<span id="cb399-3"><a href="big-data-visualization.html#cb399-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>start_long, <span class="at">y=</span>start_lat),</span>
<span id="cb399-4"><a href="big-data-visualization.html#cb399-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">color=</span><span class="st">&quot;orange&quot;</span>,</span>
<span id="cb399-5"><a href="big-data-visualization.html#cb399-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="fl">0.1</span>,</span>
<span id="cb399-6"><a href="big-data-visualization.html#cb399-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb399-7"><a href="big-data-visualization.html#cb399-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(time_of_day))</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-211-1.png" width="864" /></p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="big-data-visualization.html#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop-off locations </span></span>
<span id="cb400-2"><a href="big-data-visualization.html#cb400-2" aria-hidden="true" tabindex="-1"></a>locations <span class="sc">+</span></span>
<span id="cb400-3"><a href="big-data-visualization.html#cb400-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>dest_long, <span class="at">y=</span>dest_lat),</span>
<span id="cb400-4"><a href="big-data-visualization.html#cb400-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">color=</span><span class="st">&quot;steelblue&quot;</span>,</span>
<span id="cb400-5"><a href="big-data-visualization.html#cb400-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="fl">0.1</span>,</span>
<span id="cb400-6"><a href="big-data-visualization.html#cb400-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb400-7"><a href="big-data-visualization.html#cb400-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(time_of_day))</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-212-1.png" width="864" /></p>
<p>Alternatively, we can plot the hours on a continuous scale.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="big-data-visualization.html#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop-off locations </span></span>
<span id="cb401-2"><a href="big-data-visualization.html#cb401-2" aria-hidden="true" tabindex="-1"></a>locations <span class="sc">+</span></span>
<span id="cb401-3"><a href="big-data-visualization.html#cb401-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>dest_long, <span class="at">y=</span>dest_lat, <span class="at">color =</span> start_time ),</span>
<span id="cb401-4"><a href="big-data-visualization.html#cb401-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="fl">0.1</span>,</span>
<span id="cb401-5"><a href="big-data-visualization.html#cb401-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb401-6"><a href="big-data-visualization.html#cb401-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_colour_gradient2</span>( <span class="at">low =</span> <span class="st">&quot;red&quot;</span>, <span class="at">mid =</span> <span class="st">&quot;yellow&quot;</span>, <span class="at">high =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb401-7"><a href="big-data-visualization.html#cb401-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">midpoint =</span> <span class="dv">12</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-213-1.png" width="672" /></p>
</div>
</div>
<div id="aside-change-color-schemes" class="section level2 hasAnchor" number="13.4">
<h2><span class="header-section-number">13.4</span> Aside: change color schemes<a href="big-data-visualization.html#aside-change-color-schemes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the example above we use <code>scale_colour_gradient2()</code> to modify the color gradient used to visualize the start time of taxi trips. By default, ggplot would plot the following (default gradient color setting):</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="big-data-visualization.html#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop-off locations </span></span>
<span id="cb402-2"><a href="big-data-visualization.html#cb402-2" aria-hidden="true" tabindex="-1"></a>locations <span class="sc">+</span></span>
<span id="cb402-3"><a href="big-data-visualization.html#cb402-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>dest_long, <span class="at">y=</span>dest_lat, <span class="at">color =</span> start_time ),</span>
<span id="cb402-4"><a href="big-data-visualization.html#cb402-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="fl">0.1</span>,</span>
<span id="cb402-5"><a href="big-data-visualization.html#cb402-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.2</span>) </span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-214-1.png" width="672" /></p>
<p><code>ggplot2</code> offers various functions to modify the color scales used in a plot. In the case of the example above, we visualize values of a continuous variable. Hence we use a gradient color scale. In case of categorical variables we need to modify the default discrete color scale.</p>
<p>Recall the plot illustrating tipping behavior, where we highlight in which observations the client payd with credit card, cash, etc.</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="big-data-visualization.html#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="co"># indicate natural numbers</span></span>
<span id="cb403-2"><a href="big-data-visualization.html#cb403-2" aria-hidden="true" tabindex="-1"></a>taxi[, dollar_paid <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(tip_amount <span class="sc">==</span> <span class="fu">round</span>(tip_amount,<span class="dv">0</span>), <span class="st">&quot;Full&quot;</span>, <span class="st">&quot;Fraction&quot;</span>),]</span>
<span id="cb403-3"><a href="big-data-visualization.html#cb403-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb403-4"><a href="big-data-visualization.html#cb403-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb403-5"><a href="big-data-visualization.html#cb403-5" aria-hidden="true" tabindex="-1"></a><span class="co"># extended x/y plot</span></span>
<span id="cb403-6"><a href="big-data-visualization.html#cb403-6" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="sc">+</span></span>
<span id="cb403-7"><a href="big-data-visualization.html#cb403-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.2</span>, <span class="fu">aes</span>(<span class="at">color=</span>payment_type)) <span class="sc">+</span></span>
<span id="cb403-8"><a href="big-data-visualization.html#cb403-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">facet_wrap</span>(<span class="st">&quot;dollar_paid&quot;</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-215-1.png" width="672" /></p>
<p>Since we do not further specify the discrete color scheme to be used, ggplot simply uses its default color scheme for this plot. We can change this as follows.</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="big-data-visualization.html#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="co"># indicate natural numbers</span></span>
<span id="cb404-2"><a href="big-data-visualization.html#cb404-2" aria-hidden="true" tabindex="-1"></a>taxi[, dollar_paid <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(tip_amount <span class="sc">==</span> <span class="fu">round</span>(tip_amount,<span class="dv">0</span>), <span class="st">&quot;Full&quot;</span>, <span class="st">&quot;Fraction&quot;</span>),]</span>
<span id="cb404-3"><a href="big-data-visualization.html#cb404-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-4"><a href="big-data-visualization.html#cb404-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-5"><a href="big-data-visualization.html#cb404-5" aria-hidden="true" tabindex="-1"></a><span class="co"># extended x/y plot</span></span>
<span id="cb404-6"><a href="big-data-visualization.html#cb404-6" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="sc">+</span></span>
<span id="cb404-7"><a href="big-data-visualization.html#cb404-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.2</span>, <span class="fu">aes</span>(<span class="at">color=</span>payment_type)) <span class="sc">+</span></span>
<span id="cb404-8"><a href="big-data-visualization.html#cb404-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">facet_wrap</span>(<span class="st">&quot;dollar_paid&quot;</span>) <span class="sc">+</span></span>
<span id="cb404-9"><a href="big-data-visualization.html#cb404-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_color_discrete</span>(<span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;steelblue&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;purple&quot;</span>))</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-216-1.png" width="672" /></p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="43">
<li id="fn43"><p>Or, could there be another explanation for this pattern in the data?<a href="big-data-visualization.html#fnref43" class="footnote-back">↩︎</a></p></li>
<li id="fn44"><p>See <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">the ggplot2 documentation</a> for a list of all pre-defined themes shipped with the basic installation.<a href="big-data-visualization.html#fnref44" class="footnote-back">↩︎</a></p></li>
<li id="fn45"><p>Similar files are provided online by most city authorities in developed countries. See, for example, GIS Data for the City and Canton of Zurich: <a href="https://maps.zh.ch/" class="uri">https://maps.zh.ch/</a>.<a href="big-data-visualization.html#fnref45" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="descriptive-statistics-and-aggregation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bottle-necks-in-local-big-data-analytics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 1
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
