<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 12 (Big) Data Visualization | Big Data Analytics</title>
  <meta name="description" content="A guide to data science practitioners making the transition to Big Data." />
  <meta name="generator" content="bookdown 0.30 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 12 (Big) Data Visualization | Big Data Analytics" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://umatter.github.io/BigData/img/cover.jpg" />
  <meta property="og:description" content="A guide to data science practitioners making the transition to Big Data." />
  <meta name="github-repo" content="umatter/BigData" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 12 (Big) Data Visualization | Big Data Analytics" />
  
  <meta name="twitter:description" content="A guide to data science practitioners making the transition to Big Data." />
  <meta name="twitter:image" content="https://umatter.github.io/BigData/img/cover.jpg" />

<meta name="author" content="Ulrich Matter" />


<meta name="date" content="2023-01-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="descriptive-statistics-and-aggregation.html"/>
<link rel="next" href="a.html"/>
<script src="libs/jquery/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Big Data Analytics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="c.html"><a href="c.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="part"><span><b>I Setting the Scene: Analyzing Big Data</b></span></li>
<li class="chapter" data-level="" data-path="s.html"><a href="s.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="what-is-big-in-big-data.html"><a href="what-is-big-in-big-data.html"><i class="fa fa-check"></i><b>1</b> What is <em>big</em> in “Big Data”?</a></li>
<li class="chapter" data-level="2" data-path="approaches-to-analyzing-big-data.html"><a href="approaches-to-analyzing-big-data.html"><i class="fa fa-check"></i><b>2</b> Approaches to analyzing Big Data</a></li>
<li class="chapter" data-level="3" data-path="the-two-domains-of-big-data-analytics.html"><a href="the-two-domains-of-big-data-analytics.html"><i class="fa fa-check"></i><b>3</b> The two domains of Big Data Analytics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="the-two-domains-of-big-data-analytics.html"><a href="the-two-domains-of-big-data-analytics.html#a-practical-big-p-problem"><i class="fa fa-check"></i><b>3.1</b> A practical <em>big P</em> problem</a></li>
<li class="chapter" data-level="3.2" data-path="the-two-domains-of-big-data-analytics.html"><a href="the-two-domains-of-big-data-analytics.html#a-practical-big-n-problem"><i class="fa fa-check"></i><b>3.2</b> A practical <em>big N</em> problem</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="the-two-domains-of-big-data-analytics.html"><a href="the-two-domains-of-big-data-analytics.html#ols-as-a-point-of-reference"><i class="fa fa-check"></i><b>3.2.1</b> OLS as a point of reference</a></li>
<li class="chapter" data-level="3.2.2" data-path="the-two-domains-of-big-data-analytics.html"><a href="the-two-domains-of-big-data-analytics.html#the-uluru-algorithm-as-an-alternative-to-ols"><i class="fa fa-check"></i><b>3.2.2</b> The <em>Uluru</em> algorithm as an alternative to OLS</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="the-two-domains-of-big-data-analytics.html"><a href="the-two-domains-of-big-data-analytics.html#conclusion"><i class="fa fa-check"></i><b>3.3</b> Conclusion</a></li>
</ul></li>
<li class="part"><span><b>II Platform: Software and Computing Resources</b></span></li>
<li class="chapter" data-level="" data-path="p.html"><a href="p.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="4" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html"><i class="fa fa-check"></i><b>4</b> Software: Programming with (big) data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#domains-of-programming-with-big-data"><i class="fa fa-check"></i><b>4.1</b> Domains of programming with (big) data</a></li>
<li class="chapter" data-level="4.2" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#measuring-r-performance"><i class="fa fa-check"></i><b>4.2</b> Measuring R performance</a></li>
<li class="chapter" data-level="4.3" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#writing-efficient-r-code"><i class="fa fa-check"></i><b>4.3</b> Writing efficient R code</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#memory-allocation-and-growing-objects"><i class="fa fa-check"></i><b>4.3.1</b> Memory allocation and growing objects</a></li>
<li class="chapter" data-level="4.3.2" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#vectorization-in-basic-r-functions"><i class="fa fa-check"></i><b>4.3.2</b> Vectorization in basic R functions</a></li>
<li class="chapter" data-level="4.3.3" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#apply-type-functions-and-vectorization"><i class="fa fa-check"></i><b>4.3.3</b> <code>apply</code>-type functions and vectorization</a></li>
<li class="chapter" data-level="4.3.4" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#avoid-unnecessary-copying"><i class="fa fa-check"></i><b>4.3.4</b> Avoid unnecessary copying</a></li>
<li class="chapter" data-level="4.3.5" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#releasing-memory"><i class="fa fa-check"></i><b>4.3.5</b> Releasing memory</a></li>
<li class="chapter" data-level="4.3.6" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#beyond-r"><i class="fa fa-check"></i><b>4.3.6</b> Beyond R</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#sql-basics"><i class="fa fa-check"></i><b>4.4</b> SQL basics</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#first-steps-in-sqlite"><i class="fa fa-check"></i><b>4.4.1</b> First steps in SQL(ite)</a></li>
<li class="chapter" data-level="4.4.2" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#joins"><i class="fa fa-check"></i><b>4.4.2</b> Joins</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#wrapping-up"><i class="fa fa-check"></i><b>4.5</b> Wrapping up</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html"><i class="fa fa-check"></i><b>5</b> Hardware: Computing Resources</a>
<ul>
<li class="chapter" data-level="5.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#mass-storage"><i class="fa fa-check"></i><b>5.1</b> Mass storage</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#avoid-redundancies"><i class="fa fa-check"></i><b>5.1.1</b> Avoid redundancies</a></li>
<li class="chapter" data-level="5.1.2" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#data-compression"><i class="fa fa-check"></i><b>5.1.2</b> Data compression</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#random-access-memory-ram"><i class="fa fa-check"></i><b>5.2</b> Random access memory (RAM)</a></li>
<li class="chapter" data-level="5.3" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#combining-ram-and-hard-disk-virtual-memory"><i class="fa fa-check"></i><b>5.3</b> Combining RAM and hard disk: Virtual memory</a></li>
<li class="chapter" data-level="5.4" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#cpu-and-parallelization"><i class="fa fa-check"></i><b>5.4</b> CPU and parallelization</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#naive-multi-session-approach"><i class="fa fa-check"></i><b>5.4.1</b> Naive multi-session approach</a></li>
<li class="chapter" data-level="5.4.2" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#multi-core-and-multi-node-approach"><i class="fa fa-check"></i><b>5.4.2</b> Multi-core and multi-node approach</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#gpus-for-scientific-computing"><i class="fa fa-check"></i><b>5.5</b> GPUs for scientific computing</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#gpus-in-r"><i class="fa fa-check"></i><b>5.5.1</b> GPUs in R</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#the-road-ahead-hardware-made-for-machine-learning"><i class="fa fa-check"></i><b>5.6</b> The road ahead: Hardware made for machine learning</a></li>
<li class="chapter" data-level="5.7" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#wrapping-up-1"><i class="fa fa-check"></i><b>5.7</b> Wrapping up</a></li>
<li class="chapter" data-level="5.8" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#still-have-insufficient-computing-resources"><i class="fa fa-check"></i><b>5.8</b> Still have insufficient computing resources?</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="distributed-systems.html"><a href="distributed-systems.html"><i class="fa fa-check"></i><b>6</b> Distributed Systems</a>
<ul>
<li class="chapter" data-level="6.1" data-path="distributed-systems.html"><a href="distributed-systems.html#mapreduce"><i class="fa fa-check"></i><b>6.1</b> MapReduce</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="distributed-systems.html"><a href="distributed-systems.html#aside-mapreduce-concept-illustrated-in-r"><i class="fa fa-check"></i><b>6.1.1</b> Aside: MapReduce concept illustrated in R</a></li>
<li class="chapter" data-level="6.1.2" data-path="distributed-systems.html"><a href="distributed-systems.html#mapper"><i class="fa fa-check"></i><b>6.1.2</b> Mapper</a></li>
<li class="chapter" data-level="6.1.3" data-path="distributed-systems.html"><a href="distributed-systems.html#reducer"><i class="fa fa-check"></i><b>6.1.3</b> Reducer</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="distributed-systems.html"><a href="distributed-systems.html#apache-hadoop"><i class="fa fa-check"></i><b>6.2</b> Apache Hadoop</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="distributed-systems.html"><a href="distributed-systems.html#hadoop-word-count-example"><i class="fa fa-check"></i><b>6.2.1</b> Hadoop word count example</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="distributed-systems.html"><a href="distributed-systems.html#apache-spark"><i class="fa fa-check"></i><b>6.3</b> Apache Spark</a></li>
<li class="chapter" data-level="6.4" data-path="distributed-systems.html"><a href="distributed-systems.html#spark-with-r"><i class="fa fa-check"></i><b>6.4</b> Spark with R</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="distributed-systems.html"><a href="distributed-systems.html#data-import-and-summary-statistics"><i class="fa fa-check"></i><b>6.4.1</b> Data import and summary statistics</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="distributed-systems.html"><a href="distributed-systems.html#spark-with-sql"><i class="fa fa-check"></i><b>6.5</b> Spark with SQL</a></li>
<li class="chapter" data-level="6.6" data-path="distributed-systems.html"><a href="distributed-systems.html#spark-with-r-sql"><i class="fa fa-check"></i><b>6.6</b> Spark with R + SQL</a></li>
<li class="chapter" data-level="6.7" data-path="distributed-systems.html"><a href="distributed-systems.html#wrapping-up-2"><i class="fa fa-check"></i><b>6.7</b> Wrapping up</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="cloud-computing.html"><a href="cloud-computing.html"><i class="fa fa-check"></i><b>7</b> Cloud Computing</a>
<ul>
<li class="chapter" data-level="7.1" data-path="cloud-computing.html"><a href="cloud-computing.html#cloud-computing-basics-and-platforms"><i class="fa fa-check"></i><b>7.1</b> Cloud computing basics and platforms</a></li>
<li class="chapter" data-level="7.2" data-path="cloud-computing.html"><a href="cloud-computing.html#transitioning-to-the-cloud"><i class="fa fa-check"></i><b>7.2</b> Transitioning to the cloud</a></li>
<li class="chapter" data-level="7.3" data-path="cloud-computing.html"><a href="cloud-computing.html#scaling-up-in-the-cloud-virtual-servers"><i class="fa fa-check"></i><b>7.3</b> Scaling up in the cloud: Virtual servers</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="cloud-computing.html"><a href="cloud-computing.html#scaling-up-with-aws-ec2-and-rrstudio"><i class="fa fa-check"></i><b>7.3.1</b> Scaling up with AWS EC2 and R/RStudio</a></li>
<li class="chapter" data-level="7.3.2" data-path="cloud-computing.html"><a href="cloud-computing.html#parallelization-with-an-ec2-instance"><i class="fa fa-check"></i><b>7.3.2</b> Parallelization with an EC2 instance</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="cloud-computing.html"><a href="cloud-computing.html#scaling-up-with-gpus"><i class="fa fa-check"></i><b>7.4</b> Scaling up with GPUs</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="cloud-computing.html"><a href="cloud-computing.html#gpus-on-google-colab"><i class="fa fa-check"></i><b>7.4.1</b> GPUs on Google Colab</a></li>
<li class="chapter" data-level="7.4.2" data-path="cloud-computing.html"><a href="cloud-computing.html#rstudio-and-ec2-with-gpus-on-aws"><i class="fa fa-check"></i><b>7.4.2</b> RStudio and EC2 with GPUs on AWS</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="cloud-computing.html"><a href="cloud-computing.html#scaling-out-mapreduce-in-the-cloud"><i class="fa fa-check"></i><b>7.5</b> Scaling out: MapReduce in the cloud</a></li>
<li class="chapter" data-level="7.6" data-path="cloud-computing.html"><a href="cloud-computing.html#wrapping-up-3"><i class="fa fa-check"></i><b>7.6</b> Wrapping up</a></li>
</ul></li>
<li class="part"><span><b>III Components of Big Data Analytics</b></span></li>
<li class="chapter" data-level="" data-path="introduction-to-part-ii.html"><a href="introduction-to-part-ii.html"><i class="fa fa-check"></i>Introduction to Part II</a></li>
<li class="chapter" data-level="8" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html"><i class="fa fa-check"></i><b>8</b> Data Collection and Data Storage</a>
<ul>
<li class="chapter" data-level="8.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#gathering-and-compilation-of-raw-data"><i class="fa fa-check"></i><b>8.1</b> Gathering and compilation of raw data</a></li>
<li class="chapter" data-level="8.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#stackcombine-raw-source-files"><i class="fa fa-check"></i><b>8.2</b> Stack/combine raw source files</a></li>
<li class="chapter" data-level="8.3" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#efficient-local-data-storage"><i class="fa fa-check"></i><b>8.3</b> Efficient local data storage</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#rdbms-basics"><i class="fa fa-check"></i><b>8.3.1</b> RDBMS basics</a></li>
<li class="chapter" data-level="8.3.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#efficient-data-access-indices-and-joins-in-sqlite"><i class="fa fa-check"></i><b>8.3.2</b> Efficient data access: Indices and joins in SQLite</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#connecting-r-to-an-rdbms"><i class="fa fa-check"></i><b>8.4</b> Connecting R to an RDBMS</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#creating-a-new-database-with-rsqlite"><i class="fa fa-check"></i><b>8.4.1</b> Creating a new database with <code>RSQLite</code></a></li>
<li class="chapter" data-level="8.4.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#importing-data"><i class="fa fa-check"></i><b>8.4.2</b> Importing data</a></li>
<li class="chapter" data-level="8.4.3" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#issue-queries"><i class="fa fa-check"></i><b>8.4.3</b> Issue queries</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#cloud-solutions-for-big-data-storage"><i class="fa fa-check"></i><b>8.5</b> Cloud solutions for (big) data storage</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#easy-to-use-rdbms-in-the-cloud-aws-rds"><i class="fa fa-check"></i><b>8.5.1</b> Easy-to-use RDBMS in the cloud: AWS RDS</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#column-based-analytics-databases"><i class="fa fa-check"></i><b>8.6</b> Column-based analytics databases</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#installation-and-start-up"><i class="fa fa-check"></i><b>8.6.1</b> Installation and start up</a></li>
<li class="chapter" data-level="8.6.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#first-steps-via-druids-gui"><i class="fa fa-check"></i><b>8.6.2</b> First steps via Druid’s GUI</a></li>
<li class="chapter" data-level="8.6.3" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#query-druid-from-r"><i class="fa fa-check"></i><b>8.6.3</b> Query Druid from R</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#data-warehouses"><i class="fa fa-check"></i><b>8.7</b> Data warehouses</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#data-warehouse-for-analytics-google-bigquery-example"><i class="fa fa-check"></i><b>8.7.1</b> Data warehouse for analytics: Google BigQuery example</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#data-lakes-and-simple-storage-service"><i class="fa fa-check"></i><b>8.8</b> Data lakes and simple storage service</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#aws-s3-with-r-first-steps"><i class="fa fa-check"></i><b>8.8.1</b> AWS S3 with R: First steps</a></li>
<li class="chapter" data-level="8.8.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#uploading-data-to-s3"><i class="fa fa-check"></i><b>8.8.2</b> Uploading data to S3</a></li>
<li class="chapter" data-level="8.8.3" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#more-than-just-simple-storage-s3-aws-athena"><i class="fa fa-check"></i><b>8.8.3</b> More than just simple storage: S3 + AWS Athena</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#wrapping-up-4"><i class="fa fa-check"></i><b>8.9</b> Wrapping up</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html"><i class="fa fa-check"></i><b>9</b> Big Data Cleaning and Transformation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#out-of-memory-strategies-and-lazy-evaluation-practical-basics"><i class="fa fa-check"></i><b>9.1</b> Out-of-memory strategies and lazy evaluation: Practical basics</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#chunking-data-with-the-ff-package"><i class="fa fa-check"></i><b>9.1.1</b> Chunking data with the <code>ff</code> package</a></li>
<li class="chapter" data-level="9.1.2" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#memory-mapping-with-bigmemory"><i class="fa fa-check"></i><b>9.1.2</b> Memory mapping with <code>bigmemory</code></a></li>
<li class="chapter" data-level="9.1.3" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#connecting-to-apache-arrow"><i class="fa fa-check"></i><b>9.1.3</b> Connecting to Apache Arrow</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#ff-big-data-preparation-tutorial"><i class="fa fa-check"></i><b>9.2</b> <code>ff</code> Big Data preparation tutorial</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#set-up"><i class="fa fa-check"></i><b>9.2.1</b> Set up</a></li>
<li class="chapter" data-level="9.2.2" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#data-import"><i class="fa fa-check"></i><b>9.2.2</b> Data import</a></li>
<li class="chapter" data-level="9.2.3" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#inspect-imported-files"><i class="fa fa-check"></i><b>9.2.3</b> Inspect imported files</a></li>
<li class="chapter" data-level="9.2.4" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#data-cleaning-and-transformation"><i class="fa fa-check"></i><b>9.2.4</b> Data cleaning and transformation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="inspect-difference-to-in-memory-operation.html"><a href="inspect-difference-to-in-memory-operation.html"><i class="fa fa-check"></i><b>10</b> Inspect difference to in-memory operation</a>
<ul>
<li class="chapter" data-level="10.0.1" data-path="inspect-difference-to-in-memory-operation.html"><a href="inspect-difference-to-in-memory-operation.html#subsetting"><i class="fa fa-check"></i><b>10.0.1</b> Subsetting</a></li>
<li class="chapter" data-level="10.0.2" data-path="inspect-difference-to-in-memory-operation.html"><a href="inspect-difference-to-in-memory-operation.html#saveloadexport-ff_files-files"><i class="fa fa-check"></i><b>10.0.2</b> Save/load/export ff_files files</a></li>
<li class="chapter" data-level="10.1" data-path="inspect-difference-to-in-memory-operation.html"><a href="inspect-difference-to-in-memory-operation.html#arrow-big-data-preparation-tutorial"><i class="fa fa-check"></i><b>10.1</b> <code>arrow</code> Big Data preparation tutorial</a></li>
<li class="chapter" data-level="10.2" data-path="inspect-difference-to-in-memory-operation.html"><a href="inspect-difference-to-in-memory-operation.html#wrapping-up-5"><i class="fa fa-check"></i><b>10.2</b> Wrapping up</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html"><i class="fa fa-check"></i><b>11</b> Descriptive Statistics and Aggregation</a>
<ul>
<li class="chapter" data-level="11.1" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#data-aggregation-the-split-apply-combine-strategy"><i class="fa fa-check"></i><b>11.1</b> Data aggregation: The ‘split-apply-combine’ strategy</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#data-aggregation-with-chunked-data-files"><i class="fa fa-check"></i><b>11.1.1</b> Data aggregation with chunked data files</a></li>
<li class="chapter" data-level="11.1.2" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#cross-tabulation-of-ff-vectors"><i class="fa fa-check"></i><b>11.1.2</b> Cross-tabulation of <code>ff</code> vectors</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#high-speed-in-memory-data-aggregation-with-arrow"><i class="fa fa-check"></i><b>11.2</b> High-speed in-memory data aggregation with <code>arrow</code></a></li>
<li class="chapter" data-level="11.3" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#high-speed-in-memory-data-aggregation-with-data.table"><i class="fa fa-check"></i><b>11.3</b> High-speed in-memory data aggregation with <code>data.table</code></a></li>
<li class="chapter" data-level="11.4" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#wrapping-up-6"><i class="fa fa-check"></i><b>11.4</b> Wrapping up</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="big-data-visualization.html"><a href="big-data-visualization.html"><i class="fa fa-check"></i><b>12</b> (Big) Data Visualization</a>
<ul>
<li class="chapter" data-level="12.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#challenges-of-big-data-visualization"><i class="fa fa-check"></i><b>12.1</b> Challenges of Big Data visualization</a></li>
<li class="chapter" data-level="12.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#data-exploration-with-ggplot2"><i class="fa fa-check"></i><b>12.2</b> Data exploration with <code>ggplot2</code></a></li>
<li class="chapter" data-level="12.3" data-path="big-data-visualization.html"><a href="big-data-visualization.html#visualizing-time-and-space"><i class="fa fa-check"></i><b>12.3</b> Visualizing time and space</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#preparations"><i class="fa fa-check"></i><b>12.3.1</b> Preparations</a></li>
<li class="chapter" data-level="12.3.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#pick-up-and-drop-off-locations"><i class="fa fa-check"></i><b>12.3.2</b> Pick-up and drop-off locations</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="big-data-visualization.html"><a href="big-data-visualization.html#wrapping-up-7"><i class="fa fa-check"></i><b>12.4</b> Wrapping up</a></li>
</ul></li>
<li class="part"><span><b>IV Application: Topics in Big Data Econometrics</b></span></li>
<li class="chapter" data-level="" data-path="a.html"><a href="a.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="13" data-path="bottle-necks-in-every-day-data-analytics-tasks.html"><a href="bottle-necks-in-every-day-data-analytics-tasks.html"><i class="fa fa-check"></i><b>13</b> Bottle Necks in Every-Day Data Analytics Tasks</a>
<ul>
<li class="chapter" data-level="13.1" data-path="bottle-necks-in-every-day-data-analytics-tasks.html"><a href="bottle-necks-in-every-day-data-analytics-tasks.html#case-study-data-import-and-memory-allocation"><i class="fa fa-check"></i><b>13.1</b> Case study: Data Import and Memory Allocation</a></li>
<li class="chapter" data-level="13.2" data-path="bottle-necks-in-every-day-data-analytics-tasks.html"><a href="bottle-necks-in-every-day-data-analytics-tasks.html#case-study-loops-memory-and-vectorization"><i class="fa fa-check"></i><b>13.2</b> Case Study: Loops, Memory, and Vectorization</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="bottle-necks-in-every-day-data-analytics-tasks.html"><a href="bottle-necks-in-every-day-data-analytics-tasks.html#preparation"><i class="fa fa-check"></i><b>13.2.1</b> Preparation</a></li>
<li class="chapter" data-level="13.2.2" data-path="bottle-necks-in-every-day-data-analytics-tasks.html"><a href="bottle-necks-in-every-day-data-analytics-tasks.html#naïve-approach-ignorant-of-r"><i class="fa fa-check"></i><b>13.2.2</b> Naïve Approach (ignorant of R)</a></li>
<li class="chapter" data-level="13.2.3" data-path="bottle-necks-in-every-day-data-analytics-tasks.html"><a href="bottle-necks-in-every-day-data-analytics-tasks.html#improvement-1-pre-allocation-of-memory"><i class="fa fa-check"></i><b>13.2.3</b> Improvement 1: Pre-allocation of memory</a></li>
<li class="chapter" data-level="13.2.4" data-path="bottle-necks-in-every-day-data-analytics-tasks.html"><a href="bottle-necks-in-every-day-data-analytics-tasks.html#improvement-2-exploit-vectorization"><i class="fa fa-check"></i><b>13.2.4</b> Improvement 2: Exploit vectorization</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="bottle-necks-in-every-day-data-analytics-tasks.html"><a href="bottle-necks-in-every-day-data-analytics-tasks.html#case-study-bootstrapping-and-parallel-processing"><i class="fa fa-check"></i><b>13.3</b> Case study: Bootstrapping and Parallel Processing</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="bottle-necks-in-every-day-data-analytics-tasks.html"><a href="bottle-necks-in-every-day-data-analytics-tasks.html#parallelization-with-an-ec2-instance-1"><i class="fa fa-check"></i><b>13.3.1</b> Parallelization with an EC2 instance</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="bottle-necks-in-every-day-data-analytics-tasks.html"><a href="bottle-necks-in-every-day-data-analytics-tasks.html#case-study-efficient-fixed-effects-estimation"><i class="fa fa-check"></i><b>13.4</b> Case Study: Efficient Fixed Effects Estimation</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="econometrics-with-gpus.html"><a href="econometrics-with-gpus.html"><i class="fa fa-check"></i><b>14</b> Econometrics with GPUs</a>
<ul>
<li class="chapter" data-level="14.1" data-path="econometrics-with-gpus.html"><a href="econometrics-with-gpus.html#tensorflowkeras-example-predict-housing-prices"><i class="fa fa-check"></i><b>14.1</b> Tensorflow/Keras example: predict housing prices</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="econometrics-with-gpus.html"><a href="econometrics-with-gpus.html#data-preparation"><i class="fa fa-check"></i><b>14.1.1</b> Data preparation</a></li>
<li class="chapter" data-level="14.1.2" data-path="econometrics-with-gpus.html"><a href="econometrics-with-gpus.html#model-specification"><i class="fa fa-check"></i><b>14.1.2</b> Model specification</a></li>
<li class="chapter" data-level="14.1.3" data-path="econometrics-with-gpus.html"><a href="econometrics-with-gpus.html#training-and-prediction"><i class="fa fa-check"></i><b>14.1.3</b> Training and prediction</a></li>
<li class="chapter" data-level="14.1.4" data-path="econometrics-with-gpus.html"><a href="econometrics-with-gpus.html#a-word-of-caution"><i class="fa fa-check"></i><b>14.1.4</b> A word of caution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html"><i class="fa fa-check"></i><b>15</b> Regression Analysis and Categorization with Spark and R</a>
<ul>
<li class="chapter" data-level="15.1" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#simple-linear-regression-analysis"><i class="fa fa-check"></i><b>15.1</b> Simple linear regression analysis</a></li>
<li class="chapter" data-level="15.2" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#machine-learning-for-classification"><i class="fa fa-check"></i><b>15.2</b> Machine learning for classification</a></li>
<li class="chapter" data-level="15.3" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#building-machine-learning-pipelines-with-r-and-spark"><i class="fa fa-check"></i><b>15.3</b> Building machine learning pipelines with R and Spark</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#set-up-and-data-import"><i class="fa fa-check"></i><b>15.3.1</b> Set up and data import</a></li>
<li class="chapter" data-level="15.3.2" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#building-the-pipeline"><i class="fa fa-check"></i><b>15.3.2</b> Building the pipeline</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#wrapping-up-8"><i class="fa fa-check"></i><b>15.4</b> Wrapping up</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html"><i class="fa fa-check"></i><b>16</b> Large-scale Text Analysis with sparklyr</a>
<ul>
<li class="chapter" data-level="16.1" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html#getting-started-import-pre-processing-and-word-count"><i class="fa fa-check"></i><b>16.1</b> Getting started: import, pre-processing, and word count</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-a.html"><a href="appendix-a.html"><i class="fa fa-check"></i><b>A</b> Appendix A</a>
<ul>
<li class="chapter" data-level="A.1" data-path="appendix-a.html"><a href="appendix-a.html#github"><i class="fa fa-check"></i><b>A.1</b> GitHub</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="appendix-a.html"><a href="appendix-a.html#initiate-a-new-repository"><i class="fa fa-check"></i><b>A.1.1</b> Initiate a new repository</a></li>
<li class="chapter" data-level="A.1.2" data-path="appendix-a.html"><a href="appendix-a.html#clone-this-courses-repository"><i class="fa fa-check"></i><b>A.1.2</b> Clone this course’s repository</a></li>
<li class="chapter" data-level="A.1.3" data-path="appendix-a.html"><a href="appendix-a.html#fork-this-courses-repository"><i class="fa fa-check"></i><b>A.1.3</b> Fork this course’s repository</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="appendix-b.html"><a href="appendix-b.html"><i class="fa fa-check"></i><b>B</b> Appendix B</a>
<ul>
<li class="chapter" data-level="B.1" data-path="appendix-b.html"><a href="appendix-b.html#data-types-and-memorystorage"><i class="fa fa-check"></i><b>B.1</b> Data types and memory/storage</a>
<ul>
<li class="chapter" data-level="B.1.1" data-path="appendix-b.html"><a href="appendix-b.html#example-in-r-data-types-and-information-storage"><i class="fa fa-check"></i><b>B.1.1</b> Example in R: Data types and information storage</a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="appendix-b.html"><a href="appendix-b.html#data-structures"><i class="fa fa-check"></i><b>B.2</b> Data structures</a>
<ul>
<li class="chapter" data-level="B.2.1" data-path="appendix-b.html"><a href="appendix-b.html#vectors-vs-factors-in-r"><i class="fa fa-check"></i><b>B.2.1</b> Vectors vs Factors in R</a></li>
<li class="chapter" data-level="B.2.2" data-path="appendix-b.html"><a href="appendix-b.html#matricesarrays"><i class="fa fa-check"></i><b>B.2.2</b> Matrices/Arrays</a></li>
<li class="chapter" data-level="B.2.3" data-path="appendix-b.html"><a href="appendix-b.html#data-frames-tibbles-and-data-tables"><i class="fa fa-check"></i><b>B.2.3</b> Data frames, tibbles, and data tables</a></li>
<li class="chapter" data-level="B.2.4" data-path="appendix-b.html"><a href="appendix-b.html#lists"><i class="fa fa-check"></i><b>B.2.4</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="B.3" data-path="appendix-b.html"><a href="appendix-b.html#r-tools-to-investigate-structures-and-types"><i class="fa fa-check"></i><b>B.3</b> R-tools to investigate structures and types</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="appendix-c.html"><a href="appendix-c.html"><i class="fa fa-check"></i><b>C</b> Appendix C</a>
<ul>
<li class="chapter" data-level="C.1" data-path="appendix-c.html"><a href="appendix-c.html#install-hadoop-on-ubuntu-linux"><i class="fa fa-check"></i><b>C.1</b> Install Hadoop (on Ubuntu Linux)</a></li>
<li class="chapter" data-level="C.2" data-path="appendix-c.html"><a href="appendix-c.html#manually-set-up-a-database-server-in-the-cloud"><i class="fa fa-check"></i><b>C.2</b> Manually set up a database server in the cloud</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://umatter.github.io" target="blank">umatter.github.io</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Big Data Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="big-data-visualization" class="section level1 hasAnchor" number="12">
<h1><span class="header-section-number">Chapter 12</span> (Big) Data Visualization<a href="big-data-visualization.html#big-data-visualization" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Visualizing certain characteristics and patterns in large datasets is primarily challenging for two reasons. First, depending on the type of plot, plotting raw data consisting of many observations can take a long time (and lead to large figure files). Second, patterns might be harder to recognize due to the sheer amount of data displayed in a plot. Both of these challenges are particularly related to the visualization of raw data for explorative or descriptive purposes. Visualizations of already-computed aggregations or estimates is typically very similar whether working with large or small datasets.</p>
<p>The following sections thus particularly highlight the issue of generating plots based on the raw data, including many observations, and with the aim of exploring the data in order to discover patterns in the data that then can be further investigated in more sophisticated statistical analyses. We will do so in three steps. First, we will look into a few important conceptual aspects where generating plots with a large number of observations becomes difficult, and then look at potentially helpful tools to address these difficulties. Based on these insights, the next section presents a data exploration tutorial based on the already familiar TLC taxi trips dataset, looking into different approaches to visualize relations between variables. Finally, the last section of this chapter covers an area of data visualization that has become more and more relevant in applied economic research with the availability of highly detailed observational data on economic and social activities (due to the digitization of many aspects of modern life): the plotting of geo-spatial information on economic activity.</p>
<p>All illustrations of concepts and visualization examples in this chapter build on the Grammar of Graphics concept implemented in the <code>ggplot2</code> package. The choice of this plotting package/framework is motivated by the large variety of plot-types covered in <code>ggplot2</code> (ranging from simple scatterplots to hexbin-plots and geographic maps), as well as the flexibility to build and modify plots step by step (an aspect that is particularly interesting when exploring large datasets visually).</p>
<div id="challenges-of-big-data-visualization" class="section level2 hasAnchor" number="12.1">
<h2><span class="header-section-number">12.1</span> Challenges of Big Data visualization<a href="big-data-visualization.html#challenges-of-big-data-visualization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Generating a plot in an interactive R session means generating a new object in the R environment (RAM), which can (in the case of large datasets) take up a considerable amount of memory. Moreover, depending on how the plot function is called, RStudio will directly render the plot in the Plots tab (which again needs memory and processing). Consider the following simple example, in which we plot two vectors of random numbers against each other.</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="big-data-visualization.html#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load package</span></span>
<span id="cb423-2"><a href="big-data-visualization.html#cb423-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># for plotting</span></span>
<span id="cb423-3"><a href="big-data-visualization.html#cb423-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pryr) <span class="co"># for profiling</span></span>
<span id="cb423-4"><a href="big-data-visualization.html#cb423-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bench) <span class="co"># for profiling</span></span>
<span id="cb423-5"><a href="big-data-visualization.html#cb423-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fs) <span class="co"># for profiling</span></span>
<span id="cb423-6"><a href="big-data-visualization.html#cb423-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-7"><a href="big-data-visualization.html#cb423-7" aria-hidden="true" tabindex="-1"></a><span class="co"># random numbers generation</span></span>
<span id="cb423-8"><a href="big-data-visualization.html#cb423-8" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="at">mean=</span><span class="dv">5</span>)</span>
<span id="cb423-9"><a href="big-data-visualization.html#cb423-9" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fl">1.4</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)</span>
<span id="cb423-10"><a href="big-data-visualization.html#cb423-10" aria-hidden="true" tabindex="-1"></a>plotdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)</span>
<span id="cb423-11"><a href="big-data-visualization.html#cb423-11" aria-hidden="true" tabindex="-1"></a><span class="fu">object_size</span>(plotdata)</span></code></pre></div>
<pre><code>## 16.00 MB</code></pre>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="big-data-visualization.html#cb425-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate scatter plot</span></span>
<span id="cb425-2"><a href="big-data-visualization.html#cb425-2" aria-hidden="true" tabindex="-1"></a>splot <span class="ot">&lt;-</span></span>
<span id="cb425-3"><a href="big-data-visualization.html#cb425-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ggplot</span>(plotdata, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y))<span class="sc">+</span></span>
<span id="cb425-4"><a href="big-data-visualization.html#cb425-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>()</span>
<span id="cb425-5"><a href="big-data-visualization.html#cb425-5" aria-hidden="true" tabindex="-1"></a><span class="fu">object_size</span>(splot)</span></code></pre></div>
<pre><code>## 16.84 MB</code></pre>
<p>The plot object, not surprisingly, takes up an additional slice of RAM of the size of the original dataset, plus some overhead. Now when we instruct ggplot to generate/plot the visualization on canvas, even more memory is needed. Moreover, rather a lot of data processing is needed to place one million points on the canvas (also, note that one million observations would not be considered a lot in the context of this book…).</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="big-data-visualization.html#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mem_used</span>()</span></code></pre></div>
<pre><code>## 2.26 GB</code></pre>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="big-data-visualization.html#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">print</span>(splot))</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-188-1.png" width="672" /></p>
<pre><code>##    user  system elapsed 
##  23.015   0.295  23.123</code></pre>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="big-data-visualization.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mem_used</span>()</span></code></pre></div>
<pre><code>## 2.36 GB</code></pre>
<p>First, to generate this one plot, an average modern laptop needs about 13.6 seconds. This would not be very comfortable in an interactive session to explore the data visually. Second, and even more striking, before the plot was generated, <code>mem_used()</code> indicated the total amount of memory (in MBs) used by R was around 160MB, while right after plotting to the canvas, R had used around 270MB. Note that this is larger than the dataset and the ggplot-object by an order of magnitude. Creating the same plot based on 100 million observations would likely crash or freeze your R session. Finally, when we output the plot to a file (for example, a pdf), the generated vector-based graphic file is also rather large.</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="big-data-visualization.html#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;splot.pdf&quot;</span>, <span class="at">device=</span><span class="st">&quot;pdf&quot;</span>, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb433-2"><a href="big-data-visualization.html#cb433-2" aria-hidden="true" tabindex="-1"></a><span class="fu">file_size</span>(<span class="st">&quot;splot.pdf&quot;</span>)</span></code></pre></div>
<pre><code>## 54.7M</code></pre>
<p>Hence generating plots visualizing large amounts of raw data tends to use up a lot of computing time, memory, and (ultimately) storage space for the generated plot file. There are a couple of solutions to address these performance issues.</p>
<p><em>Avoid fancy symbols (costly rendering)</em>
It turns out that one aspect of the problem is the particular symbols/characters used in ggplot (and other plot functions in R) for the points in such a scatter-plot. Thus, one solution is to override the default set of characters directly when calling <code>ggplot()</code>. A reasonable choice of character for this purpose is simply the full point (<code>.</code>).</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="big-data-visualization.html#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate scatter plot</span></span>
<span id="cb435-2"><a href="big-data-visualization.html#cb435-2" aria-hidden="true" tabindex="-1"></a>splot2 <span class="ot">&lt;-</span></span>
<span id="cb435-3"><a href="big-data-visualization.html#cb435-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ggplot</span>(plotdata, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y))<span class="sc">+</span></span>
<span id="cb435-4"><a href="big-data-visualization.html#cb435-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">pch=</span><span class="st">&quot;.&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="big-data-visualization.html#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mem_used</span>()</span></code></pre></div>
<pre><code>## 2.26 GB</code></pre>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="big-data-visualization.html#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">print</span>(splot2))</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-191-1.png" width="672" /></p>
<pre><code>##    user  system elapsed 
##   2.186   0.079   2.270</code></pre>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="big-data-visualization.html#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mem_used</span>()</span></code></pre></div>
<pre><code>## 2.37 GB</code></pre>
<p>The increase in memory due to the plot call is comparatively smaller, and plotting is substantially faster.</p>
<p><em>Use rasterization (bitmap graphics) instead of vector graphics</em>
By default, most data visualization libraries, including <code>ggplot2</code>, are implemented to generate vector-based graphics. Conceptually, this makes a lot of sense for any type of plot when the number of observations plotted is small or moderate. In simple terms, vector-based graphics define lines and shapes as vectors in a coordinate system. In the case of a scatter-plot, the x and y coordinates of every point need to be recorded. In contrast, bitmap files contain image information in the form of a matrix (or several matrices if colors are involved), whereby each cell of the matrix represents a pixel and contains information about the pixel’s color. While a vector-based representation of plot of few observations is likely more memory-efficient than a high-resolution bitmap representation of the same plot, it might well be the other way around when we are plotting millions of observations.</p>
<p>Thus, an alternative solution to save time and memory is to directly use a bitmap format instead of a vector-based format. This could be done by plotting directly to a bitmap-format file and then opening the file to look at the plot. However, this is somewhat clumsy as part of a data visualization workflow to explore the data. Luckily there is a ready-made solution by <span class="citation">Kratochvíl et al. (<a href="#ref-kratochvil_etal2020" role="doc-biblioref">2020</a>)</span> that builds on the idea of rasterizing scatter-plots, but that then displays the bitmap image directly in R. The approach is implemented in the <code>scattermore</code> package and can straightforwardly be used in combination with <code>ggplot</code>.</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="big-data-visualization.html#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;scattermore&quot;)</span></span>
<span id="cb442-2"><a href="big-data-visualization.html#cb442-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scattermore)</span>
<span id="cb442-3"><a href="big-data-visualization.html#cb442-3" aria-hidden="true" tabindex="-1"></a><span class="co"># generate scatter plot</span></span>
<span id="cb442-4"><a href="big-data-visualization.html#cb442-4" aria-hidden="true" tabindex="-1"></a>splot3 <span class="ot">&lt;-</span></span>
<span id="cb442-5"><a href="big-data-visualization.html#cb442-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb442-6"><a href="big-data-visualization.html#cb442-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y), <span class="at">data=</span>plotdata)</span>
<span id="cb442-7"><a href="big-data-visualization.html#cb442-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-8"><a href="big-data-visualization.html#cb442-8" aria-hidden="true" tabindex="-1"></a><span class="co"># show plot in interactive session</span></span>
<span id="cb442-9"><a href="big-data-visualization.html#cb442-9" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">print</span>(splot3))</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-192-1.png" width="672" /></p>
<pre><code>##    user  system elapsed 
##   0.760   0.007   0.778</code></pre>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="big-data-visualization.html#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot to file</span></span>
<span id="cb444-2"><a href="big-data-visualization.html#cb444-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;splot3.pdf&quot;</span>,  <span class="at">device=</span><span class="st">&quot;pdf&quot;</span>, <span class="at">width =</span> <span class="dv">5</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb444-3"><a href="big-data-visualization.html#cb444-3" aria-hidden="true" tabindex="-1"></a><span class="fu">file_size</span>(<span class="st">&quot;splot3.pdf&quot;</span>)</span></code></pre></div>
<pre><code>## 13K</code></pre>
<p>This approach is faster by an order of magnitude, and the resulting pdf takes up only a fraction of the storage space needed for <code>splot.pdf</code>, which is based on the classical <code>geom_points()</code> and a vector-based image.</p>
<p><em>Use aggregates instead of raw data</em>
Depending on what pattern/aspect of the data you want to inspect visually, you might not actually need to plot all observations directly but rather the result of aggregating the observations first. There are several options to do this, but in the context of scatter plots based on many observations, a two-dimensional bin plot can be a good starting point. The idea behind this approach is to divide the canvas into grid-cells (typically in the form of rectangles or hexagons), compute for each grid cell the number of observations/points that would fall into it (in a scatter plot), and then indicate the number of observations per grid cell via the cell’s shading. Such a 2D bin plot of the same data as above can be generated via <code>geom_hex()</code>:</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="big-data-visualization.html#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate scatter plot</span></span>
<span id="cb446-2"><a href="big-data-visualization.html#cb446-2" aria-hidden="true" tabindex="-1"></a>splot4 <span class="ot">&lt;-</span></span>
<span id="cb446-3"><a href="big-data-visualization.html#cb446-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ggplot</span>(plotdata, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y))<span class="sc">+</span></span>
<span id="cb446-4"><a href="big-data-visualization.html#cb446-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_hex</span>()</span></code></pre></div>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="big-data-visualization.html#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mem_used</span>()</span></code></pre></div>
<pre><code>## 2.26 GB</code></pre>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="big-data-visualization.html#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(<span class="fu">print</span>(splot4))</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-194-1.png" width="672" /></p>
<pre><code>##    user  system elapsed 
##   0.516   0.012   0.540</code></pre>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="big-data-visualization.html#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mem_used</span>()</span></code></pre></div>
<pre><code>## 2.26 GB</code></pre>
<p>Obviously, this approach is much faster and uses up much less memory than the <code>geom_point()</code> approach. Moreover, note that this approach to visualizing a potential relation between two variables based on many observations might even have another advantage over the approaches taken above. In all of the scatter plots, it was not visible whether the point cloud contains areas with substantially more observations (more density). There were simply too many points plotted over each other to recognize much more than the contour of the overall point cloud. With the 2D bin plot implemented with <code>geom_hex()</code>, we recognize immediately that there are many more observations located in the center of the cloud than further away from the center.</p>
</div>
<div id="data-exploration-with-ggplot2" class="section level2 hasAnchor" number="12.2">
<h2><span class="header-section-number">12.2</span> Data exploration with <code>ggplot2</code><a href="big-data-visualization.html#data-exploration-with-ggplot2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this tutorial we will work with the TLC data used in the data aggregation session. The raw data consists of several monthly CSV files and can be downloaded via the <a href="https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page">TLC’s website</a>. Again, we work only with the first million observations.</p>
<p>In order to better understand the large dataset at hand (particularly regarding the determinants of tips paid), we use <code>ggplot2</code> to visualize some key aspects of the data.</p>
<p>First, let’s look at the raw relationship between fare paid and the tip paid. We set up the canvas with <code>ggplot</code>.</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="big-data-visualization.html#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb453-2"><a href="big-data-visualization.html#cb453-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb453-3"><a href="big-data-visualization.html#cb453-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-4"><a href="big-data-visualization.html#cb453-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set up the canvas</span></span>
<span id="cb453-5"><a href="big-data-visualization.html#cb453-5" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(taxi, <span class="fu">aes</span>(<span class="at">y=</span>Tip_Amt, <span class="at">x=</span> Fare_Amt)) </span>
<span id="cb453-6"><a href="big-data-visualization.html#cb453-6" aria-hidden="true" tabindex="-1"></a>taxiplot</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-196-1.png" width="672" /></p>
<p>Now we visualize the co-distribution of the two variables with a simple scatter-plot. to speed things up, we use <code>geom_scattermore()</code> but increase the point size.<a href="#fn51" class="footnote-ref" id="fnref51"><sup>51</sup></a></p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="big-data-visualization.html#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simple x/y plot</span></span>
<span id="cb454-2"><a href="big-data-visualization.html#cb454-2" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="sc">+</span></span>
<span id="cb454-3"><a href="big-data-visualization.html#cb454-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="at">pointsize =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-197-1.png" width="672" /></p>
<p>Note that this took quite a while, as R had to literally plot one million dots on the canvas. Moreover, many dots fall within the same area, making it impossible to recognize how much mass there actually is. This is typical for visualization exercises with large datasets. One way to improve this is by making the dots more transparent by setting the <code>alpha</code> parameter.</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="big-data-visualization.html#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simple x/y plot</span></span>
<span id="cb455-2"><a href="big-data-visualization.html#cb455-2" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="sc">+</span></span>
<span id="cb455-3"><a href="big-data-visualization.html#cb455-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="at">pointsize =</span> <span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-198-1.png" width="672" /></p>
<p>Alternatively, we can compute two-dimensional bins. Here, we use <code>geom_bin2d()</code> (an alternative to <code>geom_hex</code> used above) in which the canvas is split into rectangles and the number of observations falling into each respective rectangle is computed. The visualization is then based on plotting the rectangles with counts greater than 0, and the shading of the rectangles indicates the count values.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="big-data-visualization.html#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="co"># two-dimensional bins</span></span>
<span id="cb456-2"><a href="big-data-visualization.html#cb456-2" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="sc">+</span></span>
<span id="cb456-3"><a href="big-data-visualization.html#cb456-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_bin2d</span>()</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-199-1.png" width="672" /></p>
<p>A large proportion of the tip/fare observations seem to be in the very lower-left corner of the pane, while most other trips seem to be evenly distributed. However, we fail to see smaller differences in this visualization. In order to reduce the dominance of the 2D bins with very high counts, we display the natural logarithm of counts and display the bins as points.</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="big-data-visualization.html#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="co"># two-dimensional bins</span></span>
<span id="cb457-2"><a href="big-data-visualization.html#cb457-2" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="sc">+</span></span>
<span id="cb457-3"><a href="big-data-visualization.html#cb457-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">stat_bin_2d</span>(<span class="at">geom=</span><span class="st">&quot;point&quot;</span>,</span>
<span id="cb457-4"><a href="big-data-visualization.html#cb457-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">mapping=</span> <span class="fu">aes</span>(<span class="at">size =</span> <span class="fu">log</span>(..count..))) <span class="sc">+</span></span>
<span id="cb457-5"><a href="big-data-visualization.html#cb457-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">guides</span>(<span class="at">fill =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Warning: The `&lt;scale&gt;` argument of `guides()` cannot be `FALSE`. Use &quot;none&quot; instead as of ggplot2
## 3.3.4.</code></pre>
<pre><code>## Warning: The dot-dot notation (`..count..`) was deprecated in ggplot2 3.4.0.
## ℹ Please use `after_stat(count)` instead.</code></pre>
<p><img src="bigdata_files/figure-html/unnamed-chunk-200-1.png" width="672" /></p>
<p>We note that there are many cases with very low fare amounts, many cases with no or hardly any tip, and quite a lot of cases with very high tip amounts (in relation to the rather low fare amount). In the following, we dissect this picture by having a closer look at ‘typical’ tip amounts and whether they differ by type of payment.</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="big-data-visualization.html#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute frequency of per tip amount and payment method</span></span>
<span id="cb460-2"><a href="big-data-visualization.html#cb460-2" aria-hidden="true" tabindex="-1"></a>taxi[, n_same_tip<span class="sc">:</span><span class="er">=</span> .N, by<span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Tip_Amt&quot;</span>, <span class="st">&quot;Payment_Type&quot;</span>)]</span>
<span id="cb460-3"><a href="big-data-visualization.html#cb460-3" aria-hidden="true" tabindex="-1"></a>frequencies <span class="ot">&lt;-</span> <span class="fu">unique</span>(taxi[Payment_Type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;credit&quot;</span>, <span class="st">&quot;cash&quot;</span>),</span>
<span id="cb460-4"><a href="big-data-visualization.html#cb460-4" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">c</span>(<span class="st">&quot;n_same_tip&quot;</span>, <span class="st">&quot;Tip_Amt&quot;</span>, <span class="st">&quot;Payment_Type&quot;</span>)][<span class="fu">order</span>(n_same_tip, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)])</span>
<span id="cb460-5"><a href="big-data-visualization.html#cb460-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-6"><a href="big-data-visualization.html#cb460-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-7"><a href="big-data-visualization.html#cb460-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot top 20 frequent tip amounts</span></span>
<span id="cb460-8"><a href="big-data-visualization.html#cb460-8" aria-hidden="true" tabindex="-1"></a>fare <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> frequencies[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>], <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(Tip_Amt), <span class="at">y =</span> n_same_tip)) </span>
<span id="cb460-9"><a href="big-data-visualization.html#cb460-9" aria-hidden="true" tabindex="-1"></a>fare <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) </span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-201-1.png" width="672" /></p>
<p>Indeed, paying no tip at all is quite frequent, overall.<a href="#fn52" class="footnote-ref" id="fnref52"><sup>52</sup></a> The bar plot also indicates that there seem to be some ‘focal points’ in the amount of tip paid. Clearly, paying one USD or two USD is more common than paying fractions. However, fractions of dollars might be more likely if tips are paid in cash and customers simply add some loose change to the fare amount paid.</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="big-data-visualization.html#cb461-1" aria-hidden="true" tabindex="-1"></a>fare <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span> </span>
<span id="cb461-2"><a href="big-data-visualization.html#cb461-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">facet_wrap</span>(<span class="st">&quot;Payment_Type&quot;</span>) </span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-202-1.png" width="672" /></p>
<p>Clearly, it looks as if trips paid in cash tend not to be tipped (at least in this sub-sample).</p>
<p>Let’s try to tease this information out of the initial points plot. Trips paid in cash are often not tipped; we thus should indicate the payment method. Moreover, tips paid in full dollar amounts might indicate a habit.</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="big-data-visualization.html#cb462-1" aria-hidden="true" tabindex="-1"></a><span class="co"># indicate natural numbers</span></span>
<span id="cb462-2"><a href="big-data-visualization.html#cb462-2" aria-hidden="true" tabindex="-1"></a>taxi[, dollar_paid <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(Tip_Amt <span class="sc">==</span> <span class="fu">round</span>(Tip_Amt,<span class="dv">0</span>), <span class="st">&quot;Full&quot;</span>, <span class="st">&quot;Fraction&quot;</span>),]</span>
<span id="cb462-3"><a href="big-data-visualization.html#cb462-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb462-4"><a href="big-data-visualization.html#cb462-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb462-5"><a href="big-data-visualization.html#cb462-5" aria-hidden="true" tabindex="-1"></a><span class="co"># extended x/y plot</span></span>
<span id="cb462-6"><a href="big-data-visualization.html#cb462-6" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="sc">+</span></span>
<span id="cb462-7"><a href="big-data-visualization.html#cb462-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="at">pointsize =</span> <span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="fu">aes</span>(<span class="at">color=</span>Payment_Type)) <span class="sc">+</span></span>
<span id="cb462-8"><a href="big-data-visualization.html#cb462-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">facet_wrap</span>(<span class="st">&quot;dollar_paid&quot;</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-203-1.png" width="672" /></p>
<p>Now the picture is getting clearer. Paying a tip seems to follow certain rules of thumb. Certain fixed amounts tend to be paid independent of the fare amount (visible in the straight lines of dots on the right-hand panel). At the same time, the pattern in the left panel indicates another habit: computing the amount of the tip as a linear function of the total fare amount (‘pay 10% tip’). A third habit might be to determine the amount of tip by ‘rounding up’ the total amount paid. In the following, we try to tease the latter out, only focusing on credit card payments.</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="big-data-visualization.html#cb463-1" aria-hidden="true" tabindex="-1"></a>taxi[, rounded_up <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(Fare_Amt <span class="sc">+</span> Tip_Amt <span class="sc">==</span> <span class="fu">round</span>(Fare_Amt <span class="sc">+</span> Tip_Amt, <span class="dv">0</span>),</span>
<span id="cb463-2"><a href="big-data-visualization.html#cb463-2" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;Rounded up&quot;</span>,</span>
<span id="cb463-3"><a href="big-data-visualization.html#cb463-3" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;Not rounded&quot;</span>)]</span>
<span id="cb463-4"><a href="big-data-visualization.html#cb463-4" aria-hidden="true" tabindex="-1"></a><span class="co"># extended x/y plot</span></span>
<span id="cb463-5"><a href="big-data-visualization.html#cb463-5" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="sc">+</span></span>
<span id="cb463-6"><a href="big-data-visualization.html#cb463-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-7"><a href="big-data-visualization.html#cb463-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="at">data=</span> taxi[Payment_Type <span class="sc">==</span> <span class="st">&quot;credit&quot;</span>], </span>
<span id="cb463-8"><a href="big-data-visualization.html#cb463-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pointsize =</span> <span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="fu">aes</span>(<span class="at">color=</span>rounded_up)) <span class="sc">+</span></span>
<span id="cb463-9"><a href="big-data-visualization.html#cb463-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">facet_wrap</span>(<span class="st">&quot;dollar_paid&quot;</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-204-1.png" width="672" /></p>
<p>Now we can start modeling. A reasonable first shot is to model the tip amount as a linear function of the fare amount, conditional on no-zero tip amounts paid as fractions of a dollar.</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="big-data-visualization.html#cb464-1" aria-hidden="true" tabindex="-1"></a>modelplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span> taxi[Payment_Type <span class="sc">==</span> <span class="st">&quot;credit&quot;</span> <span class="sc">&amp;</span> dollar_paid <span class="sc">==</span> <span class="st">&quot;Fraction&quot;</span> <span class="sc">&amp;</span> <span class="dv">0</span> <span class="sc">&lt;</span> Tip_Amt],</span>
<span id="cb464-2"><a href="big-data-visualization.html#cb464-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x =</span> Fare_Amt, <span class="at">y =</span> Tip_Amt))</span>
<span id="cb464-3"><a href="big-data-visualization.html#cb464-3" aria-hidden="true" tabindex="-1"></a>modelplot <span class="sc">+</span></span>
<span id="cb464-4"><a href="big-data-visualization.html#cb464-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="at">pointsize =</span> <span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">color=</span><span class="st">&quot;darkgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb464-5"><a href="big-data-visualization.html#cb464-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="bigdata_files/figure-html/unnamed-chunk-205-1.png" width="672" /></p>
<p>Finally, we prepare the plot for reporting. <code>ggplot2</code> provides several predefined ‘themes’ for plots that define all kinds of aspects of a plot (background color, line colors, font size, etc.). The easiest way to tweak the design of your final plot in a certain direction is to just add such a pre-defined theme at the end of your plot. Some of the pre-defined themes allow you to change a few aspects, such as the font type and the base size of all the texts in the plot (labels, tick numbers, etc.). Here, we use the <code>theme_bw()</code>, increase the font size, and switch to a serif-type font. <code>theme_bw()</code> is one of the complete themes that ships with the basic <code>ggplot2</code> installation.<a href="#fn53" class="footnote-ref" id="fnref53"><sup>53</sup></a> Many more themes can be found in additional R packages (see, for example, the <a href="https://cran.r-project.org/web/packages/ggthemes/index.html"><code>ggthemes</code> package</a>).</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="big-data-visualization.html#cb466-1" aria-hidden="true" tabindex="-1"></a>modelplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span> taxi[Payment_Type <span class="sc">==</span> <span class="st">&quot;credit&quot;</span> <span class="sc">&amp;</span> dollar_paid <span class="sc">==</span> <span class="st">&quot;Fraction&quot;</span> <span class="sc">&amp;</span> <span class="dv">0</span> <span class="sc">&lt;</span> Tip_Amt],</span>
<span id="cb466-2"><a href="big-data-visualization.html#cb466-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x =</span> Fare_Amt, <span class="at">y =</span> Tip_Amt))</span>
<span id="cb466-3"><a href="big-data-visualization.html#cb466-3" aria-hidden="true" tabindex="-1"></a>modelplot <span class="sc">+</span></span>
<span id="cb466-4"><a href="big-data-visualization.html#cb466-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="at">pointsize =</span> <span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">color=</span><span class="st">&quot;darkgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb466-5"><a href="big-data-visualization.html#cb466-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb466-6"><a href="big-data-visualization.html#cb466-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ylab</span>(<span class="st">&quot;Amount of tip paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb466-7"><a href="big-data-visualization.html#cb466-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">xlab</span>(<span class="st">&quot;Amount of fare paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb466-8"><a href="big-data-visualization.html#cb466-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>, <span class="at">base_family =</span> <span class="st">&quot;serif&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="bigdata_files/figure-html/unnamed-chunk-206-1.png" width="672" /></p>
<div class="infobox">
<div class="center">
<p><strong>Aside: modify and create themes</strong></p>
</div>
<p><em>Simple modifications of themes</em></p>
<p>Apart from using pre-defined themes as illustrated above, we can use the <code>theme()</code> function to further modify the design of a plot. For example, we can print the axis labels (‘axis titles’) in bold.</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="big-data-visualization.html#cb468-1" aria-hidden="true" tabindex="-1"></a>modelplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span> taxi[Payment_Type <span class="sc">==</span> <span class="st">&quot;credit&quot;</span> <span class="sc">&amp;</span> dollar_paid <span class="sc">==</span> <span class="st">&quot;Fraction&quot;</span> <span class="sc">&amp;</span> <span class="dv">0</span> <span class="sc">&lt;</span> Tip_Amt],</span>
<span id="cb468-2"><a href="big-data-visualization.html#cb468-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">x =</span> Fare_Amt, <span class="at">y =</span> Tip_Amt))</span>
<span id="cb468-3"><a href="big-data-visualization.html#cb468-3" aria-hidden="true" tabindex="-1"></a>modelplot <span class="sc">+</span></span>
<span id="cb468-4"><a href="big-data-visualization.html#cb468-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="at">pointsize =</span> <span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">color=</span><span class="st">&quot;darkgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb468-5"><a href="big-data-visualization.html#cb468-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb468-6"><a href="big-data-visualization.html#cb468-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ylab</span>(<span class="st">&quot;Amount of tip paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb468-7"><a href="big-data-visualization.html#cb468-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">xlab</span>(<span class="st">&quot;Amount of fare paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb468-8"><a href="big-data-visualization.html#cb468-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>, <span class="at">base_family =</span> <span class="st">&quot;serif&quot;</span>) <span class="sc">+</span></span>
<span id="cb468-9"><a href="big-data-visualization.html#cb468-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="bigdata_files/figure-html/unnamed-chunk-207-1.png" width="672" /></p>
<p>There is a large list of plot design aspects that can be modified in this way (see <code>?theme()</code> for details).</p>
<p><em>Create your own themes</em></p>
<p>Extensive design modifications via <code>theme()</code> can involve many lines of code, making your plot code harder to read/understand. In practice, you might want to define your specific theme once and then apply this theme to all of your plots. In order to do so it makes sense to choose one of the existing themes as a basis and then modify its design aspects until you have the design you are looking for. Following the design choices in the examples above, we can create our own <code>theme_my_serif()</code> as follows.</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="big-data-visualization.html#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;define&#39; a new theme</span></span>
<span id="cb470-2"><a href="big-data-visualization.html#cb470-2" aria-hidden="true" tabindex="-1"></a>theme_my_serif <span class="ot">&lt;-</span>      </span>
<span id="cb470-3"><a href="big-data-visualization.html#cb470-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>, <span class="at">base_family =</span> <span class="st">&quot;serif&quot;</span>) <span class="sc">+</span></span>
<span id="cb470-4"><a href="big-data-visualization.html#cb470-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">&quot;bold&quot;</span>))</span>
<span id="cb470-5"><a href="big-data-visualization.html#cb470-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-6"><a href="big-data-visualization.html#cb470-6" aria-hidden="true" tabindex="-1"></a><span class="co"># apply it </span></span>
<span id="cb470-7"><a href="big-data-visualization.html#cb470-7" aria-hidden="true" tabindex="-1"></a>modelplot <span class="sc">+</span></span>
<span id="cb470-8"><a href="big-data-visualization.html#cb470-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="at">pointsize =</span> <span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">color=</span><span class="st">&quot;darkgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb470-9"><a href="big-data-visualization.html#cb470-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb470-10"><a href="big-data-visualization.html#cb470-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ylab</span>(<span class="st">&quot;Amount of tip paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb470-11"><a href="big-data-visualization.html#cb470-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">xlab</span>(<span class="st">&quot;Amount of fare paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb470-12"><a href="big-data-visualization.html#cb470-12" aria-hidden="true" tabindex="-1"></a>  theme_my_serif</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="bigdata_files/figure-html/unnamed-chunk-208-1.png" width="672" /></p>
<p>This practical approach does not require you to define every aspect of a theme. If you indeed want to completely define every aspect of a theme, you can set <code>complete=TRUE</code> when calling the theme function.</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="big-data-visualization.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;define&#39; a new theme</span></span>
<span id="cb472-2"><a href="big-data-visualization.html#cb472-2" aria-hidden="true" tabindex="-1"></a>my_serif_theme <span class="ot">&lt;-</span>      </span>
<span id="cb472-3"><a href="big-data-visualization.html#cb472-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>, <span class="at">base_family =</span> <span class="st">&quot;serif&quot;</span>) <span class="sc">+</span></span>
<span id="cb472-4"><a href="big-data-visualization.html#cb472-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">&quot;bold&quot;</span>), <span class="at">complete =</span> <span class="cn">TRUE</span>)</span>
<span id="cb472-5"><a href="big-data-visualization.html#cb472-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-6"><a href="big-data-visualization.html#cb472-6" aria-hidden="true" tabindex="-1"></a><span class="co"># apply it </span></span>
<span id="cb472-7"><a href="big-data-visualization.html#cb472-7" aria-hidden="true" tabindex="-1"></a>modelplot <span class="sc">+</span></span>
<span id="cb472-8"><a href="big-data-visualization.html#cb472-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="at">pointsize =</span> <span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">color=</span><span class="st">&quot;darkgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb472-9"><a href="big-data-visualization.html#cb472-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb472-10"><a href="big-data-visualization.html#cb472-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ylab</span>(<span class="st">&quot;Amount of tip paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb472-11"><a href="big-data-visualization.html#cb472-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">xlab</span>(<span class="st">&quot;Amount of fare paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb472-12"><a href="big-data-visualization.html#cb472-12" aria-hidden="true" tabindex="-1"></a>  theme_my_serif</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="bigdata_files/figure-html/unnamed-chunk-209-1.png" width="672" /></p>
<p>Note that since we have only defined one aspect (bold axis titles), the rest of the elements follow the default theme.</p>
<p>_Implementing actual themes as functions.</p>
<p>Importantly, the approach outlined above does not technically really create a new theme like <code>theme_bw()</code>, as these pre-defined themes are implemented as functions. Note that we add the new theme to the plot simply with <code>+ theme_my_serif</code> (no parentheses). In practice this is the simplest approach, and it provides all the functionality you need in order to apply your own ‘theme’ to each of your plots. If you want to implement a theme as a function, the following blueprint can get you started.</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="big-data-visualization.html#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define own theme</span></span>
<span id="cb474-2"><a href="big-data-visualization.html#cb474-2" aria-hidden="true" tabindex="-1"></a>theme_my_serif <span class="ot">&lt;-</span> </span>
<span id="cb474-3"><a href="big-data-visualization.html#cb474-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(<span class="at">base_size =</span> <span class="dv">15</span>,</span>
<span id="cb474-4"><a href="big-data-visualization.html#cb474-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">base_family =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb474-5"><a href="big-data-visualization.html#cb474-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">base_line_size =</span> base_size<span class="sc">/</span><span class="dv">170</span>,</span>
<span id="cb474-6"><a href="big-data-visualization.html#cb474-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">base_rect_size =</span> base_size<span class="sc">/</span><span class="dv">170</span>){ </span>
<span id="cb474-7"><a href="big-data-visualization.html#cb474-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb474-8"><a href="big-data-visualization.html#cb474-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>(<span class="at">base_size =</span> base_size,</span>
<span id="cb474-9"><a href="big-data-visualization.html#cb474-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">base_family =</span> base_family,</span>
<span id="cb474-10"><a href="big-data-visualization.html#cb474-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">base_line_size =</span> base_size<span class="sc">/</span><span class="dv">170</span>,</span>
<span id="cb474-11"><a href="big-data-visualization.html#cb474-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">base_rect_size =</span> base_size<span class="sc">/</span><span class="dv">170</span>) <span class="sc">%+replace%</span>    <span class="co"># use theme_bw() as a basis but replace some design elements</span></span>
<span id="cb474-12"><a href="big-data-visualization.html#cb474-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb474-13"><a href="big-data-visualization.html#cb474-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">&quot;bold&quot;</span>)</span>
<span id="cb474-14"><a href="big-data-visualization.html#cb474-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb474-15"><a href="big-data-visualization.html#cb474-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb474-16"><a href="big-data-visualization.html#cb474-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-17"><a href="big-data-visualization.html#cb474-17" aria-hidden="true" tabindex="-1"></a><span class="co"># apply the theme</span></span>
<span id="cb474-18"><a href="big-data-visualization.html#cb474-18" aria-hidden="true" tabindex="-1"></a>modelplot <span class="sc">+</span></span>
<span id="cb474-19"><a href="big-data-visualization.html#cb474-19" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="at">pointsize =</span> <span class="dv">3</span>, <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">color=</span><span class="st">&quot;darkgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb474-20"><a href="big-data-visualization.html#cb474-20" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb474-21"><a href="big-data-visualization.html#cb474-21" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ylab</span>(<span class="st">&quot;Amount of tip paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb474-22"><a href="big-data-visualization.html#cb474-22" aria-hidden="true" tabindex="-1"></a>     <span class="fu">xlab</span>(<span class="st">&quot;Amount of fare paid (in USD)&quot;</span>) <span class="sc">+</span></span>
<span id="cb474-23"><a href="big-data-visualization.html#cb474-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_my_serif</span>(<span class="at">base_size =</span> <span class="dv">18</span>, <span class="at">base_family=</span><span class="st">&quot;serif&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="bigdata_files/figure-html/unnamed-chunk-210-1.png" width="672" /></p>
</div>
</div>
<div id="visualizing-time-and-space" class="section level2 hasAnchor" number="12.3">
<h2><span class="header-section-number">12.3</span> Visualizing time and space<a href="big-data-visualization.html#visualizing-time-and-space" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The previous visualization exercises were focused on visually exploring patterns in the tipping behavior of people taking a NYC yellow cab ride. Based on the same dataset, we will explore the time and spatial dimensions of the TLC Yellow Cab data. That is, we explore where trips tend to start and end, depending on the time of the day.</p>
<div id="preparations" class="section level3 hasAnchor" number="12.3.1">
<h3><span class="header-section-number">12.3.1</span> Preparations<a href="big-data-visualization.html#preparations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For the visualization of spatial data, we first load additional packages that give R some <a href="https://en.wikipedia.org/wiki/Geographic_information_system">GIS</a> features.</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="big-data-visualization.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load GIS packages</span></span>
<span id="cb476-2"><a href="big-data-visualization.html#cb476-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgdal)</span>
<span id="cb476-3"><a href="big-data-visualization.html#cb476-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgeos)</span></code></pre></div>
<p>Moreover, we download and import a so-called <a href="https://en.wikipedia.org/wiki/Shapefile">‘shape file’</a> (a geospatial data format) of New York City. This will be the basis for our visualization of the spatial dimension of taxi trips. The file is downloaded from <a href="https://www1.nyc.gov/site/planning/index.page">New York’s Department of City Planning</a> and indicates the city’s community district borders.<a href="#fn54" class="footnote-ref" id="fnref54"><sup>54</sup></a></p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="big-data-visualization.html#cb477-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download the zipped shapefile to a temporary file; unzip</span></span>
<span id="cb477-2"><a href="big-data-visualization.html#cb477-2" aria-hidden="true" tabindex="-1"></a>URL <span class="ot">&lt;-</span> <span class="st">&quot;https://www1.nyc.gov/assets/planning/download/zip/data-maps/open-data/nycd_19a.zip&quot;</span></span>
<span id="cb477-3"><a href="big-data-visualization.html#cb477-3" aria-hidden="true" tabindex="-1"></a>tmp_file <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb477-4"><a href="big-data-visualization.html#cb477-4" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(URL, tmp_file)</span>
<span id="cb477-5"><a href="big-data-visualization.html#cb477-5" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">unzip</span>(tmp_file, <span class="at">exdir=</span> <span class="st">&quot;data&quot;</span>)</span>
<span id="cb477-6"><a href="big-data-visualization.html#cb477-6" aria-hidden="true" tabindex="-1"></a><span class="co"># delete the temporary file</span></span>
<span id="cb477-7"><a href="big-data-visualization.html#cb477-7" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(tmp_file)</span></code></pre></div>
<p>Now we can import the shape file and have a look at how the GIS data is structured.</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="big-data-visualization.html#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read GIS data</span></span>
<span id="cb478-2"><a href="big-data-visualization.html#cb478-2" aria-hidden="true" tabindex="-1"></a>nyc_map <span class="ot">&lt;-</span> <span class="fu">readOGR</span>(file_path[<span class="dv">1</span>], <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb478-3"><a href="big-data-visualization.html#cb478-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-4"><a href="big-data-visualization.html#cb478-4" aria-hidden="true" tabindex="-1"></a><span class="co"># have a look at the GIS data</span></span>
<span id="cb478-5"><a href="big-data-visualization.html#cb478-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nyc_map)</span></code></pre></div>
<pre><code>## Object of class SpatialPolygonsDataFrame
## Coordinates:
##      min     max
## x 913175 1067383
## y 120122  272844
## Is projected: TRUE 
## proj4string :
## [+proj=lcc +lat_0=40.1666666666667 +lon_0=-74
## +lat_1=41.0333333333333 +lat_2=40.6666666666667
## +x_0=300000 +y_0=0 +datum=NAD83 +units=us-ft
## +no_defs]
## Data attributes:
##      BoroCD      Shape_Leng       Shape_Area      
##  Min.   :101   Min.   : 23963   Min.   :2.43e+07  
##  1st Qu.:206   1st Qu.: 36611   1st Qu.:4.84e+07  
##  Median :308   Median : 52246   Median :8.27e+07  
##  Mean   :297   Mean   : 74890   Mean   :1.19e+08  
##  3rd Qu.:406   3rd Qu.: 85711   3rd Qu.:1.37e+08  
##  Max.   :595   Max.   :270660   Max.   :5.99e+08</code></pre>
<p>Note that the coordinates are not in the usual longitude and latitude units. The original map uses a different projection than the TLC data of taxi trip records. Before plotting, we thus have to change the projection to be in line with the TLC data.</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="big-data-visualization.html#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform the projection</span></span>
<span id="cb480-2"><a href="big-data-visualization.html#cb480-2" aria-hidden="true" tabindex="-1"></a>nyc_map <span class="ot">&lt;-</span> <span class="fu">spTransform</span>(nyc_map, <span class="fu">CRS</span>(<span class="st">&quot;+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: PROJ support is provided by the sf and terra
## packages among others</code></pre>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="big-data-visualization.html#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check result</span></span>
<span id="cb482-2"><a href="big-data-visualization.html#cb482-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nyc_map)</span></code></pre></div>
<pre><code>## Object of class SpatialPolygonsDataFrame
## Coordinates:
##      min    max
## x -74.26 -73.70
## y  40.50  40.92
## Is projected: FALSE 
## proj4string : [+proj=longlat +datum=WGS84 +no_defs]
## Data attributes:
##      BoroCD      Shape_Leng       Shape_Area      
##  Min.   :101   Min.   : 23963   Min.   :2.43e+07  
##  1st Qu.:206   1st Qu.: 36611   1st Qu.:4.84e+07  
##  Median :308   Median : 52246   Median :8.27e+07  
##  Mean   :297   Mean   : 74890   Mean   :1.19e+08  
##  3rd Qu.:406   3rd Qu.: 85711   3rd Qu.:1.37e+08  
##  Max.   :595   Max.   :270660   Max.   :5.99e+08</code></pre>
<p>One last preparatory step is to convert the map data to a <code>data.frame</code> for plotting with <code>ggplot</code>.</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="big-data-visualization.html#cb484-1" aria-hidden="true" tabindex="-1"></a>nyc_map <span class="ot">&lt;-</span> <span class="fu">fortify</span>(nyc_map)</span></code></pre></div>
</div>
<div id="pick-up-and-drop-off-locations" class="section level3 hasAnchor" number="12.3.2">
<h3><span class="header-section-number">12.3.2</span> Pick-up and drop-off locations<a href="big-data-visualization.html#pick-up-and-drop-off-locations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Since trips might actually start or end outside of NYC, we first restrict the sample of trips to those within the boundary box of the map. For the sake of the exercise, we only select a random sample of <code>50000</code> trips from the remaining trip records.</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="big-data-visualization.html#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="co"># taxi trips plot data</span></span>
<span id="cb485-2"><a href="big-data-visualization.html#cb485-2" aria-hidden="true" tabindex="-1"></a>taxi_trips <span class="ot">&lt;-</span> taxi[Start_Lon <span class="sc">&lt;=</span> <span class="fu">max</span>(nyc_map<span class="sc">$</span>long) <span class="sc">&amp;</span> </span>
<span id="cb485-3"><a href="big-data-visualization.html#cb485-3" aria-hidden="true" tabindex="-1"></a>                        Start_Lon <span class="sc">&gt;=</span> <span class="fu">min</span>(nyc_map<span class="sc">$</span>long) <span class="sc">&amp;</span></span>
<span id="cb485-4"><a href="big-data-visualization.html#cb485-4" aria-hidden="true" tabindex="-1"></a>                        End_Lon <span class="sc">&lt;=</span> <span class="fu">max</span>(nyc_map<span class="sc">$</span>long) <span class="sc">&amp;</span></span>
<span id="cb485-5"><a href="big-data-visualization.html#cb485-5" aria-hidden="true" tabindex="-1"></a>                        End_Lon <span class="sc">&gt;=</span> <span class="fu">min</span>(nyc_map<span class="sc">$</span>long) <span class="sc">&amp;</span></span>
<span id="cb485-6"><a href="big-data-visualization.html#cb485-6" aria-hidden="true" tabindex="-1"></a>                        Start_Lat <span class="sc">&lt;=</span> <span class="fu">max</span>(nyc_map<span class="sc">$</span>lat) <span class="sc">&amp;</span> </span>
<span id="cb485-7"><a href="big-data-visualization.html#cb485-7" aria-hidden="true" tabindex="-1"></a>                        Start_Lat <span class="sc">&gt;=</span> <span class="fu">min</span>(nyc_map<span class="sc">$</span>lat) <span class="sc">&amp;</span></span>
<span id="cb485-8"><a href="big-data-visualization.html#cb485-8" aria-hidden="true" tabindex="-1"></a>                        End_Lat <span class="sc">&lt;=</span> <span class="fu">max</span>(nyc_map<span class="sc">$</span>lat) <span class="sc">&amp;</span></span>
<span id="cb485-9"><a href="big-data-visualization.html#cb485-9" aria-hidden="true" tabindex="-1"></a>                        End_Lat <span class="sc">&gt;=</span> <span class="fu">min</span>(nyc_map<span class="sc">$</span>lat) </span>
<span id="cb485-10"><a href="big-data-visualization.html#cb485-10" aria-hidden="true" tabindex="-1"></a>                        ]</span>
<span id="cb485-11"><a href="big-data-visualization.html#cb485-11" aria-hidden="true" tabindex="-1"></a>taxi_trips <span class="ot">&lt;-</span> taxi_trips[base<span class="sc">::</span><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(taxi_trips), <span class="dv">50000</span>)]</span></code></pre></div>
<p>In order to visualize how the cab traffic is changing over the course of the day, we add an additional variable called <code>start_time</code> in which we store the time (hour) of the day a trip started.</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="big-data-visualization.html#cb486-1" aria-hidden="true" tabindex="-1"></a>taxi_trips<span class="sc">$</span>start_time <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">hour</span>(taxi_trips<span class="sc">$</span>Trip_Pickup_DateTime)</span></code></pre></div>
<p>Particularly, we want to look at differences between morning, afternoon, and evening/night.</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="big-data-visualization.html#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define new variable for facets</span></span>
<span id="cb487-2"><a href="big-data-visualization.html#cb487-2" aria-hidden="true" tabindex="-1"></a>taxi_trips<span class="sc">$</span>time_of_day <span class="ot">&lt;-</span> <span class="st">&quot;Morning&quot;</span></span>
<span id="cb487-3"><a href="big-data-visualization.html#cb487-3" aria-hidden="true" tabindex="-1"></a>taxi_trips[start_time <span class="sc">&gt;</span> <span class="dv">12</span> <span class="sc">&amp;</span> start_time <span class="sc">&lt;</span> <span class="dv">17</span>]<span class="sc">$</span>time_of_day <span class="ot">&lt;-</span> <span class="st">&quot;Afternoon&quot;</span></span>
<span id="cb487-4"><a href="big-data-visualization.html#cb487-4" aria-hidden="true" tabindex="-1"></a>taxi_trips[start_time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">17</span><span class="sc">:</span><span class="dv">24</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>)]<span class="sc">$</span>time_of_day <span class="ot">&lt;-</span> <span class="st">&quot;Evening/Night&quot;</span></span>
<span id="cb487-5"><a href="big-data-visualization.html#cb487-5" aria-hidden="true" tabindex="-1"></a>taxi_trips<span class="sc">$</span>time_of_day  <span class="ot">&lt;-</span> <span class="fu">factor</span>(taxi_trips<span class="sc">$</span>time_of_day, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Morning&quot;</span>, <span class="st">&quot;Afternoon&quot;</span>, <span class="st">&quot;Evening/Night&quot;</span>))</span></code></pre></div>
<p>We create the plot by first setting up the canvas with our taxi trip data. Then, we add the map as a first layer.</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="big-data-visualization.html#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up the canvas</span></span>
<span id="cb488-2"><a href="big-data-visualization.html#cb488-2" aria-hidden="true" tabindex="-1"></a>locations <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(taxi_trips, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y=</span>lat))</span>
<span id="cb488-3"><a href="big-data-visualization.html#cb488-3" aria-hidden="true" tabindex="-1"></a><span class="co"># add the map geometry</span></span>
<span id="cb488-4"><a href="big-data-visualization.html#cb488-4" aria-hidden="true" tabindex="-1"></a>locations <span class="ot">&lt;-</span> locations <span class="sc">+</span> <span class="fu">geom_map</span>(<span class="at">data =</span> nyc_map,</span>
<span id="cb488-5"><a href="big-data-visualization.html#cb488-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">map =</span> nyc_map,</span>
<span id="cb488-6"><a href="big-data-visualization.html#cb488-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">aes</span>(<span class="at">map_id =</span> id))</span>
<span id="cb488-7"><a href="big-data-visualization.html#cb488-7" aria-hidden="true" tabindex="-1"></a>locations</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-219-1.png" width="672" /></p>
<p>Now we can start adding the pick-up and drop-off locations of cab trips.</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="big-data-visualization.html#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add pick-up locations to plot</span></span>
<span id="cb489-2"><a href="big-data-visualization.html#cb489-2" aria-hidden="true" tabindex="-1"></a>locations <span class="sc">+</span> </span>
<span id="cb489-3"><a href="big-data-visualization.html#cb489-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="fu">aes</span>(<span class="at">x=</span>Start_Lon, <span class="at">y=</span>Start_Lat),</span>
<span id="cb489-4"><a href="big-data-visualization.html#cb489-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">color=</span><span class="st">&quot;orange&quot;</span>,</span>
<span id="cb489-5"><a href="big-data-visualization.html#cb489-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">pointsize =</span> <span class="dv">1</span>,</span>
<span id="cb489-6"><a href="big-data-visualization.html#cb489-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-220-1.png" width="672" /></p>
<p>As is to be expected, most of the trips start in Manhattan. Now let’s look at where trips end.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="big-data-visualization.html#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add drop-off locations to plot</span></span>
<span id="cb490-2"><a href="big-data-visualization.html#cb490-2" aria-hidden="true" tabindex="-1"></a>locations <span class="sc">+</span></span>
<span id="cb490-3"><a href="big-data-visualization.html#cb490-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="fu">aes</span>(<span class="at">x=</span>End_Lon, <span class="at">y=</span>End_Lat),</span>
<span id="cb490-4"><a href="big-data-visualization.html#cb490-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">color=</span><span class="st">&quot;steelblue&quot;</span>,</span>
<span id="cb490-5"><a href="big-data-visualization.html#cb490-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">pointsize =</span> <span class="dv">1</span>,</span>
<span id="cb490-6"><a href="big-data-visualization.html#cb490-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb490-7"><a href="big-data-visualization.html#cb490-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="fu">aes</span>(<span class="at">x=</span>Start_Lon, <span class="at">y=</span>Start_Lat),</span>
<span id="cb490-8"><a href="big-data-visualization.html#cb490-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">color=</span><span class="st">&quot;orange&quot;</span>,</span>
<span id="cb490-9"><a href="big-data-visualization.html#cb490-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">pointsize =</span> <span class="dv">1</span>,</span>
<span id="cb490-10"><a href="big-data-visualization.html#cb490-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-221-1.png" width="672" /></p>
<p>In fact, more trips tend to end outside of Manhattan. And the destinations seem to be broader spread across the city then the pick-up locations. Most destinations are still in Manhattan, though.</p>
<p>Now let’s have a look at how this picture changes depending on the time of the day.</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="big-data-visualization.html#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pick-up locations </span></span>
<span id="cb491-2"><a href="big-data-visualization.html#cb491-2" aria-hidden="true" tabindex="-1"></a>locations <span class="sc">+</span></span>
<span id="cb491-3"><a href="big-data-visualization.html#cb491-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="fu">aes</span>(<span class="at">x=</span>Start_Lon, <span class="at">y=</span>Start_Lat),</span>
<span id="cb491-4"><a href="big-data-visualization.html#cb491-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">color=</span><span class="st">&quot;orange&quot;</span>,</span>
<span id="cb491-5"><a href="big-data-visualization.html#cb491-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">pointsize =</span><span class="dv">1</span>,</span>
<span id="cb491-6"><a href="big-data-visualization.html#cb491-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb491-7"><a href="big-data-visualization.html#cb491-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(time_of_day))</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-222-1.png" width="864" /></p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="big-data-visualization.html#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop-off locations </span></span>
<span id="cb492-2"><a href="big-data-visualization.html#cb492-2" aria-hidden="true" tabindex="-1"></a>locations <span class="sc">+</span></span>
<span id="cb492-3"><a href="big-data-visualization.html#cb492-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="fu">aes</span>(<span class="at">x=</span>End_Lon, <span class="at">y=</span>End_Lat),</span>
<span id="cb492-4"><a href="big-data-visualization.html#cb492-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">color=</span><span class="st">&quot;steelblue&quot;</span>,</span>
<span id="cb492-5"><a href="big-data-visualization.html#cb492-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">pointsize =</span> <span class="dv">1</span>,</span>
<span id="cb492-6"><a href="big-data-visualization.html#cb492-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb492-7"><a href="big-data-visualization.html#cb492-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(time_of_day))</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-223-1.png" width="864" /></p>
<p>Alternatively, we can plot the hours on a continuous scale.</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="big-data-visualization.html#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop-off locations </span></span>
<span id="cb493-2"><a href="big-data-visualization.html#cb493-2" aria-hidden="true" tabindex="-1"></a>locations <span class="sc">+</span></span>
<span id="cb493-3"><a href="big-data-visualization.html#cb493-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="fu">aes</span>(<span class="at">x=</span>End_Lon, <span class="at">y=</span>End_Lat, <span class="at">color =</span> start_time ),</span>
<span id="cb493-4"><a href="big-data-visualization.html#cb493-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">pointsize =</span> <span class="dv">1</span>,</span>
<span id="cb493-5"><a href="big-data-visualization.html#cb493-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb493-6"><a href="big-data-visualization.html#cb493-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_colour_gradient2</span>( <span class="at">low =</span> <span class="st">&quot;red&quot;</span>, <span class="at">mid =</span> <span class="st">&quot;yellow&quot;</span>, <span class="at">high =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb493-7"><a href="big-data-visualization.html#cb493-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">midpoint =</span> <span class="dv">12</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-224-1.png" width="672" /></p>
<div class="infobox">
<div class="center">
<p><strong>Aside: change color schemes</strong></p>
</div>
<p>In the example above we use <code>scale_colour_gradient2()</code> to modify the color gradient used to visualize the start time of taxi trips. By default, ggplot would plot the following (default gradient color setting):</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="big-data-visualization.html#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="co"># drop-off locations </span></span>
<span id="cb494-2"><a href="big-data-visualization.html#cb494-2" aria-hidden="true" tabindex="-1"></a>locations <span class="sc">+</span></span>
<span id="cb494-3"><a href="big-data-visualization.html#cb494-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="fu">aes</span>(<span class="at">x=</span>End_Lon, <span class="at">y=</span>End_Lat, <span class="at">color =</span> start_time ),</span>
<span id="cb494-4"><a href="big-data-visualization.html#cb494-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">pointsize =</span> <span class="dv">1</span>,</span>
<span id="cb494-5"><a href="big-data-visualization.html#cb494-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.2</span>) </span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-225-1.png" width="672" /></p>
<p><code>ggplot2</code> offers various functions to modify the color scales used in a plot. In the case of the example above, we visualize values of a continuous variable. Hence we use a gradient color scale. In the case of categorical variables, we need to modify the default discrete color scale.</p>
<p>Recall the plot illustrating tipping behavior, where we highlight in which observations the client paid with credit card, cash, etc.</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="big-data-visualization.html#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="co"># indicate natural numbers</span></span>
<span id="cb495-2"><a href="big-data-visualization.html#cb495-2" aria-hidden="true" tabindex="-1"></a>taxi[, dollar_paid <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(Tip_Amt <span class="sc">==</span> <span class="fu">round</span>(Tip_Amt,<span class="dv">0</span>), <span class="st">&quot;Full&quot;</span>, <span class="st">&quot;Fraction&quot;</span>),]</span>
<span id="cb495-3"><a href="big-data-visualization.html#cb495-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb495-4"><a href="big-data-visualization.html#cb495-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb495-5"><a href="big-data-visualization.html#cb495-5" aria-hidden="true" tabindex="-1"></a><span class="co"># extended x/y plot</span></span>
<span id="cb495-6"><a href="big-data-visualization.html#cb495-6" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="sc">+</span></span>
<span id="cb495-7"><a href="big-data-visualization.html#cb495-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="at">alpha=</span><span class="fl">0.2</span>,</span>
<span id="cb495-8"><a href="big-data-visualization.html#cb495-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pointsize=</span><span class="dv">3</span>,</span>
<span id="cb495-9"><a href="big-data-visualization.html#cb495-9" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">color=</span>Payment_Type)) <span class="sc">+</span></span>
<span id="cb495-10"><a href="big-data-visualization.html#cb495-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">facet_wrap</span>(<span class="st">&quot;dollar_paid&quot;</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-226-1.png" width="672" /></p>
<p>Since we do not further specify the discrete color scheme to be used, ggplot simply uses its default color scheme for this plot. We can change this as follows.</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="big-data-visualization.html#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="co"># indicate natural numbers</span></span>
<span id="cb496-2"><a href="big-data-visualization.html#cb496-2" aria-hidden="true" tabindex="-1"></a>taxi[, dollar_paid <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(Tip_Amt <span class="sc">==</span> <span class="fu">round</span>(Tip_Amt,<span class="dv">0</span>), <span class="st">&quot;Full&quot;</span>, <span class="st">&quot;Fraction&quot;</span>),]</span>
<span id="cb496-3"><a href="big-data-visualization.html#cb496-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-4"><a href="big-data-visualization.html#cb496-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-5"><a href="big-data-visualization.html#cb496-5" aria-hidden="true" tabindex="-1"></a><span class="co"># extended x/y plot</span></span>
<span id="cb496-6"><a href="big-data-visualization.html#cb496-6" aria-hidden="true" tabindex="-1"></a>taxiplot <span class="sc">+</span></span>
<span id="cb496-7"><a href="big-data-visualization.html#cb496-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_scattermore</span>(<span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">pointsize =</span> <span class="dv">3</span>,</span>
<span id="cb496-8"><a href="big-data-visualization.html#cb496-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">color=</span>Payment_Type)) <span class="sc">+</span></span>
<span id="cb496-9"><a href="big-data-visualization.html#cb496-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">facet_wrap</span>(<span class="st">&quot;dollar_paid&quot;</span>) <span class="sc">+</span></span>
<span id="cb496-10"><a href="big-data-visualization.html#cb496-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_color_discrete</span>(<span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;steelblue&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;purple&quot;</span>))</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-227-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="wrapping-up-7" class="section level2 hasAnchor" number="12.4">
<h2><span class="header-section-number">12.4</span> Wrapping up<a href="big-data-visualization.html#wrapping-up-7" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><em><code>ggplot</code></em> offers a unified approach to generating a variety of plots common in the Big Data context: heatmaps, GIS-like maps, density plots, 2D-bin plots, etc.</li>
<li>Building on the concept of the <em>Grammar of Graphics</em> <span class="citation">(<a href="#ref-wilkinson2005grammar" role="doc-biblioref">Wilkinson et al. 2005</a>)</span>, <code>ggplot2</code> follows the paradigm of creating plots layer-by-layer, which offers great flexibility regarding the visualization of complex (big) data.</li>
<li>Standard plotting facilities in R (including in <code>ggplot</code>) are based on the concept of <code>vector images</code> (where each dot, line, and area is defined as in a coordinate system). While vector images have the advantage of flexible scaling (no reliance on a specific resolution), when plotting many observations, the computational load to generate and store/hold such graphics in memory can be substantial.</li>
<li>Plotting of large amounts of data can be made more efficient by relying on less complex shapes (e.g., for dots in a scatter-plot) or by directly <em>rasterizing</em> the plot into a <em>bitmap-image (a raster-based image)</em>. In contrast to vector images, raster images are created with a specific resolution that defines the size of a matrix of pixels that constitutes the image. If plotting a scatter-plot based on many observations, this data structure is much more memory-efficient than defining each dot in a vector image.</li>
<li>Specific types of plots, such as hex-bin plots and other 2D-bin plots, facilitate plotting large amounts of data independent of the type of image (vector or raster). Moreover, they can be useful to show/highlight specific patterns in large amounts of data that could not be seen in standard scatter plots.</li>
</ul>

</div>
</div>



<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-kratochvil_etal2020" class="csl-entry">
Kratochvíl, Miroslav, David Bednárek, Tomáš Sieger, Karel Fišer, and Jiří Vondrášek. 2020. <span>“<span class="nocase">ShinySOM: graphical SOM-based analysis of single-cell cytometry data</span>.”</span> <em>Bioinformatics</em> 36 (10): 3288–89. <a href="https://doi.org/10.1093/bioinformatics/btaa091">https://doi.org/10.1093/bioinformatics/btaa091</a>.
</div>
<div id="ref-wilkinson2005grammar" class="csl-entry">
Wilkinson, L., D. Wills, D. Rope, A. Norton, and R. Dubbs. 2005. <em>The Grammar of Graphics</em>. Statistics and Computing. Springer New York. <a href="https://books.google.ch/books?id=\_kRX4LoFfGQC">https://books.google.ch/books?id=\_kRX4LoFfGQC</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="51">
<li id="fn51"><p>Note how the points look less nice than what <code>geom_point()</code> would produce. This is the disadvantage of using the bitmap approach rather than the vector-based approach.<a href="big-data-visualization.html#fnref51" class="footnote-back">↩︎</a></p></li>
<li id="fn52"><p>Or, could there be another explanation for this pattern in the data?<a href="big-data-visualization.html#fnref52" class="footnote-back">↩︎</a></p></li>
<li id="fn53"><p>See <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">the ggplot2 documentation</a> for a list of all pre-defined themes shipped with the basic installation.<a href="big-data-visualization.html#fnref53" class="footnote-back">↩︎</a></p></li>
<li id="fn54"><p>Similar files are provided online by most city authorities in developed countries. See, for example, GIS Data for the City and Canton of Zurich: <a href="https://maps.zh.ch/" class="uri">https://maps.zh.ch/</a>.<a href="big-data-visualization.html#fnref54" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="descriptive-statistics-and-aggregation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="a.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 1
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
