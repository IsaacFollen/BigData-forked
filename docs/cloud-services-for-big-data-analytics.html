<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Cloud Services for Big Data Analytics | Big Data Analytics</title>
  <meta name="description" content="A guide to practical big data analytics in R." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Cloud Services for Big Data Analytics | Big Data Analytics" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="img/cover.png" />
  <meta property="og:description" content="A guide to practical big data analytics in R." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Cloud Services for Big Data Analytics | Big Data Analytics" />
  
  <meta name="twitter:description" content="A guide to practical big data analytics in R." />
  <meta name="twitter:image" content="img/cover.png" />

<meta name="author" content="Ulrich Matter" />


<meta name="date" content="2022-01-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="big-data-visualization.html"/>
<link rel="next" href="gpus-for-scientific-computing.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Big Data Analytics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#example-of-computation-time-and-memory-allocation"><i class="fa fa-check"></i><b>1.1</b> Example of Computation Time and Memory Allocation</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#preparation"><i class="fa fa-check"></i><b>1.1.1</b> Preparation</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#naïve-approach-ignorant-of-r"><i class="fa fa-check"></i><b>1.1.2</b> Naïve Approach (ignorant of R)</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#improvement-1-pre-allocation-of-memory"><i class="fa fa-check"></i><b>1.1.3</b> Improvement 1: Pre-allocation of memory</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#improvement-2-exploit-vectorization"><i class="fa fa-check"></i><b>1.1.4</b> Improvement 2: Exploit vectorization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="computing-resources.html"><a href="computing-resources.html"><i class="fa fa-check"></i><b>2</b> Computing Resources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="computing-resources.html"><a href="computing-resources.html#components-of-a-standard-computing-environment"><i class="fa fa-check"></i><b>2.1</b> Components of a standard computing environment</a></li>
<li class="chapter" data-level="2.2" data-path="computing-resources.html"><a href="computing-resources.html#units-of-informationdata-storage"><i class="fa fa-check"></i><b>2.2</b> Units of information/data storage</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="computing-resources.html"><a href="computing-resources.html#example-in-r-data-types-and-information-storage"><i class="fa fa-check"></i><b>2.2.1</b> Example in R: Data types and information storage</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="computing-resources.html"><a href="computing-resources.html#big-data-econometrics"><i class="fa fa-check"></i><b>2.3</b> Big Data econometrics</a></li>
<li class="chapter" data-level="2.4" data-path="computing-resources.html"><a href="computing-resources.html#example-fast-least-squares-regression"><i class="fa fa-check"></i><b>2.4</b> Example: Fast least squares regression</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="computing-resources.html"><a href="computing-resources.html#ols-as-a-point-of-reference"><i class="fa fa-check"></i><b>2.4.1</b> OLS as a point of reference</a></li>
<li class="chapter" data-level="2.4.2" data-path="computing-resources.html"><a href="computing-resources.html#the-uluru-algorithm-as-an-alternative-to-ols"><i class="fa fa-check"></i><b>2.4.2</b> The Uluru algorithm as an alternative to OLS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="resource-allocation.html"><a href="resource-allocation.html"><i class="fa fa-check"></i><b>3</b> Resource allocation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="resource-allocation.html"><a href="resource-allocation.html#case-study-parallel-processing"><i class="fa fa-check"></i><b>3.1</b> Case study: Parallel processing</a></li>
<li class="chapter" data-level="3.2" data-path="resource-allocation.html"><a href="resource-allocation.html#case-study-memory-allocation"><i class="fa fa-check"></i><b>3.2</b> Case study: Memory allocation</a></li>
<li class="chapter" data-level="3.3" data-path="resource-allocation.html"><a href="resource-allocation.html#beyond-memory"><i class="fa fa-check"></i><b>3.3</b> Beyond memory</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html"><i class="fa fa-check"></i><b>4</b> Advanced R Programming</a>
<ul>
<li class="chapter" data-level="4.1" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#r-tools-to-investigate-performanceresource-allocation"><i class="fa fa-check"></i><b>4.1</b> R-tools to investigate performance/resource allocation</a></li>
<li class="chapter" data-level="4.2" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#r-tools-to-investigate-structures-and-types"><i class="fa fa-check"></i><b>4.2</b> R-tools to investigate structures and types</a></li>
<li class="chapter" data-level="4.3" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#data-types-and-memorystorage"><i class="fa fa-check"></i><b>4.3</b> Data types and memory/storage</a></li>
<li class="chapter" data-level="4.4" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#data-structures"><i class="fa fa-check"></i><b>4.4</b> Data structures</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#vectors-vs-factors-in-r"><i class="fa fa-check"></i><b>4.4.1</b> Vectors vs Factors in R</a></li>
<li class="chapter" data-level="4.4.2" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#matricesarrays"><i class="fa fa-check"></i><b>4.4.2</b> Matrices/Arrays</a></li>
<li class="chapter" data-level="4.4.3" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#data-frames-tibbles-and-data-tables"><i class="fa fa-check"></i><b>4.4.3</b> Data frames, tibbles, and data tables</a></li>
<li class="chapter" data-level="4.4.4" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#lists"><i class="fa fa-check"></i><b>4.4.4</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#programming-with-big-data-in-r"><i class="fa fa-check"></i><b>4.5</b> Programming with (Big) Data in R</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#typical-programming-tasks"><i class="fa fa-check"></i><b>4.5.1</b> Typical Programming Tasks</a></li>
<li class="chapter" data-level="4.5.2" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#building-blocks-for-programming-with-big-data"><i class="fa fa-check"></i><b>4.5.2</b> Building blocks for programming with big data</a></li>
<li class="chapter" data-level="4.5.3" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#writing-efficient-code"><i class="fa fa-check"></i><b>4.5.3</b> Writing efficient code</a></li>
<li class="chapter" data-level="4.5.4" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#r-beyond-r"><i class="fa fa-check"></i><b>4.5.4</b> R, beyond R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html"><i class="fa fa-check"></i><b>5</b> Big Data Cleaning and Transformation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#out-of-memory-strategies"><i class="fa fa-check"></i><b>5.1</b> ‘Out-of-memory’ strategies</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#chunking-data-with-the-ff-package"><i class="fa fa-check"></i><b>5.1.1</b> Chunking data with the <code>ff</code>-package</a></li>
<li class="chapter" data-level="5.1.2" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#memory-mapping-with-bigmemory"><i class="fa fa-check"></i><b>5.1.2</b> Memory mapping with <code>bigmemory</code></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#typical-cleaning-tasks"><i class="fa fa-check"></i><b>5.2</b> Typical cleaning tasks</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#data-preparation-with-ff"><i class="fa fa-check"></i><b>5.2.1</b> Data Preparation with <code>ff</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-aggregation.html"><a href="data-aggregation.html"><i class="fa fa-check"></i><b>6</b> Data Aggregation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-aggregation.html"><a href="data-aggregation.html#data-aggregation-the-split-apply-combine-strategy"><i class="fa fa-check"></i><b>6.1</b> Data aggregation: The ‘split-apply-combine’ strategy</a></li>
<li class="chapter" data-level="6.2" data-path="data-aggregation.html"><a href="data-aggregation.html#data-aggregation-tutorial"><i class="fa fa-check"></i><b>6.2</b> Data aggregation tutorial</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="data-aggregation.html"><a href="data-aggregation.html#gathering-and-compilation-of-all-the-raw-data"><i class="fa fa-check"></i><b>6.2.1</b> Gathering and Compilation of all the raw data</a></li>
<li class="chapter" data-level="6.2.2" data-path="data-aggregation.html"><a href="data-aggregation.html#data-aggregation-with-chunked-data-files"><i class="fa fa-check"></i><b>6.2.2</b> Data aggregation with chunked data files</a></li>
<li class="chapter" data-level="6.2.3" data-path="data-aggregation.html"><a href="data-aggregation.html#high-speed-in-memory-data-aggregation-with-data.table"><i class="fa fa-check"></i><b>6.2.3</b> High-speed in-memory data aggregation with <code>data.table</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html"><i class="fa fa-check"></i><b>7</b> Data Storage and Databases</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#big-data-storage"><i class="fa fa-check"></i><b>7.1</b> (Big) Data Storage</a></li>
<li class="chapter" data-level="7.2" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#rdbms-basics"><i class="fa fa-check"></i><b>7.2</b> RDBMS basics</a></li>
<li class="chapter" data-level="7.3" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#getting-started-with-rsqlite"><i class="fa fa-check"></i><b>7.3</b> Getting started with (R)SQLite</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#first-steps-in-sqlite"><i class="fa fa-check"></i><b>7.3.1</b> First steps in SQLite</a></li>
<li class="chapter" data-level="7.3.2" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#indices-and-joins"><i class="fa fa-check"></i><b>7.3.2</b> Indices and joins</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#sqlite-from-within-r"><i class="fa fa-check"></i><b>7.4</b> SQLite from within R</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#creating-a-new-database-with-rsqlite"><i class="fa fa-check"></i><b>7.4.1</b> Creating a new database with <code>RSQLite</code></a></li>
<li class="chapter" data-level="7.4.2" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#importing-data"><i class="fa fa-check"></i><b>7.4.2</b> Importing data</a></li>
<li class="chapter" data-level="7.4.3" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#issue-queries"><i class="fa fa-check"></i><b>7.4.3</b> Issue queries</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="big-data-visualization.html"><a href="big-data-visualization.html"><i class="fa fa-check"></i><b>8</b> (Big) Data Visualization</a>
<ul>
<li class="chapter" data-level="8.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#data-set"><i class="fa fa-check"></i><b>8.1</b> Data Set</a></li>
<li class="chapter" data-level="8.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#excursus-modify-and-create-themes"><i class="fa fa-check"></i><b>8.2</b> Excursus: modify and create themes</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#create-your-own-theme-simple-approach"><i class="fa fa-check"></i><b>8.2.1</b> Create your own theme: simple approach</a></li>
<li class="chapter" data-level="8.2.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#implementing-actual-themes-as-functions."><i class="fa fa-check"></i><b>8.2.2</b> Implementing actual themes as functions.</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="big-data-visualization.html"><a href="big-data-visualization.html#visualize-time-and-space"><i class="fa fa-check"></i><b>8.3</b> Visualize Time and Space</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#preparations"><i class="fa fa-check"></i><b>8.3.1</b> Preparations</a></li>
<li class="chapter" data-level="8.3.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#pick-up-and-drop-off-locations"><i class="fa fa-check"></i><b>8.3.2</b> Pick-up and drop-off locations</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="big-data-visualization.html"><a href="big-data-visualization.html#excursus-change-color-schemes"><i class="fa fa-check"></i><b>8.4</b> Excursus: change color schemes</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html"><i class="fa fa-check"></i><b>9</b> Cloud Services for Big Data Analytics</a>
<ul>
<li class="chapter" data-level="9.1" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#scaling-up-in-the-cloud"><i class="fa fa-check"></i><b>9.1</b> Scaling up in the Cloud</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#parallelization-with-an-ec2-instance"><i class="fa fa-check"></i><b>9.1.1</b> Parallelization with an EC2 instance</a></li>
<li class="chapter" data-level="9.1.2" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#mass-storage-mariadb-on-an-ec2-instance"><i class="fa fa-check"></i><b>9.1.2</b> Mass Storage: MariaDB on an EC2 instance</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#distributed-systemsmapreduce"><i class="fa fa-check"></i><b>9.2</b> Distributed Systems/MapReduce</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#mapreduce-concept-illustration-in-r"><i class="fa fa-check"></i><b>9.2.1</b> Map/Reduce Concept: Illustration in R</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#hadoop-word-count"><i class="fa fa-check"></i><b>9.3</b> Hadoop Word Count</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#install-hadoop-on-ubuntupop_os-linux"><i class="fa fa-check"></i><b>9.3.1</b> Install Hadoop (on Ubuntu/Pop!_OS Linux)</a></li>
<li class="chapter" data-level="9.3.2" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#run-hadoop"><i class="fa fa-check"></i><b>9.3.2</b> Run Hadoop</a></li>
<li class="chapter" data-level="9.3.3" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#run-example"><i class="fa fa-check"></i><b>9.3.3</b> Run example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="gpus-for-scientific-computing.html"><a href="gpus-for-scientific-computing.html"><i class="fa fa-check"></i><b>10</b> GPUs for Scientific Computing</a>
<ul>
<li class="chapter" data-level="10.1" data-path="gpus-for-scientific-computing.html"><a href="gpus-for-scientific-computing.html#gpus-in-r"><i class="fa fa-check"></i><b>10.1</b> GPUs in R</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="gpus-for-scientific-computing.html"><a href="gpus-for-scientific-computing.html#example-i-matrix-multiplication-comparison-gpur"><i class="fa fa-check"></i><b>10.1.1</b> Example I: Matrix multiplication comparison (<code>gpuR</code>)</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="gpus-for-scientific-computing.html"><a href="gpus-for-scientific-computing.html#gpus-and-machine-learning"><i class="fa fa-check"></i><b>10.2</b> GPUs and Machine Learning</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="gpus-for-scientific-computing.html"><a href="gpus-for-scientific-computing.html#tensorflowkeras-example-predict-housing-prices"><i class="fa fa-check"></i><b>10.2.1</b> Tensorflow/Keras example: predict housing prices</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="gpus-for-scientific-computing.html"><a href="gpus-for-scientific-computing.html#a-word-of-caution"><i class="fa fa-check"></i><b>10.3</b> A word of caution</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="applied-econometrics-with-apache-spark.html"><a href="applied-econometrics-with-apache-spark.html"><i class="fa fa-check"></i><b>11</b> Applied Econometrics with Apache Spark</a>
<ul>
<li class="chapter" data-level="11.1" data-path="applied-econometrics-with-apache-spark.html"><a href="applied-econometrics-with-apache-spark.html#spark-basics"><i class="fa fa-check"></i><b>11.1</b> Spark basics</a></li>
<li class="chapter" data-level="11.2" data-path="applied-econometrics-with-apache-spark.html"><a href="applied-econometrics-with-apache-spark.html#spark-in-r"><i class="fa fa-check"></i><b>11.2</b> Spark in R</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="applied-econometrics-with-apache-spark.html"><a href="applied-econometrics-with-apache-spark.html#data-import-and-summary-statistics"><i class="fa fa-check"></i><b>11.2.1</b> Data import and summary statistics</a></li>
<li class="chapter" data-level="11.2.2" data-path="applied-econometrics-with-apache-spark.html"><a href="applied-econometrics-with-apache-spark.html#regression-analysis-with-sparklyr"><i class="fa fa-check"></i><b>11.2.2</b> Regression analysis with <code>sparklyr</code></a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-a.html"><a href="appendix-a.html"><i class="fa fa-check"></i><b>A</b> Appendix A</a>
<ul>
<li class="chapter" data-level="A.1" data-path="appendix-a.html"><a href="appendix-a.html#github"><i class="fa fa-check"></i><b>A.1</b> GitHub</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="appendix-a.html"><a href="appendix-a.html#initiate-a-new-repository"><i class="fa fa-check"></i><b>A.1.1</b> Initiate a new repository</a></li>
<li class="chapter" data-level="A.1.2" data-path="appendix-a.html"><a href="appendix-a.html#clone-this-courses-repository"><i class="fa fa-check"></i><b>A.1.2</b> Clone this course’s repository</a></li>
<li class="chapter" data-level="A.1.3" data-path="appendix-a.html"><a href="appendix-a.html#fork-this-courses-repository"><i class="fa fa-check"></i><b>A.1.3</b> Fork this course’s repository</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="appendix-b.html"><a href="appendix-b.html"><i class="fa fa-check"></i><b>B</b> Appendix B</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://umatter.github.io" target="blank">umatter.github.io</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Big Data Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cloud-services-for-big-data-analytics" class="section level1" number="9">
<h1><span class="header-section-number">Chapter 9</span> Cloud Services for Big Data Analytics</h1>
<p>So far we have focused on how to deal with large amounts of data and/or computationally demanding tasks on our local machines (desktop/laptop). A key aspect of this course has thus been in a first step to understand why our local machine is struggling with a data analysis task when there is a large amount of data to be processed. In a second step we have looked into practical solutions to these challenges. These solutions are in essence tools (in this course particularly tools provided in the R environment) to use the key components of our computing environment (CPU, RAM, mass storage) most efficiently:</p>
<ul>
<li>Computationally intense tasks (but not pushing RAM to the limit): parallelization, using several CPU cores (nodes) in parallel.</li>
<li>Memory-intense tasks (data still fits into RAM): efficient memory allocation (<code>data.table</code>-package).</li>
<li>Memory-intense tasks (data does not fit into RAM): efficient use of virtual memory (use parts of mass storage device as virtual memory).</li>
<li>Big Data storage: efficient storage (avoid redundancies) and efficient access (speed) with RDBMSs (here: SQLite).</li>
</ul>
<p>In practice, data sets might be too large for our local machine even if we take all of the techniques listed above into account. That is, a parallelized task might still take ages to complete because our local machine has too few cores available, a task involving virtual memory would use up way too much space on our hard-disk, running a large SQL database locally would use up too much resources, etc.</p>
<p>In such situations, we have to think about horizontal and vertical scaling beyond our local machine. That is, we outsource tasks to a bigger machine (or a cluster of machines) to which our local computer is connected over the Internet (or over a local network). While a decade or two ago most organizations had their own large centrally hosted machines (database servers, cluster computers) for such tasks, today they often rely on third-party solutions <em>‘in the cloud’</em>. That is, specialized companies provide flexible access to computing resources that can be easily accessed via a broadband Internet-connection and rented on an hourly (or even minutes and seconds) basis. Given the obvious economies of scale in this line of business, a few large players have emerged who practically dominate most of the global market:</p>
<ul>
<li><a href="https://aws.amazon.com/">Amazon Web Services (AWS)</a>.</li>
<li><a href="https://azure.microsoft.com/en-us/">Microsoft Azure</a></li>
<li><a href="https://cloud.google.com/">Google Cloud Platform</a></li>
<li><a href="https://www.ibm.com/cloud/">IBM Cloud</a></li>
<li><a href="https://www.alibabacloud.com/">Alibaba Cloud</a></li>
<li><a href="https://intl.cloud.tencent.com/">Tencent Cloud</a></li>
<li>…</li>
</ul>
<p>For details on what some of the largest platforms provide, see the overview in the online chapter to <span class="citation"><a href="references.html#ref-walkowiak_2016" role="doc-biblioref">Walkowiak</a> (<a href="references.html#ref-walkowiak_2016" role="doc-biblioref">2016</a>)</span> <a href="https://www.packtpub.com/sites/default/files/downloads/5396_6457OS_PushingRFurther.pdf">‘Pushing R Further’</a>.</p>
<p>When we use such cloud services to <em>scale up</em> (vertical scaling) the computing resources, the transition from our local implementation of a data analytics task to the cloud implementation is often rather simple. Once we have set up a cloud instance and figured out how to communicate with it, we typically can even run the exact same R-script locally or in the cloud. This is usually the case for parallelized tasks (simply run the same script on a machine with more cores), in-memory tasks (rent a machine with more RAM but still use <code>data.table()</code> etc.), and working with an SQL database (simply set up the database in the cloud instead of locally).</p>
<p>However, for really memory-intense tasks, the cloud provides options to <em>scale out</em> (horizontal scaling). Meaning, a task is distributed among a cluster of computing instances/servers. The implementation of such data analytics tasks is based on a paradigm that we rather do not encounter when working locally: <em>Map/Reduce</em> (implemented in the <em>Hadoop</em> framework).</p>
<p>In the following we look first at scaling up more familiar approaches with the help of the cloud and then look at the Map/Reduce concept and how it can be applied in <em>Hadoop</em> running on cloud instances.</p>
<div id="scaling-up-in-the-cloud" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Scaling up in the Cloud</h2>
<p>In the following examples we use different cloud services provided by AWS. See the online chapter to <span class="citation"><a href="references.html#ref-walkowiak_2016" role="doc-biblioref">Walkowiak</a> (<a href="references.html#ref-walkowiak_2016" role="doc-biblioref">2016</a>)</span> <a href="https://www.packtpub.com/sites/default/files/downloads/5396_6457OS_PushingRFurther.pdf">‘Pushing R Further’</a> for how to set up an AWS account and the basics for how to set up AWS instances. The examples below are based on the assumption that the EC2 instance and RStudio Server have been set up essentially as explained in <a href="https://www.packtpub.com/sites/default/files/downloads/5396_6457OS_PushingRFurther.pdf">‘Pushing R Further’</a>, pages 22-38. However, AWS changed a few things regarding the way their linux machines are set up since the online chapter was published first. In order to install core R on your ec2 instance, use the following command in the terminal (instead of <code>sudo yum install R</code>):</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb341-1"><a href="cloud-services-for-big-data-analytics.html#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> amazon-linux-extras install R3.4</span></code></pre></div>
<p>and confirm the installation of additional dependencies with <code>y</code>. In a second step, we install the latest CentOS 6-7 version of RStudio Server with the following commands.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb342-1"><a href="cloud-services-for-big-data-analytics.html#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="co"># April 2020</span></span>
<span id="cb342-2"><a href="cloud-services-for-big-data-analytics.html#cb342-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://download2.rstudio.org/server/centos6/x86_64/rstudio-server-rhel-1.2.5033-x86_64.rpm</span>
<span id="cb342-3"><a href="cloud-services-for-big-data-analytics.html#cb342-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> yum install rstudio-server-rhel-1.2.5033-x86_64.rpm</span></code></pre></div>
<div id="parallelization-with-an-ec2-instance" class="section level3" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Parallelization with an EC2 instance</h3>
<p>This short tutorial illustrates how to scale the computation of clustered standard errors shown in Lecture 3 up by running it on an AWS EC2 instance. Below we use the same source code as in the original example (see <a href="https://github.com/umatter/BigData/blob/master/materials/notes/03_computation_memory.Rmd"><code>03_computation_memory.Rmd</code></a>). Note that there are a few things that we need to keep in mind in order to make the script run on an AWS EC2 instance in RStudio Server.</p>
<p>First, our EC2 instance is a Linux machine. Most of you are probably rather used to running R on a Mac or Windows PC. When running R on a Linux machine, there is an additional step to install R packages (at least for most of the packages): R packages need to be compiled before they can be installed. The command to install packages is exactly the same (<code>install.packages()</code>) and normally you only notice a slight difference in the output shown in the R console during installation (and the installation process takes a little longer than what you are used to). Apart from that, using R via RStudio Server in the cloud looks/feels very similar if not identical as when using R/RStudio locally.</p>
<p>Now, let’s go through the bootstrap example. First, let’s run the non-parallel implementation of the script. When executing the code below line-by-line, you will notice that essentially all parts of the script work exactly as on your local machine. This is one of the great advantages of running R/RStudio Server in the cloud. You can implement your entire data analysis locally (based on a small sample), test it locally, and then move it to the cloud and run it on a larger scale in exactly the same way (even with the same GUI).</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="cloud-services-for-big-data-analytics.html#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CASE STUDY: PARALLEL ---------------------------</span></span>
<span id="cb343-2"><a href="cloud-services-for-big-data-analytics.html#cb343-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-3"><a href="cloud-services-for-big-data-analytics.html#cb343-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install packages</span></span>
<span id="cb343-4"><a href="cloud-services-for-big-data-analytics.html#cb343-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;data.table&quot;</span>)</span>
<span id="cb343-5"><a href="cloud-services-for-big-data-analytics.html#cb343-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;doSNOW&quot;</span>)</span>
<span id="cb343-6"><a href="cloud-services-for-big-data-analytics.html#cb343-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-7"><a href="cloud-services-for-big-data-analytics.html#cb343-7" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb343-8"><a href="cloud-services-for-big-data-analytics.html#cb343-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb343-9"><a href="cloud-services-for-big-data-analytics.html#cb343-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-10"><a href="cloud-services-for-big-data-analytics.html#cb343-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-11"><a href="cloud-services-for-big-data-analytics.html#cb343-11" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------------------------------</span></span>
<span id="cb343-12"><a href="cloud-services-for-big-data-analytics.html#cb343-12" aria-hidden="true" tabindex="-1"></a>stopdata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://vincentarelbundock.github.io/Rdatasets/csv/carData/MplsStops.csv&quot;</span>)</span>
<span id="cb343-13"><a href="cloud-services-for-big-data-analytics.html#cb343-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-14"><a href="cloud-services-for-big-data-analytics.html#cb343-14" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------------------------------</span></span>
<span id="cb343-15"><a href="cloud-services-for-big-data-analytics.html#cb343-15" aria-hidden="true" tabindex="-1"></a><span class="co"># remove incomplete obs</span></span>
<span id="cb343-16"><a href="cloud-services-for-big-data-analytics.html#cb343-16" aria-hidden="true" tabindex="-1"></a>stopdata <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(stopdata)</span>
<span id="cb343-17"><a href="cloud-services-for-big-data-analytics.html#cb343-17" aria-hidden="true" tabindex="-1"></a><span class="co"># code dependent var</span></span>
<span id="cb343-18"><a href="cloud-services-for-big-data-analytics.html#cb343-18" aria-hidden="true" tabindex="-1"></a>stopdata<span class="sc">$</span>vsearch <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb343-19"><a href="cloud-services-for-big-data-analytics.html#cb343-19" aria-hidden="true" tabindex="-1"></a>stopdata<span class="sc">$</span>vsearch[stopdata<span class="sc">$</span>vehicleSearch<span class="sc">==</span><span class="st">&quot;YES&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb343-20"><a href="cloud-services-for-big-data-analytics.html#cb343-20" aria-hidden="true" tabindex="-1"></a><span class="co"># code explanatory var</span></span>
<span id="cb343-21"><a href="cloud-services-for-big-data-analytics.html#cb343-21" aria-hidden="true" tabindex="-1"></a>stopdata<span class="sc">$</span>white <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb343-22"><a href="cloud-services-for-big-data-analytics.html#cb343-22" aria-hidden="true" tabindex="-1"></a>stopdata<span class="sc">$</span>white[stopdata<span class="sc">$</span>race<span class="sc">==</span><span class="st">&quot;White&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb343-23"><a href="cloud-services-for-big-data-analytics.html#cb343-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-24"><a href="cloud-services-for-big-data-analytics.html#cb343-24" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------------------------------</span></span>
<span id="cb343-25"><a href="cloud-services-for-big-data-analytics.html#cb343-25" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> vsearch <span class="sc">~</span> white <span class="sc">+</span> <span class="fu">factor</span>(policePrecinct)</span>
<span id="cb343-26"><a href="cloud-services-for-big-data-analytics.html#cb343-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-27"><a href="cloud-services-for-big-data-analytics.html#cb343-27" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------------------------------</span></span>
<span id="cb343-28"><a href="cloud-services-for-big-data-analytics.html#cb343-28" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(model, stopdata)</span>
<span id="cb343-29"><a href="cloud-services-for-big-data-analytics.html#cb343-29" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb343-30"><a href="cloud-services-for-big-data-analytics.html#cb343-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-31"><a href="cloud-services-for-big-data-analytics.html#cb343-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-32"><a href="cloud-services-for-big-data-analytics.html#cb343-32" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrapping: normal approach</span></span>
<span id="cb343-33"><a href="cloud-services-for-big-data-analytics.html#cb343-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-34"><a href="cloud-services-for-big-data-analytics.html#cb343-34" aria-hidden="true" tabindex="-1"></a><span class="do">## ----message=FALSE-------------------------------------------------------</span></span>
<span id="cb343-35"><a href="cloud-services-for-big-data-analytics.html#cb343-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-36"><a href="cloud-services-for-big-data-analytics.html#cb343-36" aria-hidden="true" tabindex="-1"></a><span class="co"># set the &#39;seed&#39; for random numbers (makes the example reproducible)</span></span>
<span id="cb343-37"><a href="cloud-services-for-big-data-analytics.html#cb343-37" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb343-38"><a href="cloud-services-for-big-data-analytics.html#cb343-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-39"><a href="cloud-services-for-big-data-analytics.html#cb343-39" aria-hidden="true" tabindex="-1"></a><span class="co"># set number of bootstrap iterations</span></span>
<span id="cb343-40"><a href="cloud-services-for-big-data-analytics.html#cb343-40" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb343-41"><a href="cloud-services-for-big-data-analytics.html#cb343-41" aria-hidden="true" tabindex="-1"></a><span class="co"># get selection of precincts</span></span>
<span id="cb343-42"><a href="cloud-services-for-big-data-analytics.html#cb343-42" aria-hidden="true" tabindex="-1"></a>precincts <span class="ot">&lt;-</span> <span class="fu">unique</span>(stopdata<span class="sc">$</span>policePrecinct)</span>
<span id="cb343-43"><a href="cloud-services-for-big-data-analytics.html#cb343-43" aria-hidden="true" tabindex="-1"></a><span class="co"># container for coefficients</span></span>
<span id="cb343-44"><a href="cloud-services-for-big-data-analytics.html#cb343-44" aria-hidden="true" tabindex="-1"></a>boot_coefs <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> B, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb343-45"><a href="cloud-services-for-big-data-analytics.html#cb343-45" aria-hidden="true" tabindex="-1"></a><span class="co"># draw bootstrap samples, estimate model for each sample</span></span>
<span id="cb343-46"><a href="cloud-services-for-big-data-analytics.html#cb343-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B) {</span>
<span id="cb343-47"><a href="cloud-services-for-big-data-analytics.html#cb343-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb343-48"><a href="cloud-services-for-big-data-analytics.html#cb343-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw sample of precincts (cluster level)</span></span>
<span id="cb343-49"><a href="cloud-services-for-big-data-analytics.html#cb343-49" aria-hidden="true" tabindex="-1"></a>  precincts_i <span class="ot">&lt;-</span> <span class="fu">sample</span>(precincts, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb343-50"><a href="cloud-services-for-big-data-analytics.html#cb343-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get observations</span></span>
<span id="cb343-51"><a href="cloud-services-for-big-data-analytics.html#cb343-51" aria-hidden="true" tabindex="-1"></a>  bs_i <span class="ot">&lt;-</span> <span class="fu">lapply</span>(precincts_i, <span class="cf">function</span>(x) stopdata[stopdata<span class="sc">$</span>policePrecinct<span class="sc">==</span>x,])</span>
<span id="cb343-52"><a href="cloud-services-for-big-data-analytics.html#cb343-52" aria-hidden="true" tabindex="-1"></a>  bs_i <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(bs_i)</span>
<span id="cb343-53"><a href="cloud-services-for-big-data-analytics.html#cb343-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb343-54"><a href="cloud-services-for-big-data-analytics.html#cb343-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># estimate model and record coefficients</span></span>
<span id="cb343-55"><a href="cloud-services-for-big-data-analytics.html#cb343-55" aria-hidden="true" tabindex="-1"></a>  boot_coefs[i,] <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">lm</span>(model, bs_i))[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="co"># ignore FE-coefficients</span></span>
<span id="cb343-56"><a href="cloud-services-for-big-data-analytics.html#cb343-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb343-57"><a href="cloud-services-for-big-data-analytics.html#cb343-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-58"><a href="cloud-services-for-big-data-analytics.html#cb343-58" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------------------------------</span></span>
<span id="cb343-59"><a href="cloud-services-for-big-data-analytics.html#cb343-59" aria-hidden="true" tabindex="-1"></a>se_boot <span class="ot">&lt;-</span> <span class="fu">apply</span>(boot_coefs, </span>
<span id="cb343-60"><a href="cloud-services-for-big-data-analytics.html#cb343-60" aria-hidden="true" tabindex="-1"></a>                 <span class="at">MARGIN =</span> <span class="dv">2</span>,</span>
<span id="cb343-61"><a href="cloud-services-for-big-data-analytics.html#cb343-61" aria-hidden="true" tabindex="-1"></a>                 <span class="at">FUN =</span> sd)</span>
<span id="cb343-62"><a href="cloud-services-for-big-data-analytics.html#cb343-62" aria-hidden="true" tabindex="-1"></a>se_boot</span></code></pre></div>
<p>So far, we have only demonstrated that the simple implementation (non-parallel) works both locally and in the cloud. The real purpose of using an EC2 instance in this example is to make use of the fact that we can scale up our instance to have more CPU cores available for the parallel implementation of our bootstrap procedure. Recall that running the script below on our local machine will employ all cores available to an compute the bootstrap resampling in parallel on all these cores. Exactly the same thing happens when running the code below on our simple <code>t2.micro</code> instance. However this type of EC2 instance only has one core. You can check this when running the following line of code in RStudio Server (assuming the <code>doSNOW</code> package is installed and loaded):</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="cloud-services-for-big-data-analytics.html#cb344-1" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span></code></pre></div>
<p>When running the entire parallel implementation below, you will thus notice that it won’t compute the bootstrap SE any faster than with the non-parallel version above. However, by simply initiating another EC2 type with more cores, we can distribute the workload across many CPU cores, using exactly the same R-script.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="cloud-services-for-big-data-analytics.html#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrapping: parallel approaach</span></span>
<span id="cb345-2"><a href="cloud-services-for-big-data-analytics.html#cb345-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-3"><a href="cloud-services-for-big-data-analytics.html#cb345-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ----message=FALSE-------------------------------------------------------</span></span>
<span id="cb345-4"><a href="cloud-services-for-big-data-analytics.html#cb345-4" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;doSNOW&quot;, &quot;parallel&quot;)</span></span>
<span id="cb345-5"><a href="cloud-services-for-big-data-analytics.html#cb345-5" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages for parallel processing</span></span>
<span id="cb345-6"><a href="cloud-services-for-big-data-analytics.html#cb345-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doSNOW)</span>
<span id="cb345-7"><a href="cloud-services-for-big-data-analytics.html#cb345-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-8"><a href="cloud-services-for-big-data-analytics.html#cb345-8" aria-hidden="true" tabindex="-1"></a><span class="co"># get the number of cores available</span></span>
<span id="cb345-9"><a href="cloud-services-for-big-data-analytics.html#cb345-9" aria-hidden="true" tabindex="-1"></a>ncores <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span>
<span id="cb345-10"><a href="cloud-services-for-big-data-analytics.html#cb345-10" aria-hidden="true" tabindex="-1"></a><span class="co"># set cores for parallel processing</span></span>
<span id="cb345-11"><a href="cloud-services-for-big-data-analytics.html#cb345-11" aria-hidden="true" tabindex="-1"></a>ctemp <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(ncores) <span class="co"># </span></span>
<span id="cb345-12"><a href="cloud-services-for-big-data-analytics.html#cb345-12" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoSNOW</span>(ctemp)</span>
<span id="cb345-13"><a href="cloud-services-for-big-data-analytics.html#cb345-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-14"><a href="cloud-services-for-big-data-analytics.html#cb345-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-15"><a href="cloud-services-for-big-data-analytics.html#cb345-15" aria-hidden="true" tabindex="-1"></a><span class="co"># set number of bootstrap iterations</span></span>
<span id="cb345-16"><a href="cloud-services-for-big-data-analytics.html#cb345-16" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb345-17"><a href="cloud-services-for-big-data-analytics.html#cb345-17" aria-hidden="true" tabindex="-1"></a><span class="co"># get selection of precincts</span></span>
<span id="cb345-18"><a href="cloud-services-for-big-data-analytics.html#cb345-18" aria-hidden="true" tabindex="-1"></a>precincts <span class="ot">&lt;-</span> <span class="fu">unique</span>(stopdata<span class="sc">$</span>policePrecinct)</span>
<span id="cb345-19"><a href="cloud-services-for-big-data-analytics.html#cb345-19" aria-hidden="true" tabindex="-1"></a><span class="co"># container for coefficients</span></span>
<span id="cb345-20"><a href="cloud-services-for-big-data-analytics.html#cb345-20" aria-hidden="true" tabindex="-1"></a>boot_coefs <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> B, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb345-21"><a href="cloud-services-for-big-data-analytics.html#cb345-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-22"><a href="cloud-services-for-big-data-analytics.html#cb345-22" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrapping in parallel</span></span>
<span id="cb345-23"><a href="cloud-services-for-big-data-analytics.html#cb345-23" aria-hidden="true" tabindex="-1"></a>boot_coefs <span class="ot">&lt;-</span> </span>
<span id="cb345-24"><a href="cloud-services-for-big-data-analytics.html#cb345-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>B, <span class="at">.combine =</span> rbind, <span class="at">.packages=</span><span class="st">&quot;data.table&quot;</span>) <span class="sc">%dopar%</span> {</span>
<span id="cb345-25"><a href="cloud-services-for-big-data-analytics.html#cb345-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb345-26"><a href="cloud-services-for-big-data-analytics.html#cb345-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># draw sample of precincts (cluster level)</span></span>
<span id="cb345-27"><a href="cloud-services-for-big-data-analytics.html#cb345-27" aria-hidden="true" tabindex="-1"></a>    precincts_i <span class="ot">&lt;-</span> <span class="fu">sample</span>(precincts, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb345-28"><a href="cloud-services-for-big-data-analytics.html#cb345-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get observations</span></span>
<span id="cb345-29"><a href="cloud-services-for-big-data-analytics.html#cb345-29" aria-hidden="true" tabindex="-1"></a>    bs_i <span class="ot">&lt;-</span> <span class="fu">lapply</span>(precincts_i, <span class="cf">function</span>(x) stopdata[stopdata<span class="sc">$</span>policePrecinct<span class="sc">==</span>x,])</span>
<span id="cb345-30"><a href="cloud-services-for-big-data-analytics.html#cb345-30" aria-hidden="true" tabindex="-1"></a>    bs_i <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(bs_i)</span>
<span id="cb345-31"><a href="cloud-services-for-big-data-analytics.html#cb345-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb345-32"><a href="cloud-services-for-big-data-analytics.html#cb345-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># estimate model and record coefficients</span></span>
<span id="cb345-33"><a href="cloud-services-for-big-data-analytics.html#cb345-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coef</span>(<span class="fu">lm</span>(model, bs_i))[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="co"># ignore FE-coefficients</span></span>
<span id="cb345-34"><a href="cloud-services-for-big-data-analytics.html#cb345-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb345-35"><a href="cloud-services-for-big-data-analytics.html#cb345-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb345-36"><a href="cloud-services-for-big-data-analytics.html#cb345-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-37"><a href="cloud-services-for-big-data-analytics.html#cb345-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-38"><a href="cloud-services-for-big-data-analytics.html#cb345-38" aria-hidden="true" tabindex="-1"></a><span class="co"># be a good citizen and stop the snow clusters</span></span>
<span id="cb345-39"><a href="cloud-services-for-big-data-analytics.html#cb345-39" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(<span class="at">cl =</span> ctemp)</span>
<span id="cb345-40"><a href="cloud-services-for-big-data-analytics.html#cb345-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-41"><a href="cloud-services-for-big-data-analytics.html#cb345-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-42"><a href="cloud-services-for-big-data-analytics.html#cb345-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-43"><a href="cloud-services-for-big-data-analytics.html#cb345-43" aria-hidden="true" tabindex="-1"></a><span class="do">## ------------------------------------------------------------------------</span></span>
<span id="cb345-44"><a href="cloud-services-for-big-data-analytics.html#cb345-44" aria-hidden="true" tabindex="-1"></a>se_boot <span class="ot">&lt;-</span> <span class="fu">apply</span>(boot_coefs, </span>
<span id="cb345-45"><a href="cloud-services-for-big-data-analytics.html#cb345-45" aria-hidden="true" tabindex="-1"></a>                 <span class="at">MARGIN =</span> <span class="dv">2</span>,</span>
<span id="cb345-46"><a href="cloud-services-for-big-data-analytics.html#cb345-46" aria-hidden="true" tabindex="-1"></a>                 <span class="at">FUN =</span> sd)</span>
<span id="cb345-47"><a href="cloud-services-for-big-data-analytics.html#cb345-47" aria-hidden="true" tabindex="-1"></a>se_boot</span></code></pre></div>
</div>
<div id="mass-storage-mariadb-on-an-ec2-instance" class="section level3" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> Mass Storage: MariaDB on an EC2 instance</h3>
<p>Once we have set up RStudio Server on an EC2 instance, we can run the SQLite examples demonstrated locally in Lecture 7 on it. There are no additional steps needed to install SQLite. However, when using RDBMSs in the cloud, we typically have a more sophisticated implementation than SQLite in mind. Particularly, we want to set up an actual RDBMS-server running in the cloud to which several clients can connect (via RStudio Server). The following example, based on <span class="citation"><a href="references.html#ref-walkowiak_2016" role="doc-biblioref">Walkowiak</a> (<a href="references.html#ref-walkowiak_2016" role="doc-biblioref">2016</a>)</span>, guides you through the first step to set up such a database in the cloud. To keep things simple, the example sets up a database of the same data set as shown in the first SQLite example in Lecture 7, but this time with MariaDB on an EC2 instance in the cloud. For most of the installation steps you are referred to the respective pages in <span class="citation"><a href="references.html#ref-walkowiak_2016" role="doc-biblioref">Walkowiak</a> (<a href="references.html#ref-walkowiak_2016" role="doc-biblioref">2016</a>)</span> (Chapter 5: ’MariaDB with R on a Amazon EC2 instance, pages 255ff). However, since some of the steps shown in the book are outdated, the example below hints to some alternative/additional steps needed to make the database run on an Ubuntu 18.04 machine.</p>
<p>After launching the EC2 instance on AWS, use the following terminal commands to install R:</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb346-1"><a href="cloud-services-for-big-data-analytics.html#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="co"># update ubuntu packages</span></span>
<span id="cb346-2"><a href="cloud-services-for-big-data-analytics.html#cb346-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">sudo</span> apt-get update</span>
<span id="cb346-3"><a href="cloud-services-for-big-data-analytics.html#cb346-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">sudo</span> apt-get upgrade</span></code></pre></div>
<div class="sourceCode" id="cb347"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb347-1"><a href="cloud-services-for-big-data-analytics.html#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get install r-base</span></code></pre></div>
<p>and to install RStudio Server (on Ubuntu 18.04, as of April 2020):</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb348-1"><a href="cloud-services-for-big-data-analytics.html#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get install gdebi-core</span>
<span id="cb348-2"><a href="cloud-services-for-big-data-analytics.html#cb348-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://download2.rstudio.org/server/bionic/amd64/rstudio-server-1.2.5033-amd64.deb</span>
<span id="cb348-3"><a href="cloud-services-for-big-data-analytics.html#cb348-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> gdebi rstudio-server-1.2.5033-amd64.deb</span></code></pre></div>
<p>Following <span class="citation"><a href="references.html#ref-walkowiak_2016" role="doc-biblioref">Walkowiak</a> (<a href="references.html#ref-walkowiak_2016" role="doc-biblioref">2016</a>)</span> (pages 257f), we first set up a new user and give it permissions to <code>ssh</code> directly to the EC2 instance (this way we can then more easily upload data ‘for this user’).</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb349-1"><a href="cloud-services-for-big-data-analytics.html#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create user</span></span>
<span id="cb349-2"><a href="cloud-services-for-big-data-analytics.html#cb349-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> adduser umatter </span></code></pre></div>
<p>When prompted for additional information just hit enter (for default). Now we can grant the user the permissions</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb350-1"><a href="cloud-services-for-big-data-analytics.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> cp <span class="at">-r</span> /home/ubuntu/.ssh /home/umatter/</span>
<span id="cb350-2"><a href="cloud-services-for-big-data-analytics.html#cb350-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /home/umatter/</span>
<span id="cb350-3"><a href="cloud-services-for-big-data-analytics.html#cb350-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown <span class="at">-R</span> umatter:umatter .ssh</span></code></pre></div>
<p>Then install MariaDB as follows.</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb351-1"><a href="cloud-services-for-big-data-analytics.html#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt update</span>
<span id="cb351-2"><a href="cloud-services-for-big-data-analytics.html#cb351-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install mariadb-server</span>
<span id="cb351-3"><a href="cloud-services-for-big-data-analytics.html#cb351-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install libmariadbclient-dev</span>
<span id="cb351-4"><a href="cloud-services-for-big-data-analytics.html#cb351-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install libxml2-dev <span class="co"># needed later (dependency for some R packages)</span></span></code></pre></div>
<p>If prompted to set a password for the root database user (user with all database priviledges), type in and confirm the chosen password.<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a></p>
<div id="data-import-3" class="section level4" number="9.1.2.1">
<h4><span class="header-section-number">9.1.2.1</span> Data import</h4>
<p>With the permissions set above, we can send data from the local machine directly to the instance via <code>ssh</code>. We use this to first transfer the raw data to the instance and then import it to the database.</p>
<p>The aim is to import the same simple data set <code>economics.csv</code> used in the local SQLite examples of Lecture 7. Following the instructions of <span class="citation"><a href="references.html#ref-walkowiak_2016" role="doc-biblioref">Walkowiak</a> (<a href="references.html#ref-walkowiak_2016" role="doc-biblioref">2016</a>)</span>, pages 252 to 254, we upload the <code>economics.csv</code> file (instead of the example data used in <span class="citation"><a href="references.html#ref-walkowiak_2016" role="doc-biblioref">Walkowiak</a> (<a href="references.html#ref-walkowiak_2016" role="doc-biblioref">2016</a>)</span>). Note that in all the code examples below, the username is <code>umatter</code>, and the IP-address will have to be replaced with the public IP-address of your EC2 instance.</p>
<p>Open a new terminal window and send the <code>economics.csv</code> data as follows to the instance.</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb352-1"><a href="cloud-services-for-big-data-analytics.html#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="co"># from the directory where the key-file is stored...</span></span>
<span id="cb352-2"><a href="cloud-services-for-big-data-analytics.html#cb352-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> <span class="at">-r</span> <span class="at">-i</span> <span class="st">&quot;mariadb_ec2.pem&quot;</span> ~/Desktop/economics.csv umatter@ec2-184-72-202-166.compute-1.amazonaws.com:~/</span></code></pre></div>
<p>Then switch back to the terminal connected to the instance and start the MariaDB server.</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb353-1"><a href="cloud-services-for-big-data-analytics.html#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start the MariaDB server</span></span>
<span id="cb353-2"><a href="cloud-services-for-big-data-analytics.html#cb353-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> service mysql start</span>
<span id="cb353-3"><a href="cloud-services-for-big-data-analytics.html#cb353-3" aria-hidden="true" tabindex="-1"></a><span class="co"># log into the MariaDB client as root </span></span>
<span id="cb353-4"><a href="cloud-services-for-big-data-analytics.html#cb353-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mysql <span class="at">-uroot</span> </span></code></pre></div>
<p>If not prompted to do so when installing MariaDB (see above), add a new root user in order to login to MariaDB without the <code>sudo</code> (here we simply set the password to ‘Password1’).</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb354-1"><a href="cloud-services-for-big-data-analytics.html#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">ALL</span> <span class="kw">PRIVILEGES</span> <span class="kw">on</span> <span class="op">*</span>.<span class="op">*</span> <span class="kw">to</span> <span class="st">&#39;root&#39;</span>@<span class="st">&#39;localhost&#39;</span> <span class="kw">IDENTIFIED</span> <span class="kw">BY</span> <span class="st">&#39;Password1&#39;</span>;</span>
<span id="cb354-2"><a href="cloud-services-for-big-data-analytics.html#cb354-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FLUSH</span> <span class="kw">PRIVILEGES</span>;</span></code></pre></div>
<p>Restart the mysql server and log in with the database root user.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb355-1"><a href="cloud-services-for-big-data-analytics.html#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start the MariaDB server</span></span>
<span id="cb355-2"><a href="cloud-services-for-big-data-analytics.html#cb355-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> service mysql restart</span>
<span id="cb355-3"><a href="cloud-services-for-big-data-analytics.html#cb355-3" aria-hidden="true" tabindex="-1"></a><span class="co"># log into the MariaDB client as root </span></span>
<span id="cb355-4"><a href="cloud-services-for-big-data-analytics.html#cb355-4" aria-hidden="true" tabindex="-1"></a><span class="ex">mysql</span> <span class="at">-uroot</span> <span class="at">-p</span></span></code></pre></div>
<p>Now we can initiate a new database called <code>data1</code>.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb356-1"><a href="cloud-services-for-big-data-analytics.html#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">database</span> data1;</span></code></pre></div>
<p>To work with the newly created database, we have to ‘select’ it.</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb357-1"><a href="cloud-services-for-big-data-analytics.html#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="kw">USE</span> data1;</span></code></pre></div>
<p>Then, we create the first table of our database and import data into it. Note that we only have to slightly adjust the former SQLite syntax to make this work (remove double quotes for field names). In addition, note that we can use the same field types as in the SQLite DB.<a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a></p>
<div class="sourceCode" id="cb358"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb358-1"><a href="cloud-services-for-big-data-analytics.html#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create the new table</span></span>
<span id="cb358-2"><a href="cloud-services-for-big-data-analytics.html#cb358-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> econ(</span>
<span id="cb358-3"><a href="cloud-services-for-big-data-analytics.html#cb358-3" aria-hidden="true" tabindex="-1"></a><span class="dt">date</span> <span class="dt">DATE</span>,</span>
<span id="cb358-4"><a href="cloud-services-for-big-data-analytics.html#cb358-4" aria-hidden="true" tabindex="-1"></a>pce <span class="dt">REAL</span>,</span>
<span id="cb358-5"><a href="cloud-services-for-big-data-analytics.html#cb358-5" aria-hidden="true" tabindex="-1"></a>pop <span class="dt">INTEGER</span>,</span>
<span id="cb358-6"><a href="cloud-services-for-big-data-analytics.html#cb358-6" aria-hidden="true" tabindex="-1"></a>psavert <span class="dt">REAL</span>,</span>
<span id="cb358-7"><a href="cloud-services-for-big-data-analytics.html#cb358-7" aria-hidden="true" tabindex="-1"></a>uempmed <span class="dt">REAL</span>,</span>
<span id="cb358-8"><a href="cloud-services-for-big-data-analytics.html#cb358-8" aria-hidden="true" tabindex="-1"></a>unemploy <span class="dt">INTEGER</span></span>
<span id="cb358-9"><a href="cloud-services-for-big-data-analytics.html#cb358-9" aria-hidden="true" tabindex="-1"></a>);</span></code></pre></div>
<p>After following the steps in <span class="citation"><a href="references.html#ref-walkowiak_2016" role="doc-biblioref">Walkowiak</a> (<a href="references.html#ref-walkowiak_2016" role="doc-biblioref">2016</a>)</span>, pages 259-262, we can import the <code>economics.csv</code>-file to the <code>econ</code> table in MariaDB (again, assuming the username is <code>umatter</code>). Note that the syntax to import data to a table is quite different from the SQLite example in Lecture 7.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb359-1"><a href="cloud-services-for-big-data-analytics.html#cb359-1" aria-hidden="true" tabindex="-1"></a>LOAD <span class="kw">DATA</span> <span class="kw">LOCAL</span> INFILE</span>
<span id="cb359-2"><a href="cloud-services-for-big-data-analytics.html#cb359-2" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;/home/umatter/economics.csv&#39;</span> </span>
<span id="cb359-3"><a href="cloud-services-for-big-data-analytics.html#cb359-3" aria-hidden="true" tabindex="-1"></a><span class="kw">INTO</span> <span class="kw">TABLE</span> econ</span>
<span id="cb359-4"><a href="cloud-services-for-big-data-analytics.html#cb359-4" aria-hidden="true" tabindex="-1"></a>FIELDS TERMINATED <span class="kw">BY</span> <span class="st">&#39;,&#39;</span></span>
<span id="cb359-5"><a href="cloud-services-for-big-data-analytics.html#cb359-5" aria-hidden="true" tabindex="-1"></a>LINES TERMINATED <span class="kw">BY</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></span>
<span id="cb359-6"><a href="cloud-services-for-big-data-analytics.html#cb359-6" aria-hidden="true" tabindex="-1"></a>IGNORE <span class="dv">1</span> <span class="kw">ROWS</span>;</span></code></pre></div>
<p>Now we can start using the newly created database from within RStudio Server running on our EC2 instance (following <span class="citation"><a href="references.html#ref-walkowiak_2016" role="doc-biblioref">Walkowiak</a> (<a href="references.html#ref-walkowiak_2016" role="doc-biblioref">2016</a>)</span>, pages 263ff).</p>
<p>As in the SQLite examples in Lecture 7, we can now query the database from within the R console (this time using <code>RMySQL</code> instead of <code>RSQLite</code>, and using R from within RStudio Server in the cloud!).</p>
<p>First, we need to connect to the newly created MariaDB database.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="cloud-services-for-big-data-analytics.html#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install package</span></span>
<span id="cb360-2"><a href="cloud-services-for-big-data-analytics.html#cb360-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(&quot;RMySQL&quot;)</span></span>
<span id="cb360-3"><a href="cloud-services-for-big-data-analytics.html#cb360-3" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb360-4"><a href="cloud-services-for-big-data-analytics.html#cb360-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RMySQL)</span>
<span id="cb360-5"><a href="cloud-services-for-big-data-analytics.html#cb360-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb360-6"><a href="cloud-services-for-big-data-analytics.html#cb360-6" aria-hidden="true" tabindex="-1"></a><span class="co"># connect to the db</span></span>
<span id="cb360-7"><a href="cloud-services-for-big-data-analytics.html#cb360-7" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RMySQL<span class="sc">::</span><span class="fu">MySQL</span>(), </span>
<span id="cb360-8"><a href="cloud-services-for-big-data-analytics.html#cb360-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">user =</span> <span class="st">&quot;root&quot;</span>,</span>
<span id="cb360-9"><a href="cloud-services-for-big-data-analytics.html#cb360-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">password =</span> <span class="st">&quot;Password1&quot;</span>,</span>
<span id="cb360-10"><a href="cloud-services-for-big-data-analytics.html#cb360-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">host =</span> <span class="st">&quot;localhost&quot;</span>,</span>
<span id="cb360-11"><a href="cloud-services-for-big-data-analytics.html#cb360-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dbname =</span> <span class="st">&quot;data1&quot;</span>)</span></code></pre></div>
<p>In our first query, we select all (<code>*</code>) variable values of the observation of January 1968.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="cloud-services-for-big-data-analytics.html#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the query</span></span>
<span id="cb361-2"><a href="cloud-services-for-big-data-analytics.html#cb361-2" aria-hidden="true" tabindex="-1"></a>query1 <span class="ot">&lt;-</span> </span>
<span id="cb361-3"><a href="cloud-services-for-big-data-analytics.html#cb361-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb361-4"><a href="cloud-services-for-big-data-analytics.html#cb361-4" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT * FROM econ</span></span>
<span id="cb361-5"><a href="cloud-services-for-big-data-analytics.html#cb361-5" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE date = &#39;1968-01-01&#39;;</span></span>
<span id="cb361-6"><a href="cloud-services-for-big-data-analytics.html#cb361-6" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb361-7"><a href="cloud-services-for-big-data-analytics.html#cb361-7" aria-hidden="true" tabindex="-1"></a><span class="co"># send the query to the db and get the result</span></span>
<span id="cb361-8"><a href="cloud-services-for-big-data-analytics.html#cb361-8" aria-hidden="true" tabindex="-1"></a>jan <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, query1)</span>
<span id="cb361-9"><a href="cloud-services-for-big-data-analytics.html#cb361-9" aria-hidden="true" tabindex="-1"></a>jan</span></code></pre></div>
<pre><code>#        date   pce    pop psavert uempmed unemploy
# 1 1968-01-01 531.5 199808    11.7     5.1     2878</code></pre>
<p>Now let’s select all year/months in which there were more than 15 million unemployed, ordered by date.</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="cloud-services-for-big-data-analytics.html#cb363-1" aria-hidden="true" tabindex="-1"></a>query2 <span class="ot">&lt;-</span></span>
<span id="cb363-2"><a href="cloud-services-for-big-data-analytics.html#cb363-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb363-3"><a href="cloud-services-for-big-data-analytics.html#cb363-3" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT date FROM econ </span></span>
<span id="cb363-4"><a href="cloud-services-for-big-data-analytics.html#cb363-4" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE unemploy &gt; 15000</span></span>
<span id="cb363-5"><a href="cloud-services-for-big-data-analytics.html#cb363-5" aria-hidden="true" tabindex="-1"></a><span class="st">ORDER BY date;</span></span>
<span id="cb363-6"><a href="cloud-services-for-big-data-analytics.html#cb363-6" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb363-7"><a href="cloud-services-for-big-data-analytics.html#cb363-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb363-8"><a href="cloud-services-for-big-data-analytics.html#cb363-8" aria-hidden="true" tabindex="-1"></a><span class="co"># send the query to the db and get the result</span></span>
<span id="cb363-9"><a href="cloud-services-for-big-data-analytics.html#cb363-9" aria-hidden="true" tabindex="-1"></a>unemp <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, query2)</span>
<span id="cb363-10"><a href="cloud-services-for-big-data-analytics.html#cb363-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(unemp)</span></code></pre></div>
<pre><code>#         date
# 1 2009-09-01
# 2 2009-10-01
# 3 2009-11-01
# 4 2009-12-01
# 5 2010-01-01
# 6 2010-02-01
</code></pre>
<p>When done working with the database, we close the connection to the MariaDB database with <code>dbDisconnect(con)</code>.</p>
</div>
</div>
</div>
<div id="distributed-systemsmapreduce" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Distributed Systems/MapReduce</h2>
<div id="mapreduce-concept-illustration-in-r" class="section level3" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> Map/Reduce Concept: Illustration in R</h3>
<p>In order to better understand the basic concept behind the MapReduce-Framework on a distributed system, let’s look at how we can combine the basic functions <code>map()</code> and <code>reduce()</code> in R to implement the basic MapReduce example shown in <span class="citation"><a href="references.html#ref-walkowiak_2016" role="doc-biblioref">Walkowiak</a> (<a href="references.html#ref-walkowiak_2016" role="doc-biblioref">2016</a>)</span>, Chapter 4, pages 132-134 (this is just to illustrate the underlying idea, <em>not</em> to suggest that MapReduce actually is simply an application of the classical <code>map</code> and <code>reduce (fold)</code> functions in functional programming).<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a> The overall aim of the program is to count the number of times each word is repeated in a given text. The input to the program is thus a text, the output is a list of key-value pairs with the unique words occurring in the text as keys and their respective number of occurrences as values.</p>
<p>In the code example, we will use the following text as input.</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="cloud-services-for-big-data-analytics.html#cb365-1" aria-hidden="true" tabindex="-1"></a>input_text <span class="ot">&lt;-</span></span>
<span id="cb365-2"><a href="cloud-services-for-big-data-analytics.html#cb365-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Simon is a friend of Becky.</span></span>
<span id="cb365-3"><a href="cloud-services-for-big-data-analytics.html#cb365-3" aria-hidden="true" tabindex="-1"></a><span class="st">Becky is a friend of Ann.</span></span>
<span id="cb365-4"><a href="cloud-services-for-big-data-analytics.html#cb365-4" aria-hidden="true" tabindex="-1"></a><span class="st">Ann is not a friend of Simon.&quot;</span></span></code></pre></div>
<div id="mapper" class="section level4" number="9.2.1.1">
<h4><span class="header-section-number">9.2.1.1</span> Mapper</h4>
<p>The Mapper first splits the text into lines, and then splits the lines into key-value pairs, assigning to each key the value <code>1</code>. For the first step we use <code>strsplit()</code> that takes a character string as input and splits it into a list of substrings according to the matches of a substring (here <code>"\n"</code>, indicating the end of a line).</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="cloud-services-for-big-data-analytics.html#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapper splits input into lines</span></span>
<span id="cb366-2"><a href="cloud-services-for-big-data-analytics.html#cb366-2" aria-hidden="true" tabindex="-1"></a>lines <span class="ot">&lt;-</span> <span class="fu">as.list</span>(<span class="fu">strsplit</span>(input_text, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)[[<span class="dv">1</span>]])</span>
<span id="cb366-3"><a href="cloud-services-for-big-data-analytics.html#cb366-3" aria-hidden="true" tabindex="-1"></a>lines</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;Simon is a friend of Becky.&quot;
## 
## [[2]]
## [1] &quot;Becky is a friend of Ann.&quot;
## 
## [[3]]
## [1] &quot;Ann is not a friend of Simon.&quot;</code></pre>
<p>In a second step, we apply our own function (<code>map_fun()</code>) to each line of text via <code>Map()</code>. <code>map_fun()</code> splits each line into words (keys) and assigns a value of <code>1</code> to each key.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="cloud-services-for-big-data-analytics.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapper splits lines into Key-Value pairs</span></span>
<span id="cb368-2"><a href="cloud-services-for-big-data-analytics.html#cb368-2" aria-hidden="true" tabindex="-1"></a>map_fun <span class="ot">&lt;-</span></span>
<span id="cb368-3"><a href="cloud-services-for-big-data-analytics.html#cb368-3" aria-hidden="true" tabindex="-1"></a>     <span class="cf">function</span>(x){</span>
<span id="cb368-4"><a href="cloud-services-for-big-data-analytics.html#cb368-4" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb368-5"><a href="cloud-services-for-big-data-analytics.html#cb368-5" aria-hidden="true" tabindex="-1"></a>          <span class="co"># remove special characters</span></span>
<span id="cb368-6"><a href="cloud-services-for-big-data-analytics.html#cb368-6" aria-hidden="true" tabindex="-1"></a>          x_clean <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;[[:punct:]]&quot;</span>, <span class="st">&quot;&quot;</span>, x)</span>
<span id="cb368-7"><a href="cloud-services-for-big-data-analytics.html#cb368-7" aria-hidden="true" tabindex="-1"></a>          <span class="co"># split line into words</span></span>
<span id="cb368-8"><a href="cloud-services-for-big-data-analytics.html#cb368-8" aria-hidden="true" tabindex="-1"></a>          keys <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(x_clean, <span class="st">&quot; &quot;</span>))</span>
<span id="cb368-9"><a href="cloud-services-for-big-data-analytics.html#cb368-9" aria-hidden="true" tabindex="-1"></a>          <span class="co"># initiate key-value pairs</span></span>
<span id="cb368-10"><a href="cloud-services-for-big-data-analytics.html#cb368-10" aria-hidden="true" tabindex="-1"></a>          key_values <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(keys))</span>
<span id="cb368-11"><a href="cloud-services-for-big-data-analytics.html#cb368-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">names</span>(key_values) <span class="ot">&lt;-</span> keys</span>
<span id="cb368-12"><a href="cloud-services-for-big-data-analytics.html#cb368-12" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb368-13"><a href="cloud-services-for-big-data-analytics.html#cb368-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">return</span>(key_values)</span>
<span id="cb368-14"><a href="cloud-services-for-big-data-analytics.html#cb368-14" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb368-15"><a href="cloud-services-for-big-data-analytics.html#cb368-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-16"><a href="cloud-services-for-big-data-analytics.html#cb368-16" aria-hidden="true" tabindex="-1"></a>kv_pairs <span class="ot">&lt;-</span> <span class="fu">Map</span>(map_fun, lines)</span>
<span id="cb368-17"><a href="cloud-services-for-big-data-analytics.html#cb368-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-18"><a href="cloud-services-for-big-data-analytics.html#cb368-18" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the result</span></span>
<span id="cb368-19"><a href="cloud-services-for-big-data-analytics.html#cb368-19" aria-hidden="true" tabindex="-1"></a>kv_pairs</span></code></pre></div>
<pre><code>## [[1]]
##  Simon     is      a friend     of  Becky 
##      1      1      1      1      1      1 
## 
## [[2]]
##  Becky     is      a friend     of    Ann 
##      1      1      1      1      1      1 
## 
## [[3]]
##    Ann     is    not      a friend     of  Simon 
##      1      1      1      1      1      1      1</code></pre>
</div>
<div id="reducer" class="section level4" number="9.2.1.2">
<h4><span class="header-section-number">9.2.1.2</span> Reducer</h4>
<p>The Reducer first sorts and shuffles the input from the Mapper and then reduces the key-value pairs by summing up the values for each key.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="cloud-services-for-big-data-analytics.html#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="co"># order and shuffle</span></span>
<span id="cb370-2"><a href="cloud-services-for-big-data-analytics.html#cb370-2" aria-hidden="true" tabindex="-1"></a>kv_pairs <span class="ot">&lt;-</span> <span class="fu">unlist</span>(kv_pairs)</span>
<span id="cb370-3"><a href="cloud-services-for-big-data-analytics.html#cb370-3" aria-hidden="true" tabindex="-1"></a>keys <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">names</span>(kv_pairs))</span>
<span id="cb370-4"><a href="cloud-services-for-big-data-analytics.html#cb370-4" aria-hidden="true" tabindex="-1"></a>keys <span class="ot">&lt;-</span> keys[<span class="fu">order</span>(keys)]</span>
<span id="cb370-5"><a href="cloud-services-for-big-data-analytics.html#cb370-5" aria-hidden="true" tabindex="-1"></a>shuffled <span class="ot">&lt;-</span> <span class="fu">lapply</span>(keys,</span>
<span id="cb370-6"><a href="cloud-services-for-big-data-analytics.html#cb370-6" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">function</span>(x) kv_pairs[x <span class="sc">==</span> <span class="fu">names</span>(kv_pairs)])</span>
<span id="cb370-7"><a href="cloud-services-for-big-data-analytics.html#cb370-7" aria-hidden="true" tabindex="-1"></a>shuffled</span></code></pre></div>
<pre><code>## [[1]]
## a a a 
## 1 1 1 
## 
## [[2]]
## Ann Ann 
##   1   1 
## 
## [[3]]
## Becky Becky 
##     1     1 
## 
## [[4]]
## friend friend friend 
##      1      1      1 
## 
## [[5]]
## is is is 
##  1  1  1 
## 
## [[6]]
## not 
##   1 
## 
## [[7]]
## of of of 
##  1  1  1 
## 
## [[8]]
## Simon Simon 
##     1     1</code></pre>
<p>Now we can sum up the keys in order to get the word count for the entire input.</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="cloud-services-for-big-data-analytics.html#cb372-1" aria-hidden="true" tabindex="-1"></a>sums <span class="ot">&lt;-</span> <span class="fu">sapply</span>(shuffled, sum)</span>
<span id="cb372-2"><a href="cloud-services-for-big-data-analytics.html#cb372-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sums) <span class="ot">&lt;-</span> keys</span>
<span id="cb372-3"><a href="cloud-services-for-big-data-analytics.html#cb372-3" aria-hidden="true" tabindex="-1"></a>sums</span></code></pre></div>
<pre><code>##      a    Ann  Becky friend     is    not     of 
##      3      2      2      3      3      1      3 
##  Simon 
##      2</code></pre>
</div>
<div id="simpler-example-compute-the-total-number-of-words" class="section level4" number="9.2.1.3">
<h4><span class="header-section-number">9.2.1.3</span> Simpler example: Compute the total number of words</h4>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="cloud-services-for-big-data-analytics.html#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="co"># assigns the number of words per line as value</span></span>
<span id="cb374-2"><a href="cloud-services-for-big-data-analytics.html#cb374-2" aria-hidden="true" tabindex="-1"></a>map_fun2 <span class="ot">&lt;-</span> </span>
<span id="cb374-3"><a href="cloud-services-for-big-data-analytics.html#cb374-3" aria-hidden="true" tabindex="-1"></a>     <span class="cf">function</span>(x){</span>
<span id="cb374-4"><a href="cloud-services-for-big-data-analytics.html#cb374-4" aria-hidden="true" tabindex="-1"></a>          <span class="co"># remove special characters</span></span>
<span id="cb374-5"><a href="cloud-services-for-big-data-analytics.html#cb374-5" aria-hidden="true" tabindex="-1"></a>          x_clean <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;[[:punct:]]&quot;</span>, <span class="st">&quot;&quot;</span>, x)</span>
<span id="cb374-6"><a href="cloud-services-for-big-data-analytics.html#cb374-6" aria-hidden="true" tabindex="-1"></a>          <span class="co"># split line into words, count no. of words per line</span></span>
<span id="cb374-7"><a href="cloud-services-for-big-data-analytics.html#cb374-7" aria-hidden="true" tabindex="-1"></a>          values <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(x_clean, <span class="st">&quot; &quot;</span>)))</span>
<span id="cb374-8"><a href="cloud-services-for-big-data-analytics.html#cb374-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">return</span>(values)</span>
<span id="cb374-9"><a href="cloud-services-for-big-data-analytics.html#cb374-9" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb374-10"><a href="cloud-services-for-big-data-analytics.html#cb374-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapper</span></span>
<span id="cb374-11"><a href="cloud-services-for-big-data-analytics.html#cb374-11" aria-hidden="true" tabindex="-1"></a>mapped <span class="ot">&lt;-</span> <span class="fu">Map</span>(map_fun2, lines)</span>
<span id="cb374-12"><a href="cloud-services-for-big-data-analytics.html#cb374-12" aria-hidden="true" tabindex="-1"></a>mapped</span></code></pre></div>
<pre><code>## [[1]]
## [1] 6
## 
## [[2]]
## [1] 6
## 
## [[3]]
## [1] 7</code></pre>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="cloud-services-for-big-data-analytics.html#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reducer</span></span>
<span id="cb376-2"><a href="cloud-services-for-big-data-analytics.html#cb376-2" aria-hidden="true" tabindex="-1"></a>reduced <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(sum, mapped)</span>
<span id="cb376-3"><a href="cloud-services-for-big-data-analytics.html#cb376-3" aria-hidden="true" tabindex="-1"></a>reduced</span></code></pre></div>
<pre><code>## [1] 19</code></pre>
</div>
</div>
</div>
<div id="hadoop-word-count" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Hadoop Word Count</h2>
<p>Example adapted from <a href="https://www.digitalocean.com/community/tutorials/how-to-install-hadoop-in-stand-alone-mode-on-ubuntu-18-04#step-2-%E2%80%94-installing-hadoop">this tutorial</a> by Melissa Anderson and Hanif Jetha.</p>
<div id="install-hadoop-on-ubuntupop_os-linux" class="section level3" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> Install Hadoop (on Ubuntu/Pop!_OS Linux)</h3>
<div class="sourceCode" id="cb378"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb378-1"><a href="cloud-services-for-big-data-analytics.html#cb378-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download binary</span></span>
<span id="cb378-2"><a href="cloud-services-for-big-data-analytics.html#cb378-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://downloads.apache.org/hadoop/common/hadoop-2.10.0/hadoop-2.10.0.tar.gz</span>
<span id="cb378-3"><a href="cloud-services-for-big-data-analytics.html#cb378-3" aria-hidden="true" tabindex="-1"></a><span class="co"># download checksum</span></span>
<span id="cb378-4"><a href="cloud-services-for-big-data-analytics.html#cb378-4" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://www.apache.org/dist/hadoop/common/hadoop-2.10.0/hadoop-2.10.0.tar.gz.sha512</span>
<span id="cb378-5"><a href="cloud-services-for-big-data-analytics.html#cb378-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-6"><a href="cloud-services-for-big-data-analytics.html#cb378-6" aria-hidden="true" tabindex="-1"></a><span class="co"># run the verification</span></span>
<span id="cb378-7"><a href="cloud-services-for-big-data-analytics.html#cb378-7" aria-hidden="true" tabindex="-1"></a><span class="ex">shasum</span> <span class="at">-a</span> 512 hadoop-2.10.0.tar.gz</span>
<span id="cb378-8"><a href="cloud-services-for-big-data-analytics.html#cb378-8" aria-hidden="true" tabindex="-1"></a><span class="co"># compare with value in mds file</span></span>
<span id="cb378-9"><a href="cloud-services-for-big-data-analytics.html#cb378-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> hadoop-2.10.0.tar.gz.sha512</span>
<span id="cb378-10"><a href="cloud-services-for-big-data-analytics.html#cb378-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-11"><a href="cloud-services-for-big-data-analytics.html#cb378-11" aria-hidden="true" tabindex="-1"></a><span class="co"># if all is fine, unpack</span></span>
<span id="cb378-12"><a href="cloud-services-for-big-data-analytics.html#cb378-12" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-xzvf</span> hadoop-2.10.0.tar.gz</span>
<span id="cb378-13"><a href="cloud-services-for-big-data-analytics.html#cb378-13" aria-hidden="true" tabindex="-1"></a><span class="co"># move to proper place</span></span>
<span id="cb378-14"><a href="cloud-services-for-big-data-analytics.html#cb378-14" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mv hadoop-2.10.0 /usr/local/hadoop</span>
<span id="cb378-15"><a href="cloud-services-for-big-data-analytics.html#cb378-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-16"><a href="cloud-services-for-big-data-analytics.html#cb378-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-17"><a href="cloud-services-for-big-data-analytics.html#cb378-17" aria-hidden="true" tabindex="-1"></a><span class="co"># then point to this version from hadoop</span></span>
<span id="cb378-18"><a href="cloud-services-for-big-data-analytics.html#cb378-18" aria-hidden="true" tabindex="-1"></a><span class="co"># open the file /usr/local/hadoop/etc/hadoop/hadoop-env.sh</span></span>
<span id="cb378-19"><a href="cloud-services-for-big-data-analytics.html#cb378-19" aria-hidden="true" tabindex="-1"></a><span class="co"># in a text editor and add (where export JAVA_HOME=...)</span></span>
<span id="cb378-20"><a href="cloud-services-for-big-data-analytics.html#cb378-20" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">JAVA_HOME=$(</span><span class="fu">readlink</span> <span class="at">-f</span> /usr/bin/java <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&quot;s:bin/java::&quot;</span><span class="va">)</span></span>
<span id="cb378-21"><a href="cloud-services-for-big-data-analytics.html#cb378-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-22"><a href="cloud-services-for-big-data-analytics.html#cb378-22" aria-hidden="true" tabindex="-1"></a><span class="co"># clean up</span></span>
<span id="cb378-23"><a href="cloud-services-for-big-data-analytics.html#cb378-23" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> hadoop-2.10.0.tar.gz</span>
<span id="cb378-24"><a href="cloud-services-for-big-data-analytics.html#cb378-24" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> hadoop-2.10.0.tar.gz.sha512</span></code></pre></div>
</div>
<div id="run-hadoop" class="section level3" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> Run Hadoop</h3>
<div class="sourceCode" id="cb379"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb379-1"><a href="cloud-services-for-big-data-analytics.html#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check installation</span></span>
<span id="cb379-2"><a href="cloud-services-for-big-data-analytics.html#cb379-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/usr/local/hadoop/bin/hadoop</span></span></code></pre></div>
</div>
<div id="run-example" class="section level3" number="9.3.3">
<h3><span class="header-section-number">9.3.3</span> Run example</h3>
<p>The basic Hadoop installation comes with a few examples for very typical map/reduce programs.<a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a> Below we replicate the same word-count example as shown in simple R code above.</p>
<p>In a first step, we create an input directory where we store the input file(s) to feed to Hadoop.</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb380-1"><a href="cloud-services-for-big-data-analytics.html#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create directory for input files (typically text files)</span></span>
<span id="cb380-2"><a href="cloud-services-for-big-data-analytics.html#cb380-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ~/input</span></code></pre></div>
<p>Then we add a textfile containing the same text as in the example as above (to make things simpler, we already remove special characters).</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb381-1"><a href="cloud-services-for-big-data-analytics.html#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;Simon is a friend of Becky</span></span>
<span id="cb381-2"><a href="cloud-services-for-big-data-analytics.html#cb381-2" aria-hidden="true" tabindex="-1"></a><span class="st">Becky is a friend of Ann</span></span>
<span id="cb381-3"><a href="cloud-services-for-big-data-analytics.html#cb381-3" aria-hidden="true" tabindex="-1"></a><span class="st">Ann is not a friend of Simon&quot;</span> <span class="op">&gt;&gt;</span>  ~/input/text.txt</span></code></pre></div>
<p>Now we can run the MapReduce/Hadoop word count as follows, storing the results in a new directory called <code>wordcount_example</code>.</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb382-1"><a href="cloud-services-for-big-data-analytics.html#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run mapreduce word count</span></span>
<span id="cb382-2"><a href="cloud-services-for-big-data-analytics.html#cb382-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/usr/local/hadoop/bin/hadoop</span> jar /usr/local/hadoop/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.10.0.jar wordcount ~/input ~/wc_example</span></code></pre></div>
<p>Show the output:</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb383-1"><a href="cloud-services-for-big-data-analytics.html#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> ~/wc_example/<span class="pp">*</span></span></code></pre></div>
<pre><code>## Ann  2
## Becky    2
## Simon    2
## a    3
## friend   3
## is   3
## not  1
## of   3</code></pre>
<!-- Next, we can use the following command to run the MapReduce hadoop-mapreduce-examples program, a Java archive with several options. We’ll invoke its grep program, one of the many examples included in hadoop-mapreduce-examples, followed by the input directory, input and the output directory grep_example. The MapReduce grep program will count the matches of a literal word or regular expression. Finally, we’ll supply the regular expression allowed[.]* to find occurrences of the word allowed within or at the end of a declarative sentence. The expression is case-sensitive, so we wouldn’t find the word if it were capitalized at the beginning of a sentence: -->
<!-- ```{bash} -->
<!-- # create directory for input files (typically text files) -->
<!-- mkdir ~/input -->
<!-- # copy example data to input directory -->
<!-- cp /usr/local/hadoop/etc/hadoop/*.xml ~/input -->
<!-- # run mapreduce grep  -->
<!-- # to find occurrences of the word 'allowed' (witin or at the end of a sentence) -->
<!-- /usr/local/hadoop/bin/hadoop jar /usr/local/hadoop/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.10.0.jar grep ~/input ~/grep_example 'allowed[.]*' -->
<!-- ``` -->
<!-- ## Notes on Deploying Hortonworks Sandbox on Azure -->
<!-- The instructions in @walkowiak_2016 Chapter 4, pages 138ff are partly outdated. You will notice that the screenshots do not anymore correspond with the current Azure layout. The Hortonworks tutorial ['Deploying Hortonworks Sandbox on Microsoft Azure'](https://hortonworks.com/tutorial/sandbox-deployment-and-install-guide/section/4/#creating-the-sandbox) is more up to date.^[For a short description of how to set up Hortonworks Sandbox on AWS, see [here](https://community.hortonworks.com/articles/103754/hdp-sandbox-on-aws-1.html).] The layout of Microsoft Azure's dashboard has slightly changed. The settings are essentially the same but might occur an a different order than what you see in the Hortonworks tutorial. There are also small changes in the default settings. You might have to add an additional inbound rule in the 'Networking' settings (either when setting up the virtual machine or after starting it) that allows ssh (port 22) and HTTP (port 80) inbound traffic. -->
<!-- Once you've gone through all the steps in the ['Deploying Hortonworks Sandbox on Microsoft Azure'](https://hortonworks.com/tutorial/sandbox-deployment-and-install-guide/section/4/#creating-the-sandbox) tutorial, open a terminal window and connect to the virtual machine as suggested in the tutorial: -->
<!-- ```{bash eval=FALSE} -->
<!-- ssh azureSandbox -->
<!-- ``` -->
<!-- Open another terminal window and run the following command to connect with the hadoop sandbox. You will be asked for the password. The default password is `hadoop`. After entering the password you will be prompted to change the password (`Changing password for root. (current) UNIX password:`). In order to change it you have to re-enter the current password (`hadoop`) and then enter your new password for root. -->
<!-- ```{bash eval=FALSE} -->
<!-- ssh root@localhost -p 2222  -->
<!-- ``` -->
<!-- ## Notes on working with Hortonworks Sandbox/Hadoop on Azure -->
<!-- *(@walkowiak_2016: A word count example in Hadoop using Java)* -->
<!-- Now everything should be set up and running and you can continue with the tutorial in @walkowiak_2016, pages 152 (unlike in the example in the book, the prompt will read `[root@sandbox-hdp ~]`) with the line `hadoop version`. If you do not want to go through the tutorial as `root`, you can add a user as follows (replacing `<username>` with a user name of your choice). -->
<!-- ```{bash eval=FALSE} -->
<!-- useradd <username> -->
<!-- passwd <username> -->
<!-- ``` -->
<!-- Note that you will have to grant the user additional rights for some of the commands in the book's tutorial. Follow [these instructions](https://superuser.com/a/120342) to do so. -->
<!-- In the following I use the user name `umatter` (with `sudo` permission). In order to connect to the sandbox with the new user, open a new terminal window and type the following command. -->
<!-- ```{bash eval=FALSE} -->
<!-- ssh umatter@localhost -p 2222 -->
<!-- ``` -->
<!-- To transfer the data set as instructed on page 160 in @walkowiak_2016, use the following command in a new Terminal -->
<!-- ```{bash eval=FALSE} -->
<!-- scp -P 2222 -r ~/Desktop/twain_data.txt umatter@localhost:~/data -->
<!-- ``` -->
<!-- Similarly, for uploading the Java classes as instructed on page 162: -->
<!-- ```{bash eval=FALSE} -->
<!--  scp -P 2222 -r ~/Desktop/wordcount umatter@localhost:~/wordcount -->
<!-- ``` -->
<!-- And finally to download the final output of the word count exercise: -->
<!-- ```{bash eval=FALSE} -->
<!-- scp -P 2222 -r umatter@localhost:~/wordcount/wordcount.txt ~/Desktop/wordcount_final.txt -->
<!-- ``` -->

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="14">
<li id="fn14"><p>Below it is shown how to do this ‘manually,’ if not promted at this step.<a href="cloud-services-for-big-data-analytics.html#fnref14" class="footnote-back">↩︎</a></p></li>
<li id="fn15"><p>However, MariaDB is a much more sophisticated RDBMS than SQLite and comes with many more field types, see the official <a href="https://mariadb.com/kb/en/library/data-types/">list of supported data types</a>.<a href="cloud-services-for-big-data-analytics.html#fnref15" class="footnote-back">↩︎</a></p></li>
<li id="fn16"><p>For a more detailed discussion of what <code>map</code> and <code>reduce</code> have <em>actually</em> to do with MapReduce see <a href="https://medium.com/@jkff/mapreduce-is-not-functional-programming-39109a4ba7b2">this post</a>.<a href="cloud-services-for-big-data-analytics.html#fnref16" class="footnote-back">↩︎</a></p></li>
<li id="fn17"><p>More sophisticated programs need to be custom made, written in Java.<a href="cloud-services-for-big-data-analytics.html#fnref17" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="big-data-visualization.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="gpus-for-scientific-computing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 1
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bigdata.pdf", "bigdata.html", "bigdata.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
