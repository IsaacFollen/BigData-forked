<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 12 Bottlenecks in Everyday Data Analytics Tasks | Big Data Analytics</title>
  <meta name="description" content="Chapter 12 Bottlenecks in Everyday Data Analytics Tasks | Big Data Analytics" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 12 Bottlenecks in Everyday Data Analytics Tasks | Big Data Analytics" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://umatter.github.io/BigData/img/cover_print.jpg" />
  
  <meta name="github-repo" content="umatter/BigData" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 12 Bottlenecks in Everyday Data Analytics Tasks | Big Data Analytics" />
  
  
  <meta name="twitter:image" content="https://umatter.github.io/BigData/img/cover_print.jpg" />

<meta name="author" content="Ulrich Matter" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="a.html"/>
<link rel="next" href="econometrics-with-gpus.html"/>
<script src="libs/jquery/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style/style_new.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Big Data Analytics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="c.html"><a href="c.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="c.html"><a href="c.html#background-and-goals-of-this-book"><i class="fa fa-check"></i>Background and goals of this book</a></li>
<li class="chapter" data-level="" data-path="c.html"><a href="c.html#a-moving-target"><i class="fa fa-check"></i>A moving target</a></li>
<li class="chapter" data-level="" data-path="c.html"><a href="c.html#content-and-organization-of-the-book"><i class="fa fa-check"></i>Content and organization of the book</a></li>
<li class="chapter" data-level="" data-path="c.html"><a href="c.html#prerequisites-and-requirements"><i class="fa fa-check"></i>Prerequisites and requirements</a></li>
<li class="chapter" data-level="" data-path="c.html"><a href="c.html#supplementary-materials-code-examples-datasets-and-documentation"><i class="fa fa-check"></i>Supplementary Materials: Code Examples, Datasets, and Documentation</a></li>
<li class="chapter" data-level="" data-path="c.html"><a href="c.html#thanks"><i class="fa fa-check"></i>Thanks</a></li>
</ul></li>
<li class="part"><span><b>I Setting the Scene: Analyzing Big Data</b></span></li>
<li class="chapter" data-level="" data-path="s.html"><a href="s.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="what-is-big-in-big-data.html"><a href="what-is-big-in-big-data.html"><i class="fa fa-check"></i><b>1</b> What is <em>Big</em> in “Big Data”?</a></li>
<li class="chapter" data-level="2" data-path="approaches-to-analyzing-big-data.html"><a href="approaches-to-analyzing-big-data.html"><i class="fa fa-check"></i><b>2</b> Approaches to Analyzing Big Data</a></li>
<li class="chapter" data-level="3" data-path="the-two-domains-of-big-data-analytics.html"><a href="the-two-domains-of-big-data-analytics.html"><i class="fa fa-check"></i><b>3</b> The Two Domains of Big Data Analytics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="the-two-domains-of-big-data-analytics.html"><a href="the-two-domains-of-big-data-analytics.html#a-practical-big-p-problem"><i class="fa fa-check"></i><b>3.1</b> A practical <em>big P</em> problem </a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="the-two-domains-of-big-data-analytics.html"><a href="the-two-domains-of-big-data-analytics.html#simple-logistic-regression-naive-approach"><i class="fa fa-check"></i><b>3.1.1</b> Simple logistic regression (naive approach)</a></li>
<li class="chapter" data-level="3.1.2" data-path="the-two-domains-of-big-data-analytics.html"><a href="the-two-domains-of-big-data-analytics.html#regularization-the-lasso-estimator"><i class="fa fa-check"></i><b>3.1.2</b> Regularization: the lasso estimator</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="the-two-domains-of-big-data-analytics.html"><a href="the-two-domains-of-big-data-analytics.html#a-practical-big-n-problem"><i class="fa fa-check"></i><b>3.2</b> A practical <em>big N</em> problem </a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="the-two-domains-of-big-data-analytics.html"><a href="the-two-domains-of-big-data-analytics.html#ols-as-a-point-of-reference"><i class="fa fa-check"></i><b>3.2.1</b> OLS as a point of reference </a></li>
<li class="chapter" data-level="3.2.2" data-path="the-two-domains-of-big-data-analytics.html"><a href="the-two-domains-of-big-data-analytics.html#the-uluru-algorithm-as-an-alternative-to-ols"><i class="fa fa-check"></i><b>3.2.2</b> The <em>Uluru</em> algorithm as an alternative to OLS </a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Platform: Software and Computing Resources</b></span></li>
<li class="chapter" data-level="" data-path="p.html"><a href="p.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="4" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html"><i class="fa fa-check"></i><b>4</b> Software: Programming with (Big) Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#domains-of-programming-with-big-data"><i class="fa fa-check"></i><b>4.1</b> Domains of programming with (big) data</a></li>
<li class="chapter" data-level="4.2" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#measuring-r-performance"><i class="fa fa-check"></i><b>4.2</b> Measuring R performance</a></li>
<li class="chapter" data-level="4.3" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#writing-efficient-r-code"><i class="fa fa-check"></i><b>4.3</b> Writing efficient R code</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#memory-allocation-and-growing-objects"><i class="fa fa-check"></i><b>4.3.1</b> Memory allocation and growing objects</a></li>
<li class="chapter" data-level="4.3.2" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#vectorization-in-basic-r-functions"><i class="fa fa-check"></i><b>4.3.2</b> Vectorization in basic R functions</a></li>
<li class="chapter" data-level="4.3.3" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#apply-type-functions-and-vectorization"><i class="fa fa-check"></i><b>4.3.3</b> <code>apply</code>-type functions and vectorization</a></li>
<li class="chapter" data-level="4.3.4" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#avoiding-unnecessary-copying"><i class="fa fa-check"></i><b>4.3.4</b> Avoiding unnecessary copying</a></li>
<li class="chapter" data-level="4.3.5" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#releasing-memory"><i class="fa fa-check"></i><b>4.3.5</b> Releasing memory</a></li>
<li class="chapter" data-level="4.3.6" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#beyond-r"><i class="fa fa-check"></i><b>4.3.6</b> Beyond R</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#sql-basics"><i class="fa fa-check"></i><b>4.4</b> SQL basics</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#first-steps-in-sqlite"><i class="fa fa-check"></i><b>4.4.1</b> First steps in SQL(ite)</a></li>
<li class="chapter" data-level="4.4.2" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#joins"><i class="fa fa-check"></i><b>4.4.2</b> Joins</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#with-a-little-help-from-my-friends-gpt-and-rsql-coding"><i class="fa fa-check"></i><b>4.5</b> With a little help from my friends: GPT and R/SQL coding</a></li>
<li class="chapter" data-level="4.6" data-path="software-programming-with-big-data.html"><a href="software-programming-with-big-data.html#wrapping-up"><i class="fa fa-check"></i><b>4.6</b> Wrapping up</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html"><i class="fa fa-check"></i><b>5</b> Hardware: Computing Resources</a>
<ul>
<li class="chapter" data-level="5.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#mass-storage"><i class="fa fa-check"></i><b>5.1</b> Mass storage</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#avoiding-redundancies"><i class="fa fa-check"></i><b>5.1.1</b> Avoiding redundancies</a></li>
<li class="chapter" data-level="5.1.2" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#data-compression"><i class="fa fa-check"></i><b>5.1.2</b> Data compression</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#random-access-memory-ram"><i class="fa fa-check"></i><b>5.2</b> Random access memory (RAM)</a></li>
<li class="chapter" data-level="5.3" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#combining-ram-and-hard-disk-virtual-memory"><i class="fa fa-check"></i><b>5.3</b> Combining RAM and hard disk: Virtual memory</a></li>
<li class="chapter" data-level="5.4" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#cpu-and-parallelization"><i class="fa fa-check"></i><b>5.4</b> CPU and parallelization</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#naive-multi-session-approach"><i class="fa fa-check"></i><b>5.4.1</b> Naive multi-session approach</a></li>
<li class="chapter" data-level="5.4.2" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#multi-session-approach-with-futures"><i class="fa fa-check"></i><b>5.4.2</b> Multi-session approach with futures</a></li>
<li class="chapter" data-level="5.4.3" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#multi-core-and-multi-node-approach"><i class="fa fa-check"></i><b>5.4.3</b> Multi-core and multi-node approach</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#gpus-for-scientific-computing"><i class="fa fa-check"></i><b>5.5</b> GPUs for scientific computing</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#gpus-in-r"><i class="fa fa-check"></i><b>5.5.1</b> GPUs in R</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#the-road-ahead-hardware-made-for-machine-learning"><i class="fa fa-check"></i><b>5.6</b> The road ahead: Hardware made for machine learning</a></li>
<li class="chapter" data-level="5.7" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#wrapping-up-1"><i class="fa fa-check"></i><b>5.7</b> Wrapping up</a></li>
<li class="chapter" data-level="5.8" data-path="hardware-computing-resources.html"><a href="hardware-computing-resources.html#still-have-insufficient-computing-resources"><i class="fa fa-check"></i><b>5.8</b> Still have insufficient computing resources?</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="distributed-systems.html"><a href="distributed-systems.html"><i class="fa fa-check"></i><b>6</b> Distributed Systems</a>
<ul>
<li class="chapter" data-level="6.1" data-path="distributed-systems.html"><a href="distributed-systems.html#mapreduce"><i class="fa fa-check"></i><b>6.1</b> MapReduce</a></li>
<li class="chapter" data-level="6.2" data-path="distributed-systems.html"><a href="distributed-systems.html#apache-hadoop"><i class="fa fa-check"></i><b>6.2</b> Apache Hadoop</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="distributed-systems.html"><a href="distributed-systems.html#hadoop-word-count-example"><i class="fa fa-check"></i><b>6.2.1</b> Hadoop word count example</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="distributed-systems.html"><a href="distributed-systems.html#apache-spark"><i class="fa fa-check"></i><b>6.3</b> Apache Spark</a></li>
<li class="chapter" data-level="6.4" data-path="distributed-systems.html"><a href="distributed-systems.html#spark-with-r"><i class="fa fa-check"></i><b>6.4</b> Spark with R</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="distributed-systems.html"><a href="distributed-systems.html#data-import-and-summary-statistics"><i class="fa fa-check"></i><b>6.4.1</b> Data import and summary statistics</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="distributed-systems.html"><a href="distributed-systems.html#spark-with-sql"><i class="fa fa-check"></i><b>6.5</b> Spark with SQL</a></li>
<li class="chapter" data-level="6.6" data-path="distributed-systems.html"><a href="distributed-systems.html#spark-with-r-sql"><i class="fa fa-check"></i><b>6.6</b> Spark with R + SQL</a></li>
<li class="chapter" data-level="6.7" data-path="distributed-systems.html"><a href="distributed-systems.html#wrapping-up-2"><i class="fa fa-check"></i><b>6.7</b> Wrapping up</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="cloud-computing.html"><a href="cloud-computing.html"><i class="fa fa-check"></i><b>7</b> Cloud Computing</a>
<ul>
<li class="chapter" data-level="7.1" data-path="cloud-computing.html"><a href="cloud-computing.html#cloud-computing-basics-and-platforms"><i class="fa fa-check"></i><b>7.1</b> Cloud computing basics and platforms</a></li>
<li class="chapter" data-level="7.2" data-path="cloud-computing.html"><a href="cloud-computing.html#transitioning-to-the-cloud"><i class="fa fa-check"></i><b>7.2</b> Transitioning to the cloud</a></li>
<li class="chapter" data-level="7.3" data-path="cloud-computing.html"><a href="cloud-computing.html#scaling-up-in-the-cloud-virtual-servers"><i class="fa fa-check"></i><b>7.3</b> Scaling up in the cloud: Virtual servers</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="cloud-computing.html"><a href="cloud-computing.html#parallelization-with-an-ec2-instance"><i class="fa fa-check"></i><b>7.3.1</b> Parallelization with an EC2 instance</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="cloud-computing.html"><a href="cloud-computing.html#scaling-up-with-gpus"><i class="fa fa-check"></i><b>7.4</b> Scaling up with GPUs</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="cloud-computing.html"><a href="cloud-computing.html#gpus-on-google-colab"><i class="fa fa-check"></i><b>7.4.1</b> GPUs on Google Colab</a></li>
<li class="chapter" data-level="7.4.2" data-path="cloud-computing.html"><a href="cloud-computing.html#rstudio-and-ec2-with-gpus-on-aws"><i class="fa fa-check"></i><b>7.4.2</b> RStudio and EC2 with GPUs on AWS</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="cloud-computing.html"><a href="cloud-computing.html#scaling-out-mapreduce-in-the-cloud"><i class="fa fa-check"></i><b>7.5</b> Scaling out: MapReduce in the cloud</a></li>
<li class="chapter" data-level="7.6" data-path="cloud-computing.html"><a href="cloud-computing.html#wrapping-up-3"><i class="fa fa-check"></i><b>7.6</b> Wrapping up</a></li>
</ul></li>
<li class="part"><span><b>III Components of Big Data Analytics</b></span></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="8" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html"><i class="fa fa-check"></i><b>8</b> Data Collection and Data Storage</a>
<ul>
<li class="chapter" data-level="8.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#gathering-and-compilation-of-raw-data"><i class="fa fa-check"></i><b>8.1</b> Gathering and compilation of raw data</a></li>
<li class="chapter" data-level="8.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#stackcombine-raw-source-files"><i class="fa fa-check"></i><b>8.2</b> Stack/combine raw source files</a></li>
<li class="chapter" data-level="8.3" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#efficient-local-data-storage"><i class="fa fa-check"></i><b>8.3</b> Efficient local data storage</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#rdbms-basics"><i class="fa fa-check"></i><b>8.3.1</b> RDBMS basics</a></li>
<li class="chapter" data-level="8.3.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#efficient-data-access-indices-and-joins-in-sqlite"><i class="fa fa-check"></i><b>8.3.2</b> Efficient data access: Indices and joins in SQLite</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#connecting-r-to-an-rdbms"><i class="fa fa-check"></i><b>8.4</b> Connecting R to an RDBMS</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#creating-a-new-database-with-rsqlite"><i class="fa fa-check"></i><b>8.4.1</b> Creating a new database with <code>RSQLite</code></a></li>
<li class="chapter" data-level="8.4.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#importing-data"><i class="fa fa-check"></i><b>8.4.2</b> Importing data</a></li>
<li class="chapter" data-level="8.4.3" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#issuing-queries"><i class="fa fa-check"></i><b>8.4.3</b> Issuing queries</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#cloud-solutions-for-big-data-storage"><i class="fa fa-check"></i><b>8.5</b> Cloud solutions for (big) data storage</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#easy-to-use-rdbms-in-the-cloud-aws-rds"><i class="fa fa-check"></i><b>8.5.1</b> Easy-to-use RDBMS in the cloud: AWS RDS</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#column-based-analytics-databases"><i class="fa fa-check"></i><b>8.6</b> Column-based analytics databases</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#installation-and-start-up"><i class="fa fa-check"></i><b>8.6.1</b> Installation and start up</a></li>
<li class="chapter" data-level="8.6.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#first-steps-via-druids-gui"><i class="fa fa-check"></i><b>8.6.2</b> First steps via Druid’s GUI</a></li>
<li class="chapter" data-level="8.6.3" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#query-druid-from-r"><i class="fa fa-check"></i><b>8.6.3</b> Query Druid from R</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#data-warehouses"><i class="fa fa-check"></i><b>8.7</b> Data warehouses</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#data-warehouse-for-analytics-google-bigquery-example"><i class="fa fa-check"></i><b>8.7.1</b> Data warehouse for analytics: Google BigQuery example</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#data-lakes-and-simple-storage-service"><i class="fa fa-check"></i><b>8.8</b> Data lakes and simple storage service</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#aws-s3-with-r-first-steps"><i class="fa fa-check"></i><b>8.8.1</b> AWS S3 with R: First steps</a></li>
<li class="chapter" data-level="8.8.2" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#uploading-data-to-s3"><i class="fa fa-check"></i><b>8.8.2</b> Uploading data to S3</a></li>
<li class="chapter" data-level="8.8.3" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#more-than-just-simple-storage-s3-amazon-athena"><i class="fa fa-check"></i><b>8.8.3</b> More than just simple storage: S3 + Amazon Athena</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="data-collection-and-data-storage.html"><a href="data-collection-and-data-storage.html#wrapping-up-4"><i class="fa fa-check"></i><b>8.9</b> Wrapping up</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html"><i class="fa fa-check"></i><b>9</b> Big Data Cleaning and Transformation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#out-of-memory-strategies-and-lazy-evaluation-practical-basics"><i class="fa fa-check"></i><b>9.1</b> Out-of-memory strategies and lazy evaluation: Practical basics</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#chunking-data-with-the-ff-package"><i class="fa fa-check"></i><b>9.1.1</b> Chunking data with the <code>ff</code> package</a></li>
<li class="chapter" data-level="9.1.2" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#memory-mapping-with-bigmemory"><i class="fa fa-check"></i><b>9.1.2</b> Memory mapping with <code>bigmemory</code></a></li>
<li class="chapter" data-level="9.1.3" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#connecting-to-apache-arrow"><i class="fa fa-check"></i><b>9.1.3</b> Connecting to Apache Arrow</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#big-data-preparation-tutorial-with-ff"><i class="fa fa-check"></i><b>9.2</b> Big Data preparation tutorial with <code>ff</code></a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#set-up"><i class="fa fa-check"></i><b>9.2.1</b> Set up</a></li>
<li class="chapter" data-level="9.2.2" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#data-import"><i class="fa fa-check"></i><b>9.2.2</b> Data import</a></li>
<li class="chapter" data-level="9.2.3" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#inspect-imported-files"><i class="fa fa-check"></i><b>9.2.3</b> Inspect imported files</a></li>
<li class="chapter" data-level="9.2.4" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#data-cleaning-and-transformation"><i class="fa fa-check"></i><b>9.2.4</b> Data cleaning and transformation</a></li>
<li class="chapter" data-level="9.2.5" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#inspect-difference-in-in-memory-operation"><i class="fa fa-check"></i><b>9.2.5</b> Inspect difference in in-memory operation</a></li>
<li class="chapter" data-level="9.2.6" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#subsetting"><i class="fa fa-check"></i><b>9.2.6</b> Subsetting</a></li>
<li class="chapter" data-level="9.2.7" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#saveloadexport-ff-files"><i class="fa fa-check"></i><b>9.2.7</b> Save/load/export <code>ff</code> files</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#big-data-preparation-tutorial-with-arrow"><i class="fa fa-check"></i><b>9.3</b> Big Data preparation tutorial with <code>arrow</code></a></li>
<li class="chapter" data-level="9.4" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#wrapping-up-5"><i class="fa fa-check"></i><b>9.4</b> Wrapping up</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html"><i class="fa fa-check"></i><b>10</b> Descriptive Statistics and Aggregation</a>
<ul>
<li class="chapter" data-level="10.1" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#data-aggregation-the-split-apply-combine-strategy"><i class="fa fa-check"></i><b>10.1</b> Data aggregation: The ‘split-apply-combine’ strategy</a></li>
<li class="chapter" data-level="10.2" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#data-aggregation-with-chunked-data-files"><i class="fa fa-check"></i><b>10.2</b> Data aggregation with chunked data files</a></li>
<li class="chapter" data-level="10.3" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#high-speed-in-memory-data-aggregation-with-arrow"><i class="fa fa-check"></i><b>10.3</b> High-speed in-memory data aggregation with <code>arrow</code></a></li>
<li class="chapter" data-level="10.4" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#high-speed-in-memory-data-aggregation-with-data.table"><i class="fa fa-check"></i><b>10.4</b> High-speed in-memory data aggregation with <code>data.table</code></a></li>
<li class="chapter" data-level="10.5" data-path="descriptive-statistics-and-aggregation.html"><a href="descriptive-statistics-and-aggregation.html#wrapping-up-6"><i class="fa fa-check"></i><b>10.5</b> Wrapping up</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="big-data-visualization.html"><a href="big-data-visualization.html"><i class="fa fa-check"></i><b>11</b> (Big) Data Visualization</a>
<ul>
<li class="chapter" data-level="11.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#challenges-of-big-data-visualization"><i class="fa fa-check"></i><b>11.1</b> Challenges of Big Data visualization</a></li>
<li class="chapter" data-level="11.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#data-exploration-with-ggplot2"><i class="fa fa-check"></i><b>11.2</b> Data exploration with <code>ggplot2</code></a></li>
<li class="chapter" data-level="11.3" data-path="big-data-visualization.html"><a href="big-data-visualization.html#visualizing-time-and-space"><i class="fa fa-check"></i><b>11.3</b> Visualizing time and space</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#preparations"><i class="fa fa-check"></i><b>11.3.1</b> Preparations</a></li>
<li class="chapter" data-level="11.3.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#pick-up-and-drop-off-locations"><i class="fa fa-check"></i><b>11.3.2</b> Pick-up and drop-off locations</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="big-data-visualization.html"><a href="big-data-visualization.html#wrapping-up-7"><i class="fa fa-check"></i><b>11.4</b> Wrapping up</a></li>
</ul></li>
<li class="part"><span><b>IV Application: Topics in Big Data Econometrics</b></span></li>
<li class="chapter" data-level="" data-path="a.html"><a href="a.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="12" data-path="bottlenecks-in-everyday-data-analytics-tasks.html"><a href="bottlenecks-in-everyday-data-analytics-tasks.html"><i class="fa fa-check"></i><b>12</b> Bottlenecks in Everyday Data Analytics Tasks</a>
<ul>
<li class="chapter" data-level="12.1" data-path="bottlenecks-in-everyday-data-analytics-tasks.html"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#case-study-efficient-fixed-effects-estimation"><i class="fa fa-check"></i><b>12.1</b> Case study: Efficient fixed effects estimation</a></li>
<li class="chapter" data-level="12.2" data-path="bottlenecks-in-everyday-data-analytics-tasks.html"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#case-study-loops-memory-and-vectorization"><i class="fa fa-check"></i><b>12.2</b> Case study: Loops, memory, and vectorization</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="bottlenecks-in-everyday-data-analytics-tasks.html"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#naïve-approach-ignorant-of-r"><i class="fa fa-check"></i><b>12.2.1</b> Naïve approach (ignorant of R)</a></li>
<li class="chapter" data-level="12.2.2" data-path="bottlenecks-in-everyday-data-analytics-tasks.html"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#improvement-1-pre-allocation-of-memory"><i class="fa fa-check"></i><b>12.2.2</b> Improvement 1: Pre-allocation of memory</a></li>
<li class="chapter" data-level="12.2.3" data-path="bottlenecks-in-everyday-data-analytics-tasks.html"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#improvement-2-exploit-vectorization"><i class="fa fa-check"></i><b>12.2.3</b> Improvement 2: Exploit vectorization</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="bottlenecks-in-everyday-data-analytics-tasks.html"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#case-study-bootstrapping-and-parallel-processing"><i class="fa fa-check"></i><b>12.3</b> Case study: Bootstrapping and parallel processing</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="bottlenecks-in-everyday-data-analytics-tasks.html"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#parallelization-with-an-ec2-instance-1"><i class="fa fa-check"></i><b>12.3.1</b> Parallelization with an EC2 instance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="econometrics-with-gpus.html"><a href="econometrics-with-gpus.html"><i class="fa fa-check"></i><b>13</b> Econometrics with GPUs</a>
<ul>
<li class="chapter" data-level="13.1" data-path="econometrics-with-gpus.html"><a href="econometrics-with-gpus.html#ols-on-gpus"><i class="fa fa-check"></i><b>13.1</b> OLS on GPUs</a></li>
<li class="chapter" data-level="13.2" data-path="econometrics-with-gpus.html"><a href="econometrics-with-gpus.html#a-word-of-caution"><i class="fa fa-check"></i><b>13.2</b> A word of caution</a></li>
<li class="chapter" data-level="13.3" data-path="econometrics-with-gpus.html"><a href="econometrics-with-gpus.html#higher-level-interfaces-for-basic-econometrics-with-gpus"><i class="fa fa-check"></i><b>13.3</b> Higher-level interfaces for basic econometrics with GPUs</a></li>
<li class="chapter" data-level="13.4" data-path="econometrics-with-gpus.html"><a href="econometrics-with-gpus.html#tensorflowkeras-example-predict-housing-prices"><i class="fa fa-check"></i><b>13.4</b> TensorFlow/Keras example: Predict housing prices</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="econometrics-with-gpus.html"><a href="econometrics-with-gpus.html#data-preparation"><i class="fa fa-check"></i><b>13.4.1</b> Data preparation</a></li>
<li class="chapter" data-level="13.4.2" data-path="econometrics-with-gpus.html"><a href="econometrics-with-gpus.html#model-specification"><i class="fa fa-check"></i><b>13.4.2</b> Model specification</a></li>
<li class="chapter" data-level="13.4.3" data-path="econometrics-with-gpus.html"><a href="econometrics-with-gpus.html#training-and-prediction"><i class="fa fa-check"></i><b>13.4.3</b> Training and prediction</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="econometrics-with-gpus.html"><a href="econometrics-with-gpus.html#wrapping-up-8"><i class="fa fa-check"></i><b>13.5</b> Wrapping up</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html"><i class="fa fa-check"></i><b>14</b> Regression Analysis and Categorization with Spark and R</a>
<ul>
<li class="chapter" data-level="14.1" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#simple-linear-regression-analysis"><i class="fa fa-check"></i><b>14.1</b> Simple linear regression analysis</a></li>
<li class="chapter" data-level="14.2" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#machine-learning-for-classification"><i class="fa fa-check"></i><b>14.2</b> Machine learning for classification</a></li>
<li class="chapter" data-level="14.3" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#building-machine-learning-pipelines-with-r-and-spark"><i class="fa fa-check"></i><b>14.3</b> Building machine learning pipelines with R and Spark</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#set-up-and-data-import"><i class="fa fa-check"></i><b>14.3.1</b> Set up and data import</a></li>
<li class="chapter" data-level="14.3.2" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#building-the-pipeline"><i class="fa fa-check"></i><b>14.3.2</b> Building the pipeline</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="regression-analysis-and-categorization-with-spark-and-r.html"><a href="regression-analysis-and-categorization-with-spark-and-r.html#wrapping-up-9"><i class="fa fa-check"></i><b>14.4</b> Wrapping up</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html"><i class="fa fa-check"></i><b>15</b> Large-scale Text Analysis with sparklyr</a>
<ul>
<li class="chapter" data-level="15.1" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html#getting-started-import-pre-processing-and-word-count"><i class="fa fa-check"></i><b>15.1</b> Getting started: Import, pre-processing, and word count</a></li>
<li class="chapter" data-level="15.2" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html#tutorial-political-slant"><i class="fa fa-check"></i><b>15.2</b> Tutorial: political slant</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html#data-download-and-import"><i class="fa fa-check"></i><b>15.2.1</b> Data download and import</a></li>
<li class="chapter" data-level="15.2.2" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html#cleaning-speeches-data"><i class="fa fa-check"></i><b>15.2.2</b> Cleaning speeches data</a></li>
<li class="chapter" data-level="15.2.3" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html#create-a-bigrams-count-per-party"><i class="fa fa-check"></i><b>15.2.3</b> Create a bigrams count per party</a></li>
<li class="chapter" data-level="15.2.4" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html#find-partisan-phrases"><i class="fa fa-check"></i><b>15.2.4</b> Find “partisan” phrases</a></li>
<li class="chapter" data-level="15.2.5" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html#results-most-partisan-phrases-by-congress"><i class="fa fa-check"></i><b>15.2.5</b> Results: Most partisan phrases by congress</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html#natural-language-processing-at-scale"><i class="fa fa-check"></i><b>15.3</b> Natural Language Processing at Scale</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html#preparatory-steps"><i class="fa fa-check"></i><b>15.3.1</b> Preparatory steps</a></li>
<li class="chapter" data-level="15.3.2" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html#sentiment-annotation"><i class="fa fa-check"></i><b>15.3.2</b> Sentiment annotation</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html#aggregation-and-visualization"><i class="fa fa-check"></i><b>15.4</b> Aggregation and visualization</a></li>
<li class="chapter" data-level="15.5" data-path="large-scale-text-analysis-with-sparklyr.html"><a href="large-scale-text-analysis-with-sparklyr.html#sparklyr-and-lazy-evaluation"><i class="fa fa-check"></i><b>15.5</b> <code>sparklyr</code> and lazy evaluation</a></li>
</ul></li>
<li class="part"><span><b>V Appendices</b></span></li>
<li class="chapter" data-level="" data-path="appendix-a-github.html"><a href="appendix-a-github.html"><i class="fa fa-check"></i>Appendix A: GitHub</a>
<ul>
<li class="chapter" data-level="" data-path="appendix-a-github.html"><a href="appendix-a-github.html#initiate-a-new-repository"><i class="fa fa-check"></i>Initiate a new repository</a></li>
<li class="chapter" data-level="" data-path="appendix-a-github.html"><a href="appendix-a-github.html#clone-this-books-repository"><i class="fa fa-check"></i>Clone this book’s repository</a></li>
<li class="chapter" data-level="" data-path="appendix-a-github.html"><a href="appendix-a-github.html#fork-this-books-repository"><i class="fa fa-check"></i>Fork this book’s repository</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-b-r-basics.html"><a href="appendix-b-r-basics.html"><i class="fa fa-check"></i>Appendix B: R Basics</a>
<ul>
<li class="chapter" data-level="" data-path="appendix-b-r-basics.html"><a href="appendix-b-r-basics.html#data-types-and-memorystorage"><i class="fa fa-check"></i>Data types and memory/storage</a>
<ul>
<li class="chapter" data-level="" data-path="appendix-b-r-basics.html"><a href="appendix-b-r-basics.html#example-data-types-and-information-storage"><i class="fa fa-check"></i>Example: Data types and information storage</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-b-r-basics.html"><a href="appendix-b-r-basics.html#data-structures"><i class="fa fa-check"></i>Data structures</a>
<ul>
<li class="chapter" data-level="" data-path="appendix-b-r-basics.html"><a href="appendix-b-r-basics.html#vectors-vs.-factors-in-r"><i class="fa fa-check"></i>Vectors vs. Factors in R</a></li>
<li class="chapter" data-level="" data-path="appendix-b-r-basics.html"><a href="appendix-b-r-basics.html#matricesarrays"><i class="fa fa-check"></i>Matrices/Arrays</a></li>
<li class="chapter" data-level="" data-path="appendix-b-r-basics.html"><a href="appendix-b-r-basics.html#data-frames-tibbles-and-data-tables"><i class="fa fa-check"></i>Data frames, tibbles, and data tables</a></li>
<li class="chapter" data-level="" data-path="appendix-b-r-basics.html"><a href="appendix-b-r-basics.html#lists"><i class="fa fa-check"></i>Lists</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-b-r-basics.html"><a href="appendix-b-r-basics.html#r-tools-to-investigate-structures-and-types"><i class="fa fa-check"></i>R-tools to investigate structures and types</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-c-install-hadoop.html"><a href="appendix-c-install-hadoop.html"><i class="fa fa-check"></i>Appendix C: Install Hadoop</a></li>
<li class="part"><span><b>VI References and Index</b></span></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://umatter.github.io" target="blank">umatter.github.io</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Big Data Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bottlenecks-in-everyday-data-analytics-tasks" class="section level1 hasAnchor" number="12">
<h1><span class="header-section-number">Chapter 12</span> Bottlenecks in Everyday Data Analytics Tasks<a href="bottlenecks-in-everyday-data-analytics-tasks.html#bottlenecks-in-everyday-data-analytics-tasks" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This chapter presents three examples of how the lessons from the previous chapters could be applied in everyday data analytics tasks. The first section focuses on the statistics perspective: compute something in a different way (with a different algorithm) but end up with essentially the same result. It is also an illustration of how diverse the already implemented solutions for working with large data in applied econometrics in the R-universe are, and how it makes sense to first look into a more efficient algorithm/statistical procedure than directly use specialized packages such as <code>bigmemory</code> or even scale up in the cloud. The second section is a reminder (in an extremely simple setting) of how we can use R more efficiently when taking basic R characteristics into consideration. It is an example and detailed illustration of how adapting a few simple coding habits with basic R can substantially improve the efficiency of your code for larger workloads. Finally, the third section in this chapter re-visits the topics of scaling up both locally and in the cloud.</p>
<div id="case-study-efficient-fixed-effects-estimation" class="section level2 hasAnchor" number="12.1">
<h2><span class="header-section-number">12.1</span> Case study: Efficient fixed effects estimation<a href="bottlenecks-in-everyday-data-analytics-tasks.html#case-study-efficient-fixed-effects-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this case study we look into a very common computational problem in applied econometrics: estimation of a fixed effects model with various fixed-effects units (i.e., many intercepts). The aim of this case study is to give an illustration of how a specific statistical procedure can help us reduce the computational burden substantially (here, by reducing the number of columns in the model matrix and therefore the burden of computing the inverse of a huge model matrix). The context of this tutorial builds on a study called <a href="https://www.aeaweb.org/articles?id=10.1257/pol.6.3.63">“Friends in High Places”</a> by <span class="citation">Cohen and Malloy (<a href="#ref-cohen_malloy" role="doc-biblioref">2014</a>)</span>. Cohen and Malloy show that US Senators who are alumni of the same university/college tend to help each other out in votes on industrial policies if the corresponding policy is highly relevant for the state of one senator but not relevant for the state of the other senator. The data is provided along with the published article and can be accessed here: <a href="http://doi.org/10.3886/E114873V1">http://doi.org/10.3886/E114873V1</a>. The data (and code) is provided in STATA format. We can import the main dataset with the <code>foreign</code> package <span class="citation">(<a href="#ref-foreign" role="doc-biblioref">R Core Team 2022</a>)</span>. For data handling we load the <code>data.table</code> package and for hypotheses tests we load the <code>lmtest</code> package <span class="citation">(<a href="#ref-lmtest" role="doc-biblioref">Zeileis and Hothorn 2002</a>)</span>.</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SET UP ------------------</span></span>
<span id="cb452-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb452-2" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb452-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb452-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreign)</span>
<span id="cb452-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb452-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb452-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb452-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb452-6"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb452-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fix vars</span></span>
<span id="cb452-7"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb452-7" aria-hidden="true" tabindex="-1"></a>DATA_PATH <span class="ot">&lt;-</span> <span class="st">&quot;data/data_for_tables.dta&quot;</span></span>
<span id="cb452-8"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb452-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-9"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb452-9" aria-hidden="true" tabindex="-1"></a><span class="co"># import data</span></span>
<span id="cb452-10"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb452-10" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(<span class="fu">read.dta</span>(DATA_PATH))</span>
<span id="cb452-11"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb452-11" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only clean obs</span></span>
<span id="cb452-12"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb452-12" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> cm[<span class="sc">!</span>(<span class="fu">is.na</span>(yes)</span>
<span id="cb452-13"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb452-13" aria-hidden="true" tabindex="-1"></a>           <span class="sc">|</span><span class="fu">is.na</span>(pctsumyessameparty)</span>
<span id="cb452-14"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb452-14" aria-hidden="true" tabindex="-1"></a>           <span class="sc">|</span><span class="fu">is.na</span>(pctsumyessameschool)</span>
<span id="cb452-15"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb452-15" aria-hidden="true" tabindex="-1"></a>           <span class="sc">|</span><span class="fu">is.na</span>(pctsumyessamestate))] </span></code></pre></div>
<p>As part of this case study, we will replicate parts of Table 3 of the main article (p. 73). Specifically, we will estimate specifications (1) and (2). In both specifications, the dependent variable is an indicator <code>yes</code> that is equal to 1 if the corresponding senator voted Yes on the given bill and 0 otherwise. The main explanatory variables of interest are <code>pctsumyessameschool</code> (the percentage of senators from the same school as the corresponding senator who voted Yes on the given bill), <code>pctsumyessamestate</code> (the percentage of senators from the same state as the corresponding senator who voted Yes on the given bill), and <code>pctsumyessameparty</code> (the percentage of senators from the same party as the corresponding senator who voted Yes on the given bill). Specification 1 accounts for congress (time) fixed effects and senator (individual) fixed effects, and specification 2 accounts for congress-session-vote fixed effects and senator fixed effects.</p>
<p>First, let us look at a very simple example to highlight where the computational burden in the estimation of such specifications is coming from. In terms of the regression model 1, the fixed effect specification means that we introduce an indicator variable (an intercept) for <span class="math inline">\(N-1\)</span> senators and <span class="math inline">\(M-1\)</span> congresses. That is, the simple model matrix (<span class="math inline">\(X\)</span>) without accounting for fixed effects has dimensions <span class="math inline">\(425653\times4\)</span>.</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pooled model (no FE)</span></span>
<span id="cb453-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb453-2" aria-hidden="true" tabindex="-1"></a>model0 <span class="ot">&lt;-</span>   yes <span class="sc">~</span> </span>
<span id="cb453-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb453-3" aria-hidden="true" tabindex="-1"></a>  pctsumyessameschool <span class="sc">+</span> </span>
<span id="cb453-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb453-4" aria-hidden="true" tabindex="-1"></a>  pctsumyessamestate <span class="sc">+</span> </span>
<span id="cb453-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb453-5" aria-hidden="true" tabindex="-1"></a>  pctsumyessameparty </span>
<span id="cb453-6"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb453-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-7"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb453-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(<span class="fu">model.matrix</span>(model0, <span class="at">data=</span>cm))</span></code></pre></div>
<pre><code>## [1] 425653      4</code></pre>
<p>In contrast, the model matrix of specification (1) is of dimensions <span class="math inline">\(425653\times221\)</span>, and the model matrix of specification (2) even of <span class="math inline">\(425653\times6929\)</span>.</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb455-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> </span>
<span id="cb455-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb455-2" aria-hidden="true" tabindex="-1"></a>  yes <span class="sc">~</span> pctsumyessameschool <span class="sc">+</span> </span>
<span id="cb455-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb455-3" aria-hidden="true" tabindex="-1"></a>        pctsumyessamestate <span class="sc">+</span> </span>
<span id="cb455-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb455-4" aria-hidden="true" tabindex="-1"></a>        pctsumyessameparty <span class="sc">+</span> </span>
<span id="cb455-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb455-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">factor</span>(congress) <span class="sc">+</span></span>
<span id="cb455-6"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb455-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">factor</span>(id) <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb455-7"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb455-7" aria-hidden="true" tabindex="-1"></a>mm1 <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(model1, <span class="at">data=</span>cm)</span>
<span id="cb455-8"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb455-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(mm1)</span></code></pre></div>
<pre><code>## [1] 425653    168</code></pre>
<p>Using OLS to estimate such a model thus involves the computation of a very large matrix inversion (because <span class="math inline">\(\hat{\beta}_{OLS} = (\mathbf{X}^\intercal\mathbf{X})^{-1}\mathbf{X}^{\intercal}\mathbf{y}\)</span>). In addition, the model matrix for specification 2 is about 22GB, which might further slow down the computer due to a lack of physical memory or even crash the R session altogether.</p>
<!-- ```{r} -->
<!-- as.numeric(object.size(mm2))*9.31e-10 -->
<!-- ``` -->
<p>In order to set a point of reference, we first estimate specification (1) with standard OLS.</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit specification (1)</span></span>
<span id="cb457-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb457-2" aria-hidden="true" tabindex="-1"></a>runtime <span class="ot">&lt;-</span> <span class="fu">system.time</span>(fit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> cm, <span class="at">formula =</span> model1))</span>
<span id="cb457-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb457-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(fit1)[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>,]</span></code></pre></div>
<pre><code>##                     Estimate Std. Error t value
## pctsumyessamestate   0.11861   0.001085 109.275
## pctsumyessameparty   0.92640   0.001397 662.910
## factor(congress)101 -0.01458   0.006429  -2.269
##                     Pr(&gt;|t|)
## pctsumyessamestate    0.0000
## pctsumyessameparty    0.0000
## factor(congress)101   0.0233</code></pre>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="co"># median amount of time needed for estimation</span></span>
<span id="cb459-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb459-2" aria-hidden="true" tabindex="-1"></a>runtime[<span class="dv">3</span>]</span></code></pre></div>
<pre><code>## elapsed 
##   6.486</code></pre>
<p>As expected, this takes quite some time to compute. However, there is an alternative approach to estimating such models that substantially reduces the computational burden by “sweeping out the fixed effects dummies”. In the simple case of only one fixed effect variable (e.g., only individual fixed effects), the trick is called “within transformation” or “demeaning” and is quite simple to implement. For each of the categories in the fixed effect variable, compute the mean of the covariate and subtract the mean from the covariate’s value.</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="co"># illustration of within transformation for the senator fixed effects</span></span>
<span id="cb461-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-2" aria-hidden="true" tabindex="-1"></a>cm_within <span class="ot">&lt;-</span> </span>
<span id="cb461-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(cm, <span class="fu">data.table</span>(<span class="at">yes =</span> yes <span class="sc">-</span> <span class="fu">ave</span>(yes, id),</span>
<span id="cb461-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pctsumyessameschool =</span> pctsumyessameschool <span class="sc">-</span></span>
<span id="cb461-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-5" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ave</span>(pctsumyessameschool, id),</span>
<span id="cb461-6"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pctsumyessamestate =</span> pctsumyessamestate <span class="sc">-</span></span>
<span id="cb461-7"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-7" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ave</span>(pctsumyessamestate, id),</span>
<span id="cb461-8"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pctsumyessameparty =</span> pctsumyessameparty <span class="sc">-</span></span>
<span id="cb461-9"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-9" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ave</span>(pctsumyessameparty, id)</span>
<span id="cb461-10"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-10" aria-hidden="true" tabindex="-1"></a>                      ))</span>
<span id="cb461-11"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-12"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-12" aria-hidden="true" tabindex="-1"></a><span class="co"># comparison of dummy fixed effects estimator and within estimator</span></span>
<span id="cb461-13"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-13" aria-hidden="true" tabindex="-1"></a>dummy_time <span class="ot">&lt;-</span> <span class="fu">system.time</span>(fit_dummy <span class="ot">&lt;-</span> </span>
<span id="cb461-14"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-14" aria-hidden="true" tabindex="-1"></a>              <span class="fu">lm</span>(yes <span class="sc">~</span> pctsumyessameschool <span class="sc">+</span> </span>
<span id="cb461-15"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-15" aria-hidden="true" tabindex="-1"></a>                       pctsumyessamestate <span class="sc">+</span></span>
<span id="cb461-16"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-16" aria-hidden="true" tabindex="-1"></a>                       pctsumyessameparty <span class="sc">+</span> </span>
<span id="cb461-17"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-17" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">factor</span>(id) <span class="sc">-</span><span class="dv">1</span>, <span class="at">data =</span> cm</span>
<span id="cb461-18"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-18" aria-hidden="true" tabindex="-1"></a>                         ))</span>
<span id="cb461-19"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-19" aria-hidden="true" tabindex="-1"></a>within_time <span class="ot">&lt;-</span> <span class="fu">system.time</span>(fit_within <span class="ot">&lt;-</span> </span>
<span id="cb461-20"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-20" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">lm</span>(yes <span class="sc">~</span> pctsumyessameschool <span class="sc">+</span></span>
<span id="cb461-21"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-21" aria-hidden="true" tabindex="-1"></a>                                      pctsumyessamestate <span class="sc">+</span> </span>
<span id="cb461-22"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-22" aria-hidden="true" tabindex="-1"></a>                                      pctsumyessameparty <span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb461-23"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-23" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">data =</span> cm_within))</span>
<span id="cb461-24"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-24" aria-hidden="true" tabindex="-1"></a><span class="co"># computation time comparison</span></span>
<span id="cb461-25"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb461-25" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(within_time[<span class="dv">3</span>])<span class="sc">/</span><span class="fu">as.numeric</span>(dummy_time[<span class="dv">3</span>])</span></code></pre></div>
<pre><code>## [1] 0.009609</code></pre>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb463-1" aria-hidden="true" tabindex="-1"></a><span class="co"># comparison of estimates</span></span>
<span id="cb463-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb463-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(fit_dummy)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]</span></code></pre></div>
<pre><code>##                     Estimate Std. Error t value
## pctsumyessameschool  0.04424   0.001352   32.73
## pctsumyessamestate   0.11864   0.001085  109.30
## pctsumyessameparty   0.92615   0.001397  662.93
##                       Pr(&gt;|t|)
## pctsumyessameschool 1.205e-234
## pctsumyessamestate   0.000e+00
## pctsumyessameparty   0.000e+00</code></pre>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(fit_within)</span></code></pre></div>
<pre><code>## 
## t test of coefficients:
## 
##                     Estimate Std. Error t value
## pctsumyessameschool  0.04424    0.00135    32.7
## pctsumyessamestate   0.11864    0.00109   109.3
## pctsumyessameparty   0.92615    0.00140   663.0
##                     Pr(&gt;|t|)    
## pctsumyessameschool   &lt;2e-16 ***
## pctsumyessamestate    &lt;2e-16 ***
## pctsumyessameparty    &lt;2e-16 ***
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Unfortunately, we cannot simply apply the same procedure in a specification with several fixed effects variables. However, <span class="citation">Gaure (<a href="#ref-GAURE20138" role="doc-biblioref">2013b</a>)</span> provides a generalization of the linear within-estimator to several fixed effects variables. This method is implemented in the <code>lfe</code> package <span class="citation">(<a href="#ref-gaure_2013" role="doc-biblioref">Gaure 2013a</a>)</span>. With this package, we can easily estimate both fixed-effect specifications (as well as the corresponding cluster-robust standard errors) in order to replicate the original results by <span class="citation">Cohen and Malloy (<a href="#ref-cohen_malloy" role="doc-biblioref">2014</a>)</span>.</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lfe)</span>
<span id="cb467-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb467-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb467-3" aria-hidden="true" tabindex="-1"></a><span class="co"># model and clustered SE specifications</span></span>
<span id="cb467-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb467-4" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> yes <span class="sc">~</span> pctsumyessameschool <span class="sc">+</span> </span>
<span id="cb467-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb467-5" aria-hidden="true" tabindex="-1"></a>                pctsumyessamestate <span class="sc">+</span> </span>
<span id="cb467-6"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb467-6" aria-hidden="true" tabindex="-1"></a>                pctsumyessameparty <span class="sc">|</span>congress<span class="sc">+</span>id<span class="sc">|</span><span class="dv">0</span><span class="sc">|</span>id</span>
<span id="cb467-7"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb467-7" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> yes <span class="sc">~</span> pctsumyessameschool <span class="sc">+</span> </span>
<span id="cb467-8"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb467-8" aria-hidden="true" tabindex="-1"></a>                pctsumyessamestate <span class="sc">+</span> </span>
<span id="cb467-9"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb467-9" aria-hidden="true" tabindex="-1"></a>                pctsumyessameparty <span class="sc">|</span>congress_session_votenumber<span class="sc">+</span>id<span class="sc">|</span><span class="dv">0</span><span class="sc">|</span>id</span>
<span id="cb467-10"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb467-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-11"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb467-11" aria-hidden="true" tabindex="-1"></a><span class="co"># estimation</span></span>
<span id="cb467-12"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb467-12" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">felm</span>(model1, <span class="at">data=</span>cm)</span>
<span id="cb467-13"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb467-13" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">felm</span>(model2, <span class="at">data=</span>cm)</span></code></pre></div>
<p>Finally we can display the regression table.</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb468-1" aria-hidden="true" tabindex="-1"></a>stargazer<span class="sc">::</span><span class="fu">stargazer</span>(fit1,fit2,</span>
<span id="cb468-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb468-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">type=</span><span class="st">&quot;text&quot;</span>,</span>
<span id="cb468-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb468-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dep.var.labels =</span> <span class="st">&quot;Vote (yes/no)&quot;</span>,</span>
<span id="cb468-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb468-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">covariate.labels =</span> <span class="fu">c</span>(<span class="st">&quot;School Connected Votes&quot;</span>,</span>
<span id="cb468-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb468-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;State Votes&quot;</span>,</span>
<span id="cb468-6"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb468-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&quot;Party Votes&quot;</span>),</span>
<span id="cb468-7"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb468-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">keep.stat =</span> <span class="fu">c</span>(<span class="st">&quot;adj.rsq&quot;</span>, <span class="st">&quot;n&quot;</span>))</span></code></pre></div>
<pre><code>## 
## ===================================================
##                            Dependent variable:     
##                        ----------------------------
##                               Vote (yes/no)        
##                             (1)            (2)     
## ---------------------------------------------------
## School Connected Votes    0.045***      0.052***   
##                           (0.016)        (0.016)   
##                                                    
## State Votes               0.119***      0.122***   
##                           (0.013)        (0.012)   
##                                                    
## Party Votes               0.926***      0.945***   
##                           (0.022)        (0.024)   
##                                                    
## ---------------------------------------------------
## Observations              425,653        425,653   
## Adjusted R2                0.641          0.641    
## ===================================================
## Note:                   *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
<div id="case-study-loops-memory-and-vectorization" class="section level2 hasAnchor" number="12.2">
<h2><span class="header-section-number">12.2</span> Case study: Loops, memory, and vectorization<a href="bottlenecks-in-everyday-data-analytics-tasks.html#case-study-loops-memory-and-vectorization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We first read the <code>economics</code> dataset into R and extend it by duplicating its rows to get a slightly larger dataset (this step can easily be adapted to create a very large dataset).</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read dataset into R</span></span>
<span id="cb470-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb470-2" aria-hidden="true" tabindex="-1"></a>economics <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/economics.csv&quot;</span>)</span>
<span id="cb470-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb470-3" aria-hidden="true" tabindex="-1"></a><span class="co"># have a look at the data</span></span>
<span id="cb470-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb470-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(economics, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##         date   pce    pop psavert uempmed unemploy
## 1 1967-07-01 507.4 198712    12.5     4.5     2944
## 2 1967-08-01 510.5 198911    12.5     4.7     2945</code></pre>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a &#39;large&#39; dataset out of this</span></span>
<span id="cb472-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb472-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb472-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb472-3" aria-hidden="true" tabindex="-1"></a>     economics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(economics, economics)</span>
<span id="cb472-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb472-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb472-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb472-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(economics)</span></code></pre></div>
<pre><code>## [1] 4592    6</code></pre>
<p>The goal of this code example is to compute real personal consumption expenditures, assuming that <code>pce</code> in the <code>economics</code> dataset provides nominal personal consumption expenditures. Thus, we divide each value in the vector <code>pce</code> by a deflator <code>1.05</code>.</p>
<div id="naïve-approach-ignorant-of-r" class="section level3 hasAnchor" number="12.2.1">
<h3><span class="header-section-number">12.2.1</span> Naïve approach (ignorant of R)<a href="bottlenecks-in-everyday-data-analytics-tasks.html#naïve-approach-ignorant-of-r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The first approach we take is based on a simple <code>for</code> loop. In each iteration one element in <code>pce</code> is divided by the <code>deflator</code>, and the resulting value is stored as a new element in the vector <code>pce_real</code>.</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Naïve approach (ignorant of R)</span></span>
<span id="cb474-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb474-2" aria-hidden="true" tabindex="-1"></a>deflator <span class="ot">&lt;-</span> <span class="fl">1.05</span> <span class="co"># define deflator</span></span>
<span id="cb474-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb474-3" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate through each observation</span></span>
<span id="cb474-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb474-4" aria-hidden="true" tabindex="-1"></a>pce_real <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb474-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb474-5" aria-hidden="true" tabindex="-1"></a>n_obs <span class="ot">&lt;-</span> <span class="fu">length</span>(economics<span class="sc">$</span>pce)</span>
<span id="cb474-6"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb474-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_obs) {</span>
<span id="cb474-7"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb474-7" aria-hidden="true" tabindex="-1"></a>  pce_real <span class="ot">&lt;-</span> <span class="fu">c</span>(pce_real, economics<span class="sc">$</span>pce[i]<span class="sc">/</span>deflator)</span>
<span id="cb474-8"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb474-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb474-9"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb474-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-10"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb474-10" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the result</span></span>
<span id="cb474-11"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb474-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pce_real, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 483.2 486.2</code></pre>
<p>How long does it take?</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Naïve approach (ignorant of R)</span></span>
<span id="cb476-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb476-2" aria-hidden="true" tabindex="-1"></a>deflator <span class="ot">&lt;-</span> <span class="fl">1.05</span> <span class="co"># define deflator</span></span>
<span id="cb476-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb476-3" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate through each observation</span></span>
<span id="cb476-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb476-4" aria-hidden="true" tabindex="-1"></a>pce_real <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb476-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb476-5" aria-hidden="true" tabindex="-1"></a>n_obs <span class="ot">&lt;-</span> <span class="fu">length</span>(economics<span class="sc">$</span>pce)</span>
<span id="cb476-6"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb476-6" aria-hidden="true" tabindex="-1"></a>time_elapsed <span class="ot">&lt;-</span></span>
<span id="cb476-7"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb476-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">system.time</span>(</span>
<span id="cb476-8"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb476-8" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_obs) {</span>
<span id="cb476-9"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb476-9" aria-hidden="true" tabindex="-1"></a>              pce_real <span class="ot">&lt;-</span> <span class="fu">c</span>(pce_real, economics<span class="sc">$</span>pce[i]<span class="sc">/</span>deflator)</span>
<span id="cb476-10"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb476-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb476-11"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb476-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb476-12"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb476-12" aria-hidden="true" tabindex="-1"></a>time_elapsed</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.108   0.000   0.110</code></pre>
<p>Assuming a linear time algorithm (<span class="math inline">\(O(n)\)</span>), we need that much time for one additional row of data:</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb478-1" aria-hidden="true" tabindex="-1"></a>time_per_row <span class="ot">&lt;-</span> time_elapsed[<span class="dv">3</span>]<span class="sc">/</span>n_obs</span>
<span id="cb478-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb478-2" aria-hidden="true" tabindex="-1"></a>time_per_row</span></code></pre></div>
<pre><code>##   elapsed 
## 2.395e-05</code></pre>
<p>If we are dealing with Big Data, say 100 million rows, that is</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in seconds</span></span>
<span id="cb480-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb480-2" aria-hidden="true" tabindex="-1"></a>(time_per_row<span class="sc">*</span><span class="dv">100</span><span class="sc">^</span><span class="dv">4</span>) </span></code></pre></div>
<pre><code>## elapsed 
##    2395</code></pre>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in minutes</span></span>
<span id="cb482-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb482-2" aria-hidden="true" tabindex="-1"></a>(time_per_row<span class="sc">*</span><span class="dv">100</span><span class="sc">^</span><span class="dv">4</span>)<span class="sc">/</span><span class="dv">60</span> </span></code></pre></div>
<pre><code>## elapsed 
##   39.92</code></pre>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in hours</span></span>
<span id="cb484-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb484-2" aria-hidden="true" tabindex="-1"></a>(time_per_row<span class="sc">*</span><span class="dv">100</span><span class="sc">^</span><span class="dv">4</span>)<span class="sc">/</span><span class="dv">60</span><span class="sc">^</span><span class="dv">2</span> </span></code></pre></div>
<pre><code>## elapsed 
##  0.6654</code></pre>
<p>Can we improve this?</p>
</div>
<div id="improvement-1-pre-allocation-of-memory" class="section level3 hasAnchor" number="12.2.2">
<h3><span class="header-section-number">12.2.2</span> Improvement 1: Pre-allocation of memory<a href="bottlenecks-in-everyday-data-analytics-tasks.html#improvement-1-pre-allocation-of-memory" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the naïve approach taken above, each iteration of the loop causes R to re-allocate memory because the number of elements in the vector <code>pce_element</code> is changing. In simple terms, this means that R needs to execute more steps in each iteration. We can improve this with a simple trick by initiating the vector to the right size to begin with (filled with <code>NA</code> values).</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Improve memory allocation (still somewhat ignorant of R)</span></span>
<span id="cb486-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb486-2" aria-hidden="true" tabindex="-1"></a>deflator <span class="ot">&lt;-</span> <span class="fl">1.05</span> <span class="co"># define deflator</span></span>
<span id="cb486-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb486-3" aria-hidden="true" tabindex="-1"></a>n_obs <span class="ot">&lt;-</span> <span class="fu">length</span>(economics<span class="sc">$</span>pce)</span>
<span id="cb486-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb486-4" aria-hidden="true" tabindex="-1"></a><span class="co"># allocate memory beforehand</span></span>
<span id="cb486-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb486-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the vector to the right size</span></span>
<span id="cb486-6"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb486-6" aria-hidden="true" tabindex="-1"></a>pce_real <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_obs)</span>
<span id="cb486-7"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb486-7" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate through each observation</span></span>
<span id="cb486-8"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb486-8" aria-hidden="true" tabindex="-1"></a>time_elapsed <span class="ot">&lt;-</span></span>
<span id="cb486-9"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb486-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">system.time</span>(</span>
<span id="cb486-10"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb486-10" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_obs) {</span>
<span id="cb486-11"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb486-11" aria-hidden="true" tabindex="-1"></a>              pce_real[i] <span class="ot">&lt;-</span> economics<span class="sc">$</span>pce[i]<span class="sc">/</span>deflator</span>
<span id="cb486-12"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb486-12" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>Let’s see if this helped to make the code faster.</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb487-1" aria-hidden="true" tabindex="-1"></a>time_per_row <span class="ot">&lt;-</span> time_elapsed[<span class="dv">3</span>]<span class="sc">/</span>n_obs</span>
<span id="cb487-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb487-2" aria-hidden="true" tabindex="-1"></a>time_per_row</span></code></pre></div>
<pre><code>##   elapsed 
## 2.178e-06</code></pre>
<p>Again, we can extrapolate (approximately) the computation time, assuming the dataset had millions of rows.</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in seconds</span></span>
<span id="cb489-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb489-2" aria-hidden="true" tabindex="-1"></a>(time_per_row<span class="sc">*</span><span class="dv">100</span><span class="sc">^</span><span class="dv">4</span>) </span></code></pre></div>
<pre><code>## elapsed 
##   217.8</code></pre>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in minutes</span></span>
<span id="cb491-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb491-2" aria-hidden="true" tabindex="-1"></a>(time_per_row<span class="sc">*</span><span class="dv">100</span><span class="sc">^</span><span class="dv">4</span>)<span class="sc">/</span><span class="dv">60</span> </span></code></pre></div>
<pre><code>## elapsed 
##    3.63</code></pre>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in hours</span></span>
<span id="cb493-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb493-2" aria-hidden="true" tabindex="-1"></a>(time_per_row<span class="sc">*</span><span class="dv">100</span><span class="sc">^</span><span class="dv">4</span>)<span class="sc">/</span><span class="dv">60</span><span class="sc">^</span><span class="dv">2</span> </span></code></pre></div>
<pre><code>## elapsed 
## 0.06049</code></pre>
<p>This looks much better, but we can do even better.</p>
</div>
<div id="improvement-2-exploit-vectorization" class="section level3 hasAnchor" number="12.2.3">
<h3><span class="header-section-number">12.2.3</span> Improvement 2: Exploit vectorization<a href="bottlenecks-in-everyday-data-analytics-tasks.html#improvement-2-exploit-vectorization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
In this approach, we exploit the fact that in R, ‘everything is a vector’ and that many of the basic R functions (such as math operators) are <em>vectorized</em>. In simple terms, this means that a vectorized operation is implemented in such a way that it can take advantage of the similarity of each of the vector’s elements. That is, R only has to figure out once how to apply a given function to a vector element in order to apply it to all elements of the vector. In a simple loop, R has to go through the same ‘preparatory’ steps again and again in each iteration; this is time-intensive.</p>
<p>In this example, we specifically exploit that the division operator <code>/</code> is actually a vectorized function. Thus, the division by our <code>deflator</code> is applied to each element of <code>economics$pce</code>.</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Do it &#39;the R way&#39;</span></span>
<span id="cb495-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb495-2" aria-hidden="true" tabindex="-1"></a>deflator <span class="ot">&lt;-</span> <span class="fl">1.05</span> <span class="co"># define deflator</span></span>
<span id="cb495-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb495-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Exploit R&#39;s vectorization</span></span>
<span id="cb495-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb495-4" aria-hidden="true" tabindex="-1"></a>time_elapsed <span class="ot">&lt;-</span> </span>
<span id="cb495-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb495-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">system.time</span>(</span>
<span id="cb495-6"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb495-6" aria-hidden="true" tabindex="-1"></a>     pce_real <span class="ot">&lt;-</span> economics<span class="sc">$</span>pce<span class="sc">/</span>deflator</span>
<span id="cb495-7"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb495-7" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb495-8"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb495-8" aria-hidden="true" tabindex="-1"></a><span class="co"># same result</span></span>
<span id="cb495-9"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb495-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pce_real, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 483.2 486.2</code></pre>
<p>Now this is much faster. In fact, <code>system.time()</code> is not precise enough to capture the time elapsed. In order to measure the improvement, we use <code>microbenchmark::microbenchmark()</code> to measure the elapsed time in microseconds (millionth of a second).</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(microbenchmark)</span>
<span id="cb497-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb497-2" aria-hidden="true" tabindex="-1"></a><span class="co"># measure elapsed time in microseconds (avg.)</span></span>
<span id="cb497-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb497-3" aria-hidden="true" tabindex="-1"></a>time_elapsed <span class="ot">&lt;-</span> </span>
<span id="cb497-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb497-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(<span class="fu">microbenchmark</span>(pce_real <span class="ot">&lt;-</span> economics<span class="sc">$</span>pce<span class="sc">/</span>deflator))<span class="sc">$</span>mean</span>
<span id="cb497-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb497-5" aria-hidden="true" tabindex="-1"></a><span class="co"># per row (in sec)</span></span>
<span id="cb497-6"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb497-6" aria-hidden="true" tabindex="-1"></a>time_per_row <span class="ot">&lt;-</span> (time_elapsed<span class="sc">/</span>n_obs)<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span></span></code></pre></div>
<p>Now we get a more precise picture regarding the improvement due to vectorization:</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in seconds</span></span>
<span id="cb498-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb498-2" aria-hidden="true" tabindex="-1"></a>(time_per_row<span class="sc">*</span><span class="dv">100</span><span class="sc">^</span><span class="dv">4</span>) </span></code></pre></div>
<pre><code>## [1] 0.1868</code></pre>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb500-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in minutes</span></span>
<span id="cb500-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb500-2" aria-hidden="true" tabindex="-1"></a>(time_per_row<span class="sc">*</span><span class="dv">100</span><span class="sc">^</span><span class="dv">4</span>)<span class="sc">/</span><span class="dv">60</span> </span></code></pre></div>
<pre><code>## [1] 0.003113</code></pre>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb502-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in hours</span></span>
<span id="cb502-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb502-2" aria-hidden="true" tabindex="-1"></a>(time_per_row<span class="sc">*</span><span class="dv">100</span><span class="sc">^</span><span class="dv">4</span>)<span class="sc">/</span><span class="dv">60</span><span class="sc">^</span><span class="dv">2</span> </span></code></pre></div>
<pre><code>## [1] 5.189e-05</code></pre>
</div>
</div>
<div id="case-study-bootstrapping-and-parallel-processing" class="section level2 hasAnchor" number="12.3">
<h2><span class="header-section-number">12.3</span> Case study: Bootstrapping and parallel processing<a href="bottlenecks-in-everyday-data-analytics-tasks.html#case-study-bootstrapping-and-parallel-processing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this example, we estimate a simple regression model that aims to assess racial discrimination in the context of police stops.<a href="#fn66" class="footnote-ref" id="fnref66"><sup>66</sup></a> The example is based on the ‘Minneapolis Police Department 2017 Stop Dataset’, containing data on nearly all stops made by the Minneapolis Police Department for the year 2017.</p>
<p>We start by importing the data into R.</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb504-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span></span>
<span id="cb504-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb504-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;https://vincentarelbundock.github.io/Rdatasets/csv/carData/MplsStops.csv&quot;</span></span>
<span id="cb504-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb504-3" aria-hidden="true" tabindex="-1"></a>stopdata <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(url) </span></code></pre></div>
<p>We specify a simple linear probability model that aims to test whether a person identified as ‘white’ is less likely to have their vehicle searched when stopped by the police. In order to take into account level differences between different police precincts, we add precinct indicators to the regression specification.</p>
<p>First, let’s remove observations with missing entries (<code>NA</code>) and code our main explanatory variable and the dependent variable.</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove incomplete obs</span></span>
<span id="cb505-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb505-2" aria-hidden="true" tabindex="-1"></a>stopdata <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(stopdata)</span>
<span id="cb505-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb505-3" aria-hidden="true" tabindex="-1"></a><span class="co"># code dependent var</span></span>
<span id="cb505-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb505-4" aria-hidden="true" tabindex="-1"></a>stopdata<span class="sc">$</span>vsearch <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb505-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb505-5" aria-hidden="true" tabindex="-1"></a>stopdata<span class="sc">$</span>vsearch[stopdata<span class="sc">$</span>vehicleSearch<span class="sc">==</span><span class="st">&quot;YES&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb505-6"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb505-6" aria-hidden="true" tabindex="-1"></a><span class="co"># code explanatory var</span></span>
<span id="cb505-7"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb505-7" aria-hidden="true" tabindex="-1"></a>stopdata<span class="sc">$</span>white <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb505-8"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb505-8" aria-hidden="true" tabindex="-1"></a>stopdata<span class="sc">$</span>white[stopdata<span class="sc">$</span>race<span class="sc">==</span><span class="st">&quot;White&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
<p>We specify our baseline model as follows.</p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb506-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> vsearch <span class="sc">~</span> white <span class="sc">+</span> <span class="fu">factor</span>(policePrecinct)</span></code></pre></div>
<p>and estimate the linear probability model via OLS (the <code>lm</code> function).</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb507-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(model, stopdata)</span>
<span id="cb507-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb507-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = model, data = stopdata)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -0.1394 -0.0633 -0.0547 -0.0423  0.9773 
## 
## Coefficients:
##                         Estimate Std. Error t value
## (Intercept)              0.05473    0.00515   10.62
## white                   -0.01955    0.00446   -4.38
## factor(policePrecinct)2  0.00856    0.00676    1.27
## factor(policePrecinct)3  0.00341    0.00648    0.53
## factor(policePrecinct)4  0.08464    0.00623   13.58
## factor(policePrecinct)5 -0.01246    0.00637   -1.96
##                         Pr(&gt;|t|)    
## (Intercept)              &lt; 2e-16 ***
## white                    1.2e-05 ***
## factor(policePrecinct)2     0.21    
## factor(policePrecinct)3     0.60    
## factor(policePrecinct)4  &lt; 2e-16 ***
## factor(policePrecinct)5     0.05 .  
## ---
## Signif. codes:  
## 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.254 on 19078 degrees of freedom
## Multiple R-squared:  0.025,  Adjusted R-squared:  0.0248 
## F-statistic: 97.9 on 5 and 19078 DF,  p-value: &lt;2e-16</code></pre>
<p>A potential problem with this approach (and there might be many more in this simple example) is that observations stemming from different police precincts might be correlated over time. If that is the case, we likely underestimate the coefficient’s standard errors. There is a standard approach to computing estimates for so-called <em>cluster-robust</em> standard errors, which would take the problem of correlation over time within clusters into consideration (and deliver a more conservative estimate of the SEs). However, this approach only works well if the number of clusters in the data is roughly 50 or more. Here we only have five.</p>
<p>The alternative approach is to compute bootstrapped clustered standard errors. That is, we apply the <a href="https://en.wikipedia.org/wiki/Bootstrapping_(statistics)">bootstrap resampling procedure</a> at the cluster level. Specifically, we draw <span class="math inline">\(B\)</span> samples (with replacement), estimate and record the coefficient vector for each bootstrap-sample, and then estimate <span class="math inline">\(SE_{boot}\)</span> based on the standard deviation of all respective estimated coefficient values.</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb509-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb509-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set the &#39;seed&#39; for random numbers (makes the example reproducible)</span></span>
<span id="cb509-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb509-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb509-6"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-6" aria-hidden="true" tabindex="-1"></a><span class="co"># set number of bootstrap iterations</span></span>
<span id="cb509-7"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-7" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb509-8"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-8" aria-hidden="true" tabindex="-1"></a><span class="co"># get selection of precincts</span></span>
<span id="cb509-9"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-9" aria-hidden="true" tabindex="-1"></a>precincts <span class="ot">&lt;-</span> <span class="fu">unique</span>(stopdata<span class="sc">$</span>policePrecinct)</span>
<span id="cb509-10"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-10" aria-hidden="true" tabindex="-1"></a><span class="co"># container for coefficients</span></span>
<span id="cb509-11"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-11" aria-hidden="true" tabindex="-1"></a>boot_coefs <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> B, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb509-12"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-12" aria-hidden="true" tabindex="-1"></a><span class="co"># draw bootstrap samples, estimate model for each sample</span></span>
<span id="cb509-13"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B) {</span>
<span id="cb509-14"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-14" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb509-15"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-15" aria-hidden="true" tabindex="-1"></a>     <span class="co"># draw sample of precincts (cluster level)</span></span>
<span id="cb509-16"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-16" aria-hidden="true" tabindex="-1"></a>     precincts_i <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">sample</span>(precincts, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb509-17"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-17" aria-hidden="true" tabindex="-1"></a>     <span class="co"># get observations</span></span>
<span id="cb509-18"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-18" aria-hidden="true" tabindex="-1"></a>     bs_i <span class="ot">&lt;-</span> </span>
<span id="cb509-19"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-19" aria-hidden="true" tabindex="-1"></a>          <span class="fu">lapply</span>(precincts_i, <span class="cf">function</span>(x){</span>
<span id="cb509-20"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-20" aria-hidden="true" tabindex="-1"></a>               stopdata[stopdata<span class="sc">$</span>policePrecinct<span class="sc">==</span>x,]</span>
<span id="cb509-21"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-21" aria-hidden="true" tabindex="-1"></a>     } )</span>
<span id="cb509-22"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-22" aria-hidden="true" tabindex="-1"></a>     bs_i <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(bs_i)</span>
<span id="cb509-23"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-23" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb509-24"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-24" aria-hidden="true" tabindex="-1"></a>     <span class="co"># estimate model and record coefficients</span></span>
<span id="cb509-25"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-25" aria-hidden="true" tabindex="-1"></a>     boot_coefs[i,] <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">lm</span>(model, bs_i))[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="co"># ignore FE-coefficients</span></span>
<span id="cb509-26"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb509-26" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Finally, let’s compute <span class="math inline">\(SE_{boot}\)</span>.</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb510-1" aria-hidden="true" tabindex="-1"></a>se_boot <span class="ot">&lt;-</span> <span class="fu">apply</span>(boot_coefs, </span>
<span id="cb510-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb510-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">MARGIN =</span> <span class="dv">2</span>,</span>
<span id="cb510-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb510-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">FUN =</span> sd)</span>
<span id="cb510-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb510-4" aria-hidden="true" tabindex="-1"></a>se_boot</span></code></pre></div>
<pre><code>## [1] 0.004043 0.004690</code></pre>
<p>Note that even with a very small <span class="math inline">\(B\)</span>, computing <span class="math inline">\(SE_{boot}\)</span> takes some time to compute. When setting <span class="math inline">\(B\)</span> to over 500, computation time will be substantial. Also note that running this code hardly uses up more memory than the very simple approach without bootstrapping (after all, in each bootstrap iteration the dataset used to estimate the model is approximately the same size as the original dataset). There is little we can do to improve the script’s performance regarding memory. However, we can tell R how to allocate CPU resources more efficiently to handle that many regression estimates.</p>
<p>In particular, we can make use of the fact that most modern computing environments (such as a laptop) have CPUs with several <em>cores</em>. We can exploit this fact by instructing the computer to run the computations <em>in parallel</em> (simultaneously computing on several cores). The following code is a parallel implementation of our bootstrap procedure that does exactly that.</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages for parallel processing</span></span>
<span id="cb512-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doSNOW)</span>
<span id="cb512-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get the number of cores available</span></span>
<span id="cb512-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-4" aria-hidden="true" tabindex="-1"></a>ncores <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span>
<span id="cb512-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set cores for parallel processing</span></span>
<span id="cb512-6"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-6" aria-hidden="true" tabindex="-1"></a>ctemp <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(ncores) <span class="co"># </span></span>
<span id="cb512-7"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-7" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoSNOW</span>(ctemp)</span>
<span id="cb512-8"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-9"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-10"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-10" aria-hidden="true" tabindex="-1"></a><span class="co"># set number of bootstrap iterations</span></span>
<span id="cb512-11"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-11" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb512-12"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-12" aria-hidden="true" tabindex="-1"></a><span class="co"># get selection of precincts</span></span>
<span id="cb512-13"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-13" aria-hidden="true" tabindex="-1"></a>precincts <span class="ot">&lt;-</span> <span class="fu">unique</span>(stopdata<span class="sc">$</span>policePrecinct)</span>
<span id="cb512-14"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-14" aria-hidden="true" tabindex="-1"></a><span class="co"># container for coefficients</span></span>
<span id="cb512-15"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-15" aria-hidden="true" tabindex="-1"></a>boot_coefs <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> B, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb512-16"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-17"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-17" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrapping in parallel</span></span>
<span id="cb512-18"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-18" aria-hidden="true" tabindex="-1"></a>boot_coefs <span class="ot">&lt;-</span> </span>
<span id="cb512-19"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-19" aria-hidden="true" tabindex="-1"></a>     <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>B, <span class="at">.combine =</span> rbind, <span class="at">.packages=</span><span class="st">&quot;data.table&quot;</span>) <span class="sc">%dopar%</span> {</span>
<span id="cb512-20"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-20" aria-hidden="true" tabindex="-1"></a>          <span class="co"># draw sample of precincts (cluster level)</span></span>
<span id="cb512-21"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-21" aria-hidden="true" tabindex="-1"></a>          precincts_i <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">sample</span>(precincts, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb512-22"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-22" aria-hidden="true" tabindex="-1"></a>          <span class="co"># get observations</span></span>
<span id="cb512-23"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-23" aria-hidden="true" tabindex="-1"></a>          bs_i <span class="ot">&lt;-</span> <span class="fu">lapply</span>(precincts_i, <span class="cf">function</span>(x) {</span>
<span id="cb512-24"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-24" aria-hidden="true" tabindex="-1"></a>            stopdata[stopdata<span class="sc">$</span>policePrecinct<span class="sc">==</span>x,]</span>
<span id="cb512-25"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-25" aria-hidden="true" tabindex="-1"></a>          })</span>
<span id="cb512-26"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-26" aria-hidden="true" tabindex="-1"></a>          bs_i <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(bs_i)</span>
<span id="cb512-27"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-27" aria-hidden="true" tabindex="-1"></a>          <span class="co"># estimate model and record coefficients</span></span>
<span id="cb512-28"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-28" aria-hidden="true" tabindex="-1"></a>          <span class="fu">coef</span>(<span class="fu">lm</span>(model, bs_i))[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="co"># ignore FE-coefficients</span></span>
<span id="cb512-29"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-29" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb512-30"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-30" aria-hidden="true" tabindex="-1"></a><span class="co"># be a good citizen and stop the snow clusters</span></span>
<span id="cb512-31"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb512-31" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(<span class="at">cl =</span> ctemp)</span></code></pre></div>
<p>As a last step, we again compute <span class="math inline">\(SE_{boot}\)</span>.</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb513-1" aria-hidden="true" tabindex="-1"></a>se_boot <span class="ot">&lt;-</span> <span class="fu">apply</span>(boot_coefs, </span>
<span id="cb513-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb513-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">MARGIN =</span> <span class="dv">2</span>,</span>
<span id="cb513-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb513-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">FUN =</span> sd)</span>
<span id="cb513-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb513-4" aria-hidden="true" tabindex="-1"></a>se_boot</span></code></pre></div>
<pre><code>## (Intercept)       white 
##    0.002446    0.003017</code></pre>
<div id="parallelization-with-an-ec2-instance-1" class="section level3 hasAnchor" number="12.3.1">
<h3><span class="header-section-number">12.3.1</span> Parallelization with an EC2 instance<a href="bottlenecks-in-everyday-data-analytics-tasks.html#parallelization-with-an-ec2-instance-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This short tutorial illustrates how to scale up the computation of clustered standard errors shown above by running it on an AWS EC2 instance. Note that there are a few things that we need to keep in mind to make the script run on an AWS EC2 instance in RStudio Server. First, our EC2 instance is a Linux machine. When running R on a Linux machine, there is an additional step to install R packages (at least for most of the packages): R packages need to be compiled before they can be installed. The command to install packages is exactly the same (<code>install.packages()</code>), and normally you only notice a slight difference in the output shown in the R console during installation (and the installation process takes a little longer than you are used to). Apart from that, using R via RStudio Server in the cloud looks/feels very similar if not identical to when using R/RStudio locally. For this step of the case study, first follow the instructions of how to set up an AWS EC2 instance with R/RStudio Server in Chapter 7. Then, open a browser window, log in to RStudio Server on the EC2 instance, and copy and paste the code below to a new R-file on the EC2 instance (note that you might have to install the <code>data.table</code> and <code>doSNOW</code> packages before running the code).</p>
<p>When executing the code below line-by-line, you will notice that essentially all parts of the script work exactly as on your local machine. This is one of the great advantages of running R/RStudio Server in the cloud. You can implement your entire data analysis locally (based on a small sample), test it locally, and then move it to the cloud and run it at a larger scale in exactly the same way (even with the same Graphical User Interface (GUI)).</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install packages</span></span>
<span id="cb515-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;data.table&quot;</span>)</span>
<span id="cb515-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;doSNOW&quot;</span>)</span>
<span id="cb515-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb515-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb515-6"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-7"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-7" aria-hidden="true" tabindex="-1"></a><span class="co"># fetch the data</span></span>
<span id="cb515-8"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-8" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://vincentarelbundock.github.io/Rdatasets/csv/carData/MplsStops.csv&quot;</span></span>
<span id="cb515-9"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-9" aria-hidden="true" tabindex="-1"></a>stopdata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url)</span>
<span id="cb515-10"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-10" aria-hidden="true" tabindex="-1"></a><span class="co"># remove incomplete obs</span></span>
<span id="cb515-11"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-11" aria-hidden="true" tabindex="-1"></a>stopdata <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(stopdata)</span>
<span id="cb515-12"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-12" aria-hidden="true" tabindex="-1"></a><span class="co"># code dependent var</span></span>
<span id="cb515-13"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-13" aria-hidden="true" tabindex="-1"></a>stopdata<span class="sc">$</span>vsearch <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb515-14"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-14" aria-hidden="true" tabindex="-1"></a>stopdata<span class="sc">$</span>vsearch[stopdata<span class="sc">$</span>vehicleSearch <span class="sc">==</span> <span class="st">&quot;YES&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb515-15"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-15" aria-hidden="true" tabindex="-1"></a><span class="co"># code explanatory var</span></span>
<span id="cb515-16"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-16" aria-hidden="true" tabindex="-1"></a>stopdata<span class="sc">$</span>white <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb515-17"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-17" aria-hidden="true" tabindex="-1"></a>stopdata<span class="sc">$</span>white[stopdata<span class="sc">$</span>race <span class="sc">==</span> <span class="st">&quot;White&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb515-18"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-19"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-19" aria-hidden="true" tabindex="-1"></a><span class="co"># model fit</span></span>
<span id="cb515-20"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-20" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> vsearch <span class="sc">~</span> white <span class="sc">+</span> <span class="fu">factor</span>(policePrecinct)</span>
<span id="cb515-21"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-21" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(model, stopdata)</span>
<span id="cb515-22"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb515-23"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-23" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrapping: normal approach set the &#39;seed&#39; for random</span></span>
<span id="cb515-24"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-24" aria-hidden="true" tabindex="-1"></a><span class="co"># numbers (makes the example reproducible)</span></span>
<span id="cb515-25"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-25" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb515-26"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-26" aria-hidden="true" tabindex="-1"></a><span class="co"># set number of bootstrap iterations</span></span>
<span id="cb515-27"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-27" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb515-28"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-28" aria-hidden="true" tabindex="-1"></a><span class="co"># get selection of precincts</span></span>
<span id="cb515-29"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-29" aria-hidden="true" tabindex="-1"></a>precincts <span class="ot">&lt;-</span> <span class="fu">unique</span>(stopdata<span class="sc">$</span>policePrecinct)</span>
<span id="cb515-30"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-30" aria-hidden="true" tabindex="-1"></a><span class="co"># container for coefficients</span></span>
<span id="cb515-31"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-31" aria-hidden="true" tabindex="-1"></a>boot_coefs <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> B, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb515-32"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-32" aria-hidden="true" tabindex="-1"></a><span class="co"># draw bootstrap samples, estimate model for each sample</span></span>
<span id="cb515-33"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B) {</span>
<span id="cb515-34"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># draw sample of precincts (cluster level)</span></span>
<span id="cb515-35"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-35" aria-hidden="true" tabindex="-1"></a>  precincts_i <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">sample</span>(precincts, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb515-36"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get observations</span></span>
<span id="cb515-37"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-37" aria-hidden="true" tabindex="-1"></a>  bs_i <span class="ot">&lt;-</span> <span class="fu">lapply</span>(precincts_i, <span class="cf">function</span>(x) {</span>
<span id="cb515-38"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-38" aria-hidden="true" tabindex="-1"></a>    stopdata[stopdata<span class="sc">$</span>policePrecinct <span class="sc">==</span> x, ]</span>
<span id="cb515-39"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-39" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb515-40"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-40" aria-hidden="true" tabindex="-1"></a>  bs_i <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(bs_i)</span>
<span id="cb515-41"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># estimate model and record coefficients</span></span>
<span id="cb515-42"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-42" aria-hidden="true" tabindex="-1"></a>  boot_coefs[i, ] <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">lm</span>(model, bs_i))[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]  <span class="co"># ignore FE-coefficients</span></span>
<span id="cb515-43"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb515-44"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb515-45"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-45" aria-hidden="true" tabindex="-1"></a>se_boot <span class="ot">&lt;-</span> <span class="fu">apply</span>(boot_coefs, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">FUN =</span> sd)</span>
<span id="cb515-46"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb515-46" aria-hidden="true" tabindex="-1"></a>se_boot</span></code></pre></div>
<p>So far, we have only demonstrated that the simple implementation (non-parallel) works both locally and in the cloud. However, the real purpose of using an EC2 instance in this example is to make use of the fact that we can scale up our instance to have more CPU cores available for the parallel implementation of our bootstrap procedure. Recall that running the script below on our local machine will employ all cores available to us and compute the bootstrap resampling in parallel on all these cores. Exactly the same thing happens when running the code below on our simple <code>t2.micro</code> instance. However, this type of EC2 instance only has one core. You can check this when running the following line of code in RStudio Server (assuming the <code>doSNOW</code> package is installed and loaded): <code>parallel::detectCores()</code>
.</p>
<p>When running the entire parallel implementation below, you will thus notice that it won’t compute the bootstrap SE any faster than with the non-parallel version above. However, by simply initiating another EC2 type with more cores, we can distribute the workload across many CPU cores, using exactly the same R script.</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrapping: parallel approaach</span></span>
<span id="cb516-2"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;doSNOW&quot;, &quot;parallel&quot;)</span></span>
<span id="cb516-3"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-3" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages for parallel processing</span></span>
<span id="cb516-4"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doSNOW)</span>
<span id="cb516-5"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-5" aria-hidden="true" tabindex="-1"></a><span class="co"># set cores for parallel processing</span></span>
<span id="cb516-6"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-6" aria-hidden="true" tabindex="-1"></a>ncores <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span>
<span id="cb516-7"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-7" aria-hidden="true" tabindex="-1"></a>ctemp <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(ncores) </span>
<span id="cb516-8"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-8" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoSNOW</span>(ctemp)</span>
<span id="cb516-9"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-9" aria-hidden="true" tabindex="-1"></a><span class="co"># set number of bootstrap iterations</span></span>
<span id="cb516-10"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-10" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb516-11"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-11" aria-hidden="true" tabindex="-1"></a><span class="co"># get selection of precincts</span></span>
<span id="cb516-12"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-12" aria-hidden="true" tabindex="-1"></a>precincts <span class="ot">&lt;-</span> <span class="fu">unique</span>(stopdata<span class="sc">$</span>policePrecinct)</span>
<span id="cb516-13"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-13" aria-hidden="true" tabindex="-1"></a><span class="co"># container for coefficients</span></span>
<span id="cb516-14"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-14" aria-hidden="true" tabindex="-1"></a>boot_coefs <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> B, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb516-15"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb516-16"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-16" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrapping in parallel</span></span>
<span id="cb516-17"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-17" aria-hidden="true" tabindex="-1"></a>boot_coefs <span class="ot">&lt;-</span> </span>
<span id="cb516-18"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>B, <span class="at">.combine =</span> rbind, <span class="at">.packages=</span><span class="st">&quot;data.table&quot;</span>) <span class="sc">%dopar%</span> {</span>
<span id="cb516-19"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># draw sample of precincts (cluster level)</span></span>
<span id="cb516-20"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-20" aria-hidden="true" tabindex="-1"></a>    precincts_i <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">sample</span>(precincts, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb516-21"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get observations</span></span>
<span id="cb516-22"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-22" aria-hidden="true" tabindex="-1"></a>    bs_i <span class="ot">&lt;-</span> <span class="fu">lapply</span>(precincts_i, <span class="cf">function</span>(x){</span>
<span id="cb516-23"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-23" aria-hidden="true" tabindex="-1"></a>         stopdata[stopdata<span class="sc">$</span>policePrecinct<span class="sc">==</span>x,]<span class="er">)</span></span>
<span id="cb516-24"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-24" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb516-25"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-25" aria-hidden="true" tabindex="-1"></a>    bs_i <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(bs_i)</span>
<span id="cb516-26"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb516-27"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># estimate model and record coefficients</span></span>
<span id="cb516-28"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coef</span>(<span class="fu">lm</span>(model, bs_i))[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="co"># ignore FE-coefficients</span></span>
<span id="cb516-29"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-29" aria-hidden="true" tabindex="-1"></a>  <span class="er">}</span></span>
<span id="cb516-30"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb516-31"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-31" aria-hidden="true" tabindex="-1"></a><span class="co"># be a good citizen and stop the snow clusters</span></span>
<span id="cb516-32"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-32" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(<span class="at">cl =</span> ctemp)</span>
<span id="cb516-33"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-33" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the bootstrapped standard errors</span></span>
<span id="cb516-34"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-34" aria-hidden="true" tabindex="-1"></a>se_boot <span class="ot">&lt;-</span> <span class="fu">apply</span>(boot_coefs, </span>
<span id="cb516-35"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-35" aria-hidden="true" tabindex="-1"></a>                 <span class="at">MARGIN =</span> <span class="dv">2</span>,</span>
<span id="cb516-36"><a href="bottlenecks-in-everyday-data-analytics-tasks.html#cb516-36" aria-hidden="true" tabindex="-1"></a>                 <span class="at">FUN =</span> sd)</span></code></pre></div>

</div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-cohen_malloy" class="csl-entry">
Cohen, Lauren, and Christopher J. Malloy. 2014. <span>“Friends in High Places.”</span> <em>American Economic Journal: Economic Policy</em> 6 (3): 63–91. <a href="https://doi.org/10.1257/pol.6.3.63">https://doi.org/10.1257/pol.6.3.63</a>.
</div>
<div id="ref-gaure_2013" class="csl-entry">
Gaure, Simen. 2013a. <span>“<span class="nocase">lfe: Linear Group Fixed Effects</span>.”</span> <em><span>The R Journal</span></em> 5 (2): 104–16. <a href="https://doi.org/10.32614/RJ-2013-031">https://doi.org/10.32614/RJ-2013-031</a>.
</div>
<div id="ref-GAURE20138" class="csl-entry">
———. 2013b. <span>“<span>OLS</span> with Multiple High Dimensional Category Variables.”</span> <em>Computational Statistics &amp; Data Analysis</em> 66: 8–18. https://doi.org/<a href="https://doi.org/10.1016/j.csda.2013.03.024">https://doi.org/10.1016/j.csda.2013.03.024</a>.
</div>
<div id="ref-foreign" class="csl-entry">
———. 2022. <em>Foreign: Read Data Stored by ’Minitab’, ’s’, ’SAS’, ’SPSS’, ’Stata’, ’Systat’, ’Weka’, ’dBase’, ...</em> <a href="https://CRAN.R-project.org/package=foreign">https://CRAN.R-project.org/package=foreign</a>.
</div>
<div id="ref-lmtest" class="csl-entry">
Zeileis, Achim, and Torsten Hothorn. 2002. <span>“Diagnostic Checking in Regression Relationships.”</span> <em>R News</em> 2 (3): 7–10. <a href="https://CRAN.R-project.org/doc/Rnews/">https://CRAN.R-project.org/doc/Rnews/</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="66">
<li id="fn66"><p>Note that this example aims to illustrate a point about computation in an applied econometrics context. It does not make any argument whatsoever about identification or the broader research question.<a href="bottlenecks-in-everyday-data-analytics-tasks.html#fnref66" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="a.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="econometrics-with-gpus.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 1
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
