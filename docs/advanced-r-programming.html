<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Advanced R Programming | Big Data Analytics</title>
  <meta name="description" content="A guide to practical big data analytics in R." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Advanced R Programming | Big Data Analytics" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://umatter.github.io/BigData" />
  <meta property="og:image" content="https://umatter.github.io/BigDataimg/cover.png" />
  <meta property="og:description" content="A guide to practical big data analytics in R." />
  <meta name="github-repo" content="umatter/BigData" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Advanced R Programming | Big Data Analytics" />
  
  <meta name="twitter:description" content="A guide to practical big data analytics in R." />
  <meta name="twitter:image" content="https://umatter.github.io/BigDataimg/cover.png" />

<meta name="author" content="Ulrich Matter" />


<meta name="date" content="2022-01-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="resource-allocation.html"/>
<link rel="next" href="big-data-cleaning-and-transformation.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Big Data Analytics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#example-of-computation-time-and-memory-allocation"><i class="fa fa-check"></i><b>1.1</b> Example of Computation Time and Memory Allocation</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#preparation"><i class="fa fa-check"></i><b>1.1.1</b> Preparation</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction.html"><a href="introduction.html#naïve-approach-ignorant-of-r"><i class="fa fa-check"></i><b>1.1.2</b> Naïve Approach (ignorant of R)</a></li>
<li class="chapter" data-level="1.1.3" data-path="introduction.html"><a href="introduction.html#improvement-1-pre-allocation-of-memory"><i class="fa fa-check"></i><b>1.1.3</b> Improvement 1: Pre-allocation of memory</a></li>
<li class="chapter" data-level="1.1.4" data-path="introduction.html"><a href="introduction.html#improvement-2-exploit-vectorization"><i class="fa fa-check"></i><b>1.1.4</b> Improvement 2: Exploit vectorization</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="computing-resources.html"><a href="computing-resources.html"><i class="fa fa-check"></i><b>2</b> Computing Resources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="computing-resources.html"><a href="computing-resources.html#components-of-a-standard-computing-environment"><i class="fa fa-check"></i><b>2.1</b> Components of a standard computing environment</a></li>
<li class="chapter" data-level="2.2" data-path="computing-resources.html"><a href="computing-resources.html#units-of-informationdata-storage"><i class="fa fa-check"></i><b>2.2</b> Units of information/data storage</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="computing-resources.html"><a href="computing-resources.html#example-in-r-data-types-and-information-storage"><i class="fa fa-check"></i><b>2.2.1</b> Example in R: Data types and information storage</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="computing-resources.html"><a href="computing-resources.html#big-data-econometrics"><i class="fa fa-check"></i><b>2.3</b> Big Data econometrics</a></li>
<li class="chapter" data-level="2.4" data-path="computing-resources.html"><a href="computing-resources.html#example-fast-least-squares-regression"><i class="fa fa-check"></i><b>2.4</b> Example: Fast least squares regression</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="computing-resources.html"><a href="computing-resources.html#ols-as-a-point-of-reference"><i class="fa fa-check"></i><b>2.4.1</b> OLS as a point of reference</a></li>
<li class="chapter" data-level="2.4.2" data-path="computing-resources.html"><a href="computing-resources.html#the-uluru-algorithm-as-an-alternative-to-ols"><i class="fa fa-check"></i><b>2.4.2</b> The Uluru algorithm as an alternative to OLS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="resource-allocation.html"><a href="resource-allocation.html"><i class="fa fa-check"></i><b>3</b> Resource allocation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="resource-allocation.html"><a href="resource-allocation.html#case-study-parallel-processing"><i class="fa fa-check"></i><b>3.1</b> Case study: Parallel processing</a></li>
<li class="chapter" data-level="3.2" data-path="resource-allocation.html"><a href="resource-allocation.html#case-study-memory-allocation"><i class="fa fa-check"></i><b>3.2</b> Case study: Memory allocation</a></li>
<li class="chapter" data-level="3.3" data-path="resource-allocation.html"><a href="resource-allocation.html#beyond-memory"><i class="fa fa-check"></i><b>3.3</b> Beyond memory</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html"><i class="fa fa-check"></i><b>4</b> Advanced R Programming</a>
<ul>
<li class="chapter" data-level="4.1" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#r-tools-to-investigate-performanceresource-allocation"><i class="fa fa-check"></i><b>4.1</b> R-tools to investigate performance/resource allocation</a></li>
<li class="chapter" data-level="4.2" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#r-tools-to-investigate-structures-and-types"><i class="fa fa-check"></i><b>4.2</b> R-tools to investigate structures and types</a></li>
<li class="chapter" data-level="4.3" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#data-types-and-memorystorage"><i class="fa fa-check"></i><b>4.3</b> Data types and memory/storage</a></li>
<li class="chapter" data-level="4.4" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#data-structures"><i class="fa fa-check"></i><b>4.4</b> Data structures</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#vectors-vs-factors-in-r"><i class="fa fa-check"></i><b>4.4.1</b> Vectors vs Factors in R</a></li>
<li class="chapter" data-level="4.4.2" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#matricesarrays"><i class="fa fa-check"></i><b>4.4.2</b> Matrices/Arrays</a></li>
<li class="chapter" data-level="4.4.3" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#data-frames-tibbles-and-data-tables"><i class="fa fa-check"></i><b>4.4.3</b> Data frames, tibbles, and data tables</a></li>
<li class="chapter" data-level="4.4.4" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#lists"><i class="fa fa-check"></i><b>4.4.4</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#programming-with-big-data-in-r"><i class="fa fa-check"></i><b>4.5</b> Programming with (Big) Data in R</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#typical-programming-tasks"><i class="fa fa-check"></i><b>4.5.1</b> Typical Programming Tasks</a></li>
<li class="chapter" data-level="4.5.2" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#building-blocks-for-programming-with-big-data"><i class="fa fa-check"></i><b>4.5.2</b> Building blocks for programming with big data</a></li>
<li class="chapter" data-level="4.5.3" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#writing-efficient-code"><i class="fa fa-check"></i><b>4.5.3</b> Writing efficient code</a></li>
<li class="chapter" data-level="4.5.4" data-path="advanced-r-programming.html"><a href="advanced-r-programming.html#r-beyond-r"><i class="fa fa-check"></i><b>4.5.4</b> R, beyond R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html"><i class="fa fa-check"></i><b>5</b> Big Data Cleaning and Transformation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#out-of-memory-strategies"><i class="fa fa-check"></i><b>5.1</b> ‘Out-of-memory’ strategies</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#chunking-data-with-the-ff-package"><i class="fa fa-check"></i><b>5.1.1</b> Chunking data with the <code>ff</code>-package</a></li>
<li class="chapter" data-level="5.1.2" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#memory-mapping-with-bigmemory"><i class="fa fa-check"></i><b>5.1.2</b> Memory mapping with <code>bigmemory</code></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#typical-cleaning-tasks"><i class="fa fa-check"></i><b>5.2</b> Typical cleaning tasks</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="big-data-cleaning-and-transformation.html"><a href="big-data-cleaning-and-transformation.html#data-preparation-with-ff"><i class="fa fa-check"></i><b>5.2.1</b> Data Preparation with <code>ff</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-aggregation.html"><a href="data-aggregation.html"><i class="fa fa-check"></i><b>6</b> Data Aggregation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-aggregation.html"><a href="data-aggregation.html#data-aggregation-the-split-apply-combine-strategy"><i class="fa fa-check"></i><b>6.1</b> Data aggregation: The ‘split-apply-combine’ strategy</a></li>
<li class="chapter" data-level="6.2" data-path="data-aggregation.html"><a href="data-aggregation.html#data-aggregation-tutorial"><i class="fa fa-check"></i><b>6.2</b> Data aggregation tutorial</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="data-aggregation.html"><a href="data-aggregation.html#gathering-and-compilation-of-all-the-raw-data"><i class="fa fa-check"></i><b>6.2.1</b> Gathering and Compilation of all the raw data</a></li>
<li class="chapter" data-level="6.2.2" data-path="data-aggregation.html"><a href="data-aggregation.html#data-aggregation-with-chunked-data-files"><i class="fa fa-check"></i><b>6.2.2</b> Data aggregation with chunked data files</a></li>
<li class="chapter" data-level="6.2.3" data-path="data-aggregation.html"><a href="data-aggregation.html#high-speed-in-memory-data-aggregation-with-data.table"><i class="fa fa-check"></i><b>6.2.3</b> High-speed in-memory data aggregation with <code>data.table</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html"><i class="fa fa-check"></i><b>7</b> Data Storage and Databases</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#big-data-storage"><i class="fa fa-check"></i><b>7.1</b> (Big) Data Storage</a></li>
<li class="chapter" data-level="7.2" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#rdbms-basics"><i class="fa fa-check"></i><b>7.2</b> RDBMS basics</a></li>
<li class="chapter" data-level="7.3" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#getting-started-with-rsqlite"><i class="fa fa-check"></i><b>7.3</b> Getting started with (R)SQLite</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#first-steps-in-sqlite"><i class="fa fa-check"></i><b>7.3.1</b> First steps in SQLite</a></li>
<li class="chapter" data-level="7.3.2" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#indices-and-joins"><i class="fa fa-check"></i><b>7.3.2</b> Indices and joins</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#sqlite-from-within-r"><i class="fa fa-check"></i><b>7.4</b> SQLite from within R</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#creating-a-new-database-with-rsqlite"><i class="fa fa-check"></i><b>7.4.1</b> Creating a new database with <code>RSQLite</code></a></li>
<li class="chapter" data-level="7.4.2" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#importing-data"><i class="fa fa-check"></i><b>7.4.2</b> Importing data</a></li>
<li class="chapter" data-level="7.4.3" data-path="data-storage-and-databases.html"><a href="data-storage-and-databases.html#issue-queries"><i class="fa fa-check"></i><b>7.4.3</b> Issue queries</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="big-data-visualization.html"><a href="big-data-visualization.html"><i class="fa fa-check"></i><b>8</b> (Big) Data Visualization</a>
<ul>
<li class="chapter" data-level="8.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#data-set"><i class="fa fa-check"></i><b>8.1</b> Data Set</a></li>
<li class="chapter" data-level="8.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#excursus-modify-and-create-themes"><i class="fa fa-check"></i><b>8.2</b> Excursus: modify and create themes</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#create-your-own-theme-simple-approach"><i class="fa fa-check"></i><b>8.2.1</b> Create your own theme: simple approach</a></li>
<li class="chapter" data-level="8.2.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#implementing-actual-themes-as-functions."><i class="fa fa-check"></i><b>8.2.2</b> Implementing actual themes as functions.</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="big-data-visualization.html"><a href="big-data-visualization.html#visualize-time-and-space"><i class="fa fa-check"></i><b>8.3</b> Visualize Time and Space</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="big-data-visualization.html"><a href="big-data-visualization.html#preparations"><i class="fa fa-check"></i><b>8.3.1</b> Preparations</a></li>
<li class="chapter" data-level="8.3.2" data-path="big-data-visualization.html"><a href="big-data-visualization.html#pick-up-and-drop-off-locations"><i class="fa fa-check"></i><b>8.3.2</b> Pick-up and drop-off locations</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="big-data-visualization.html"><a href="big-data-visualization.html#excursus-change-color-schemes"><i class="fa fa-check"></i><b>8.4</b> Excursus: change color schemes</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html"><i class="fa fa-check"></i><b>9</b> Cloud Services for Big Data Analytics</a>
<ul>
<li class="chapter" data-level="9.1" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#scaling-up-in-the-cloud"><i class="fa fa-check"></i><b>9.1</b> Scaling up in the Cloud</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#parallelization-with-an-ec2-instance"><i class="fa fa-check"></i><b>9.1.1</b> Parallelization with an EC2 instance</a></li>
<li class="chapter" data-level="9.1.2" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#mass-storage-mariadb-on-an-ec2-instance"><i class="fa fa-check"></i><b>9.1.2</b> Mass Storage: MariaDB on an EC2 instance</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#distributed-systemsmapreduce"><i class="fa fa-check"></i><b>9.2</b> Distributed Systems/MapReduce</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#mapreduce-concept-illustration-in-r"><i class="fa fa-check"></i><b>9.2.1</b> Map/Reduce Concept: Illustration in R</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#hadoop-word-count"><i class="fa fa-check"></i><b>9.3</b> Hadoop Word Count</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#install-hadoop-on-ubuntupop_os-linux"><i class="fa fa-check"></i><b>9.3.1</b> Install Hadoop (on Ubuntu/Pop!_OS Linux)</a></li>
<li class="chapter" data-level="9.3.2" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#run-hadoop"><i class="fa fa-check"></i><b>9.3.2</b> Run Hadoop</a></li>
<li class="chapter" data-level="9.3.3" data-path="cloud-services-for-big-data-analytics.html"><a href="cloud-services-for-big-data-analytics.html#run-example"><i class="fa fa-check"></i><b>9.3.3</b> Run example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="gpus-for-scientific-computing.html"><a href="gpus-for-scientific-computing.html"><i class="fa fa-check"></i><b>10</b> GPUs for Scientific Computing</a>
<ul>
<li class="chapter" data-level="10.1" data-path="gpus-for-scientific-computing.html"><a href="gpus-for-scientific-computing.html#gpus-in-r"><i class="fa fa-check"></i><b>10.1</b> GPUs in R</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="gpus-for-scientific-computing.html"><a href="gpus-for-scientific-computing.html#example-i-matrix-multiplication-comparison-gpur"><i class="fa fa-check"></i><b>10.1.1</b> Example I: Matrix multiplication comparison (<code>gpuR</code>)</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="gpus-for-scientific-computing.html"><a href="gpus-for-scientific-computing.html#gpus-and-machine-learning"><i class="fa fa-check"></i><b>10.2</b> GPUs and Machine Learning</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="gpus-for-scientific-computing.html"><a href="gpus-for-scientific-computing.html#tensorflowkeras-example-predict-housing-prices"><i class="fa fa-check"></i><b>10.2.1</b> Tensorflow/Keras example: predict housing prices</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="gpus-for-scientific-computing.html"><a href="gpus-for-scientific-computing.html#a-word-of-caution"><i class="fa fa-check"></i><b>10.3</b> A word of caution</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="applied-econometrics-with-apache-spark.html"><a href="applied-econometrics-with-apache-spark.html"><i class="fa fa-check"></i><b>11</b> Applied Econometrics with Apache Spark</a>
<ul>
<li class="chapter" data-level="11.1" data-path="applied-econometrics-with-apache-spark.html"><a href="applied-econometrics-with-apache-spark.html#spark-basics"><i class="fa fa-check"></i><b>11.1</b> Spark basics</a></li>
<li class="chapter" data-level="11.2" data-path="applied-econometrics-with-apache-spark.html"><a href="applied-econometrics-with-apache-spark.html#spark-in-r"><i class="fa fa-check"></i><b>11.2</b> Spark in R</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="applied-econometrics-with-apache-spark.html"><a href="applied-econometrics-with-apache-spark.html#data-import-and-summary-statistics"><i class="fa fa-check"></i><b>11.2.1</b> Data import and summary statistics</a></li>
<li class="chapter" data-level="11.2.2" data-path="applied-econometrics-with-apache-spark.html"><a href="applied-econometrics-with-apache-spark.html#regression-analysis-with-sparklyr"><i class="fa fa-check"></i><b>11.2.2</b> Regression analysis with <code>sparklyr</code></a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appendix-a.html"><a href="appendix-a.html"><i class="fa fa-check"></i><b>A</b> Appendix A</a>
<ul>
<li class="chapter" data-level="A.1" data-path="appendix-a.html"><a href="appendix-a.html#github"><i class="fa fa-check"></i><b>A.1</b> GitHub</a>
<ul>
<li class="chapter" data-level="A.1.1" data-path="appendix-a.html"><a href="appendix-a.html#initiate-a-new-repository"><i class="fa fa-check"></i><b>A.1.1</b> Initiate a new repository</a></li>
<li class="chapter" data-level="A.1.2" data-path="appendix-a.html"><a href="appendix-a.html#clone-this-courses-repository"><i class="fa fa-check"></i><b>A.1.2</b> Clone this course’s repository</a></li>
<li class="chapter" data-level="A.1.3" data-path="appendix-a.html"><a href="appendix-a.html#fork-this-courses-repository"><i class="fa fa-check"></i><b>A.1.3</b> Fork this course’s repository</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="appendix-b.html"><a href="appendix-b.html"><i class="fa fa-check"></i><b>B</b> Appendix B</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://umatter.github.io" target="blank">umatter.github.io</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Big Data Analytics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="advanced-r-programming" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Advanced R Programming</h1>
<div id="r-tools-to-investigate-performanceresource-allocation" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> R-tools to investigate performance/resource allocation</h2>
<table>
<colgroup>
<col width="12%" />
<col width="15%" />
<col width="71%" />
</colgroup>
<thead>
<tr class="header">
<th>package</th>
<th>function</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>utils</code></td>
<td><code>object.size()</code></td>
<td>Provides an estimate of the memory that is being used to store an R object.</td>
</tr>
<tr class="even">
<td><code>pryr</code></td>
<td><code>object_size()</code></td>
<td>Works similarly to <code>object.size()</code>, but counts more accurately and includes the size of environments.</td>
</tr>
<tr class="odd">
<td><code>pryr</code></td>
<td><code>compare_size()</code></td>
<td>Makes it easy to compare the output of object_size and object.size.</td>
</tr>
<tr class="even">
<td><code>pryr</code></td>
<td><code>mem_used()</code></td>
<td>Returns the total amount of memory (in megabytes) currently used by R.</td>
</tr>
<tr class="odd">
<td><code>pryr</code></td>
<td><code>mem_change()</code></td>
<td>Shows the change in memory (in megabytes) before and after running code.</td>
</tr>
<tr class="even">
<td><code>base</code></td>
<td><code>system.time()</code></td>
<td>Returns CPU (and other) times that an R expression used.</td>
</tr>
<tr class="odd">
<td><code>microbenchmark</code></td>
<td><code>microbenchmark()</code></td>
<td>Highly accurate timing of R expression evaluation.</td>
</tr>
<tr class="even">
<td><code>bench</code></td>
<td><code>mark()</code></td>
<td>Benchmark a series of functions.</td>
</tr>
<tr class="odd">
<td><code>profvis</code></td>
<td><code>profvis()</code></td>
<td>Profiles an R expression and visualizes the profiling data (usage of memory, time elapsed, etc.).</td>
</tr>
</tbody>
</table>
</div>
<div id="r-tools-to-investigate-structures-and-types" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> R-tools to investigate structures and types</h2>
<table>
<colgroup>
<col width="12%" />
<col width="15%" />
<col width="71%" />
</colgroup>
<thead>
<tr class="header">
<th>package</th>
<th>function</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>utils</code></td>
<td><code>str()</code></td>
<td>Compactly display the structure of an arbitrary R object.</td>
</tr>
<tr class="even">
<td><code>base</code></td>
<td><code>class()</code></td>
<td>Prints the class(es) of an R object.</td>
</tr>
<tr class="odd">
<td><code>base</code></td>
<td><code>typeof()</code></td>
<td>Determines the (R-internal) type or storage mode of an object.</td>
</tr>
</tbody>
</table>
</div>
<div id="data-types-and-memorystorage" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Data types and memory/storage</h2>
<p>Data loaded into RAM can be interpreted differently by R depending on the data <em>type</em>. Some operators or functions in R only accept data of a specific type as arguments. For example, we can store the numeric values <code>1.5</code> and <code>3</code> in the variables <code>a</code> and <code>b</code>, respectively.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="advanced-r-programming.html#cb99-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb99-2"><a href="advanced-r-programming.html#cb99-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb99-3"><a href="advanced-r-programming.html#cb99-3" aria-hidden="true" tabindex="-1"></a>a <span class="sc">+</span> b</span></code></pre></div>
<pre><code>## [1] 4.5</code></pre>
<p>R interprets this data as type <code>double</code> (class ‘numeric’):</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="advanced-r-programming.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(a)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="advanced-r-programming.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(a)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="advanced-r-programming.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(a)</span></code></pre></div>
<pre><code>## 56 bytes</code></pre>
<p>If, however, we define <code>a</code> and <code>b</code> as follows, R will interpret the values stored in <code>a</code> and <code>b</code> as text (<code>character</code>).</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="advanced-r-programming.html#cb107-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="st">&quot;1.5&quot;</span></span>
<span id="cb107-2"><a href="advanced-r-programming.html#cb107-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="st">&quot;3&quot;</span></span>
<span id="cb107-3"><a href="advanced-r-programming.html#cb107-3" aria-hidden="true" tabindex="-1"></a>a <span class="sc">+</span> b</span></code></pre></div>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="advanced-r-programming.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(a)</span></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="advanced-r-programming.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(a)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="advanced-r-programming.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(a)</span></code></pre></div>
<pre><code>## 56 bytes</code></pre>
<p>Note that the symbols <code>1.5</code> take up more or less memory depending on the data-type they are stored in. This directly links to how data/information is stored/represented in binary code, which in turn is reflected in how much memory is used to store these symbols in an object as well as what we can do with it.</p>
</div>
<div id="data-structures" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Data structures</h2>
<p>For now, we have only looked at individual bytes of data. An entire data set can consist of gigabytes of data and contain both text and numeric values. R provides several classes of objects providing different data structures. Both the choice of data types and data structures to store data in can affect how much memory is needed to contain a dataset in RAM.</p>
<div id="vectors-vs-factors-in-r" class="section level3" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Vectors vs Factors in R</h3>
<p>Vectors are collections of values of the same type. They can contain either all numeric values or all character values.</p>
<div class="figure" style="text-align: center"><span id="fig:numvec"></span>
<img src="img/02_numvec.png" alt="Illustration of a numeric vector (symbolic). Figure by Murrell (2009) (licensed under CC BY-NC-SA 3.0 NZ)." width="5%" />
<p class="caption">
Figure 4.1: Illustration of a numeric vector (symbolic). Figure by <span class="citation"><a href="references.html#ref-murrell_2009" role="doc-biblioref">Murrell</a> (<a href="references.html#ref-murrell_2009" role="doc-biblioref">2009</a>)</span> (licensed under CC BY-NC-SA 3.0 NZ).
</p>
</div>

<p>For example, we can initiate a character vector containing information on the home towns of persons participating in a survey.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="advanced-r-programming.html#cb114-1" aria-hidden="true" tabindex="-1"></a>hometown <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;St.Gallen&quot;</span>, <span class="st">&quot;Basel&quot;</span>, <span class="st">&quot;St.Gallen&quot;</span>)</span>
<span id="cb114-2"><a href="advanced-r-programming.html#cb114-2" aria-hidden="true" tabindex="-1"></a>hometown</span></code></pre></div>
<pre><code>## [1] &quot;St.Gallen&quot; &quot;Basel&quot;     &quot;St.Gallen&quot;</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="advanced-r-programming.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(hometown)</span></code></pre></div>
<pre><code>## 200 bytes</code></pre>
<p>Unlike in the data types example above, it would likely be not that practical to store these values as type <code>numeric</code> to save memory. R would not know how to translate these strings into floating point numbers. Alternatively, we could think of a correspondence table that assigns a numeric (id) code to each unique town name in the data set. This way we would save memory but it would mean additional effort to work with the data. Fortunately, basic R already implements exactly this idea in a user-friendly way in a data-structure called <code>factor</code>.</p>
<p>Factors are sets of categories. Thus, the values come from a fixed set of possible values.</p>
<div class="figure" style="text-align: center"><span id="fig:factor"></span>
<img src="img/02_factor.png" alt="Illustration of a factor (symbolic). Figure by Murrell (2009) (licensed under CC BY-NC-SA 3.0 NZ)." width="5%" />
<p class="caption">
Figure 4.2: Illustration of a factor (symbolic). Figure by <span class="citation"><a href="references.html#ref-murrell_2009" role="doc-biblioref">Murrell</a> (<a href="references.html#ref-murrell_2009" role="doc-biblioref">2009</a>)</span> (licensed under CC BY-NC-SA 3.0 NZ).
</p>
</div>

<p>Considering the same example as above, we can store the same information in an object of type class <code>factor</code>.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="advanced-r-programming.html#cb118-1" aria-hidden="true" tabindex="-1"></a>hometown_f <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;St.Gallen&quot;</span>, <span class="st">&quot;Basel&quot;</span>, <span class="st">&quot;St.Gallen&quot;</span>))</span>
<span id="cb118-2"><a href="advanced-r-programming.html#cb118-2" aria-hidden="true" tabindex="-1"></a>hometown_f</span></code></pre></div>
<pre><code>## [1] St.Gallen Basel     St.Gallen
## Levels: Basel St.Gallen</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="advanced-r-programming.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(hometown_f)</span></code></pre></div>
<pre><code>## 584 bytes</code></pre>
<p>At first sight, the fact that <code>hometown_f</code> takes up more memory than its character vector sibling seems odd. But, we have encountered this kind of ‘paradox’ before. Again, the more sophisticated approach involves an ‘overhead’ (here not in terms of computing time but in terms of structure encoded in an object). <code>hometown_f</code> has more ‘structure’ (i.e., a mapping of numbers to ‘factor levels’/category labels). This additional structure is also information that needs to be stored somewhere. As in previous examples of this ‘overhead costs,’ this disadvantage is diminishing with larger data sets:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="advanced-r-programming.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a large character vector</span></span>
<span id="cb122-2"><a href="advanced-r-programming.html#cb122-2" aria-hidden="true" tabindex="-1"></a>hometown_large <span class="ot">&lt;-</span> <span class="fu">rep</span>(hometown, <span class="at">times =</span> <span class="dv">1000</span>)</span>
<span id="cb122-3"><a href="advanced-r-programming.html#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="co"># and the same content as factor</span></span>
<span id="cb122-4"><a href="advanced-r-programming.html#cb122-4" aria-hidden="true" tabindex="-1"></a>hometown_large_f <span class="ot">&lt;-</span> <span class="fu">factor</span>(hometown_large)</span>
<span id="cb122-5"><a href="advanced-r-programming.html#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compare size</span></span>
<span id="cb122-6"><a href="advanced-r-programming.html#cb122-6" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(hometown_large)</span></code></pre></div>
<pre><code>## 24168 bytes</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="advanced-r-programming.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(hometown_large_f)</span></code></pre></div>
<pre><code>## 12568 bytes</code></pre>
</div>
<div id="matricesarrays" class="section level3" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Matrices/Arrays</h3>
<p>Matrices are two-dimensional collections of values, arrays higher-dimensional collections of values, of the same type.</p>
<div class="figure" style="text-align: center"><span id="fig:matrix"></span>
<img src="img/02_matrix.png" alt="Illustration of a numeric matrix (symbolic). Figure by Murrell (2009) (licensed under CC BY-NC-SA 3.0 NZ)." width="10%" />
<p class="caption">
Figure 4.3: Illustration of a numeric matrix (symbolic). Figure by <span class="citation"><a href="references.html#ref-murrell_2009" role="doc-biblioref">Murrell</a> (<a href="references.html#ref-murrell_2009" role="doc-biblioref">2009</a>)</span> (licensed under CC BY-NC-SA 3.0 NZ).
</p>
</div>

<p>For example, we can initiate a three-row/two-column numeric matrix as follows.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="advanced-r-programming.html#cb126-1" aria-hidden="true" tabindex="-1"></a>my_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>), <span class="at">nrow =</span> <span class="dv">3</span>)</span>
<span id="cb126-2"><a href="advanced-r-programming.html#cb126-2" aria-hidden="true" tabindex="-1"></a>my_matrix</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    4
## [2,]    2    5
## [3,]    3    6</code></pre>
<p>And a three-dimensional numeric array as follows.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="advanced-r-programming.html#cb128-1" aria-hidden="true" tabindex="-1"></a>my_array <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>), <span class="at">dim =</span> <span class="dv">3</span>)</span>
<span id="cb128-2"><a href="advanced-r-programming.html#cb128-2" aria-hidden="true" tabindex="-1"></a>my_array</span></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
</div>
<div id="data-frames-tibbles-and-data-tables" class="section level3" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Data frames, tibbles, and data tables</h3>
<p>Recall that data frames are the typical representation of a (table-like) data set in R. Each column can contain a vector of a given data type (or a factor), but all columns need to be of identical length. Thus in the context of data analysis, we would say that each row of a data frame contains an observation, and each column contains a characteristic of this observation.</p>
<div class="figure" style="text-align: center"><span id="fig:df"></span>
<img src="img/02_df.png" alt="Illustration of a data frame (symbolic). Figure by Murrell (2009) (licensed under CC BY-NC-SA 3.0 NZ)." width="10%" />
<p class="caption">
Figure 4.4: Illustration of a data frame (symbolic). Figure by <span class="citation"><a href="references.html#ref-murrell_2009" role="doc-biblioref">Murrell</a> (<a href="references.html#ref-murrell_2009" role="doc-biblioref">2009</a>)</span> (licensed under CC BY-NC-SA 3.0 NZ).
</p>
</div>

<p>The historical implementation of data frames in R is not very comfortable to work with large data sets.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> Several newer implementations of the data-frame concept in R aim to make data processing faster. One is called <code>tibbles</code>, implemented and used in the <code>tidyverse</code> packages. The other is called <code>data table</code>, implemented in the <code>data.table</code>-package. In this course we will focus on the <code>data.table</code>-package.</p>
<p>Here is how we define a <code>data.table</code> in R:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="advanced-r-programming.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load package</span></span>
<span id="cb130-2"><a href="advanced-r-programming.html#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb130-3"><a href="advanced-r-programming.html#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="co"># initiate a data.table</span></span>
<span id="cb130-4"><a href="advanced-r-programming.html#cb130-4" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">person =</span> <span class="fu">c</span>(<span class="st">&quot;Alice&quot;</span>, <span class="st">&quot;Ben&quot;</span>),</span>
<span id="cb130-5"><a href="advanced-r-programming.html#cb130-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">30</span>),</span>
<span id="cb130-6"><a href="advanced-r-programming.html#cb130-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">gender =</span> <span class="fu">c</span>(<span class="st">&quot;f&quot;</span>, <span class="st">&quot;m&quot;</span>))</span>
<span id="cb130-7"><a href="advanced-r-programming.html#cb130-7" aria-hidden="true" tabindex="-1"></a>dt</span></code></pre></div>
<pre><code>##    person age gender
## 1:  Alice  50      f
## 2:    Ben  30      m</code></pre>
</div>
<div id="lists" class="section level3" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> Lists</h3>
<p>Similar to data frames and data tables, lists can contain different types of data in each element. For example, a list could contain different other lists, data frames, and vectors with differing numbers of elements.</p>
<div class="figure" style="text-align: center"><span id="fig:list"></span>
<img src="img/02_list.png" alt="Illustration of a data frame (symbolic). Figure by Murrell (2009) (licensed under CC BY-NC-SA 3.0 NZ)." width="10%" />
<p class="caption">
Figure 4.5: Illustration of a data frame (symbolic). Figure by <span class="citation"><a href="references.html#ref-murrell_2009" role="doc-biblioref">Murrell</a> (<a href="references.html#ref-murrell_2009" role="doc-biblioref">2009</a>)</span> (licensed under CC BY-NC-SA 3.0 NZ).
</p>
</div>

<p>This flexibility can easily be demonstrated by combining some of the data structures created in the examples above:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="advanced-r-programming.html#cb132-1" aria-hidden="true" tabindex="-1"></a>my_list <span class="ot">&lt;-</span> <span class="fu">list</span>(my_array, my_matrix, dt)</span>
<span id="cb132-2"><a href="advanced-r-programming.html#cb132-2" aria-hidden="true" tabindex="-1"></a>my_list</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1 2 3
## 
## [[2]]
##      [,1] [,2]
## [1,]    1    4
## [2,]    2    5
## [3,]    3    6
## 
## [[3]]
##    person age gender
## 1:  Alice  50      f
## 2:    Ben  30      m</code></pre>
</div>
</div>
<div id="programming-with-big-data-in-r" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Programming with (Big) Data in R</h2>
<div id="typical-programming-tasks" class="section level3" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Typical Programming Tasks</h3>
<p>Programming tasks in the context of data analysis typically fall into one of the following broad categories.</p>
<ul>
<li>Procedures to import/export data.</li>
<li>Procedures to clean and filter data.</li>
<li>Implement functions for statistical analysis.</li>
</ul>
<p>When writing a program to process large amounts of data in any of these areas, it is helpful to take into consideration the following design choices:</p>
<ol style="list-style-type: decimal">
<li>Which basic (already implemented) R functions are more or less suitable as building blocks for the program?</li>
<li>How can we exploit/avoid some of R’s lower-level characteristics in order to implement efficient functions?</li>
<li>Is there a need to interface with a lower-level programming language in order to speed up the code? (advanced topic)</li>
</ol>
<p>Finally, there is an additional important point to be made regarding the implementation of functions for <em>statistical analysis</em>: Independent of <em>how</em> we write a statistical procedure in R (or in any other language, for that matter), is there an <em>alternative statistical procedure/algorithm</em> that is faster but delivers approximately the same result (as long as we use a sufficiently large data sets). The following subsections elaborate briefly on each of these points and show some code examples to further illustrate these points.</p>
</div>
<div id="building-blocks-for-programming-with-big-data" class="section level3" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> Building blocks for programming with big data</h3>
<p>When writing a program in R, we can rely on many already implemented functions on which we can build. Often, there are even several functions already implemented that take care of essentially the same task. When the amount of data to be processed by these functions is not large, it doesn’t matter that much which ones we choose to build our program on. However, when we are writing a program which likely has to process large amounts of data, we should think more closely about which building blocks we choose to base our program on. For example, when writing the data-import part of a program, we could use the traditional <code>read.csv()</code> or <code>fread()</code> from the <code>data.table</code>-package. The result is very similar (in many situations, the differences of the resulting objects would not matter at all).</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="advanced-r-programming.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read a CSV-file the &#39;traditional way&#39;</span></span>
<span id="cb134-2"><a href="advanced-r-programming.html#cb134-2" aria-hidden="true" tabindex="-1"></a>flights <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/flights.csv&quot;</span>)</span>
<span id="cb134-3"><a href="advanced-r-programming.html#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(flights)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="advanced-r-programming.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative (needs the data.table package)</span></span>
<span id="cb136-2"><a href="advanced-r-programming.html#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb136-3"><a href="advanced-r-programming.html#cb136-3" aria-hidden="true" tabindex="-1"></a>flights <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;data/flights.csv&quot;</span>)</span>
<span id="cb136-4"><a href="advanced-r-programming.html#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(flights)</span></code></pre></div>
<pre><code>## [1] &quot;data.table&quot; &quot;data.frame&quot;</code></pre>
<p>However, the latter approach is usually much faster (see above for why this is the case in this example).</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="advanced-r-programming.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(flights <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/flights.csv&quot;</span>))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   1.238   0.001   1.238</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="advanced-r-programming.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(flights <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;data/flights.csv&quot;</span>))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.286   0.000   0.053</code></pre>
</div>
<div id="writing-efficient-code" class="section level3" number="4.5.3">
<h3><span class="header-section-number">4.5.3</span> Writing efficient code</h3>
<div id="memory-allocation-before-looping" class="section level4" number="4.5.3.1">
<h4><span class="header-section-number">4.5.3.1</span> Memory allocation before looping</h4>
<p>Recall the code example from the introductory lecture. When we write a <code>for</code>-loop that results in a vector or list of values, it is favorable to instruct R to pre-allocate the memory necessary to contain the final result. If we don’t do that, each iteration of the loop causes R to re-allocate memory because the number of elements in the vector/list is changing. In simple terms, this means that R needs to execute more steps in each iteration.</p>
<p>In the following example, we compare the performance of two functions. One taking this principle into account, the other not. The function takes a numeric vector as input and returns the square root of each element of the numeric vector.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="advanced-r-programming.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># naïve implementation</span></span>
<span id="cb142-2"><a href="advanced-r-programming.html#cb142-2" aria-hidden="true" tabindex="-1"></a>sqrt_vector <span class="ot">&lt;-</span> </span>
<span id="cb142-3"><a href="advanced-r-programming.html#cb142-3" aria-hidden="true" tabindex="-1"></a>     <span class="cf">function</span>(x) {</span>
<span id="cb142-4"><a href="advanced-r-programming.html#cb142-4" aria-hidden="true" tabindex="-1"></a>          output <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb142-5"><a href="advanced-r-programming.html#cb142-5" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) {</span>
<span id="cb142-6"><a href="advanced-r-programming.html#cb142-6" aria-hidden="true" tabindex="-1"></a>               output <span class="ot">&lt;-</span> <span class="fu">c</span>(output, x[i]<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb142-7"><a href="advanced-r-programming.html#cb142-7" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb142-8"><a href="advanced-r-programming.html#cb142-8" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb142-9"><a href="advanced-r-programming.html#cb142-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">return</span>(output)</span>
<span id="cb142-10"><a href="advanced-r-programming.html#cb142-10" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb142-11"><a href="advanced-r-programming.html#cb142-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-12"><a href="advanced-r-programming.html#cb142-12" aria-hidden="true" tabindex="-1"></a><span class="co"># implementation with pre-allocation of memory</span></span>
<span id="cb142-13"><a href="advanced-r-programming.html#cb142-13" aria-hidden="true" tabindex="-1"></a>sqrt_vector_faster <span class="ot">&lt;-</span> </span>
<span id="cb142-14"><a href="advanced-r-programming.html#cb142-14" aria-hidden="true" tabindex="-1"></a>     <span class="cf">function</span>(x) {</span>
<span id="cb142-15"><a href="advanced-r-programming.html#cb142-15" aria-hidden="true" tabindex="-1"></a>          output <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(x))</span>
<span id="cb142-16"><a href="advanced-r-programming.html#cb142-16" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) {</span>
<span id="cb142-17"><a href="advanced-r-programming.html#cb142-17" aria-hidden="true" tabindex="-1"></a>               output[i] <span class="ot">&lt;-</span>  x[i]<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb142-18"><a href="advanced-r-programming.html#cb142-18" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb142-19"><a href="advanced-r-programming.html#cb142-19" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb142-20"><a href="advanced-r-programming.html#cb142-20" aria-hidden="true" tabindex="-1"></a>          <span class="fu">return</span>(output)</span>
<span id="cb142-21"><a href="advanced-r-programming.html#cb142-21" aria-hidden="true" tabindex="-1"></a>     }</span></code></pre></div>
<p>As a proof of concept we use <code>system.time()</code> to measure the difference in speed for various input sizes.<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a></p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="advanced-r-programming.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the different sizes of the vectors we will put into the two functions</span></span>
<span id="cb143-2"><a href="advanced-r-programming.html#cb143-2" aria-hidden="true" tabindex="-1"></a>input_sizes <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">100</span>, <span class="at">to =</span> <span class="dv">10000</span>, <span class="at">by =</span> <span class="dv">100</span>)</span>
<span id="cb143-3"><a href="advanced-r-programming.html#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create the input vectors</span></span>
<span id="cb143-4"><a href="advanced-r-programming.html#cb143-4" aria-hidden="true" tabindex="-1"></a>inputs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(input_sizes, rnorm)</span>
<span id="cb143-5"><a href="advanced-r-programming.html#cb143-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-6"><a href="advanced-r-programming.html#cb143-6" aria-hidden="true" tabindex="-1"></a><span class="co"># compute ouputs for each of the functions</span></span>
<span id="cb143-7"><a href="advanced-r-programming.html#cb143-7" aria-hidden="true" tabindex="-1"></a>output_slower <span class="ot">&lt;-</span> </span>
<span id="cb143-8"><a href="advanced-r-programming.html#cb143-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">sapply</span>(inputs, </span>
<span id="cb143-9"><a href="advanced-r-programming.html#cb143-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x){ <span class="fu">system.time</span>(<span class="fu">sqrt_vector</span>(x))[<span class="st">&quot;elapsed&quot;</span>]</span>
<span id="cb143-10"><a href="advanced-r-programming.html#cb143-10" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb143-11"><a href="advanced-r-programming.html#cb143-11" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb143-12"><a href="advanced-r-programming.html#cb143-12" aria-hidden="true" tabindex="-1"></a>output_faster <span class="ot">&lt;-</span> </span>
<span id="cb143-13"><a href="advanced-r-programming.html#cb143-13" aria-hidden="true" tabindex="-1"></a>     <span class="fu">sapply</span>(inputs, </span>
<span id="cb143-14"><a href="advanced-r-programming.html#cb143-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x){ <span class="fu">system.time</span>(<span class="fu">sqrt_vector_faster</span>(x))[<span class="st">&quot;elapsed&quot;</span>]</span>
<span id="cb143-15"><a href="advanced-r-programming.html#cb143-15" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb143-16"><a href="advanced-r-programming.html#cb143-16" aria-hidden="true" tabindex="-1"></a>            )</span></code></pre></div>
<p>The following plot shows the difference in the performance of the two functions.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="advanced-r-programming.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb144-2"><a href="advanced-r-programming.html#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb144-3"><a href="advanced-r-programming.html#cb144-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-4"><a href="advanced-r-programming.html#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="co"># initiate data frame for plot</span></span>
<span id="cb144-5"><a href="advanced-r-programming.html#cb144-5" aria-hidden="true" tabindex="-1"></a>plotdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time_elapsed =</span> <span class="fu">c</span>(output_slower, output_faster),</span>
<span id="cb144-6"><a href="advanced-r-programming.html#cb144-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">input_size =</span> <span class="fu">c</span>(input_sizes, input_sizes),</span>
<span id="cb144-7"><a href="advanced-r-programming.html#cb144-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Implementation=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;sqrt_vector&quot;</span>, <span class="fu">length</span>(output_slower)),</span>
<span id="cb144-8"><a href="advanced-r-programming.html#cb144-8" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">rep</span>(<span class="st">&quot;sqrt_vector_faster&quot;</span>, <span class="fu">length</span>(output_faster))))</span>
<span id="cb144-9"><a href="advanced-r-programming.html#cb144-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-10"><a href="advanced-r-programming.html#cb144-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb144-11"><a href="advanced-r-programming.html#cb144-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plotdata, <span class="fu">aes</span>(<span class="at">x=</span>input_size, <span class="at">y=</span> time_elapsed)) <span class="sc">+</span></span>
<span id="cb144-12"><a href="advanced-r-programming.html#cb144-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour=</span>Implementation)) <span class="sc">+</span></span>
<span id="cb144-13"><a href="advanced-r-programming.html#cb144-13" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">18</span>) <span class="sc">+</span></span>
<span id="cb144-14"><a href="advanced-r-programming.html#cb144-14" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ylab</span>(<span class="st">&quot;Time elapsed (in seconds)&quot;</span>) <span class="sc">+</span></span>
<span id="cb144-15"><a href="advanced-r-programming.html#cb144-15" aria-hidden="true" tabindex="-1"></a>     <span class="fu">xlab</span>(<span class="st">&quot;No. of elements processed&quot;</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
</div>
<div id="vectorization" class="section level4" number="4.5.3.2">
<h4><span class="header-section-number">4.5.3.2</span> Vectorization</h4>
<p>We can further improve the performance of this function by exploiting the fact that in R ‘everything is a vector’ and that many of the basic R functions (such as math operators) are <em>vectorized</em>. In simple terms, this means that an operation is implemented to directly work on vectors in such a way that it can take advantage of the similarity of each of the vector’s elements. That is, R only has to figure out once how to apply a given function to a vector element in order to apply it to all elements of the vector. In a simple loop, R has to go through the same ‘preparatory’ steps again and again in each iteration.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="advanced-r-programming.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># implementation with vectorization</span></span>
<span id="cb145-2"><a href="advanced-r-programming.html#cb145-2" aria-hidden="true" tabindex="-1"></a>sqrt_vector_fastest <span class="ot">&lt;-</span> </span>
<span id="cb145-3"><a href="advanced-r-programming.html#cb145-3" aria-hidden="true" tabindex="-1"></a>     <span class="cf">function</span>(x) {</span>
<span id="cb145-4"><a href="advanced-r-programming.html#cb145-4" aria-hidden="true" tabindex="-1"></a>               output <span class="ot">&lt;-</span>  x<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb145-5"><a href="advanced-r-programming.html#cb145-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">return</span>(output)</span>
<span id="cb145-6"><a href="advanced-r-programming.html#cb145-6" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb145-7"><a href="advanced-r-programming.html#cb145-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-8"><a href="advanced-r-programming.html#cb145-8" aria-hidden="true" tabindex="-1"></a><span class="co"># speed test</span></span>
<span id="cb145-9"><a href="advanced-r-programming.html#cb145-9" aria-hidden="true" tabindex="-1"></a>output_fastest <span class="ot">&lt;-</span> </span>
<span id="cb145-10"><a href="advanced-r-programming.html#cb145-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">sapply</span>(inputs, </span>
<span id="cb145-11"><a href="advanced-r-programming.html#cb145-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x){ <span class="fu">system.time</span>(<span class="fu">sqrt_vector_fastest</span>(x))[<span class="st">&quot;elapsed&quot;</span>]</span>
<span id="cb145-12"><a href="advanced-r-programming.html#cb145-12" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb145-13"><a href="advanced-r-programming.html#cb145-13" aria-hidden="true" tabindex="-1"></a>            )</span></code></pre></div>
<p>Let’s have a look at whether this improves the function’s performance further.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="advanced-r-programming.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb146-2"><a href="advanced-r-programming.html#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb146-3"><a href="advanced-r-programming.html#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="advanced-r-programming.html#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="co"># initiate data frame for plot</span></span>
<span id="cb146-5"><a href="advanced-r-programming.html#cb146-5" aria-hidden="true" tabindex="-1"></a>plotdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time_elapsed =</span> <span class="fu">c</span>(output_faster, output_fastest),</span>
<span id="cb146-6"><a href="advanced-r-programming.html#cb146-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">input_size =</span> <span class="fu">c</span>(input_sizes, input_sizes),</span>
<span id="cb146-7"><a href="advanced-r-programming.html#cb146-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Implementation=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;sqrt_vector_faster&quot;</span>, <span class="fu">length</span>(output_faster)),</span>
<span id="cb146-8"><a href="advanced-r-programming.html#cb146-8" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">rep</span>(<span class="st">&quot;sqrt_vector_fastest&quot;</span>, <span class="fu">length</span>(output_fastest))))</span>
<span id="cb146-9"><a href="advanced-r-programming.html#cb146-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-10"><a href="advanced-r-programming.html#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb146-11"><a href="advanced-r-programming.html#cb146-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plotdata, <span class="fu">aes</span>(<span class="at">x=</span>input_size, <span class="at">y=</span> time_elapsed)) <span class="sc">+</span></span>
<span id="cb146-12"><a href="advanced-r-programming.html#cb146-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour=</span>Implementation)) <span class="sc">+</span></span>
<span id="cb146-13"><a href="advanced-r-programming.html#cb146-13" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">18</span>) <span class="sc">+</span></span>
<span id="cb146-14"><a href="advanced-r-programming.html#cb146-14" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ylab</span>(<span class="st">&quot;Time elapsed (in seconds)&quot;</span>) <span class="sc">+</span></span>
<span id="cb146-15"><a href="advanced-r-programming.html#cb146-15" aria-hidden="true" tabindex="-1"></a>     <span class="fu">xlab</span>(<span class="st">&quot;No. of elements processed&quot;</span>)</span></code></pre></div>
<p><img src="bigdata_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
<p>In the example above, we have simply exploited the fact that many of R’s basic functions (such as math operators) are vectorized. If the program we want to implement cannot directly benefit from such a function, there are basically two ways to make use of vectorization (instead of loops written in R).</p>
<p>One approach is to use an <code>apply</code>-type function instead of loops. Probably most widely used is <code>lapply()</code>, a function that takes a vector (atomic or list) as input and applies a function <code>FUN</code> to each of its elements. It is a straightforward alternative to <code>for</code>-loops in many situations. The following example shows how we can get the same result by either writing a loop or using <code>lapply()</code>. The aim of the code example is to import the <a href="https://archive.ics.uci.edu/ml/datasets/Health+News+in+Twitter">Health News in Twitter Data Set</a> by <span class="citation"><a href="references.html#ref-karami_etal2017" role="doc-biblioref">Karami et al.</a> (<a href="references.html#ref-karami_etal2017" role="doc-biblioref">2017</a>)</span>. The raw data consists of several text files that need to be imported to R consecutively.</p>
<p>The text-files are located in <code>data/twitter_texts/</code>. For either approach of importing all of these files, we first need a list of the paths to all of the files. We can get this with <code>list.files()</code>. Also, for either approach we will make use of the <code>fread</code>-function in the <code>data.table</code>-package.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="advanced-r-programming.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb147-2"><a href="advanced-r-programming.html#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb147-3"><a href="advanced-r-programming.html#cb147-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-4"><a href="advanced-r-programming.html#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get a list of all file-paths</span></span>
<span id="cb147-5"><a href="advanced-r-programming.html#cb147-5" aria-hidden="true" tabindex="-1"></a>textfiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;data/twitter_texts&quot;</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Now we can read in all the text files with a <code>for</code>-loop as follows.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="advanced-r-programming.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare loop</span></span>
<span id="cb148-2"><a href="advanced-r-programming.html#cb148-2" aria-hidden="true" tabindex="-1"></a>all_texts <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb148-3"><a href="advanced-r-programming.html#cb148-3" aria-hidden="true" tabindex="-1"></a>n_files <span class="ot">&lt;-</span> <span class="fu">length</span>(textfiles)</span>
<span id="cb148-4"><a href="advanced-r-programming.html#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(all_texts) <span class="ot">&lt;-</span> n_files</span>
<span id="cb148-5"><a href="advanced-r-programming.html#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="co"># read all files listed in textfiles</span></span>
<span id="cb148-6"><a href="advanced-r-programming.html#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_files) {</span>
<span id="cb148-7"><a href="advanced-r-programming.html#cb148-7" aria-hidden="true" tabindex="-1"></a>     all_texts[[i]] <span class="ot">&lt;-</span> <span class="fu">fread</span>(textfiles[i])</span>
<span id="cb148-8"><a href="advanced-r-programming.html#cb148-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The imported files are now stored as <code>data.table</code>-objects in the list <code>all_texts</code>. With the following line of code we combine all of them in one <code>data.table</code>.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="advanced-r-programming.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combine all in one data.table</span></span>
<span id="cb149-2"><a href="advanced-r-programming.html#cb149-2" aria-hidden="true" tabindex="-1"></a>twitter_text <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(all_texts)</span>
<span id="cb149-3"><a href="advanced-r-programming.html#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check result</span></span>
<span id="cb149-4"><a href="advanced-r-programming.html#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(twitter_text)</span></code></pre></div>
<pre><code>## Classes &#39;data.table&#39; and &#39;data.frame&#39;:   42422 obs. of  3 variables:
##  $ V1:integer64 585978391360221184 585947808772960257 585947807816650752 585866060991078401 585794106170839041 585733482413891584 585733481608646657 585701601131765761 ... 
##  $ V2: chr  &quot;Thu Apr 09 01:31:50 +0000 2015&quot; &quot;Wed Apr 08 23:30:18 +0000 2015&quot; &quot;Wed Apr 08 23:30:18 +0000 2015&quot; &quot;Wed Apr 08 18:05:28 +0000 2015&quot; ...
##  $ V3: chr  &quot;Breast cancer risk test devised http://bbc.in/1CimpJF&quot; &quot;GP workload harming care - BMA poll http://bbc.in/1ChTBRv&quot; &quot;Short people&#39;s &#39;heart risk greater&#39; http://bbc.in/1ChTANp&quot; &quot;New approach against HIV &#39;promising&#39; http://bbc.in/1E6jAjt&quot; ...
##  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</code></pre>
<p>Alternatively, we can make use of <code>lapply</code> as follows in order to achieve exactly the same.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="advanced-r-programming.html#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare loop</span></span>
<span id="cb151-2"><a href="advanced-r-programming.html#cb151-2" aria-hidden="true" tabindex="-1"></a>all_texts <span class="ot">&lt;-</span> <span class="fu">lapply</span>(textfiles, fread)</span>
<span id="cb151-3"><a href="advanced-r-programming.html#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="co"># combine all in one data.table</span></span>
<span id="cb151-4"><a href="advanced-r-programming.html#cb151-4" aria-hidden="true" tabindex="-1"></a>twitter_text <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(all_texts)</span>
<span id="cb151-5"><a href="advanced-r-programming.html#cb151-5" aria-hidden="true" tabindex="-1"></a><span class="co"># check result</span></span>
<span id="cb151-6"><a href="advanced-r-programming.html#cb151-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(twitter_text)</span></code></pre></div>
<pre><code>## Classes &#39;data.table&#39; and &#39;data.frame&#39;:   42422 obs. of  3 variables:
##  $ V1:integer64 585978391360221184 585947808772960257 585947807816650752 585866060991078401 585794106170839041 585733482413891584 585733481608646657 585701601131765761 ... 
##  $ V2: chr  &quot;Thu Apr 09 01:31:50 +0000 2015&quot; &quot;Wed Apr 08 23:30:18 +0000 2015&quot; &quot;Wed Apr 08 23:30:18 +0000 2015&quot; &quot;Wed Apr 08 18:05:28 +0000 2015&quot; ...
##  $ V3: chr  &quot;Breast cancer risk test devised http://bbc.in/1CimpJF&quot; &quot;GP workload harming care - BMA poll http://bbc.in/1ChTBRv&quot; &quot;Short people&#39;s &#39;heart risk greater&#39; http://bbc.in/1ChTANp&quot; &quot;New approach against HIV &#39;promising&#39; http://bbc.in/1E6jAjt&quot; ...
##  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</code></pre>
<p>Finally, we can make use of <code>Vectorization()</code> in order to ‘vectorize’ (as far as possible) our own import function (written for this example).</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="advanced-r-programming.html#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initiate the import function</span></span>
<span id="cb153-2"><a href="advanced-r-programming.html#cb153-2" aria-hidden="true" tabindex="-1"></a>import_file <span class="ot">&lt;-</span> </span>
<span id="cb153-3"><a href="advanced-r-programming.html#cb153-3" aria-hidden="true" tabindex="-1"></a>     <span class="cf">function</span>(x) {</span>
<span id="cb153-4"><a href="advanced-r-programming.html#cb153-4" aria-hidden="true" tabindex="-1"></a>          parsed_x <span class="ot">&lt;-</span> <span class="fu">fread</span>(x)</span>
<span id="cb153-5"><a href="advanced-r-programming.html#cb153-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">return</span>(parsed_x)</span>
<span id="cb153-6"><a href="advanced-r-programming.html#cb153-6" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb153-7"><a href="advanced-r-programming.html#cb153-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-8"><a href="advanced-r-programming.html#cb153-8" aria-hidden="true" tabindex="-1"></a><span class="co"># &#39;vectorize&#39; it</span></span>
<span id="cb153-9"><a href="advanced-r-programming.html#cb153-9" aria-hidden="true" tabindex="-1"></a>import_files <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(import_file, <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>)</span>
<span id="cb153-10"><a href="advanced-r-programming.html#cb153-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-11"><a href="advanced-r-programming.html#cb153-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the vectorized function</span></span>
<span id="cb153-12"><a href="advanced-r-programming.html#cb153-12" aria-hidden="true" tabindex="-1"></a>all_texts <span class="ot">&lt;-</span> <span class="fu">import_files</span>(textfiles)</span>
<span id="cb153-13"><a href="advanced-r-programming.html#cb153-13" aria-hidden="true" tabindex="-1"></a>twitter_text <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(all_texts)</span>
<span id="cb153-14"><a href="advanced-r-programming.html#cb153-14" aria-hidden="true" tabindex="-1"></a><span class="co"># check the result</span></span>
<span id="cb153-15"><a href="advanced-r-programming.html#cb153-15" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(twitter_text)</span></code></pre></div>
<pre><code>## Classes &#39;data.table&#39; and &#39;data.frame&#39;:   42422 obs. of  3 variables:
##  $ V1:integer64 585978391360221184 585947808772960257 585947807816650752 585866060991078401 585794106170839041 585733482413891584 585733481608646657 585701601131765761 ... 
##  $ V2: chr  &quot;Thu Apr 09 01:31:50 +0000 2015&quot; &quot;Wed Apr 08 23:30:18 +0000 2015&quot; &quot;Wed Apr 08 23:30:18 +0000 2015&quot; &quot;Wed Apr 08 18:05:28 +0000 2015&quot; ...
##  $ V3: chr  &quot;Breast cancer risk test devised http://bbc.in/1CimpJF&quot; &quot;GP workload harming care - BMA poll http://bbc.in/1ChTBRv&quot; &quot;Short people&#39;s &#39;heart risk greater&#39; http://bbc.in/1ChTANp&quot; &quot;New approach against HIV &#39;promising&#39; http://bbc.in/1E6jAjt&quot; ...
##  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</code></pre>
</div>
</div>
<div id="r-beyond-r" class="section level3" number="4.5.4">
<h3><span class="header-section-number">4.5.4</span> R, beyond R</h3>
<p>So far, we have explored idiosyncrasies of R we should be aware of when writing programs to handle and analyze large data sets. While this has shown that R has many advantages for working with data, it also revealed some aspects of R that might result in low performance compared other programming languages. A simple generic explanation for this is that R is an <a href="https://en.wikipedia.org/wiki/Interpreted_language">interpreted language</a>, meaning that when we execute R code, it is processed (statement by statement) by an ‘interpreter’ that translates the code into machine code (without the user giving any specific instructions). In contrast, when writing code in a ‘compiled language,’ we first have to explicitly compile the code and then run the compiled program. Running code that is already compiled is typically much faster than running R code that has to be interpreted before it can actually be processed by the CPU.</p>
<p>For advanced programmers, R offers various options to directly make use of compiled programs (for example, written in C, C++, or FORTRAN). In fact several of the core R functions installed with the basic R distribution are implemented in one of these lower-level programming languages and the R function we call simply interacts with these functions.</p>
<p>We can actually investigate this by looking at the source code of an R function. When simply typing the name of a function (such as our <code>import_file()</code>) to the console, R is printing the function’s source code to the console.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="advanced-r-programming.html#cb155-1" aria-hidden="true" tabindex="-1"></a>import_file</span></code></pre></div>
<pre><code>## function(x) {
##           parsed_x &lt;- fread(x)
##           return(parsed_x)
##      }
## &lt;bytecode: 0x55dfebf891c8&gt;</code></pre>
<p>However, if we do the same for function <code>sum</code>, we don’t see any actual source code.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="advanced-r-programming.html#cb157-1" aria-hidden="true" tabindex="-1"></a>sum</span></code></pre></div>
<pre><code>## function (..., na.rm = FALSE)  .Primitive(&quot;sum&quot;)</code></pre>
<p>Instead <code>.Primitive()</code> indicates that <code>sum()</code> is actually referring to an internal function (in this case implemented in C).</p>
<p>While the use of functions implemented in a lower-level language is a common technique to improve the speed of ‘R’ functions, it is particularly prominent in the context of functions/packages made to deal with large amounts of data (such as the <code>data.table</code> package).</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="5">
<li id="fn5"><p>In the early days of R this was not really an issue because data sets that are rather large by today’s standards (in the Gigabytes) could not have been handled properly by normal computers anyhow (due to a lack of RAM).<a href="advanced-r-programming.html#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>We generate the numeric input by drawing vectors of (pseudo) random numbers via <code>rnorm()</code>.<a href="advanced-r-programming.html#fnref6" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="resource-allocation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="big-data-cleaning-and-transformation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 1
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bigdata.pdf", "bigdata.html", "bigdata.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
